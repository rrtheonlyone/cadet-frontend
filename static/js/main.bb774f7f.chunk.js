(this["webpackJsonpcadet-frontend"]=this["webpackJsonpcadet-frontend"]||[]).push([[0],{2431:function(e,t,a){"use strict";a.r(t);var s={};a.r(s),a.d(s,"browseReplHistoryDown",(function(){return I})),a.d(s,"browseReplHistoryUp",(function(){return k})),a.d(s,"changeExternalLibrary",(function(){return P})),a.d(s,"changeEditorHeight",(function(){return x})),a.d(s,"changeEditorWidth",(function(){return R})),a.d(s,"changeExecTime",(function(){return N})),a.d(s,"changeSideContentHeight",(function(){return M})),a.d(s,"chapterSelect",(function(){return _})),a.d(s,"externalLibrarySelect",(function(){return D})),a.d(s,"toggleEditorAutorun",(function(){return L})),a.d(s,"updateActiveTab",(function(){return j})),a.d(s,"beginClearContext",(function(){return B})),a.d(s,"clearReplInput",(function(){return G})),a.d(s,"clearReplOutput",(function(){return U})),a.d(s,"clearReplOutputLast",(function(){return V})),a.d(s,"endClearContext",(function(){return H})),a.d(s,"ensureLibrariesLoaded",(function(){return F})),a.d(s,"evalEditor",(function(){return q})),a.d(s,"evalRepl",(function(){return X})),a.d(s,"evalTestcase",(function(){return W})),a.d(s,"updateEditorValue",(function(){return z})),a.d(s,"setEditorBreakpoint",(function(){return Y})),a.d(s,"highlightEditorLine",(function(){return $})),a.d(s,"updateReplValue",(function(){return K})),a.d(s,"sendReplInputToOutput",(function(){return Q})),a.d(s,"resetTestcase",(function(){return J})),a.d(s,"navigateToDeclaration",(function(){return Z})),a.d(s,"moveCursor",(function(){return ee})),a.d(s,"resetWorkspace",(function(){return te})),a.d(s,"updateWorkspace",(function(){return ae})),a.d(s,"setEditorReadonly",(function(){return se})),a.d(s,"updateCurrentAssessmentId",(function(){return ne})),a.d(s,"updateCurrentSubmissionId",(function(){return ie})),a.d(s,"updateHasUnsavedChanges",(function(){return re})),a.d(s,"fetchChapter",(function(){return oe})),a.d(s,"changeChapter",(function(){return le})),a.d(s,"updateChapter",(function(){return ce})),a.d(s,"promptAutocomplete",(function(){return de})),a.d(s,"notifyProgramEvaluated",(function(){return ue}));var n={};a.r(n),a.d(n,"logOut",(function(){return he}));var i={};a.r(i),a.d(i,"fetchAuth",(function(){return me})),a.d(i,"fetchAssessment",(function(){return ge})),a.d(i,"fetchAssessmentOverviews",(function(){return ye})),a.d(i,"fetchGrading",(function(){return Ee})),a.d(i,"fetchGradingOverviews",(function(){return be})),a.d(i,"login",(function(){return ve})),a.d(i,"logoutGoogle",(function(){return Se})),a.d(i,"setGameState",(function(){return fe})),a.d(i,"setTokens",(function(){return Ce})),a.d(i,"setUser",(function(){return we})),a.d(i,"setGoogleUser",(function(){return Ae})),a.d(i,"submitAnswer",(function(){return Oe})),a.d(i,"submitAssessment",(function(){return Te})),a.d(i,"submitGrading",(function(){return Ie})),a.d(i,"submitGradingAndContinue",(function(){return ke})),a.d(i,"updateHistoryHelpers",(function(){return Pe})),a.d(i,"updateAssessmentOverviews",(function(){return xe})),a.d(i,"updateAssessment",(function(){return Re})),a.d(i,"updateGradingOverviews",(function(){return Ne})),a.d(i,"updateGrading",(function(){return Me})),a.d(i,"unsubmitSubmission",(function(){return _e})),a.d(i,"fetchNotifications",(function(){return De})),a.d(i,"acknowledgeNotifications",(function(){return Le})),a.d(i,"updateNotifications",(function(){return je}));var r={};a.r(r),a.d(r,"handleConsoleLog",(function(){return Ze})),a.d(r,"evalInterpreterSuccess",(function(){return et})),a.d(r,"evalTestcaseSuccess",(function(){return tt})),a.d(r,"evalTestcaseFailure",(function(){return at})),a.d(r,"evalInterpreterError",(function(){return st})),a.d(r,"beginInterruptExecution",(function(){return nt})),a.d(r,"endInterruptExecution",(function(){return it})),a.d(r,"beginDebuggerPause",(function(){return rt})),a.d(r,"endDebuggerPause",(function(){return ot})),a.d(r,"debuggerResume",(function(){return lt})),a.d(r,"debuggerReset",(function(){return ct}));var o={};a.r(o),a.d(o,"fetchGroupGradingSummary",(function(){return Ys})),a.d(o,"updateGroupGradingSummary",(function(){return $s}));var l={};a.r(l),a.d(l,"finishInvite",(function(){return xi})),a.d(l,"initInvite",(function(){return Ri})),a.d(l,"invalidEditorSessionId",(function(){return Ni})),a.d(l,"setEditorSessionId",(function(){return Mi})),a.d(l,"setWebsocketStatus",(function(){return _i}));var c={};a.r(c),a.d(c,"saveCanvas",(function(){return Di}));var d={};a.r(d),a.d(d,"changeDateAssessment",(function(){return Li})),a.d(d,"deleteAssessment",(function(){return ji})),a.d(d,"publishAssessment",(function(){return Bi})),a.d(d,"uploadAssessment",(function(){return Gi}));var u={};a.r(u),a.d(u,"persistenceOpenPicker",(function(){return Ui})),a.d(u,"persistenceSaveFile",(function(){return Vi})),a.d(u,"persistenceSaveFileAs",(function(){return Hi})),a.d(u,"persistenceInitialise",(function(){return Fi}));var h={};a.r(h),a.d(h,"generateLzString",(function(){return qi})),a.d(h,"shortenURL",(function(){return Xi})),a.d(h,"updateShortURL",(function(){return Wi})),a.d(h,"toggleUsingSubst",(function(){return zi})),a.d(h,"changeQueryString",(function(){return Yi})),a.d(h,"playgroundUpdatePersistenceFile",(function(){return $i}));var p={};a.r(p),a.d(p,"fetchSourcecastIndex",(function(){return Ki})),a.d(p,"updateSourcecastIndex",(function(){return Qi}));var m={};a.r(m),a.d(m,"saveSourcecastData",(function(){return Ji})),a.d(m,"setCurrentPlayerTime",(function(){return Zi})),a.d(m,"setCodeDeltasToApply",(function(){return er})),a.d(m,"setInputToApply",(function(){return tr})),a.d(m,"setSourcecastData",(function(){return ar})),a.d(m,"setSourcecastDuration",(function(){return sr})),a.d(m,"setSourcecastStatus",(function(){return nr}));var g={};a.r(g),a.d(g,"deleteSourcecastEntry",(function(){return ir})),a.d(g,"recordInit",(function(){return rr})),a.d(g,"recordInput",(function(){return or})),a.d(g,"resetInputs",(function(){return lr})),a.d(g,"timerPause",(function(){return cr})),a.d(g,"timerReset",(function(){return dr})),a.d(g,"timerResume",(function(){return ur})),a.d(g,"timerStart",(function(){return hr})),a.d(g,"timerStop",(function(){return pr}));a(892);var y=a(2436),E=a(237),b=a(294),v=a(0),S=a.n(v),f=a(42),C=a(20),w=a(15),A=a(21),O=a(10);let T;!function(e){e.autograder="autograder",e.briefing="briefing",e.dataVisualiser="data_visualiser",e.editorGrading="editor_grading",e.editorAutograder="editor_autograder",e.editorBriefing="editor_briefing",e.editorGlobalDeployment="editor_global_deployment",e.editorGlobalGraderDeployment="editor_global_grader_deployment",e.editorLocalDeployment="editor_local_deployment",e.editorLocalGraderDeployment="editor_local_grader_deployment",e.editorManageQuestion="editor_manage_question",e.editorQuestionOverview="editor_question_overview",e.editorQuestionTemplate="editor_question_template",e.envVisualiser="env_visualiser",e.grading="grading",e.introduction="introduction",e.inspector="inspector",e.questionOverview="question_overview",e.sourcereel="sourcereel",e.substVisualizer="subst_visualiser",e.toneMatrix="tone_matrix"}(T||(T={}));const I=e=>Object(O.action)("BROWSE_REPL_HISTORY_DOWN",{workspaceLocation:e}),k=e=>Object(O.action)("BROWSE_REPL_HISTORY_UP",{workspaceLocation:e}),P=(e,t)=>Object(O.action)("CHANGE_EXTERNAL_LIBRARY",{newExternal:e,workspaceLocation:t}),x=(e,t)=>Object(O.action)("CHANGE_EDITOR_HEIGHT",{height:e,workspaceLocation:t}),R=(e,t)=>Object(O.action)("CHANGE_EDITOR_WIDTH",{widthChange:e,workspaceLocation:t}),N=(e,t)=>Object(O.action)("CHANGE_EXEC_TIME",{execTime:e,workspaceLocation:t}),M=(e,t)=>Object(O.action)("CHANGE_SIDE_CONTENT_HEIGHT",{height:e,workspaceLocation:t}),_=(e,t,a)=>Object(O.action)("CHAPTER_SELECT",{chapter:e,variant:t,workspaceLocation:a}),D=(e,t)=>Object(O.action)("PLAYGROUND_EXTERNAL_SELECT ",{externalLibraryName:e,workspaceLocation:t}),L=e=>Object(O.action)("TOGGLE_EDITOR_AUTORUN",{workspaceLocation:e}),j=(e,t)=>Object(O.action)("UPDATE_ACTIVE_TAB",{activeTab:e,workspaceLocation:t}),B=(e,t)=>Object(O.action)("BEGIN_CLEAR_CONTEXT",{library:e,workspaceLocation:t}),G=e=>Object(O.action)("CLEAR_REPL_INPUT",{workspaceLocation:e}),U=e=>Object(O.action)("CLEAR_REPL_OUTPUT",{workspaceLocation:e}),V=e=>Object(O.action)("CLEAR_REPL_OUTPUT_LAST",{workspaceLocation:e}),H=(e,t)=>Object(O.action)("END_CLEAR_CONTEXT",{library:e,workspaceLocation:t}),F=()=>Object(O.action)("ENSURE_LIBRARIES_LOADED"),q=e=>Object(O.action)("EVAL_EDITOR",{workspaceLocation:e}),X=e=>Object(O.action)("EVAL_REPL",{workspaceLocation:e}),W=(e,t)=>Object(O.action)("EVAL_TESTCASE",{workspaceLocation:e,testcaseId:t}),z=(e,t)=>Object(O.action)("UPDATE_EDITOR_VALUE",{newEditorValue:e,workspaceLocation:t}),Y=(e,t)=>Object(O.action)("UPDATE_EDITOR_BREAKPOINTS",{breakpoints:e,workspaceLocation:t}),$=(e,t)=>Object(O.action)("HIGHLIGHT_LINE",{highlightedLines:e,workspaceLocation:t}),K=(e,t)=>Object(O.action)("UPDATE_REPL_VALUE",{newReplValue:e,workspaceLocation:t}),Q=(e,t)=>Object(O.action)("SEND_REPL_INPUT_TO_OUTPUT",{type:"code",workspaceLocation:t,value:e}),J=(e,t)=>Object(O.action)("RESET_TESTCASE",{workspaceLocation:e,index:t}),Z=(e,t)=>Object(O.action)("NAV_DECLARATION",{workspaceLocation:e,cursorPosition:t}),ee=(e,t)=>Object(O.action)("MOVE_CURSOR",{workspaceLocation:e,cursorPosition:t}),te=(e,t)=>Object(O.action)("RESET_WORKSPACE",{workspaceLocation:e,workspaceOptions:t}),ae=(e,t)=>Object(O.action)("UPDATE_WORKSPACE",{workspaceLocation:e,workspaceOptions:t}),se=(e,t)=>Object(O.action)("SET_EDITOR_READONLY",{workspaceLocation:e,editorReadonly:t}),ne=(e,t)=>Object(O.action)("UPDATE_CURRENT_ASSESSMENT_ID",{assessmentId:e,questionId:t}),ie=(e,t)=>Object(O.action)("UPDATE_CURRENT_SUBMISSION_ID",{submissionId:e,questionId:t}),re=(e,t)=>Object(O.action)("UPDATE_HAS_UNSAVED_CHANGES",{workspaceLocation:e,hasUnsavedChanges:t}),oe=()=>Object(O.action)("FETCH_CHAPTER"),le=(e,t)=>Object(O.action)("CHANGE_CHAPTER",{chapter:e,variant:t}),ce=(e,t)=>Object(O.action)("UPDATE_CHAPTER",{chapter:e,variant:t}),de=(e,t,a,s)=>Object(O.action)("PROMPT_AUTOCOMPLETE",{workspaceLocation:e,row:t,column:a,callback:s}),ue=(e,t,a,s,n)=>Object(O.action)("NOTIFY_PROGRAM_EVALUATED",{result:e,lastDebuggerResult:t,code:a,context:s,workspaceLocation:n}),he=()=>Object(O.action)("LOG_OUT");var pe=a(166);const me=(e,t)=>Object(O.action)("FETCH_AUTH",{code:e,providerId:t}),ge=e=>Object(O.action)("FETCH_ASSESSMENT",e),ye=()=>Object(O.action)("FETCH_ASSESSMENT_OVERVIEWS"),Ee=e=>Object(O.action)("FETCH_GRADING",e),be=(e=!0)=>Object(O.action)("FETCH_GRADING_OVERVIEWS",e),ve=e=>Object(O.action)("LOGIN",e),Se=()=>Object(O.action)("LOGOUT_GOOGLE"),fe=e=>Object(O.action)("SET_GAME_STATE",e),Ce=({accessToken:e,refreshToken:t})=>Object(O.action)("SET_TOKENS",{accessToken:e,refreshToken:t}),we=e=>Object(O.action)("SET_USER",e),Ae=e=>Object(O.action)("SET_GOOGLE_USER",e),Oe=(e,t)=>Object(O.action)("SUBMIT_ANSWER",{id:e,answer:t}),Te=e=>Object(O.action)("SUBMIT_ASSESSMENT",e),Ie=(e,t,a=0,s=0,n)=>Object(O.action)("SUBMIT_GRADING",{submissionId:e,questionId:t,gradeAdjustment:a,xpAdjustment:s,comments:n}),ke=(e,t,a=0,s=0,n)=>Object(O.action)("SUBMIT_GRADING_AND_CONTINUE",{submissionId:e,questionId:t,gradeAdjustment:a,xpAdjustment:s,comments:n}),Pe=e=>Object(O.action)("UPDATE_HISTORY_HELPERS",e),xe=e=>Object(O.action)("UPDATE_ASSESSMENT_OVERVIEWS",e),Re=e=>Object(O.action)("UPDATE_ASSESSMENT",e),Ne=e=>Object(O.action)("UPDATE_GRADING_OVERVIEWS",e),Me=(e,t)=>Object(O.action)("UPDATE_GRADING",{submissionId:e,grading:t}),_e=e=>Object(O.action)("UNSUBMIT_SUBMISSION",{submissionId:e}),De=()=>Object(O.action)("FETCH_NOTIFICATIONS"),Le=e=>Object(O.action)("ACKNOWLEDGE_NOTIFICATIONS",{withFilter:e}),je=e=>Object(O.action)("UPDATE_NOTIFICATIONS",e);let Be,Ge,Ue;function Ve(e){return"string"===typeof e&&"TRUE"===e.toUpperCase()}!function(e){e.run="run"}(Be||(Be={})),function(e){e.playing="playing",e.paused="paused"}(Ge||(Ge={})),function(e){e.notStarted="notStarted",e.recording="recording",e.paused="paused",e.finished="finished"}(Ue||(Ue={}));const He=Ve("FALSE"),Fe=Ve("TRUE"),qe=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""}).REACT_APP_SENTRY_DSN,Xe=new Map;for(let ng=1;;++ng){const e=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})["REACT_APP_OAUTH2_PROVIDER"+ng];if(!e)break;const t=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})[`REACT_APP_OAUTH2_PROVIDER${ng}_NAME`]||"Unnamed provider",a=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})[`REACT_APP_OAUTH2_PROVIDER${ng}_ENDPOINT`]||"";Xe.set(e,{name:t,endpoint:a,isDefault:1===ng})}let We;!function(e){e.githubIssues="https://github.com/source-academy/cadet-frontend/issues",e.githubOrg="https://github.com/source-academy",e.moduleDetails="https://www.comp.nus.edu.sg/~cs1101s",e.luminus="https://luminus.nus.edu.sg/modules/41d42e9a-5880-43b5-8ee6-75f5a41355e3/announcements/active",e.piazza="https://piazza.com/class/kas136yscf8605",e.shareDBServer="api2.sourceacademy.nus.edu.sg/",e.sourceDocs="https://source-academy.github.io/source/",e.sourceDocsChapter2_2="https://source-academy.github.io/sicp/chapters/2.2.html",e.sourceDocsChapter3_2="https://source-academy.github.io/sicp/chapters/3.2.html",e.techSVC="mailto:techsvc@comp.nus.edu.sg",e.techSVCNumber="6516 2736",e.textbook="https://source-academy.github.io/sicp/",e.aceHotkeys="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts",e.sourceHotkeys="https://github.com/source-academy/cadet-frontend/wiki/Source-Academy-Keyboard-Shortcuts",e.source_1="https://source-academy.github.io/source/source_1/",e.source_1_Lazy="https://source-academy.github.io/source/source_1_lazy/",e.source_1_Wasm="https://source-academy.github.io/source/source_1_wasm/",e.source_2="https://source-academy.github.io/source/source_2/",e.source_2_Lazy="https://source-academy.github.io/source/source_2_lazy/",e.source_3="https://source-academy.github.io/source/source_1/",e.source_3_Concurrent="https://source-academy.github.io/source/source_3_concurrent/",e.source_3_Nondet="https://source-academy.github.io/source/source_3_non-det/",e.source_4="https://source-academy.github.io/source/source_4/",e.source_4_Gpu="https://source-academy.github.io/source/source_4_gpu/"}(We||(We={}));var ze={sourceAcademyVersion:"rr_test",backendUrl:"http://localhost:4000",useBackend:He,defaultSourceChapter:4,defaultSourceVariant:"default",defaultQuestionId:0,maxBrowseIndex:50,urlShortener:"",urlShortenerSignature:"",moduleBackendUrl:"https://source-academy.github.io/modules",authProviders:Xe,playgroundOnly:Fe,sentryDsn:qe,googleClientId:"",googleApiKey:"",googleAppId:""},Ye=a(146),$e=a.n(Ye),Ke=a(59),Qe=a(39),Je=a.n(Qe);const Ze=(e,t)=>Object(O.action)("HANDLE_CONSOLE_LOG",{logString:e,workspaceLocation:t}),et=(e,t)=>Object(O.action)("EVAL_INTERPRETER_SUCCESS",{type:"result",value:e,workspaceLocation:t}),tt=(e,t,a)=>Object(O.action)("EVAL_TESTCASE_SUCCESS",{type:"result",value:e,workspaceLocation:t,index:a}),at=(e,t,a)=>Object(O.action)("EVAL_TESTCASE_FAILURE",{type:"errors",value:e,workspaceLocation:t,index:a}),st=(e,t)=>Object(O.action)("EVAL_INTERPRETER_ERROR",{type:"errors",errors:e,workspaceLocation:t}),nt=e=>Object(O.action)("BEGIN_INTERRUPT_EXECUTION",{workspaceLocation:e}),it=e=>Object(O.action)("END_INTERRUPT_EXECUTION",{workspaceLocation:e}),rt=e=>Object(O.action)("BEGIN_DEBUG_PAUSE",{workspaceLocation:e}),ot=e=>Object(O.action)("END_DEBUG_PAUSE",{workspaceLocation:e}),lt=e=>Object(O.action)("DEBUG_RESUME",{workspaceLocation:e}),ct=e=>Object(O.action)("DEBUG_RESET",{workspaceLocation:e});function dt(e){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.highlightClean(),window.Inspector.highlightLine(e)}function ut(e){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.updateContext(e,Ke.stringify)}const ht={display:function e(t,a,s){return e((void 0===a?"":a+" ")+Object(Ke.stringify)(t),"",s),t},rawDisplay:function(e,t,a){const s=(void 0===t?"":t+" ")+String(e);return"undefined"!==typeof window.__REDUX_STORE__&&window.__REDUX_STORE__.dispatch(Ze(s,a)),e},prompt:function(e){return prompt(e)},alert:function(e){alert(Object(Ke.stringify)(e))},visualiseList:function(e){if(window.ListVisualizer)return window.ListVisualizer.draw(e),e;throw new Error("List visualizer is not enabled")}};function pt(e,t,a,s="default",n){return $e()(e,s,t,a,ht,n)}function mt(e){function t(){}t.prototype=e.runtime.environments[0].head;const a=new t,s=new Proxy(e.runtime.environments[0],{get:(e,t,s)=>"head"===t?a:e[t]}),n=new Proxy(e.runtime.environments,{get:(e,t,a)=>"0"===t?s:e[t]}),i=new Proxy(e.runtime,{get:(e,t,a)=>"environments"===t?n:e[t]}),r=new Proxy(e,{get(e,t,a){switch(t){case"chapter":return 4;case"runtime":return i;default:return e[t]}}});var o,l;return o=r,l=ht,Object(Ye.importBuiltins)(o,l),Object(Ye.defineBuiltin)(o,"makeUndefinedErrorFunction",e=>()=>{throw new Error(`Name ${e} not declared.`)}),r}function gt(e,t){const a=e.runtime.environments[0].head,s=t.runtime.environments[0].head;return Object(Qe.difference)(Object(Qe.keys)(a),Object(Qe.keys)(s))}let yt;!function(e){e.NONE="NONE",e.RUNES="RUNES",e.CURVES="CURVES",e.SOUNDS="SOUNDS",e.BINARYTREES="BINARYTREES",e.PIXNFLIX="PIX&FLIX",e.MACHINELEARNING="MACHINELEARNING",e.ALL="ALL"}(yt||(yt={}));const Et=["show","color","random_color","red","pink","purple","indigo","blue","green","yellow","orange","brown","black","white","scale_independent","scale","translate","rotate","stack_frac","stack","stackn","quarter_turn_right","quarter_turn_left","turn_upside_down","beside_frac","beside","flip_vert","flip_horiz","make_cross","repeat_pattern","square","blank","rcross","sail","corner","nova","circle","heart","pentagram","ribbon","anaglyph","overlay_frac","overlay","hollusion"],bt=["make_point","draw_points_on","draw_connected","draw_points_squeezed_to_window","draw_connected_squeezed_to_window","draw_connected_full_view","draw_connected_full_view_proportional","x_of","y_of","unit_line","unit_line_at","unit_circle","connect_rigidly","connect_ends","put_in_standard_position","translate","scale","rotate_pi_over_2","scale_x_y","gosperize","gosper_curve","show_connected_gosper","repeated","param_gosper","param_gosperize","rotate_around_origin","arc","invert","alternative_unit_circle","full_view_proportional","squeeze_full_view","squeeze_rectangular_portion"],vt=["make_sound","get_wave","get_duration","play","stop","consecutively","simultaneously","noise_sound","sine_sound","silence_sound","letter_name_to_midi_note","letter_name_to_frequency","midi_note_to_frequency","square_sound","triangle_sound","sawtooth_sound","play_unsafe","display_waveform","init_record","record","record_for","adsr","stacking_adsr","trombone","piano","bell","violin","cello"],St=["make_empty_tree","is_tree","make_tree","is_empty_tree","entry","left_branch","right_branch"],ft=["red_of","green_of","blue_of","set_rgb","copy_pixel","copy_image","constrain_color","compose_filter","make_distortion_filter","make_static_distortion_filter","pixel_similar","get_video_width","get_video_height","apply_filter","reset_filter"],Ct=[[yt.NONE,[]],[yt.RUNES,Et],[yt.CURVES,bt],[yt.SOUNDS,vt],[yt.BINARYTREES,St],[yt.PIXNFLIX,ft],[yt.MACHINELEARNING,["init_webcam","train_recognition","load_faceapi","change_label","array_push","normalise_data"]],[yt.ALL,Et.concat(bt,vt,St,ft)]],wt=new Map(Ct);let At,Ot;!function(e){e.Development="development",e.Production="production",e.Test="test"}(At||(At={})),function(e){e.Student="student",e.Staff="staff",e.Admin="admin"}(Ot||(Ot={}));const Tt=[{chapter:1,variant:"default"},{chapter:1,variant:"wasm"},{chapter:1,variant:"lazy"},{chapter:2,variant:"default"},{chapter:2,variant:"lazy"},{chapter:3,variant:"default"},{chapter:3,variant:"concurrent"},{chapter:3,variant:"non-det"},{chapter:4,variant:"default"},{chapter:4,variant:"gpu"}],It=new Map([["wasm","WebAssembly"],["non-det","Non-Det"],["concurrent","Concurrent"],["lazy","Lazy"],["gpu","GPU"]]),kt=(e,t="default")=>{let a="Source \xa7"+e;return It.has(t)&&(a+=" "+It.get(t)),a},Pt={gameCanvas:void 0},xt={title:"Cadet",environment:At.Production},Rt={gradingSummary:[]},Nt={usingSubst:!1},Mt=e=>({autogradingResults:[],breakpoints:[],context:pt(ze.defaultSourceChapter,[],e,ze.defaultSourceVariant),editorPrepend:"",editorSessionId:"",editorValue:"// Type your program in here!",editorPostpend:"",editorReadonly:!1,editorTestcases:[],editorHeight:150,editorWidth:"50%",externalLibrary:yt.NONE,execTime:1e3,highlightedLines:[],output:[],replHistory:{browseIndex:null,records:[],originalValue:""},replValue:"",sharedbAceInitValue:"",sharedbAceIsInviting:!1,sideContentActiveTab:T.questionOverview,websocketStatus:0,globals:[],isEditorAutorun:!1,isRunning:!1,isDebugging:!1,enableDebugging:!0,debuggerContext:{}}),_t={assessment:{...Mt("assessment"),currentAssessment:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},grading:{...Mt("grading"),currentSubmission:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},playground:{...Mt("playground"),usingSubst:!1},sourcecast:{...Mt("sourcecast"),audioUrl:"",codeDeltasToApply:null,currentPlayerTime:0,description:null,inputToApply:null,playbackData:{init:{editorValue:"",chapter:1,externalLibrary:yt.NONE},inputs:[]},playbackDuration:0,playbackStatus:Ge.paused,sourcecastIndex:null,title:null},sourcereel:{...Mt("sourcereel"),playbackData:{init:{editorValue:"",chapter:1,externalLibrary:yt.NONE},inputs:[]},recordingStatus:Ue.notStarted,timeElapsedBeforePause:0,timeResumed:0}},Dt={accessToken:void 0,assessments:new Map,assessmentOverviews:void 0,grade:0,gradingOverviews:void 0,gradings:new Map,group:null,historyHelper:{lastAcademyLocations:[null,null],lastGeneralLocations:[null,null]},maxGrade:0,maxXp:0,refreshToken:void 0,role:void 0,name:void 0,story:{story:"",playStory:!1},gameState:{completed_quests:[],collectibles:{}},xp:0,notifications:[]},Lt={academy:Pt,application:xt,dashboard:Rt,playground:Nt,session:Dt,workspaces:_t},jt=(e=Dt,t)=>{switch(t.type){case"LOG_OUT":return Dt;case"SET_TOKENS":return{...e,accessToken:t.payload.accessToken,refreshToken:t.payload.refreshToken};case"SET_USER":return{...e,...t.payload};case"SET_GOOGLE_USER":return{...e,googleUser:t.payload};case"UPDATE_HISTORY_HELPERS":const a=e.historyHelper,s=null!=Bt.exec(t.payload)?[a.lastAcademyLocations[1],t.payload]:[...a.lastAcademyLocations],n=[a.lastGeneralLocations[1],t.payload];return{...e,historyHelper:{lastAcademyLocations:s,lastGeneralLocations:n}};case"UPDATE_ASSESSMENT":const i=new Map(e.assessments);return i.set(t.payload.id,t.payload),{...e,assessments:i};case"UPDATE_ASSESSMENT_OVERVIEWS":return{...e,assessmentOverviews:t.payload};case"UPDATE_GRADING":const r=new Map(e.gradings);return r.set(t.payload.submissionId,t.payload.grading),{...e,gradings:r};case"UPDATE_GRADING_OVERVIEWS":return{...e,gradingOverviews:t.payload};case"UPDATE_NOTIFICATIONS":return{...e,notifications:t.payload};case"SET_GAME_STATE":return{...e,gameState:t.payload};default:return e}},Bt=new RegExp("^/academy.*","i");var Gt=a(1),Ut=a(4),Vt=a(45),Ht=a(316),Ft=a.n(Ht),qt=a(8),Xt=a.n(qt);let Wt,zt,Yt,$t,Kt;!function(e){e.attempting="attempting",e.attempted="attempted",e.not_attempted="not_attempted",e.submitted="submitted"}(Wt||(Wt={})),function(e){e.excluded="excluded",e.graded="graded",e.grading="grading",e.none="none"}(zt||(zt={})),function(e){e.Contest="Contest",e.Mission="Mission",e.Path="Path",e.Sidequest="Sidequest",e.Practical="Practical"}(Yt||(Yt={})),function(e){e.public="public",e.hidden="hidden",e.private="private"}($t||($t={})),function(e){e.programming="programming",e.mcq="mcq"}(Kt||(Kt={}));const Qt=()=>({category:Yt.Mission,closeAt:"2100-12-01T00:00+08",coverImage:"https://fakeimg.pl/300/",grade:1,id:-1,maxGrade:0,maxXp:0,openAt:"2000-01-01T00:00+08",title:"Insert title here",reading:"",shortSummary:"Insert short summary here",status:Wt.not_attempted,story:"mission",xp:0,gradingStatus:"none"}),Jt=()=>({autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}),Zt=()=>({answer:3,roomId:null,content:"This is a mock MCQ question",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:2,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},type:"mcq",solution:0,xp:0,grade:0,maxGrade:0,maxXp:0});var ea=a(2437);function ta(e){const t=Tt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:kt(e.chapter,e.variant)})),a=({items:e,itemsParentRef:t,query:a,renderItem:s})=>{const n=e.filter(e=>"default"===e.variant).map(s),i=e.filter(e=>"default"!==e.variant).map(s);return v.createElement(Gt.Menu,{ulRef:t},n,v.createElement(Gt.MenuItem,{active:!1,key:"variant-menu",text:"Variant",icon:"cog"},i))},s=(e,{handleClick:t})=>v.createElement(Gt.MenuItem,{active:!1,key:e.chapter+e.variant,onClick:t,text:e.displayName}),n=ea.a.ofType();return((e,i,r=((e,t)=>{}),o)=>v.createElement(n,{className:Gt.Classes.MINIMAL,items:t,onItemSelect:r,itemRenderer:s,itemListRenderer:a,filterable:!1,disabled:o||!1},((e,t,a)=>v.createElement("div",null,v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:kt(e,t),rightIcon:a?null:Ut.a.DOUBLE_CARET_VERTICAL,disabled:a||!1})))(e,i,o)))(e.sourceChapter,e.sourceVariant,e.handleChapterSelect,e.disabled||!1)}const aa={className:"",fullWidth:!1,iconOnRight:!1,intent:Gt.Intent.NONE,minimal:!0};var sa=(e,t,a=null,s={},n=!1)=>{const i={...aa,...s},r={disabled:n};if(r.fill=void 0!==i.fullWidth&&i.fullWidth,r.intent=void 0===i.intent?Gt.Intent.NONE:i.intent,r.minimal=void 0!==i.minimal&&i.minimal,r.className=i.className,r.type=i.type,t){const e=v.createElement(Gt.Icon,{icon:t,color:i.iconColor?i.iconColor:void 0});i.iconOnRight?r.rightIcon=e:r.icon=e}return a&&(r.onClick=a),v.createElement(Gt.Button,r,e)};function na(e){return sa("Clear",Ut.a.REMOVE,e.handleReplOutputClear)}function ia(e){return e.isRunning?null:v.createElement(Gt.Tooltip,{content:"...or press shift-enter in the REPL"},sa("Eval",Ut.a.CODE,e.handleReplEval))}function ra(e){return sa("Return to Academy",Ut.a.ARROW_RIGHT,e.onClick,{iconOnRight:!0})}function oa(e){return e.questionProgress[0]===e.questionProgress[1]?v.createElement(ra,{onClick:e.onClickReturn,key:"return_to_academy"}):sa("Next",Ut.a.ARROW_RIGHT,e.onClickNext,{iconOnRight:!0})}function la(e){return e.questionProgress[0]<=1?null:sa("Previous",Ut.a.ARROW_LEFT,e.onClick)}function ca(e){return sa(`Question ${e.questionProgress[0]} of ${e.questionProgress[1]}  `,null,null,{},!0)}function da(e){return sa("Reset",Ut.a.REPEAT,e.onClick)}function ua(e){return v.createElement(Gt.Tooltip,{content:"...or press shift-enter in the editor"},sa("Run",Ut.a.PLAY,e.handleEditorEval))}function ha(e){const t=e.hasUnsavedChanges?{intent:Gt.Intent.WARNING,minimal:!1}:{};return sa("Save",Ut.a.FLOPPY_DISK,e.onClickSave,t)}var pa=a(857);var ma=v.memo(e=>{const t=new pa.Converter({tables:!0,simplifiedAutoLink:e.simplifiedAutoLink,strikethrough:e.strikethrough,tasklists:e.tasklists,openLinksInNewWindow:e.openLinksInNewWindow});return v.createElement("div",{className:Xt()(e.className?e.className:"md",Gt.Classes.RUNNING_TEXT),dangerouslySetInnerHTML:{__html:t.makeHtml(e.content)}})}),ga=a(30);class ya extends v.Component{constructor(...e){super(...e),this.$parent=null}componentDidMount(){this.$parent.appendChild(this.props.canvas),this.props.canvas.hidden=!1}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:"canvas-container"})}}var Ea=ya;class ba extends v.Component{constructor(...e){super(...e),this.evalSelf=()=>{this.props.handleTestcaseEval(this.props.index)}}render(){const e=void 0!==this.props.testcase.result||this.props.testcase.errors,t=Object(Ke.stringify)(this.props.testcase.result)===this.props.testcase.answer,a={correct:e&&t,wrong:e&&!t,private:this.props.testcase.type===$t.private};return this.props.testcase.type===$t.hidden?v.createElement("div",{className:Xt()("AutograderCard",a)},v.createElement(Gt.Card,{className:"bp3-interactive",elevation:Gt.Elevation.ONE,onClick:this.evalSelf},v.createElement(Gt.Pre,{className:"testcase-placeholder"},"Hidden testcase"))):v.createElement("div",{className:Xt()("AutograderCard",a)},v.createElement(Gt.Card,{className:Gt.Classes.INTERACTIVE,elevation:Gt.Elevation.ONE,onClick:this.evalSelf},v.createElement(Gt.Pre,{className:"testcase-program"},this.props.testcase.program),v.createElement(Gt.Pre,{className:"testcase-expected"},this.props.testcase.answer),v.createElement(Gt.Pre,{className:"testcase-actual"},this.props.testcase.errors?Object(ga.parseError)(this.props.testcase.errors):void 0!==this.props.testcase.result?(e=>{const t=window.ShapeDrawn;return"undefined"!==typeof t&&e instanceof t?v.createElement(Ea,{canvas:e.$canvas}):Object(Ke.stringify)(e)})(this.props.testcase.result):"No Answer")))}}var va=ba;class Sa extends v.Component{render(){const e="pass"===this.props.result.resultType?" correct":" wrong";return v.createElement("div",{className:"ResultCard"+e},v.createElement(Gt.Card,{elevation:Gt.Elevation.ONE},v.createElement("div",{className:"result-data"},v.createElement("div",{className:"result-idx"},this.props.index+1),v.createElement("div",{className:"result-status"},this.props.result.resultType.toUpperCase())),v.createElement(Gt.Pre,{className:"result-expected"},this.props.result.expected),v.createElement(Gt.Pre,{className:"result-actual"},"error"===this.props.result.resultType?this.props.result.errors.map(e=>"timeout"===e.errorType?"Timeout: Submission exceeded time limit for this test case.":`Line ${e.line}: Error: ${e.errorExplanation}`).join("\n"):this.props.result.actual)))}}var fa=Sa;class Ca extends v.Component{constructor(e){super(e),this.toggleTestcases=()=>this.setState({...this.state,showTestcases:!this.state.showTestcases}),this.toggleResults=()=>this.setState({...this.state,showResults:!this.state.showResults}),this.state={showTestcases:!0,showResults:!0}}render(){const e=v.createElement("div",{className:"testcases-header"},v.createElement("div",{className:"header-fn"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Testcase (click to run)"),v.createElement("div",{className:"header-expected"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Expected result"),v.createElement("div",{className:"header-actual"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Actual result")),t=v.createElement("div",{className:"results-header"},v.createElement("div",{className:"header-data"},v.createElement("div",{className:"header-sn"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"S/N"),v.createElement("div",{className:"header-status"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Testcase status")),v.createElement("div",{className:"header-expected"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Expected result"),v.createElement("div",{className:"header-actual"},v.createElement(Gt.Icon,{icon:Ut.a.CARET_DOWN}),"Actual result")),a=this.props.testcases.length>0?v.createElement("div",null,e,this.props.testcases.map((e,t)=>v.createElement(va,{key:t,index:t,testcase:e,handleTestcaseEval:this.props.handleTestcaseEval}))):v.createElement("div",{className:"noResults"},"There are no testcases provided for this question."),s=this.props.autogradingResults.length>0?v.createElement("div",null,t,this.props.autogradingResults.map((e,t)=>v.createElement(fa,{key:t,index:t,result:e}))):v.createElement("div",{className:"noResults"},"There are no results to show."),n=(e,t,a)=>sa(e,t?Ut.a.CARET_DOWN:Ut.a.CARET_RIGHT,a,{minimal:!0,className:"collapse-button"});return v.createElement("div",{className:"Autograder"},n("Testcases",this.state.showTestcases,this.toggleTestcases),v.createElement(Gt.Collapse,{isOpen:this.state.showTestcases},a),n("Autograder Results",this.state.showResults,this.toggleResults),v.createElement(Gt.Collapse,{isOpen:this.state.showResults},s))}}var wa=Ca;class Aa extends v.Component{constructor(...e){super(...e),this.$container=null}shouldComponentUpdate(){return!1}componentDidMount(){window.ToneMatrix&&window.ToneMatrix.initialise_matrix(this.$container)}handleClear(){window.ToneMatrix.clear_matrix()}handleRandomise(){window.ToneMatrix.randomise_matrix()}render(){return v.createElement("div",{className:"sa-tone-matrix"},v.createElement("div",{className:"row"},v.createElement("div",{className:Xt()("controls","col-xs-12",Gt.Classes.DARK,Gt.Classes.BUTTON_GROUP)},v.createElement(Gt.Button,{id:"clear-matrix",onClick:this.handleClear},"Clear"),v.createElement(Gt.Button,{id:"randomise-matrix",onClick:this.handleRandomise},"Randomise"))),v.createElement("div",{className:"row"},v.createElement("div",{className:"col-xs-12",ref:e=>this.$container=e})))}}var Oa=Aa,Ta=a(197),Ia=a.n(Ta);const ka=e=>{const t=Ia()(e),a=Ia()();return t.isBefore(a)},Pa=e=>Ia()(e).format("Do MMMM, HH:mm");var xa=a(81);const Ra=Object(xa.a)({basename:"/cadet-frontend"}),Na=Gt.Toaster.create({position:Gt.Position.TOP}),Ma=(e,t=2e3,a)=>Na.show({intent:Gt.Intent.SUCCESS,message:e,timeout:t},a),_a=(e,t=2e3,a)=>Na.show({intent:Gt.Intent.WARNING,message:e,timeout:t},a),Da=(e,t)=>Na.show(e,t),La=e=>Na.dismiss(e),ja=e=>e===Yt.Sidequest?"quests":e.toLowerCase().concat("s"),Ba=e=>{if(void 0===e)return null;const t=parseInt(e,10);return Number.isInteger(t)?t:null};var Ga=a(475);var Ua=function(e){return v.createElement("div",{className:"ControlBar"},v.createElement("div",{className:Xt()("ControlBar_editor",Gt.Classes.BUTTON_GROUP)},e.editorButtons),e.flowButtons&&v.createElement("div",{className:Xt()("ControlBar_flow",Gt.Classes.BUTTON_GROUP)},e.flowButtons),v.createElement("div",{className:Xt()("ControlBar_repl",Gt.Classes.BUTTON_GROUP)},e.replButtons))},Va=a(108),Ha=(a(1007),a(541),a(335),a(195)),Fa=a(109),qa=a.n(Fa),Xa=a(110);const Wa={};function za(e){return e.length<=25?e:e.substring(0,22)+"..."}for(const[ng,ig]of wt){const e=ig.map(e=>e in ga.SourceDocumentation.ext_lib?{caption:za(e),value:e,meta:ga.SourceDocumentation.ext_lib[e].meta,docHTML:ga.SourceDocumentation.ext_lib[e].description}:{caption:za(e),value:e,meta:"const"});Wa[ng]=e}const Ya={};Object.entries(ga.SourceDocumentation.builtins).forEach(e=>{const[t,a]=e;Ya[t]=Object.entries(a).map(e=>{const[t,a]=e;return{caption:za(t),value:t,meta:a.meta,docHTML:a.description}})});const $a={builtins:Ya,externalLibraries:Wa},Ka=(...e)=>t=>e.forEach(e=>{"function"===typeof e?e(t):e&&"object"===typeof e&&(e.current=t)});function Qa(e){const[t,a]=S.a.useState(e);return{value:t,setValue:a,inputProps:{value:t,onChange:e=>{a(e.target.value)}}}}const Ja={evaluate:{win:"Shift-Enter",mac:"Shift-Enter"},navigate:{win:"Ctrl-B",mac:"Command-B"},refactor:{win:"Ctrl-M",mac:"Command-M"},highlightScope:{win:"Ctrl-Shift-H",mac:"Command-Shift-H"},typeInferenceDisplay:{win:"Ctrl-Shift-M",mac:"Command-Shift-M"}};var Za=(e,t,a,s)=>{const n=v.useRef([]),i=v.useRef(e.editorValue);v.useEffect(()=>{i.current=e.editorValue},[e.editorValue]);const{sourceChapter:r}=e,o=v.useCallback(()=>{setTimeout(()=>{if(!s.current)return;const e=s.current.editor,t=e.session,a=i.current,o=r,l=e.getCursorPosition();if(!t||!t.bgTokenizer)return;n.current.forEach(e=>{t.removeMarker(e)});const c=Object(ga.getAllOccurrencesInScope)(a,Object(ga.createContext)(o),{line:l.row+1,column:l.column}).map(e=>new Va.Range(e.start.line-1,e.start.column,e.end.line-1,e.end.column));n.current=c.map(e=>t.addMarker(e,"ace_variable_highlighting","text"))},10)},[s,r]),l=v.useCallback(()=>{if(!s.current)return;const e=i.current,t=r,a=s.current.editor.getCursorPosition(),o=Object(ga.getScope)(e,Object(ga.createContext)(t),{line:a.row+1,column:a.column});0!==o.length&&o.forEach(e=>{n.current.push(s.current.editor.session.addMarker(new Va.Range(e.start.line-1,e.start.column,e.end.line-1,e.end.column),"ace_selection","text"))})},[s,r]),{onChange:c,onCursorChange:d}=t;t.onChange=(...e)=>{o(),c&&c(...e)},t.onCursorChange=(...e)=>{o(),d&&d(...e)},a.highlightScope=l};var es=(e,t,a,s)=>{const n=v.useRef(e.editorValue);v.useEffect(()=>{n.current=e.editorValue},[e.editorValue]);const{sourceChapter:i,handleDeclarationNavigate:r}=e,o="default"===e.sourceVariant?"":"_"+e.sourceVariant,l=void 0===e.externalLibraryName?"NONE":e.externalLibraryName,c="ALL"===e.externalLibraryName?"External%20libraries":l,d=v.useCallback(()=>{const e=s.current.editor,t=e.selection.getCursor(),a=e.session.getTokenAt(t.row,t.column),d=We.textbook,u=$a.externalLibraries[l];r(e.getCursorPosition());const h=e.selection.getCursor();h.row===t.row&&h.column===t.column&&(Object(ga.hasDeclaration)(n.current,Object(ga.createContext)(i),{line:h.row+1,column:h.column})||(u.some(e=>e.caption===(a&&a.value))?null!==a&&(/\bsupport.function\b/.test(a.type)||/\bbuiltinConsts\b/.test(a.type))&&window.open(`${d}source/${c}/global.html#${a.value}`):null!==a&&(/\bsupport.function\b/.test(a.type)||/\bbuiltinconsts\b/.test(a.type))&&window.open(`${d}source/source_${i}${o}/global.html#${a.value}`),null!==a&&/\bstorage.type\b/.test(a.type)&&window.open(`${d}source/source_${i}.pdf`)))},[s,i,o,r,l,c]);a.navigate=d};var ts=(e,t,a,s)=>{const n=v.useRef(e.editorValue);v.useEffect(()=>{n.current=e.editorValue},[e.editorValue]);const{sourceChapter:i}=e,r=v.useCallback(()=>{const e=s.current.editor;if(!e)return;const t=n.current,a=e.getCursorPosition(),r=Object(ga.getAllOccurrencesInScope)(t,Object(ga.createContext)(i),{line:a.row+1,column:a.column}),o=e.getSelection();r.map(e=>new Va.Range(e.start.line-1,e.start.column,e.end.line-1,e.end.column)).forEach(e=>o.addRange(e))},[n,s,i]);a.refactor=r},as=a(858),ss=a.n(as);let ns,is;function rs(e,t,a,s){const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(n.readyState!==ns.DONE)return;if(n.status!==is.OK)return void s();JSON.parse(n.responseText).state?t():a()},n.open("GET","https://"+We.shareDBServer+"gists/"+e,!0),n.send()}!function(e){e[e.UNSENT=0]="UNSENT",e[e.OPENED=1]="OPENED",e[e.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",e[e.LOADING=3]="LOADING",e[e.DONE=4]="DONE"}(ns||(ns={})),function(e){e[e.OK=200]="OK",e[e.PAGE_NOT_FOUND=404]="PAGE_NOT_FOUND"}(is||(is={}));var os=(e,t,a,s)=>{const n=v.useRef(e.editorValue);v.useEffect(()=>{n.current=e.editorValue},[e.editorValue]);const{editorSessionId:i,sharedbAceIsInviting:r,handleEditorValueChange:o,handleFinishInvite:l,sharedbAceInitValue:c,handleSetWebsocketStatus:d}=e,u=v.useCallback(()=>{const e=s.current.editor,t=new ss.a(i,{WsUrl:"wss://"+We.shareDBServer+"ws/",pluginWsUrl:null,namespace:"codepad"});t.on("ready",()=>{t.add(e,["code"],[]),r&&(o(c),l())});const a=t.WS;let n;const u=()=>{clearInterval(n),a.close()},h=()=>{a.reconnect()};return n=setInterval(()=>{null!==t&&rs(i,()=>{},u,h)},5e3),a.addEventListener("open",e=>{d(1)}),a.addEventListener("close",e=>{d(0)}),t},[s,i,o,d,l,c,r]);v.useEffect(()=>{const e=""!==i?u():null;return()=>{e&&e.WS.close()}},[u,s,i])};var ls=(e,t,a,s)=>{const n=v.useRef(e.editorValue);v.useEffect(()=>{n.current=e.editorValue},[e.editorValue]);const{sourceChapter:i,handleSendReplInputToOutput:r}=e,o=v.useCallback(()=>{const e=n.current,t=s.current.editor,a=t.getCursorPosition(),o=t.session.getTokenAt(a.row,a.column);let l;if(r){if(a&&o){if("comment"===o.type)return;const t=Object(ga.getTypeInformation)(e,Object(ga.createContext)(i),{line:a.row+1,column:a.column},o.value);l=(e=>e.split("\n").filter(e=>""!==e).map(e=>"// "+e).join("\n"))(t),0===t.length&&(l="// type information not found")}else l="// invalid token. Please put cursor on an identifier.";r(l)}},[n,s,r,i]);a.typeInferenceDisplay=o};const cs={goGreen:()=>{}},ds=v.forwardRef((function(e,t){const a=v.useRef(null),s=v.useRef(e.handleEditorUpdateBreakpoints),n=v.useRef(e.handlePromptAutocomplete);v.useEffect(()=>{s.current=e.handleEditorUpdateBreakpoints,n.current=e.handlePromptAutocomplete},[e.handleEditorUpdateBreakpoints,e.handlePromptAutocomplete]);const[i,r,o]=[e.sourceChapter||1,e.sourceVariant||"default",e.externalLibraryName||"NONE"];v.useEffect(()=>{var e,t,a;e=i,t=r,a=o,Object(Ha.HighlightRulesSelector)(e,t,a,$a.externalLibraries[a]),Object(Ha.ModeSelector)(e,t,a)},[i,r,o]),v.useLayoutEffect(()=>{if(!a.current)return;const e=a.current.editor,t=e.getSession();var i,r;e.on("gutterclick",(i=(...e)=>s.current(...e),e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const a=e.getDocumentPosition().row,s=e.editor.session.getLine(a);void 0!==e.editor.session.getBreakpoints()[a]||0===s.length||s.includes("//")||s.includes("debugger;")?e.editor.session.clearBreakpoint(a):e.editor.session.setBreakpoint(a,void 0),e.stop(),i(e.editor.session.getBreakpoints())})),t.on("changeAnnotation",(e=>()=>{const t=e.getAnnotations();let a=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",a++);0!==a&&e.setAnnotations(t)})(t)),Object(Va.require)("ace/ext/language_tools").setCompleters([(r=(...e)=>n.current(...e),{getCompletions:(e,t,a,s,n)=>{s&&/\d/.test(s.charAt(0))?n():r(a.row+1,a.column,n)}})])},[a,s,n]),v.useLayoutEffect(()=>{if(!a.current)return;const t=e.newCursorPosition;var s,n;t&&(s=a.current.editor,n=t,s.selection.clearSelection(),s.moveCursorToPosition(n),s.renderer.showCursor(),s.renderer.scrollCursorIntoView(n,.5))},[a,e.newCursorPosition]);const{handleUpdateHasUnsavedChanges:l,handleEditorValueChange:c,isEditorAutorun:d,handleEditorEval:u}=e,h=v.useCallback((e,t)=>{if(!a.current)return;l&&l(!0),c(e);const s=a.current.editor.getSession().getAnnotations();d&&0===s.length&&u()},[a,l,c,u,d]),p={evaluate:u},m={className:"react-ace",editorProps:{$blockScrolling:1/0},markers:v.useMemo(()=>e.highlightedLines.map(e=>({startRow:e[0],startCol:0,endRow:e[1],endCol:1,className:"myMarker",type:"fullLine"})),[e.highlightedLines]),fontSize:17,height:"100%",highlightActiveLine:!1,mode:(g=i,y=r,E=o,`source${g}${y}${E}`),theme:"source",value:e.editorValue,width:"100%",setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:"'Inconsolata', monospace"},onChange:h};var g,y,E;const[b]=v.useState(e.hooks);if(b)for(const v of b)v(e,m,p,a);return m.commands=Object.entries(p).filter(([e,t])=>t).map(([e,t])=>({name:e,bindKey:Ja[e],exec:t})),v.createElement(Xa.HotKeys,{className:"Editor",handlers:cs},v.createElement("div",{className:"row editor-react-ace"},v.createElement(qa.a,Object.assign({},m,{ref:Ka(a,t)}))))}));var us=v.forwardRef((e,t)=>v.createElement(ds,Object.assign({},e,{hooks:[Za,es,ls,os,ts],ref:t})));class hs extends v.PureComponent{constructor(e){super(e),this.onButtonClickFactory=e=>t=>{e!==this.state.mcqOption&&(this.props.handleMCQSubmit(e),this.setState({mcqOption:e}));if(null!==this.props.mcq.solution&&this.props.mcq.choices[e].hint){const t=v.createElement(ma,{className:"markdown-notification",content:this.props.mcq.choices[e].hint});e===this.props.mcq.solution?Ma(t,4e3):_a(t,4e3)}},this.getButtonIntent=(e,t,a)=>{const s=e===t,n=s&&null!==a&&e===a;return null===a?Gt.Intent.NONE:s&&n?Gt.Intent.SUCCESS:s&&!n?Gt.Intent.DANGER:Gt.Intent.NONE},this.state={mcqOption:e.mcq.answer}}render(){const e=this.props.mcq.choices.map((e,t)=>v.createElement(Gt.Button,{key:t,className:"mcq-option col-xs-12",active:t===this.state.mcqOption,intent:this.getButtonIntent(t,this.state.mcqOption,this.props.mcq.solution),onClick:this.onButtonClickFactory(t),minimal:!0},v.createElement(ma,{content:e.content})));return v.createElement("div",{className:"MCQChooser row"},v.createElement(Gt.Card,{className:"mcq-content-parent col-xs-12 middle-xs"},v.createElement("div",{className:"row mcq-options-parent between-xs"},e)))}}var ps=hs;class ms extends v.PureComponent{constructor(e){super(e),this.replInputBottom=void 0,this.execBrowseHistoryDown=void 0,this.execBrowseHistoryUp=void 0,this.execEvaluate=void 0,this.execBrowseHistoryDown=e.handleBrowseHistoryDown,this.execBrowseHistoryUp=e.handleBrowseHistoryUp,this.execEvaluate=()=>{this.replInputBottom&&(this.replInputBottom.scrollIntoView(),this.props.handleReplEval())}}componentDidUpdate(){this.replInputBottom&&(this.replInputBottom.clientWidth>=window.innerWidth-50||this.replInputBottom.scrollIntoView())}render(){return v.createElement(v.Fragment,null,v.createElement(qa.a,{className:"repl-react-ace react-ace",mode:`source${this.props.sourceChapter||1}defaultNONE`,theme:"source",height:"1px",width:"100%",value:this.props.replValue,onChange:this.props.handleReplValueChange,commands:[{name:"browseHistoryDown",bindKey:{win:"Down",mac:"Down"},exec:this.execBrowseHistoryDown},{name:"browseHistoryUp",bindKey:{win:"Up",mac:"Up"},exec:this.execBrowseHistoryUp},{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.execEvaluate}],minLines:1,maxLines:20,fontSize:17,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"}}),v.createElement("div",{className:"replInputBottom",ref:e=>this.replInputBottom=e}))}}var gs=ms;class ys extends v.PureComponent{constructor(e){super(e)}render(){const e=this.props.output.map((e,t)=>v.createElement(Es,{output:e,key:t,usingSubst:this.props.usingSubst||!1})),t=this.props;return v.createElement("div",{className:"Repl",style:{display:this.props.hidden?"none":void 0}},v.createElement("div",{className:"repl-output-parent"},e,v.createElement(Xa.HotKeys,{className:Xt()("repl-input-parent","row",Gt.Classes.CARD,Gt.Classes.ELEVATION_0),handlers:vs},"concurrent"!==this.props.sourceVariant?v.createElement(gs,t):null)))}}const Es=e=>{switch(e.output.type){case"code":return v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"codeOutput"},e.output.value));case"running":return v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")));case"result":return e.usingSubst&&e.output.value instanceof Array?v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"logOutput"},"Check out the substituter tab!")):0===e.output.consoleLogs.length?v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"resultOutput"},bs(e.output.value))):v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")),v.createElement(Gt.Pre,{className:"resultOutput"},bs(e.output.value)));case"errors":return 0===e.output.consoleLogs.length?v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"errorOutput"},Object(ga.parseError)(e.output.errors))):v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")),v.createElement("br",null),v.createElement(Gt.Pre,{className:"errorOutput"},Object(ga.parseError)(e.output.errors)));default:return v.createElement(Gt.Card,null,"''")}},bs=e=>{const t=window.ShapeDrawn;return"undefined"!==typeof t&&e instanceof t?v.createElement(Ea,{canvas:e.$canvas}):Object(Ke.stringify)(e)},vs={goGreen:()=>{}};var Ss=ys;const fs=[],Cs=new Map;var ws=e=>{const{tabs:t,defaultSelectedTabId:a,handleActiveTabChange:s,onChange:n}=e,[i,r]=v.useState(t),o=Object(C.e)(e=>e.workspaces);let l;v.useEffect(()=>{s(a||t[0].id)},[]),l=e.workspaceLocation?o[e.workspaceLocation].debuggerContext:{},v.useEffect(()=>{const e=t.concat((e=>{const t=fs.filter(t=>t.toSpawn(e));return e.workspaceLocation&&Cs.set(e.workspaceLocation,t.map(e=>e.label)),t})(l));r(e)},[t,l]);const c=e=>e+"-icon",d=v.useMemo(()=>i.map(t=>((e,t)=>{const a=void 0===e.id?e.label:e.id,s=v.createElement(Gt.Tooltip,{content:e.label},v.createElement("div",{className:"side-content-tooltip",id:c(a)},v.createElement(Gt.Icon,{icon:e.iconName,iconSize:20}))),n=t?{...e.body,props:{...e.body.props,workspaceLocation:t}}:e.body,i=v.createElement("div",{className:"side-content-text"},n);return v.createElement(Gt.Tab,{key:a,id:a,title:s,panel:i,disabled:e.disabled,className:"side-content-tab"})})(t,e.workspaceLocation)),[i,e.workspaceLocation]),u=v.useCallback((e,t,a)=>{const i=e=>{const t=c(e),a=document.getElementById(t);a&&a.classList.remove("side-content-tab-alert")};s(e),void 0===n||n(e,t,a),i(t)},[s,n]);return v.createElement("div",{className:"side-content"},v.createElement(Gt.Card,null,v.createElement("div",{className:"side-content-tabs"},v.createElement(Gt.Tabs,{id:"side-content-tabs",onChange:u,defaultSelectedTabId:e.defaultSelectedTabId,renderActiveTabPanelOnly:e.renderActiveTabPanelOnly,selectedTabId:e.selectedTabId},d))))};class As extends v.Component{constructor(e){super(e),this.editorDividerDiv=void 0,this.leftParentResizable=void 0,this.maxDividerHeight=void 0,this.sideDividerDiv=void 0,this.toggleEditorDividerDisplay=(e,t,a)=>{const s=a.clientWidth/window.innerWidth*100;s>95?this.leftParentResizable.updateSize({width:"100%",height:"100%"}):s<2&&this.leftParentResizable.updateSize({width:"0%",height:"100%"}),this.editorDividerDiv.style.marginRight=s<2?"0.6rem":"0"},this.toggleDividerDisplay=(e,t,a)=>{this.maxDividerHeight=this.sideDividerDiv.clientHeight>this.maxDividerHeight?this.sideDividerDiv.clientHeight:this.maxDividerHeight;const s=a.clientHeight,n=a.parentNode.clientHeight;s+this.maxDividerHeight+2>n?this.sideDividerDiv.style.display="none":this.sideDividerDiv.style.display="initial"},this.createWorkspaceInput=e=>e.customEditor?e.customEditor:e.editorProps?v.createElement(us,Object.assign({},e.editorProps,{key:e.editorProps.editorSessionId})):v.createElement(ps,e.mcqProps)}componentDidMount(){this.maxDividerHeight=this.sideDividerDiv.clientHeight}render(){const e=v.createElement(ws,this.props.sideContentProps),t=v.createElement(Ga.a,this.sideContentResizableProps(),e,v.createElement("div",{className:"side-content-divider",ref:e=>this.sideDividerDiv=e}));return v.createElement("div",{className:"workspace"},this.props.hasUnsavedChanges?v.createElement(w.a,{message:"You have changes that may not be saved. Are you sure you want to leave?"}):null,v.createElement(Ua,this.controlBarProps()),v.createElement("div",{className:"row workspace-parent"},v.createElement("div",{className:"editor-divider",ref:e=>this.editorDividerDiv=e}),v.createElement(Ga.a,this.editorResizableProps(),this.createWorkspaceInput(this.props)),v.createElement("div",{className:"right-parent"},void 0===this.props.sideContentIsResizeable||this.props.sideContentIsResizeable?t:e,v.createElement(Ss,this.props.replProps))))}controlBarProps(){return{...this.props.controlBarProps}}editorResizableProps(){return{className:"resize-editor left-parent",enable:Os,minWidth:0,onResize:this.toggleEditorDividerDisplay,onResizeStop:(e,t,a,s)=>this.props.handleEditorWidthChange(100*s.width/window.innerWidth),ref:e=>this.leftParentResizable=e,size:{width:this.props.editorWidth,height:"100%"},as:void 0}}sideContentResizableProps(){return{bounds:"parent",className:"resize-side-content",enable:Ts,onResize:this.toggleDividerDisplay,onResizeStop:(e,t,a,s)=>this.props.handleSideContentHeightChange(a.clientHeight),size:void 0===this.props.sideContentHeight?void 0:{height:this.props.sideContentHeight,width:"100%"}}}}const Os={top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},Ts={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};var Is=As;class ks extends v.Component{render(){return v.createElement("div",{className:"GradingResult"},v.createElement("div",{className:"grading-result-table"},v.createElement(Gt.HTMLTable,null,v.createElement("tbody",null,v.createElement("tr",null,v.createElement("th",null,"Grade:"),v.createElement("td",null,v.createElement(Gt.Text,null,this.props.grade," / ",this.props.maxGrade))),v.createElement("tr",null,v.createElement("th",null,"XP:"),v.createElement("td",null,v.createElement(Gt.Text,null,this.props.xp," / ",this.props.maxXp))),v.createElement("tr",null,v.createElement("th",null,"Comments:"),v.createElement("td",null,!this.props.comments&&v.createElement(Gt.Text,null,"None"))))),this.props.comments&&v.createElement(Gt.HTMLTable,null,v.createElement("tbody",null,v.createElement("tr",null,v.createElement("td",null,v.createElement(Gt.Divider,null),v.createElement(ma,{content:this.props.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),v.createElement(Gt.Divider,null))))),v.createElement("br",null),v.createElement("div",{className:"grading-result-info"},v.createElement(Gt.Text,null,"Graded by ",v.createElement("b",null,this.props.graderName)," on ",Pa(this.props.gradedAt)))))}}var Ps=ks;class xs extends v.Component{constructor(e){super(e),this.sideContentProps=(e,t)=>{const a=[{label:"Task "+(t+1),iconName:Ut.a.NINJA,body:v.createElement(ma,{content:e.assessment.questions[t].content}),id:T.questionOverview,toSpawn:()=>!0},{label:e.assessment.category+" Briefing",iconName:Ut.a.BRIEFCASE,body:v.createElement(ma,{content:e.assessment.longSummary}),id:T.briefing,toSpawn:()=>!0},{label:e.assessment.category+" Autograder",iconName:Ut.a.AIRPLANE,body:v.createElement(wa,{testcases:e.editorTestcases,autogradingResults:e.autogradingResults,handleTestcaseEval:this.props.handleTestcaseEval}),id:T.autograder,toSpawn:()=>!0}],s=void 0!==e.assessment.questions[t].grader;s&&a.push({label:"Report Card",iconName:Ut.a.TICK,body:v.createElement(Ps,{graderName:e.assessment.questions[t].grader.name,gradedAt:e.assessment.questions[t].gradedAt,xp:e.assessment.questions[t].xp,grade:e.assessment.questions[t].grade,maxGrade:e.assessment.questions[t].maxGrade,maxXp:e.assessment.questions[t].maxXp,comments:e.assessment.questions[t].comments}),id:T.grading,toSpawn:()=>!0});return e.assessment.questions[t].library.external.symbols.includes("get_matrix")&&a.push({label:"Tone Matrix",iconName:Ut.a.GRID_VIEW,body:v.createElement(Oa,null),id:T.toneMatrix,toSpawn:()=>!0}),{handleActiveTabChange:e.handleActiveTabChange,defaultSelectedTabId:s?T.grading:T.questionOverview,tabs:a,workspaceLocation:"assessment"}},this.controlBarProps=e=>{const t="/academy/"+ja(this.props.assessment.category),a=t+"/"+this.props.assessment.id.toString(),s=[e+1,this.props.assessment.questions.length],n=()=>Ra.push(a+"/"+(e+1).toString()),i=()=>Ra.push(t),r=t=>()=>{const a=this.props.assessment.questions.filter(e=>null!==e.answer).length-1;if(e<a)return t();const s=this.props.assessment.questions[e];if(s.type===Kt.mcq){if(s.answer!==s.solution)return _a("Your MCQ solution is incorrect!",750)}else if(s.type===Kt.programming){if(!this.props.editorTestcases.reduce((e,t)=>e&&Object(Ke.stringify)(t.result)===t.answer,!0))return _a("Your solution has not passed all testcases!",750)}return t()},o=v.createElement(na,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),l=v.createElement(ia,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),c=v.createElement(oa,{onClickNext:this.props.assessment.category===Yt.Path?r(n):n,onClickReturn:this.props.assessment.category===Yt.Path?r(i):i,questionProgress:s,key:"next_question"}),d=v.createElement(la,{onClick:()=>Ra.push(a+"/"+(e-1).toString()),questionProgress:s,key:"previous_question"}),u=v.createElement(ca,{questionProgress:s,key:"question_view"}),h=this.props.assessment.questions[e].type!==Kt.mcq?v.createElement(da,{onClick:()=>{this.setState({showResetTemplateOverlay:!0})},key:"reset_template"}):null;return{editorButtons:[v.createElement(ua,{handleEditorEval:this.props.handleEditorEval,key:"run"}),ka(this.props.closeDate)||this.props.assessment.questions[e].type===Kt.mcq?null:v.createElement(ha,{hasUnsavedChanges:this.props.hasUnsavedChanges,onClickSave:()=>this.props.handleSave(this.props.assessment.questions[e].id,this.props.editorValue),key:"save"}),h,v.createElement(ta,{handleChapterSelect:()=>{},sourceChapter:this.props.assessment.questions[e].library.chapter,sourceVariant:ze.defaultSourceVariant,disabled:!0,key:"chapter"})],flowButtons:[d,u,c],replButtons:[l,o]}},this.state={showOverlay:!1,showResetTemplateOverlay:!1},this.props.handleEditorValueChange("")}componentDidMount(){if(this.props.handleAssessmentFetch(this.props.assessmentId),0===this.props.questionId&&this.props.notAttempted&&this.setState({showOverlay:!0}),!this.props.assessment)return;let e=this.props.questionId;this.props.questionId>=this.props.assessment.questions.length&&(e=this.props.assessment.questions.length-1);const t=this.props.assessment.questions[e];let a="";t.type===Kt.programming&&(a=t.answer?t.answer:t.solutionTemplate),this.props.handleEditorValueChange(a)}componentDidUpdate(){this.checkWorkspaceReset(this.props)}render(){if(void 0===this.props.assessment||0===this.props.assessment.questions.length)return v.createElement(Gt.NonIdealState,{className:Xt()("WorkspaceParent",Gt.Classes.DARK),description:"Getting mission ready...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})});const e=v.createElement(Gt.Dialog,{className:"assessment-briefing",isOpen:this.state.showOverlay},v.createElement(Gt.Card,null,v.createElement(ma,{content:this.props.assessment.longSummary}),v.createElement(Gt.Button,{className:"assessment-briefing-button",onClick:()=>this.setState({showOverlay:!1}),text:"Continue"}))),t=()=>this.setState({showResetTemplateOverlay:!1}),a=v.createElement(Gt.Dialog,{className:"assessment-reset",icon:Ut.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showResetTemplateOverlay,onClose:t,title:"Confirmation: Reset editor?"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement(ma,{content:"Are you sure you want to reset the template?"}),v.createElement(ma,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement(Gt.ButtonGroup,null,sa("Cancel",null,t,{minimal:!1}),sa("Confirm",null,()=>{t(),this.props.handleEditorValueChange(this.props.assessment.questions[s].solutionTemplate),this.props.handleUpdateHasUnsavedChanges(!0)},{minimal:!1,intent:Gt.Intent.DANGER})))),s=this.props.questionId>=this.props.assessment.questions.length?this.props.assessment.questions.length-1:this.props.questionId,n=this.props.assessment.questions[s],i={controlBarProps:this.controlBarProps(s),editorProps:n.type===Kt.programming?{editorSessionId:"",editorValue:this.props.editorValue,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,handleUpdateHasUnsavedChanges:this.props.handleUpdateHasUnsavedChanges,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,hasUnsavedChanges:this.props.hasUnsavedChanges,mcqProps:{mcq:n,handleMCQSubmit:e=>this.props.handleSave(this.props.assessment.questions[s].id,e)},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,s),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:Xt()("WorkspaceParent",Gt.Classes.DARK)},e,a,v.createElement(Is,i))}checkWorkspaceReset(e){if(void 0===this.props.assessment)return;const t=this.props.assessmentId,a=this.props.questionId;if(this.props.storedAssessmentId===t&&this.props.storedQuestionId===a)return;const s=this.props.assessment.questions[a];let n=[],i="",r="",o="",l=[];if(s.type===Kt.programming){const e=s;n=e.autogradingResults,r=e.prepend,o=e.postpend,l=e.testcases,i=e.answer,i||(i=e.solutionTemplate)}this.props.handleEditorUpdateBreakpoints([]),this.props.handleUpdateCurrentAssessmentId(t,a),this.props.handleResetWorkspace({autogradingResults:n,editorPrepend:r,editorValue:i,editorPostpend:o,editorTestcases:l}),this.props.handleClearContext(s.library),this.props.handleUpdateHasUnsavedChanges(!1),i&&this.props.handleEditorValueChange(i)}}var Rs=xs;var Ns=Object(C.c)((e,t)=>({assessment:e.session.assessments.get(t.assessmentId),autogradingResults:e.workspaces.assessment.autogradingResults,editorPrepend:e.workspaces.assessment.editorPrepend,editorValue:e.workspaces.assessment.editorValue,editorPostpend:e.workspaces.assessment.editorPostpend,editorTestcases:e.workspaces.assessment.editorTestcases,editorHeight:e.workspaces.assessment.editorHeight,editorWidth:e.workspaces.assessment.editorWidth,breakpoints:e.workspaces.assessment.breakpoints,highlightedLines:e.workspaces.assessment.highlightedLines,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,newCursorPosition:e.workspaces.assessment.newCursorPosition,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion}),e=>Object(A.b)({handleActiveTabChange:e=>j(e,"assessment"),handleAssessmentFetch:ge,handleBrowseHistoryDown:()=>I("assessment"),handleBrowseHistoryUp:()=>k("assessment"),handleChapterSelect:(e,t)=>_(e,"default","assessment"),handleClearContext:e=>B(e,"assessment"),handleDeclarationNavigate:e=>Z("assessment",e),handleEditorEval:()=>q("assessment"),handleEditorValueChange:e=>z(e,"assessment"),handleEditorHeightChange:e=>x(e,"assessment"),handleEditorWidthChange:e=>R(e.toString(),"assessment"),handleEditorUpdateBreakpoints:e=>Y(e,"assessment"),handleInterruptEval:()=>nt("assessment"),handleReplEval:()=>X("assessment"),handleReplOutputClear:()=>U("assessment"),handleReplValueChange:e=>K(e,"assessment"),handleResetWorkspace:e=>te("assessment",e),handleSave:Oe,handleSideContentHeightChange:e=>M(e,"assessment"),handleTestcaseEval:e=>W("assessment",e),handleUpdateHasUnsavedChanges:e=>re("assessment",e),handleUpdateCurrentAssessmentId:ne,handleDebuggerPause:()=>rt("assessment"),handleDebuggerResume:()=>lt("assessment"),handleDebuggerReset:()=>ct("assessment"),handlePromptAutocomplete:(e,t,a)=>de("assessment",e,t,a)},e))(Rs);class Ms extends v.Component{componentDidMount(){this.props.loadContentDispatch()}render(){return v.createElement("div",{className:"ContentDisplay row center-xs"},v.createElement("div",{className:(this.props.fullWidth?"col-xs-12":"col-xs-10")+" contentdisplay-content-parent"},v.createElement(Gt.Card,{className:"contentdisplay-content",elevation:Gt.Elevation.THREE},this.props.display)))}}var _s=Ms;function Ds(e){return t=>t.filter(t=>!t.submission_id&&t.assessment_id===e)}function Ls(e){return t=>t.filter(t=>t.submission_id===e)}function js(e){return t=>t.filter(t=>"Grading"===e?void 0!==t.submission_id:!t.submission_id&&e===t.assessment_type)}let Bs;!function(e){e.new="new",e.deadline="deadline",e.autograded="autograded",e.graded="graded",e.submitted="submitted",e.unsubmitted="unsubmitted",e.new_message="new_message"}(Bs||(Bs={}));const Gs=e=>{switch(e){case Bs.new:return"This assessment is new.";case Bs.deadline:return"This assessment is closing soon.";case Bs.autograded:return"This assessment has been autograded.";case Bs.submitted:return"This submission is new.";case Bs.unsubmitted:return"This assessment has been unsubmitted.";case Bs.graded:return"This assessment has been manually graded.";case Bs.new_message:return"There are new messages.";default:return"Unknown notification"}};var Us=e=>{const t=e.notificationFilter?e.notificationFilter(e.notifications):e.notifications;if(!t.length)return null;const a=v.createElement(Gt.Tag,{intent:Gt.Intent.DANGER,round:!0,large:e.large},t.length);if(!e.disableHover){const s=t=>v.createElement(Gt.Tag,{className:"row badge-tag",key:""+t.id,minimal:!0,multiline:!0,onRemove:()=>{return e.handleAcknowledgeNotifications((a=t.id,e=>e.filter(e=>e.id===a)));var a}},Gs(t.type)),n=v.createElement("div",{className:"col"},t.map(s));return v.createElement(Gt.Popover,{className:e.className,content:n,interactionKind:Gt.PopoverInteractionKind.HOVER,position:Gt.Position.RIGHT,hoverOpenDelay:50,hoverCloseDelay:50,lazy:!0},a)}return a};var Vs=Object(C.c)(e=>({notifications:e.session.notifications}),e=>Object(A.b)({handleAcknowledgeNotifications:Le},e))(Us);class Hs extends v.Component{constructor(e){super(e),this.toggleClosedAssessments=()=>this.setState({...this.state,showClosedAssessments:!this.state.showClosedAssessments}),this.toggleOpenAssessments=()=>this.setState({...this.state,showOpenedAssessments:!this.state.showOpenedAssessments}),this.toggleUpcomingAssessments=()=>this.setState({...this.state,showUpcomingAssessments:!this.state.showUpcomingAssessments}),this.setBetchaAssessment=e=>this.setState({...this.state,betchaAssessment:e}),this.setBetchaAssessmentNull=()=>this.setBetchaAssessment(null),this.submitAssessment=()=>{this.state.betchaAssessment&&(this.props.handleSubmitAssessment(this.state.betchaAssessment.id),this.setBetchaAssessmentNull())},this.sortAssessments=e=>Object(Qe.sortBy)(e,[e=>-e.id]),this.makeSubmissionButton=(e,t)=>v.createElement(Gt.Button,{disabled:e.status!==Wt.attempted,icon:Ut.a.CONFIRM,intent:e.status===Wt.attempted?Gt.Intent.DANGER:Gt.Intent.NONE,minimal:!0,onClick:()=>this.setBetchaAssessment(e)},v.createElement("span",{className:"custom-hidden-xxxs"},"Finalize"),v.createElement("span",{className:"custom-hidden-xxs"}," Submission")),this.makeAssessmentInteractButton=e=>{let t,a,s="";switch(e.status){case Wt.not_attempted:t=Ut.a.PLAY,a="Attempt";break;case Wt.attempting:t=Ut.a.PLAY,a="Continue",s=" Attempt";break;case Wt.attempted:t=Ut.a.EDIT,a="Review",s=" Attempt";break;case Wt.submitted:t=Ut.a.EYE_OPEN,a="Review",s=" Submission";break;default:t=Ut.a.PLAY,a="Review"}return v.createElement(Vt.a,{to:`/academy/${ja(e.category)}/${e.id.toString()}/${ze.defaultQuestionId}`},v.createElement(Gt.Button,{icon:t,minimal:!0,onClick:()=>this.props.handleAcknowledgeNotifications(Ds(e.id))},v.createElement("span",{className:"custom-hidden-xxxs"},a),v.createElement("span",{className:"custom-hidden-xxs"},s)))},this.makeOverviewCard=(e,t,a,s)=>v.createElement("div",{key:t},v.createElement(Gt.Card,{className:"row listing",elevation:Gt.Elevation.ONE},v.createElement("div",{className:"col-xs-3 listing-picture"},v.createElement(Vs,{className:"badge",notificationFilter:Ds(e.id),large:!0}),v.createElement("img",{alt:"Assessment",className:"cover-image-"+e.status,src:e.coverImage?e.coverImage:Ft.a})),v.createElement("div",{className:"col-xs-9 listing-text"},this.makeOverviewCardTitle(e,t,s),v.createElement("div",{className:"listing-grade"},v.createElement(Gt.H6,null,ka(e.openAt)?`Grade: ${e.grade} / ${e.maxGrade}`:"Max Grade: "+e.maxGrade)),v.createElement("div",{className:"listing-xp"},v.createElement(Gt.H6,null,ka(e.openAt)?`XP: ${e.xp} / ${e.maxXp}`:"Max XP: "+e.maxXp)),v.createElement("div",{className:"listing-description"},v.createElement(ma,{content:e.shortSummary})),v.createElement("div",{className:"listing-footer"},v.createElement(Gt.Text,{className:"listing-due-date"},v.createElement(Gt.Icon,{className:"listing-due-icon",iconSize:12,icon:Ut.a.TIME}),ka(e.openAt)?"Due: "+Pa(e.closeAt):"Opens at: "+Pa(e.openAt)),v.createElement("div",{className:"listing-button"},a?this.makeAssessmentInteractButton(e):null))))),this.makeOverviewCardTitle=(e,t,a)=>v.createElement("div",{className:"listing-header"},v.createElement(Gt.Text,{ellipsize:!0},v.createElement(Gt.H4,{className:"listing-title"},e.title,e.private?v.createElement(Gt.Tooltip,{className:"listing-title-tooltip",content:"This assessment is password-protected."},v.createElement(Gt.Icon,{icon:"lock"})):null,a?Fs(e.gradingStatus):null)),v.createElement("div",{className:"listing-button"},this.makeSubmissionButton(e,t))),this.state={betchaAssessment:null,showClosedAssessments:!1,showOpenedAssessments:!0,showUpcomingAssessments:!0}}render(){const{assessmentOverviews:e,isStudent:t}=this.props,a=Ba(this.props.match.params.assessmentId),s=Ba(this.props.match.params.questionId)||ze.defaultQuestionId;if(null!==a&&void 0!==e){const t=e.filter(e=>e.id===a)[0],n={assessmentId:a,questionId:s,notAttempted:t.status===Wt.not_attempted,closeDate:t.closeAt};return v.createElement(Ns,n)}let n;if(void 0===e)n=v.createElement(Gt.NonIdealState,{description:"Fetching assessment...",icon:v.createElement(Gt.Spinner,null)});else if(0===e.length)n=v.createElement(Gt.NonIdealState,{title:"There are no assessments.",icon:Ut.a.FLAME});else{const a=e=>!ka(e.closeAt)&&!ka(e.openAt),s=this.sortAssessments(e.filter(a)).map((e,a)=>this.makeOverviewCard(e,a,!t,!1)),i=e=>!ka(e.closeAt)&&ka(e.openAt)&&e.status!==Wt.submitted,r=this.sortAssessments(e.filter(e=>i(e))).map((e,t)=>this.makeOverviewCard(e,t,!0,!1)),o=this.sortAssessments(e.filter(e=>!i(e)&&!a(e))).map((e,t)=>this.makeOverviewCard(e,t,!0,!0)),l=v.createElement(v.Fragment,null,qs("Upcoming",this.state.showUpcomingAssessments,this.toggleUpcomingAssessments),v.createElement(Gt.Collapse,{isOpen:this.state.showUpcomingAssessments},s)),c=v.createElement(v.Fragment,null,qs("Open",this.state.showOpenedAssessments,this.toggleOpenAssessments),v.createElement(Gt.Collapse,{isOpen:this.state.showOpenedAssessments},r)),d=v.createElement(v.Fragment,null,qs("Closed",this.state.showClosedAssessments,this.toggleClosedAssessments),v.createElement(Gt.Collapse,{isOpen:this.state.showClosedAssessments},o));n=v.createElement(v.Fragment,null,s.length>0?l:null,r.length>0?c:null,o.length>0?d:null)}const i=this.state.betchaAssessment?v.createElement("p",null,"You are about to finalise your submission for the"," ",this.state.betchaAssessment.category.toLowerCase()," ",v.createElement("i",null,'"',this.state.betchaAssessment.title,'"'),"."):v.createElement("p",null,"You are about to finalise your submission."),r=v.createElement(v.Fragment,null,i,v.createElement("p",null,"Early submissions grant you additional XP, but"," ",v.createElement("span",{className:"warning"},"this action is irreversible."))),o=v.createElement(Gt.Dialog,{className:"betcha-dialog",icon:Ut.a.ERROR,isCloseButtonShown:!0,isOpen:null!==this.state.betchaAssessment,onClose:this.setBetchaAssessmentNull,title:"Betcha: Early Submission"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement(Gt.Text,null,r)),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement(Gt.ButtonGroup,null,sa("Cancel",null,this.setBetchaAssessmentNull,{minimal:!1}),sa("Finalise Submission",null,this.submitAssessment,{minimal:!1,intent:Gt.Intent.DANGER}))));return v.createElement("div",{className:"Assessment"},v.createElement(_s,{display:n,loadContentDispatch:this.props.handleAssessmentOverviewFetch}),o)}}const Fs=e=>{let t,a,s;switch(e){case zt.graded:t=Ut.a.TICK,a=Gt.Intent.SUCCESS,s="Fully graded";break;case zt.grading:t=Ut.a.TIME,a=Gt.Intent.WARNING,s="Grading in progress";break;case zt.none:t=Ut.a.CROSS,a=Gt.Intent.DANGER,s="Not graded yet";break;default:t=Ut.a.DISABLE,a=Gt.Intent.PRIMARY,s="Not applicable"}return v.createElement(Gt.Tooltip,{className:"listing-title-tooltip",content:s,position:Gt.Position.RIGHT},v.createElement(Gt.Icon,{icon:t,intent:a}))},qs=(e,t,a)=>sa(e,t?Ut.a.CARET_DOWN:Ut.a.CARET_RIGHT,a,{minimal:!0,className:"collapse-button"});var Xs=Hs;var Ws=Object(w.h)(Object(C.c)((e,t)=>({assessmentOverviews:e.session.assessmentOverviews?e.session.assessmentOverviews.filter(e=>e.category===t.assessmentCategory):void 0,isStudent:!e.session.role||e.session.role===Ot.Student}),e=>Object(A.b)({handleAcknowledgeNotifications:Le,handleAssessmentOverviewFetch:ye,handleSubmitAssessment:Te},e))(Xs));const zs=":assessmentId(\\d+)?/:questionId(\\d+)?",Ys=()=>Object(O.action)("FETCH_GROUP_GRADING_SUMMARY"),$s=e=>Object(O.action)("UPDATE_GROUP_GRADING_SUMMARY",e);a(245),a(337);var Ks=a(147);class Qs extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFetchGradingSummary=()=>{this.props.handleFetchGradingSummary()},this.onGridReady=e=>{this.gridApi=e.api},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.columnDefs=[{headerName:"Group",field:"groupName",width:80,sort:"asc"},{headerName:"Avenger",field:"leaderName"},{headerName:"Ungraded Missions",field:"ungradedMissions"},{headerName:"Submitted Missions",field:"submittedMissions"},{headerName:"Ungraded Quests",field:"ungradedSidequests"},{headerName:"Submitted Quests",field:"submittedSidequests"}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidUpdate(e){this.gridApi&&this.props.gradingSummary.length!==e.gradingSummary.length&&this.gridApi.setRowData(this.props.gradingSummary)}render(){const e=v.createElement("div",{className:"GradingContainer"},v.createElement("div",{className:"Grading ag-grid-parent ag-theme-balham"},v.createElement(Ks.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onFirstDataRendered:this.resizeGrid,onGridSizeChanged:this.resizeGrid,rowData:this.props.gradingSummary,rowHeight:30,suppressMovableColumns:!0})));return v.createElement("div",null,v.createElement(_s,{display:e,loadContentDispatch:this.handleFetchGradingSummary}))}}var Js=Qs;var Zs=Object(C.c)(e=>({gradingSummary:e.dashboard.gradingSummary}),e=>Object(A.b)({handleFetchGradingSummary:Ys},e))(Js),en=a(131),tn=a.n(en);var an={zektonFont:{key:"zekton",pngPath:"../assets/zekton.png",fntPath:"../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../assets/alien_and_cows.png",fntPath:"../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../assets/alien_league.png",fntPath:"../assets/alien_league.fnt"},educatedDeersFont:{key:"educatedDeers",pngPath:"../assets/educated_deers.png",fntPath:"../assets/educated_deers.fnt"},pixelFont:{key:"pixel",pngPath:"../assets/pixel.png",fntPath:"../assets/pixel.fnt"}};const sn={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},nn=Qe.mapValues(sn,e=>parseInt(e.slice(1),16));let rn;function on({direction:e=rn.Row,numOfItems:t,maxXSpace:a=un.x,maxYSpace:s=un.y,numItemLimit:n=0,redistributeLast:i=!0}){let r=n||t;const o=Math.ceil(t/r);return Qe.times(t,n=>{const l=n%r,c=Math.floor(n/r);return i&&c===o-1&&(r=t%o||r),e===rn.Row?[ln(un.x,a,l,r),ln(un.y,s,c,o)]:[ln(un.x,a,c,o),ln(un.y,s,l,r)]})}function ln(e,t,a,s){const n=t/s;return(e-t+n)/2+n*a}function cn({numOfItems:e,xSpacing:t=30,ySpacing:a=30}){const s=new Array;for(let n=0;n<e;n++)s.push([n*t,n*a]);return s}!function(e){e.Row="Row",e.Column="Column"}(rn||(rn={}));const dn={repoAssetsFolder:"../assets",assetsFolder:"https://s3-ap-southeast-1.amazonaws.com/source-academy-assets",fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popupDuration:1e3,defaultAssetPath:"/UI/wristDeviceButton.png",defaultFontStyle:{key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER}},un={x:1920,y:1080},hn={x:un.x/2,y:un.y/2};let pn;!function(e){e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.SpeakerBox=6]="SpeakerBox",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Collectibles=12]="Collectibles"}(pn||(pn={}));const mn=[pn.Background,pn.Selector,pn.Collectibles,pn.Objects,pn.BBox,pn.Character,pn.Speaker,pn.PopUp,pn.Dialogue,pn.SpeakerBox,pn.UI,pn.Effects,pn.Escape],gn={volume:0,ease:"Power2"};let yn;!function(e){e[e.SFX=0]="SFX",e[e.BGM=1]="BGM"}(yn||(yn={}));var En={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.2},soundType:yn.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.2},soundType:yn.SFX},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.3},soundType:yn.SFX},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.6},soundType:yn.SFX},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.7},soundType:yn.SFX},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.7},soundType:yn.SFX},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:1},soundType:yn.SFX},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:1},soundType:yn.SFX},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.2},soundType:yn.SFX},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.5},soundType:yn.SFX},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.5},soundType:yn.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.5,loop:!0},soundType:yn.BGM}};const bn={promptSize:{x:30,y:60},promptPadding:{x:30,y:10},rect:{x:10,y:760,width:un.x-20,height:320},textPadding:{x:100,y:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},vn={fontFamily:"Verdana",fontSize:"30px",fill:sn.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:bn.rect.width-2*bn.textPadding.x-20}},Sn={key:an.zektonFont.key,size:36,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var fn=bn;var Cn={shortButton:{key:"short-button",path:"/ui/shortButton.png"},mediumButton:{key:"med-button",path:"/ui/mediumButton.png"},longButton:{key:"long-button",path:"/ui/longButton.png"},topButton:{key:"top-button",path:"/ui/topButton.png"},speechBox:{key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{key:"medium-box",path:"/ui/mediumBox.png"},diamond:{key:"diamond",path:"/ui/zircon.png"},arrow:{key:"arrow",path:"/ui/arrow.png"},cookies:{key:"cookies",path:"/images/cookies.png"},scrollFrame:{key:"scroll-frame",path:"/ui/scrollFrame.png"},escapeMenuBackground:{key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{key:"award-banner",path:"/ui/collectiblesBanner.png"},awardsPageChosen:{key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{key:"award-hall-bg",path:"/ui/awardsHall.png"},chapterSelectBackground:{key:"chapter-select-bg",path:"/locations/yourRoom-dim/normal.png"},chapterRepeatButton:{key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{key:"chapter-continue",path:"/ui/chapterContinue.png"},chapterSelectFrame:{key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuBackground:{key:"main-menu-bg",path:"/locations/yourRoom-dim/normal.png"},mainMenuOptBanner:{key:"menu-option",path:"/ui/menuOption.png"},settingBackground:{key:"setting-bg",path:"/locations/yourRoom-dim/normal.png"},settingBanner:{key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{key:"verified-frame",path:"/ui/verifiedFrame.png"},bindingsBackground:{key:"setting-bg",path:"/locations/yourRoom-dim/normal.png"},squareKeyboardIcon:{key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{key:"keyboard-key-medium",path:"/ui/TabIcon.png"}};function wn(e){return new Promise(t=>setTimeout(t,e))}function An(e,t,a){return Math.min(Math.max(e,t),a)}function On(e){return dn.assetsFolder+e}function Tn(e,t){if(void 0===e)throw new Error(t||"Object not found");return e}const In=(e,t=dn.fadeDuration)=>({alpha:0,targets:e,duration:t,ease:"Power2"}),kn=(e,t=dn.fadeDuration)=>({alpha:1,targets:e,duration:t,ease:"Power2"});function Pn(e,t,{fadeDuration:a}={}){t&&(e.add.tween(In([t],a||dn.fadeDuration)),setTimeout(()=>t.destroy(),a||dn.fadeDuration))}const xn=async(e,t,a,s)=>{const n=function(e){return new Phaser.GameObjects.Rectangle(e,hn.x,hn.y,un.x,un.y,0)}(e);e.layerManager.addToLayer(pn.Effects,n),n.setAlpha(0),e.tweens.add(kn([n],t)),await wn(t),await s(),await wn(a),n.setAlpha(1),e.tweens.add(In([n],t)),await wn(t),n.destroy()};function Rn(e,t){let a=0;const s=setInterval(()=>{a%2!==0?(t.setAlpha(0),e.tweens.add(kn([t],250))):(t.setAlpha(1),e.tweens.add(In([t],250))),a++},500);return function(){a=0,clearInterval(s)}}var Nn=function(e,{x:t=0,y:a=0,textStyle:s={},typeWriterInterval:n=1}){const i=new Phaser.GameObjects.Text(e,t,a,"",s);let r,o="",l=0;return{container:i,changeLine:e=>{e&&(o=e,i.text="",l=0,r&&clearInterval(r),r=setInterval(()=>{i.text+=o[l++],l===o.length&&clearInterval(r)},n))}}};var Mn=class{constructor(e){this.typewriter=void 0,this.dialogueBox=void 0,this.blinkingDiamond=void 0;const t=Hn.getInstance().getGameManager();var a;this.dialogueBox=(a=t,new Phaser.GameObjects.Image(a,hn.x,hn.y,Cn.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return Nn(e,{x:fn.rect.x+fn.textPadding.x,y:fn.rect.y+fn.textPadding.y,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=Hn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,un.x-fn.promptSize.x-fn.promptPadding.x,un.y-fn.promptSize.y-fn.promptPadding.y,Cn.diamond.key).setDisplaySize(fn.promptSize.x,fn.promptSize.y);return{container:t,clearBlink:Rn(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=Hn.getInstance().getGameManager();this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),Pn(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}};const _n=(e,t,{x:a,y:s,oriX:n,oriY:i},r)=>new Phaser.GameObjects.BitmapText(e,a,s,r.key,t,r.size,r.align).setTintFill(r.fill).setOrigin(n,i),Dn={key:an.alienLeagueFont.key,size:100,fill:nn.paleYellow,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ln={x:hn.x,y:fn.rect.y+2*Dn.size,oriX:.5,oriY:.9};let jn,Bn,Gn,Un;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.AwardMenu="AwardMenu"}(jn||(jn={})),function(e){e.UserState="UserState",e.ChecklistState="ChecklistState"}(Bn||(Bn={})),function(e){e.collectibles="collectibles",e.assessments="assessments",e.achievements="achievements"}(Gn||(Gn={})),function(e){e[e.Add=0]="Add",e[e.Mutate=1]="Mutate",e[e.Delete=2]="Delete"}(Un||(Un={}));class Vn{constructor(){this.gameManager=void 0,this.getGameManager=()=>Tn(this.gameManager),this.gameManager=void 0}static getInstance(){return Vn.instance||(Vn.instance=new Vn),Vn.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getCurrentCheckpoint().map.getLocationAtId(e)}getModesByLocId(e){return this.getGameManager().stateManager.getLocationMode(e)}addLocationMode(e,t){this.getGameManager().stateManager.addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().stateManager.removeLocationMode(e,t)}hasLocationUpdateAttr(e,t){return this.getGameManager().stateManager.hasLocationUpdateAttr(e,t)}hasLocationUpdateMode(e,t){return this.getGameManager().stateManager.hasLocationUpdateMode(e,t)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}hasTriggeredInteraction(e){return this.getGameManager().stateManager.hasTriggeredInteraction(e)}triggerInteraction(e){this.getGameManager().stateManager.triggerInteraction(e)}consumedLocationUpdate(e,t){return this.getGameManager().stateManager.consumedLocationUpdate(e,t)}getLocationAttr(e,t){return this.getGameManager().stateManager.getLocationAttr(e,t)}addLocationAttr(e,t,a){this.getGameManager().stateManager.addLocationAttr(e,t,a)}removeLocationAttr(e,t,a){return this.getGameManager().stateManager.removeLocationAttr(e,t,a)}subscribeState(e){this.getGameManager().stateManager.subscribe(e)}unsubscribeState(e){this.getGameManager().stateManager.unsubscribe(e)}makeObjectGlow(e,t){this.getGameManager().objectManager.makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().objectManager.makeObjectBlink(e,t)}getObjPropertyMap(){return this.getGameManager().stateManager.getObjPropertyMap()}setObjProperty(e,t){this.getGameManager().stateManager.setObjProperty(e,t)}enableObjectAction(e){this.getGameManager().objectManager.enableObjectAction(e)}disableObjectAction(){this.getGameManager().objectManager.disableObjectAction()}getBBoxPropertyMap(){return this.getGameManager().stateManager.getBBoxPropertyMap()}setBBoxProperty(e,t){this.getGameManager().stateManager.setBBoxProperty(e,t)}enableBBoxAction(e){this.getGameManager().boundingBoxManager.enableBBoxAction(e)}disableBBoxAction(){this.getGameManager().boundingBoxManager.disableBBoxAction()}isAllComplete(){return this.getGameManager().stateManager.isAllComplete()}isObjectiveComplete(e){return this.getGameManager().stateManager.isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().stateManager.areObjectivesComplete(e)}completeObjective(e){this.getGameManager().stateManager.completeObjective(e)}addToUserStateList(e,t){this.getGameManager().userStateManager.addToList(e,t)}async existsInUserStateList(e,t){return await this.getGameManager().userStateManager.doesIdExistInList(e,t)}clearSeveralLayers(e){this.getGameManager().layerManager.clearSeveralLayers(e)}addContainerToLayer(e,t){this.getGameManager().layerManager.addToLayer(e,t)}fadeInLayer(e,t){this.getGameManager().layerManager.fadeInLayer(e,t)}fadeOutLayer(e,t){this.getGameManager().layerManager.fadeOutLayer(e,t)}async bringUpUpdateNotif(e){this.getGameManager(),await async function(e){const t=Hn.getInstance().getGameManager(),a=new Mn({}),s=a.getDialogueContainer();Hn.getInstance().addContainerToLayer(pn.Effects,s),Hn.getInstance().fadeInLayer(pn.Effects);const n=_n(t,e,Ln,Dn).setAlpha(0);s.add(n),gd.getInstance().getSoundManager().playSound(En.notifEnter.key),t.add.tween(kn([n],2*dn.fadeDuration)),await wn(2*dn.fadeDuration);const i=new Promise(e=>{a.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{gd.getInstance().getSoundManager().playSound(En.notifExit.key),Pn(t,n,{fadeDuration:dn.fadeDuration/4}),a.destroy(),e()})});await i}(e)}async processGameActions(e){await this.getGameManager().phaseManager.pushPhase(jn.Sequence),await this.getGameManager().actionManager.processGameActions(e),await this.getGameManager().phaseManager.popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().actionManager.processGameActions(e)}async showDialogue(e){await this.getGameManager().phaseManager.pushPhase(jn.Sequence),await this.getGameManager().dialogueManager.showDialogue(e),await this.getGameManager().phaseManager.popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().dialogueManager.showDialogue(e)}getDialogue(e){return this.getGameManager().getCurrentCheckpoint().map.getDialogues().get(e)}async obtainCollectible(e){this.getGameManager().userStateManager.addToList(Gn.collectibles,e)}displayPopUp(e,t,a){this.getGameManager().popUpManager.displayPopUp(e,t,a)}destroyAllPopUps(){this.getGameManager().popUpManager.destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().popUpManager.destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return gd.getInstance().getSoundManager()}playSound(e){gd.getInstance().getSoundManager().playSound(e)}playBgMusic(e){gd.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){gd.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){gd.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){gd.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){gd.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){gd.getInstance().getSoundManager().loadSounds(e)}enableKeyboardInput(e){this.getGameManager().inputManager.enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().inputManager.enableMouseInput(e)}async popPhase(){await this.getGameManager().phaseManager.popPhase()}async pushPhase(e){await this.getGameManager().phaseManager.pushPhase(e)}async swapPhase(e){await this.getGameManager().phaseManager.swapPhase(e)}isCurrentPhase(e){return this.getGameManager().phaseManager.isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().backgroundManager.renderBackgroundLayerContainer(e)}hideCharacterFromMap(e){this.getGameManager().characterManager.hideCharacterFromMap(e)}showCharacterOnMap(e){this.getGameManager().characterManager.showCharacterOnMap(e)}createCharacterSprite(e,t,a){return this.getGameManager().characterManager.createCharacterSprite(e,t,a)}getCharacterById(e){return this.getGameManager().characterManager.getCharacterById(e)}}Vn.instance=void 0;var Hn=Vn;let Fn,qn;!function(e){e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.LocationChange="LocationChange",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.BringUpDialogue="BringUpDialogue",e.ChangeBackground="ChangeBackground",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow",e.PlayBGM="PlayBGM",e.PlaySFX="PlaySFX"}(Fn||(Fn={}));class Xn{constructor(){this.actionMap=void 0,this.getActionFromId=e=>Tn(this.actionMap.get(e)),this.actionMap=new Map}initialise(e){this.actionMap=e.getCurrentCheckpoint().map.getActions()}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await Hn.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:a,actionConditions:s,isRepeatable:n,interactionId:i}=this.getActionFromId(e);await this.checkCanPlayAction(n,i,s)&&(await class{static async executeGameAction(e,t){const a=Hn.getInstance();switch(e){case Fn.LocationChange:return void await a.changeLocationTo(t.id);case Fn.ChangeBackground:return void a.renderBackgroundLayerContainer(t.id);case Fn.ObtainCollectible:return void a.obtainCollectible(t.id);case Fn.CompleteObjective:return void a.completeObjective(t.id);case Fn.AddItem:return void a.addLocationAttr(t.attr,t.locationId,t.id);case Fn.RemoveItem:return void a.removeLocationAttr(t.attr,t.locationId,t.id);case Fn.AddLocationMode:return void a.addLocationMode(t.locationId,t.mode);case Fn.RemoveLocationMode:return void a.removeLocationMode(t.locationId,t.mode);case Fn.BringUpDialogue:return void await a.showDialogueInSamePhase(t.id);case Fn.AddPopup:return void await a.displayPopUp(t.id,t.position,t.duration);case Fn.MakeObjectBlink:return void await a.makeObjectBlink(t.id,t.turnOn);case Fn.MakeObjectGlow:return void await a.makeObjectGlow(t.id,t.turnOn);case Fn.PlayBGM:return void gd.getInstance().getSoundManager().playBgMusic(t.id);case Fn.PlaySFX:return void await gd.getInstance().getSoundManager().playSound(t.id);default:return}}}.executeGameAction(t,a),Hn.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,a){return(e||!Hn.getInstance().hasTriggeredInteraction(t))&&await class{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map(async e=>await this.checkConditionSatisfied(e)))).every(e=>!0===e)}static async checkConditionSatisfied(e){const{state:t,conditionParams:a,boolean:s}=e;switch(t){case Bn.UserState:return await Hn.getInstance().existsInUserStateList(a.listName,a.id)===s;case Bn.ChecklistState:return Hn.getInstance().isObjectiveComplete(a.id)===s;default:return!0}}}.checkAllConditionsSatisfied(a)}}!function(e){e.navigation="navigation",e.talkTopics="talkTopics",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles"}(qn||(qn={}));var Wn=class{constructor(){this.observerId=void 0,this.bboxes=void 0,this.observerId="GameBoundingBoxManager",this.bboxes=new Map}initialise(){Hn.getInstance().subscribeState(this)}notify(e,t,a){const s=Hn.getInstance().hasLocationUpdateAttr(t,qn.boundingBoxes),n=Hn.getInstance().getCurrLocId();s&&t===n&&(Hn.getInstance().consumedLocationUpdate(t,qn.boundingBoxes),a?this.handleBBoxChange(e,a):this.renderBBoxLayerContainer(t))}renderBBoxLayerContainer(e){Hn.getInstance().clearSeveralLayers([pn.BBox]);const t=Hn.getInstance().getLocationAttr(qn.boundingBoxes,e);this.bboxes.clear(),t.map(e=>this.handleAdd(e))}enableBBoxAction(e){this.bboxes.forEach(t=>t.activate(e))}disableBBoxAction(){this.bboxes.forEach(e=>e.deactivate())}createBBox(e,t){const{x:a,y:s,width:n,height:i,actionIds:r,interactionId:o}=t,l=new Phaser.GameObjects.Rectangle(e,a,s,n,i,0,0);return t.isInteractive&&l.setInteractive(),{sprite:l,activate:r?function({onClick:e=(e=>{}),onPointerout:t=(e=>{}),onHover:a=(e=>{})}){l.on("pointerup",async()=>{e(o),await Hn.getInstance().processGameActions(r)}),l.on("pointerover",()=>{a(o)}),l.on("pointerout",()=>{t(o)})}:dn.nullFunction,deactivate:function(){l.off("pointerup"),l.off("pointerover"),l.off("pointerout")}}}handleBBoxChange(e,t){switch(e){case Un.Add:return this.handleAdd(t);case Un.Mutate:return this.handleMutate(t);case Un.Delete:return this.handleDelete(t)}}handleAdd(e){const t=Hn.getInstance().getGameManager(),a=Tn(Hn.getInstance().getBBoxPropertyMap().get(e)),s=this.createBBox(t,a);return Hn.getInstance().addContainerToLayer(pn.BBox,s.sprite),this.bboxes.set(e,s),s}handleMutate(e){this.handleDelete(e),this.handleAdd(e)}handleDelete(e){const t=this.bboxes.get(e);t&&t.sprite.destroy()}};function zn(e,t,a){const s=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=a||t*s):(e.displayWidth=a/s,e.displayHeight=a)}function Yn(e,t,a){e.displayWidth>e.displayHeight?zn(e,0,a):zn(e,t)}function $n(e,t,a){e.displayWidth>e.displayHeight?zn(e,t):zn(e,0,a)}var Kn={charWidth:700,charRect:{x:{Left:350,Middle:hn.x,Right:un.x-350},y:800,height:.4*un.y}};class Qn{constructor(){this.observerId=void 0,this.characterMap=void 0,this.characterSpriteMap=void 0,this.getCharacterById=e=>Tn(this.characterMap.get(e)),this.observerId="GameCharacterManager",this.characterMap=new Map,this.characterSpriteMap=new Map}initialise(e){this.characterMap=e.getCurrentCheckpoint().map.getCharacters(),Hn.getInstance().subscribeState(this)}notify(e,t,a){const s=Hn.getInstance().hasLocationUpdateAttr(t,qn.characters),n=Hn.getInstance().getCurrLocId();s&&t===n&&(Hn.getInstance().consumedLocationUpdate(t,qn.characters),a?this.handleCharacterChange(e,a):this.renderCharacterLayerContainer(t))}renderCharacterLayerContainer(e){const t=Hn.getInstance().getLocationAttr(qn.characters,e);this.characterSpriteMap.clear(),t.map(e=>this.handleAdd(e))}createCharacterSprite(e,t,a){const s=this.getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r}=s,o=Kn.charRect.x[a||n],l=r.get(t||i),c=new Phaser.GameObjects.Image(Hn.getInstance().getGameManager(),o,un.y,l).setOrigin(.5,1);return zn(c,Kn.charWidth),c}handleCharacterChange(e,t){switch(e){case Un.Add:return this.handleAdd(t);case Un.Mutate:return this.handleMutate(t);case Un.Delete:return this.handleDelete(t)}}handleAdd(e){const t=this.createCharacterSprite(e);return Hn.getInstance().addContainerToLayer(pn.Character,t),this.characterSpriteMap.set(e,t),t}handleMutate(e){this.handleDelete(e),this.handleAdd(e)}handleDelete(e){const t=this.characterSpriteMap.get(e);t&&t.destroy()}showCharacterOnMap(e){const t=this.characterSpriteMap.get(e);t&&Hn.getInstance().getGameManager().add.tween(kn([t]))}hideCharacterFromMap(e){const t=this.characterSpriteMap.get(e);t&&Hn.getInstance().getGameManager().add.tween(In([t]))}}class Jn{constructor(e){this.currPart=void 0,this.currLineNum=void 0,this.dialogueContent=void 0,this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){if(!this.dialogueContent.get(e.goto))return{line:""};this.currPart=e.goto,this.currLineNum=0}else this.currLineNum++;return e}}let Zn;!function(e){e.Left="Left",e.Middle="Middle",e.Right="Right"}(Zn||(Zn={}));class ei{static splitToParagraph(e){const t=[];return e.forEach(e=>{if(e.startsWith("\t")||e.startsWith("    ")){const a=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(a)}else t.push([e.trim(),[]])}),t}static mapByHeader(e,t){const a=new Map;if(!t(e[0]))return a.set("0",e),a;let s="";return e.forEach(e=>{if(t(e))return s=e,void a.set(e,[]);a.get(s).push(e)}),a}static splitByChar(e,t,a){let s=[];if(a){let n="";for(let i=0;i<e.length;i++){const r=e[i];r===t&&s.length<a?(s.push(n),n=""):n+=r}s.push(n)}else s=e.split(t);return s.map(e=>e.trim())}static splitToLines(e){return e.split("\n").map(e=>e.trimRight()).filter(e=>""!==e)}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(ei.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===dn.nullInteractionId}}class ti{constructor(e){this.currentSpeakerId=void 0,this.username=void 0,this.username=e}changeSpeakerTo(e){void 0!==e&&(this.hidePreviousSpeaker(this.currentSpeakerId),this.showNewSpeaker(e))}hidePreviousSpeaker(e){e&&(Hn.getInstance().clearSeveralLayers([pn.Speaker,pn.SpeakerBox]),Hn.getInstance().showCharacterOnMap(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){const t="you"===e?this.createSpeakerBox(this.username,Zn.Right):this.createSpeakerBox(Hn.getInstance().getCharacterById(e).name,Zn.Left);Hn.getInstance().addContainerToLayer(pn.SpeakerBox,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:a}){if("you"===e||"narrator"===e)return;Hn.getInstance().hideCharacterFromMap(e);const s=Hn.getInstance().createCharacterSprite(e,a,t);Hn.getInstance().addContainerToLayer(pn.Speaker,s),this.currentSpeakerId=e}createSpeakerBox(e,t){const a=Hn.getInstance().getGameManager(),s=new Phaser.GameObjects.Container(a,0,0),n=new Phaser.GameObjects.Image(a,hn.x,hn.y,Cn.speakerBox.key).setAlpha(.8),i=_n(a,"",fn.speakerTextConfig,Sn);return t===Zn.Right&&(n.displayWidth*=-1,i.x=un.x-i.x),s.add([n,i]),i.text=ei.capitalize(e),s}}class ai{constructor(){this.dialogueMap=void 0,this.username=void 0,this.speakerRenderer=void 0,this.dialogueRenderer=void 0,this.dialogueGenerator=void 0,this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.dialogueMap=new Map,this.username=""}initialise(e){this.username=gd.getInstance().getAccountInfo().name,this.dialogueMap=e.getCurrentCheckpoint().map.getDialogues()}async showDialogue(e){const t=this.dialogueMap.get(e);t&&(this.dialogueRenderer=new Mn(vn),this.dialogueGenerator=new Jn(t.content),this.speakerRenderer=new ti(this.username),Hn.getInstance().addContainerToLayer(pn.Dialogue,this.dialogueRenderer.getDialogueContainer()),Hn.getInstance().fadeInLayer(pn.Dialogue),await new Promise(e=>this.playWholeDialogue(e)))}async playWholeDialogue(e){await this.showNextLine(e),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,async()=>{Hn.getInstance().playSound(En.dialogueAdvance.key),await this.showNextLine(e)})}async showNextLine(e){const{line:t,speakerDetail:a,actionIds:s}=this.getDialogueGenerator().generateNextLine(),n=t.replace("{name}",this.username);this.getDialogueRenderer().changeText(n),this.getSpeakerRenderer().changeSpeakerTo(a),await Hn.getInstance().processGameActionsInSamePhase(s),t||(e(),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null))}}const si=hn.x-160,ni=hn.y,ii=si+10,ri=ni+10;function oi(e){let t,a;e.load.on("start",()=>{t=e.add.graphics(),a=e.add.graphics(),a.fillStyle(2236962,.8),a.fillRect(si,ni,320,50)}),e.load.on("progress",e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(ii,ri,300*e,30)}),e.load.on("complete",(function(){t.destroy(),a.destroy()}))}var li=class{constructor(){this.mainLayer=void 0,this.layers=void 0,this.mainLayer=void 0,this.layers=new Map}initialise(e){this.mainLayer=new Phaser.GameObjects.Container(e,0,0),e.add.existing(this.mainLayer);for(const t of mn){const a=new Phaser.GameObjects.Container(e,0,0);this.layers.set(t,a),this.mainLayer.add(a)}}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e,t=dn.fadeDuration){const a=Hn.getInstance().getGameManager(),s=this.layers.get(e);s.setAlpha(0),a.tweens.add(kn([s],t)),wn(t)}async fadeOutLayer(e,t=dn.fadeDuration){const a=Hn.getInstance().getGameManager(),s=this.layers.get(e);s.setAlpha(1),a.tweens.add(In([s],t)),wn(t)}addToLayer(e,t){const a=this.layers.get(e);a&&a.add(t)}clearSeveralLayers(e){e.forEach(e=>this.clearLayerContents(e))}clearAllLayers(){this.layers.forEach((e,t)=>this.clearLayerContents(t))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}};class ci{constructor(e,t,a,s,n,i){this.scene=void 0,this.container=void 0,this.imageGlow=void 0,this.clickArea=void 0,this.glowClearer=void 0,this.blinkClearer=void 0,this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,a);const r=new Phaser.GameObjects.Image(e,0,0,s);this.imageGlow=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(0).setTint(nn.yellow),this.clickArea=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(.01).setInteractive({pixelPerfect:!0}),n&&(zn(r,n,i),zn(this.imageGlow,n,i),zn(this.clickArea,n,i)),this.container.add([r,this.imageGlow,this.clickArea])}startGlow(){this.glowClearer&&this.glowClearer(),this.glowClearer=Rn(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer&&this.glowClearer(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=Rn(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer&&this.blinkClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}var di=class{constructor(){this.observerId=void 0,this.objects=void 0,this.observerId="GameObjectManager",this.objects=new Map}initialise(){Hn.getInstance().subscribeState(this)}notify(e,t,a){const s=Hn.getInstance().hasLocationUpdateAttr(t,qn.objects),n=Hn.getInstance().getCurrLocId();s&&t===n&&(Hn.getInstance().consumedLocationUpdate(t,qn.objects),a?this.handleObjectChange(e,a):this.renderObjectsLayerContainer(t))}renderObjectsLayerContainer(e){Hn.getInstance().clearSeveralLayers([pn.Objects]);const t=Hn.getInstance().getLocationAttr(qn.objects,e);this.objects.clear(),t.map(e=>this.handleAdd(e))}enableObjectAction(e){this.objects.forEach(t=>t.activate(e))}disableObjectAction(){this.objects.forEach(e=>e.deactivate())}makeObjectGlow(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startGlow():a.sprite.clearGlow())}makeObjectBlink(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startBlink():a.sprite.clearBlink())}createObject(e,t){const{assetKey:a,x:s,y:n,width:i,height:r,actionIds:o,interactionId:l}=t,c=new ci(e,s,n,a,i,r);return{sprite:c,activate:o?function({onClick:e=(e=>{}),onPointerout:t=(e=>{}),onHover:a=(e=>{})}){c.getClickArea().on("pointerup",async()=>{e(l),await Hn.getInstance().processGameActions(o)}),c.getClickArea().on("pointerover",()=>{a(l)}),c.getClickArea().on("pointerout",()=>{t(l)})}:dn.nullFunction,deactivate:function(){c.getClickArea().off("pointerup"),c.getClickArea().off("pointerover"),c.getClickArea().off("pointerout")}}}handleObjectChange(e,t){switch(e){case Un.Add:return this.handleAdd(t);case Un.Mutate:return this.handleMutate(t);case Un.Delete:return this.handleDelete(t)}}handleAdd(e){const t=Hn.getInstance().getGameManager(),a=Tn(Hn.getInstance().getObjPropertyMap().get(e)),s=this.createObject(t,a);return Hn.getInstance().addContainerToLayer(pn.Objects,s.sprite.getContainer()),this.objects.set(e,s),s}handleMutate(e){this.handleDelete(e),this.handleAdd(e)}handleDelete(e){const t=this.objects.get(e);t&&t.sprite.getContainer().destroy()}};const ui=hn.y/2;var hi={imgXOffset:20,imgYOffset:20,rect:{x:{Left:350,Middle:hn.x,Right:un.x-350},y:ui,width:280,height:280},tweenDuration:300};var pi=class{constructor(){this.currPopUp=void 0,this.currPopUp=new Map}async displayPopUp(e,t,a=dn.popupDuration){this.destroyPopUp(t);const s=Hn.getInstance().getGameManager(),n=new Phaser.GameObjects.Container(s,0,0),i=new Phaser.GameObjects.Image(s,hi.rect.x[t],hi.rect.y,Cn.popUpFrame.key),r=this.getAssetKey(e);if(!r)return;const o=new Phaser.GameObjects.Image(s,hi.rect.x[t]+hi.imgXOffset,hi.rect.y+hi.imgYOffset,r);$n(o,hi.rect.width,hi.rect.height),n.add([i,o]),this.currPopUp.set(t,n),Hn.getInstance().addContainerToLayer(pn.PopUp,n),Hn.getInstance().playSound(En.popUpEnter.key),n.setActive(!0),n.setVisible(!0),n.setScale(1,0),s.tweens.add(((e,t=500)=>({scaleY:1,targets:e,duration:t,ease:"Power1"}))([n],hi.tweenDuration)),await wn(hi.tweenDuration),setTimeout(()=>this.destroyPopUp(t),a)}destroyAllPopUps(){this.currPopUp.forEach((e,t,a)=>{this.destroyPopUp(t)})}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(Hn.getInstance().getGameManager().tweens.add(((e,t=500)=>({scaleY:0,targets:e,duration:t,ease:"Power1"}))([t],hi.tweenDuration)),await wn(hi.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),Hn.getInstance().playSound(En.popUpExit.key))}getAssetKey(e){const t=Hn.getInstance().getGameManager().getCurrentCheckpoint().map.getObjects().get(e);if(t)return t.assetKey}};let mi;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu"}(mi||(mi={}));const gi={Move:jn.Move,Explore:jn.Explore,Talk:jn.Talk,Menu:jn.Menu};var yi=class{constructor(){this.objective=void 0,this.totalNumOfObjectives=void 0,this.numOfCompletedObjectives=void 0,this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const a=this.objective.get(e);this.objective.set(e,t),void 0!==a&&a!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach(e=>this.addObjective(e))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){return this.objective.get(e)}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};function Ei(e){const t={};return e.forEach((e,a)=>{t[a]=e}),t}function bi(e){const t=new Map;return Object.keys(e).length&&Object.keys(e).forEach(a=>{t.set(a,e[a])}),t}function vi(e){const t={};return e.forEach((e,a)=>{const s=Qe.mapValues(e,e=>e instanceof Set?Array.from(e):e);t[a]=s}),t}var Si=class{constructor(){this.subscribers=void 0,this.checkpoint=void 0,this.checkpointObjective=void 0,this.locationHasUpdate=void 0,this.locationStates=void 0,this.objectPropertyMap=void 0,this.bboxPropertyMap=void 0,this.triggeredInteractions=void 0,this.getLocationById=e=>Tn(this.locationStates.get(e)),this.subscribers=new Array,this.checkpoint={},this.checkpointObjective=new yi,this.locationHasUpdate=new Map,this.locationStates=new Map,this.objectPropertyMap=new Map,this.bboxPropertyMap=new Map,this.triggeredInteractions=new Map}update(e,t,a){this.subscribers.forEach(s=>s.notify(e,t,a))}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t.observerId!==e.observerId)}updateLocationStateMode(e,t,a){switch(a){case mi.Explore:return this.updateLocationStateAttr(e,t,qn.boundingBoxes),void this.updateLocationStateAttr(e,t,qn.objects);case mi.Move:return void this.updateLocationStateAttr(e,t,qn.navigation);case mi.Talk:return void this.updateLocationStateAttr(e,t,qn.talkTopics);default:return}}updateLocationStateAttr(e,t,a,s){const n=Hn.getInstance().getCurrLocId();this.locationHasUpdate.get(t).set(a,!0),n!==t&&this.triggeredInteractions.set(t,!1),this.update(e,t,s)}checkLocationsExist(e){e.forEach(e=>Tn(this.locationStates.get(e)))}initialise(e){this.checkpoint=e.getCurrentCheckpoint();const t=e.getSaveManager().getLoadedGameStoryState();this.checkpointObjective=this.checkpoint.objectives,t?this.loadFromGameStoryState(t):this.loadNewGameStoryState(),this.locationStates.forEach((e,t)=>{this.locationHasUpdate.set(t,new Map),Object.values(qn).forEach(e=>this.locationHasUpdate.get(t).set(e,!1))})}loadFromGameStoryState(e){this.checkpointObjective.setObjectives(bi(e.chapterObjective)),this.locationStates=function(e){const t=new Map;return Object.keys(e).length&&Object.keys(e).forEach(a=>{const s=Qe.mapValues(e[a],e=>e instanceof Array?new Set(e):e);t.set(a,s)}),t}(e.locationStates),this.objectPropertyMap=bi(e.objectPropertyMap),this.bboxPropertyMap=bi(e.bboxPropertyMap),this.triggeredInteractions=bi(e.triggeredInteractions)}loadNewGameStoryState(){this.checkpointObjective=this.checkpoint.objectives,this.locationStates=this.checkpoint.map.getLocations(),this.objectPropertyMap=this.checkpoint.map.getObjects(),this.bboxPropertyMap=this.checkpoint.map.getBBoxes(),this.triggeredInteractions.clear()}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}hasLocationUpdateMode(e,t){if(t)switch(t){case mi.Explore:return this.hasLocationUpdateAttr(e,qn.boundingBoxes),void this.hasLocationUpdateAttr(e,qn.objects);case mi.Move:return void this.hasLocationUpdateAttr(e,qn.navigation);case mi.Talk:return void this.hasLocationUpdateAttr(e,qn.talkTopics);default:return}return this.hasLocationUpdateAttr(e)}hasLocationUpdateAttr(e,t){if(this.checkLocationsExist([e]),t)return this.locationHasUpdate.get(e).get(t);let a=!1;return this.locationHasUpdate.get(e).forEach((e,t,s)=>a=a||e),a}consumedLocationUpdate(e,t){this.checkLocationsExist([e]),this.locationHasUpdate.get(e).set(t,!1)}getLocationMode(e){return Array.from(this.checkpoint.map.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.getLocationById(e).modes.add(t),this.locationStates.get(e).modes.add(t),this.updateLocationStateMode(Un.Add,e,mi.Menu)}removeLocationMode(e,t){const a=this.getLocationById(e);a.modes&&(a.modes.delete(t),this.updateLocationStateMode(Un.Delete,e,mi.Menu))}getLocationAttr(e,t){const a=this.getLocationById(t);return Array.from(a[e])||[]}addLocationAttr(e,t,a){const s=this.getLocationById(t);s[e]||(s[e]=new Set([])),s[e].add(a),this.updateLocationStateAttr(Un.Add,t,e,a)}removeLocationAttr(e,t,a){const s=this.getLocationById(t);s[e]&&(s[e]=s[e].filter(e=>e!==a),this.updateLocationStateAttr(Un.Delete,t,e,a))}isAllComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){const t=this.checkpointObjective.getObjectiveState(e);return!(void 0!==t&&!t)}areObjectivesComplete(e){let t=!0;return e.forEach(e=>t=t&&this.isObjectiveComplete(e)),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}getObjPropertyMap(){return this.objectPropertyMap}setObjProperty(e,t){this.objectPropertyMap.set(e,t),this.locationStates.forEach((t,a)=>{t.objects&&t.objects.has(e)&&this.updateLocationStateAttr(Un.Mutate,a,qn.objects,e)})}getBBoxPropertyMap(){return this.bboxPropertyMap}setBBoxProperty(e,t){this.bboxPropertyMap.set(e,t),this.locationStates.forEach((t,a)=>{t.boundingBoxes&&t.boundingBoxes.delete(e)&&this.updateLocationStateAttr(Un.Mutate,a,qn.boundingBoxes,e)})}getLocationStates(){return this.locationStates}getCheckpointObjectives(){return this.checkpointObjective}getTriggeredInteractions(){return this.triggeredInteractions}},fi=a(2),Ci=a(833),wi=a(865);const Ai=(e=Pt,t)=>{switch(t.type){case"LOG_OUT":return Pt;case"SAVE_CANVAS":return{...e,gameCanvas:t.payload};default:return e}},Oi=(e=Rt,t)=>{switch(t.type){case"UPDATE_GROUP_GRADING_SUMMARY":return{...e,gradingSummary:t.payload};default:return e}},Ti=(e=Nt,t)=>{switch(t.type){case"CHANGE_QUERY_STRING":return{...e,queryString:t.payload};case"TOGGLE_USING_SUBST":return{...e,usingSubst:t.payload};case"UPDATE_SHORT_URL":return{...e,shortURL:t.payload};case"PLAYGROUND_UPDATE_PERSISTENCE_FILE":return{...e,persistenceFile:t.payload};default:return e}},Ii=(e=_t,t)=>{const a=t.payload?t.payload.workspaceLocation:"assessment";let s,n;switch(a){case"sourcecast":const a=((e,t)=>{switch(t.type){case"SAVE_SOURCECAST_DATA":return{...e,title:t.payload.title,description:t.payload.description,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case"SET_CURRENT_PLAYER_TIME":return{...e,currentPlayerTime:t.payload.playerTime};case"SET_CODE_DELTAS_TO_APPLY":return{...e,codeDeltasToApply:t.payload.deltas};case"SET_INPUT_TO_APPLY":return{...e,inputToApply:t.payload.inputToApply};case"SET_SOURCECAST_DATA":return{...e,title:t.payload.title,description:t.payload.description,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case"SET_SOURCECAST_PLAYBACK_DURATION":return{...e,playbackDuration:t.payload.duration};case"SET_SOURCECAST_PLAYBACK_STATUS":return{...e,playbackStatus:t.payload.playbackStatus};case"UPDATE_SOURCECAST_INDEX":return{...e,sourcecastIndex:t.payload.index};default:return e}})(e.sourcecast,t);if(a===e.sourcecast)break;return{...e,sourcecast:a};case"sourcereel":const s=((e,t)=>{switch(t.type){case"RECORD_INIT":return{...e,playbackData:{init:t.payload.initData,inputs:[]}};case"RECORD_INPUT":return{...e,playbackData:{...e.playbackData,inputs:[...e.playbackData.inputs,t.payload.input]}};case"RESET_INPUTS":return{...e,playbackData:{...e.playbackData,inputs:t.payload.inputs}};case"TIMER_PAUSE":return{...e,recordingStatus:Ue.paused,timeElapsedBeforePause:e.timeElapsedBeforePause+t.payload.timeNow-e.timeResumed};case"TIMER_RESET":return{...e,recordingStatus:Ue.notStarted,timeElapsedBeforePause:0,timeResumed:0};case"TIMER_RESUME":return{...e,recordingStatus:Ue.recording,timeElapsedBeforePause:t.payload.timeBefore>=0?t.payload.timeBefore:e.timeElapsedBeforePause,timeResumed:t.payload.timeNow};case"TIMER_START":return{...e,recordingStatus:Ue.recording,timeElapsedBeforePause:0,timeResumed:t.payload.timeNow};case"TIMER_STOP":return{...e,recordingStatus:Ue.finished,timeElapsedBeforePause:0,timeResumed:0};default:return e}})(e.sourcereel,t);if(s===e.sourcereel)break;return{...e,sourcereel:s}}switch(t.type){case"BROWSE_REPL_HISTORY_DOWN":if(null===e[a].replHistory.browseIndex)return e;if(0!==e[a].replHistory.browseIndex){const t=e[a].replHistory.browseIndex-1,s=e[a].replHistory.records[t];return{...e,[a]:{...e[a],replValue:s,replHistory:{...e[a].replHistory,browseIndex:t}}}}{const t=null,s=e[a].replHistory.originalValue,n=e[a].replHistory.records.slice();return{...e,[a]:{...e[a],replValue:s,replHistory:{browseIndex:t,records:n,originalValue:""}}}}case"BROWSE_REPL_HISTORY_UP":const i=e[a].replHistory.records,r=e[a].replHistory.browseIndex;if(0===i.length||null!==r&&void 0===i[r+1])return e;if(null===r){const t=0,s=i.slice(),n=e[a].replValue,r=s[t];return{...e,[a]:{...e[a],replValue:r,replHistory:{...e[a].replHistory,browseIndex:t,records:s,originalValue:n}}}}{const t=r+1,s=i[t];return{...e,[a]:{...e[a],replValue:s,replHistory:{...e[a].replHistory,browseIndex:t}}}}case"CHANGE_EDITOR_HEIGHT":return{...e,[a]:{...e[a],editorHeight:t.payload.height}};case"CHANGE_EDITOR_WIDTH":return{...e,[a]:{...e[a],editorWidth:(parseFloat(e[a].editorWidth.slice(0,-1))+parseFloat(t.payload.widthChange)).toString()+"%"}};case"CHANGE_EXEC_TIME":return{...e,[a]:{...e[a],execTime:t.payload.execTime}};case"CHANGE_SIDE_CONTENT_HEIGHT":return{...e,[a]:{...e[a],sideContentHeight:t.payload.height}};case"CLEAR_REPL_INPUT":return{...e,[a]:{...e[a],replValue:""}};case"CLEAR_REPL_OUTPUT_LAST":return{...e,[a]:{...e[a],output:e[a].output.slice(0,-1)}};case"CLEAR_REPL_OUTPUT":return{...e,[a]:{...e[a],output:[]}};case"END_CLEAR_CONTEXT":return{...e,[a]:{...e[a],context:pt(t.payload.library.chapter,t.payload.library.external.symbols,a,t.payload.library.variant,t.payload.library.moduleParams),globals:t.payload.library.globals}};case"SEND_REPL_INPUT_TO_OUTPUT":let o;return s=e[a].output.concat(t.payload),o=""!==t.payload.value?[t.payload.value].concat(e[a].replHistory.records):e[a].replHistory.records,o.length>ze.maxBrowseIndex&&o.pop(),{...e,[a]:{...e[a],output:s,replHistory:{...e[a].replHistory,records:o}}};case"CHANGE_EXTERNAL_LIBRARY":return{...e,[a]:{...e[a],externalLibrary:t.payload.newExternal}};case"HANDLE_CONSOLE_LOG":if(n=e[a].output.slice(-1)[0],void 0===n||"running"!==n.type)s=e[a].output.concat({type:"running",consoleLogs:[t.payload.logString]});else{const i={type:n.type,consoleLogs:n.consoleLogs.concat(t.payload.logString)};s=e[a].output.slice(0,-1).concat(i)}return{...e,[a]:{...e[a],output:s}};case"LOG_OUT":const l=e.playground;return{..._t,playground:l};case"EVAL_EDITOR":return{...e,[a]:{...e[a],isRunning:!0,isDebugging:!1}};case"EVAL_REPL":return{...e,[a]:{...e[a],isRunning:!0}};case"EVAL_INTERPRETER_SUCCESS":return n=e[a].output.slice(-1)[0],s=void 0!==n&&"running"===n.type?e[a].output.slice(0,-1).concat({type:t.payload.type,value:t.payload.value,consoleLogs:n.consoleLogs}):e[a].output.concat({type:t.payload.type,value:t.payload.value,consoleLogs:[]}),{...e,[a]:{...e[a],output:s,isRunning:!1,breakpoints:[],highlightedLines:[]}};case"EVAL_TESTCASE_SUCCESS":return{...e,[a]:{...e[a],editorTestcases:e[a].editorTestcases.map((e,a)=>a===t.payload.index?{...e,result:t.payload.value,errors:void 0}:e),isRunning:!1}};case"EVAL_TESTCASE_FAILURE":return{...e,[a]:{...e[a],editorTestcases:e[a].editorTestcases.map((e,a)=>a===t.payload.index?{...e,result:void 0,errors:t.payload.value}:e)}};case"EVAL_INTERPRETER_ERROR":return n=e[a].output.slice(-1)[0],s=void 0!==n&&"running"===n.type?e[a].output.slice(0,-1).concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:n.consoleLogs}):e[a].output.concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:[]}),{...e,[a]:{...e[a],output:s,isRunning:!1,isDebugging:!1}};case"END_INTERRUPT_EXECUTION":return{...e,[a]:{...e[a],isRunning:!1,isDebugging:!1}};case"END_DEBUG_PAUSE":return{...e,[a]:{...e[a],isRunning:!1,isDebugging:!0}};case"DEBUG_RESUME":return{...e,[a]:{...e[a],isRunning:!0,isDebugging:!1}};case"DEBUG_RESET":return{...e,[a]:{...e[a],isRunning:!1,isDebugging:!1}};case"RESET_TESTCASE":return{...e,[a]:{...e[a],editorTestcases:e[a].editorTestcases.map((e,a)=>a===t.payload.index?{...e,result:void 0,errors:void 0}:e)}};case"RESET_WORKSPACE":return{...e,[a]:{...e[a],...Mt(a),...t.payload.workspaceOptions}};case"INIT_INVITE":return{...e,[a]:{...e[a],sharedbAceInitValue:t.payload.editorValue,sharedbAceIsInviting:!0}};case"FINISH_INVITE":return{...e,[a]:{...e[a],sharedbAceIsInviting:!1}};case"UPDATE_WORKSPACE":return{...e,[a]:{...e[a],...t.payload.workspaceOptions}};case"SET_EDITOR_SESSION_ID":return{...e,[a]:{...e[a],editorSessionId:t.payload.editorSessionId}};case"SET_EDITOR_READONLY":return{...e,[a]:{...e[a],editorReadonly:t.payload.editorReadonly}};case"SET_WEBSOCKET_STATUS":return{...e,[a]:{...e[a],websocketStatus:t.payload.websocketStatus}};case"TOGGLE_EDITOR_AUTORUN":return{...e,[a]:{...e[a],isEditorAutorun:!e[a].isEditorAutorun}};case"UPDATE_ACTIVE_TAB":return{...e,[a]:{...e[a],sideContentActiveTab:t.payload.activeTab}};case"UPDATE_CURRENT_ASSESSMENT_ID":return{...e,assessment:{...e.assessment,currentAssessment:t.payload.assessmentId,currentQuestion:t.payload.questionId}};case"UPDATE_CURRENT_SUBMISSION_ID":return{...e,grading:{...e.grading,currentSubmission:t.payload.submissionId,currentQuestion:t.payload.questionId}};case"UPDATE_EDITOR_VALUE":return{...e,[a]:{...e[a],editorValue:t.payload.newEditorValue}};case"HIGHLIGHT_LINE":return{...e,[a]:{...e[a],highlightedLines:t.payload.highlightedLines}};case"MOVE_CURSOR":return{...e,[a]:{...e[a],newCursorPosition:t.payload.cursorPosition}};case"UPDATE_REPL_VALUE":return{...e,[a]:{...e[a],replValue:t.payload.newReplValue}};case"UPDATE_HAS_UNSAVED_CHANGES":return{...e,[a]:{...e[a],hasUnsavedChanges:t.payload.hasUnsavedChanges}};case"UPDATE_CHAPTER":return{...e,playground:{...e.playground,context:{...e.playground.context,chapter:t.payload.chapter,variant:t.payload.variant}}};case"NOTIFY_PROGRAM_EVALUATED":return{...e,[a]:{...e[a],debuggerContext:{...e[a].debuggerContext,result:t.payload.result,lastDebuggerResult:t.payload.lastDebuggerResult,code:t.payload.code,context:t.payload.context,workspaceLocation:t.payload.workspaceLocation}}};default:return e}},ki=(e=xt,t)=>e;var Pi=e=>Object(A.c)({router:Object(E.b)(e),academy:Ai,application:ki,dashboard:Oi,playground:Ti,session:jt,workspaces:Ii});const xi=e=>Object(O.action)("FINISH_INVITE",{workspaceLocation:e}),Ri=(e,t)=>Object(O.action)("INIT_INVITE",{editorValue:e,workspaceLocation:t}),Ni=()=>Object(O.action)("INVALID_EDITOR_SESSION_ID"),Mi=(e,t)=>Object(O.action)("SET_EDITOR_SESSION_ID",{workspaceLocation:e,editorSessionId:t}),_i=(e,t)=>Object(O.action)("SET_WEBSOCKET_STATUS",{workspaceLocation:e,websocketStatus:t}),Di=e=>Object(O.action)("SAVE_CANVAS",e),Li=(e,t,a)=>Object(O.action)("CHANGE_DATE_ASSESSMENT",{id:e,openAt:t,closeAt:a}),ji=e=>Object(O.action)("DELETE_ASSESSMENT",e),Bi=(e,t)=>Object(O.action)("PUBLISH_ASSESSMENT",{id:t,togglePublishTo:e}),Gi=(e,t)=>Object(O.action)("UPLOAD_ASSESSMENT",{file:e,forceUpdate:t}),Ui=()=>Object(O.action)("PERSISTENCE_OPEN_PICKER"),Vi=e=>Object(O.action)("PERSISTENCE_SAVE_FILE",e),Hi=()=>Object(O.action)("PERSISTENCE_SAVE_FILE_AS"),Fi=()=>Object(O.action)("PERSISTENCE_INITIALISE"),qi=()=>Object(O.action)("GENERATE_LZ_STRING"),Xi=e=>Object(O.action)("SHORTEN_URL",e),Wi=e=>Object(O.action)("UPDATE_SHORT_URL",e),zi=e=>Object(O.action)("TOGGLE_USING_SUBST",e),Yi=e=>Object(O.action)("CHANGE_QUERY_STRING",e),$i=e=>Object(O.action)("PLAYGROUND_UPDATE_PERSISTENCE_FILE",e),Ki=e=>Object(O.action)("FETCH_SOURCECAST_INDEX",{workspaceLocation:e}),Qi=(e,t)=>Object(O.action)("UPDATE_SOURCECAST_INDEX",{index:e,workspaceLocation:t}),Ji=(e,t,a,s,n)=>Object(O.action)("SAVE_SOURCECAST_DATA",{title:e,description:t,audio:a,audioUrl:window.URL.createObjectURL(a),playbackData:s,workspaceLocation:n}),Zi=(e,t)=>Object(O.action)("SET_CURRENT_PLAYER_TIME",{playerTime:e,workspaceLocation:t}),er=(e,t)=>Object(O.action)("SET_CODE_DELTAS_TO_APPLY",{deltas:e,workspaceLocation:t}),tr=(e,t)=>Object(O.action)("SET_INPUT_TO_APPLY",{inputToApply:e,workspaceLocation:t}),ar=(e,t,a,s,n)=>Object(O.action)("SET_SOURCECAST_DATA",{title:e,description:t,audioUrl:a,playbackData:s,workspaceLocation:n}),sr=(e,t)=>Object(O.action)("SET_SOURCECAST_PLAYBACK_DURATION",{duration:e,workspaceLocation:t}),nr=(e,t)=>Object(O.action)("SET_SOURCECAST_PLAYBACK_STATUS",{playbackStatus:e,workspaceLocation:t}),ir=(e,t)=>Object(O.action)("DELETE_SOURCECAST_ENTRY",{id:e,workspaceLocation:t}),rr=(e,t)=>Object(O.action)("RECORD_INIT",{initData:e,workspaceLocation:t}),or=(e,t)=>Object(O.action)("RECORD_INPUT",{input:e,workspaceLocation:t}),lr=(e,t)=>Object(O.action)("RESET_INPUTS",{inputs:e,workspaceLocation:t}),cr=e=>Object(O.action)("TIMER_PAUSE",{timeNow:Date.now(),workspaceLocation:e}),dr=e=>Object(O.action)("TIMER_RESET",{workspaceLocation:e}),ur=(e,t)=>Object(O.action)("TIMER_RESUME",{timeBefore:e,timeNow:Date.now(),workspaceLocation:t}),hr=e=>Object(O.action)("TIMER_START",{timeNow:Date.now(),workspaceLocation:e}),pr=e=>Object(O.action)("TIMER_STOP",{timeNow:Date.now(),workspaceLocation:e}),mr={...n,...l,...o,...r,...h,...i,...p,...m,...g,...s,...d,...c,...u},gr=[...[{category:Yt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",grade:1,id:1,maxGrade:3e3,maxXp:1e3,openAt:"2038-06-18T05:24:26.026Z",title:"An Odessey to Runes (Duplicate)",shortSummary:"This is a test for the UI of the unopened assessment overview. It links to the mock Mission 0",status:Wt.not_attempted,story:"mission-1",xp:0,gradingStatus:zt.none}],...[{category:Yt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",grade:2,id:1,maxGrade:3e3,maxXp:1e3,openAt:"2018-06-18T05:24:26.026Z",title:"An Odessey to Runes",shortSummary:"\n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor\n  incididunt ut labore et dolore magna aliqua.\n  \n  ```\n  const a = 5;\n  ```\n  \n  Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium\n  _doloremque laudantium_, totam rem aperiam, eaque ipsa quae ab illo inventore\n  [veritatis et quasi architecto](google.com) beatae vitae dicta sunt\n  `explicabo`.\n  \n  ",status:Wt.attempted,story:"mission-1",xp:1,gradingStatus:zt.none},{category:Yt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=World&font=lobster",grade:3,id:2,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"The Secret to Streams",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Wt.attempting,story:"mission-2",xp:2,gradingStatus:zt.none},{category:Yt.Sidequest,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",grade:4,id:3,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Sidequest",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Wt.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:zt.none},{category:Yt.Path,closeAt:"2069-04-20T01:23:45.111Z",coverImage:"https://fakeimg.pl/700x400/417678,64/?text=%E3%83%91%E3%82%B9&font=noto",grade:0,id:6,maxGrade:0,maxXp:200,openAt:"2018-01-01T00:00:00.000Z",title:"Basic logic gates",shortSummary:"This mock path serves as a demonstration of the support provided for mock programming path functionality.",status:Wt.not_attempted,story:null,xp:0,gradingStatus:zt.excluded},{category:Yt.Practical,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",grade:4,id:5,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Practical",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Wt.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:zt.none,private:!0}],...[{category:Yt.Mission,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",grade:2700,id:4,maxGrade:3e3,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"A closed Mission",shortSummary:"This is a test for the grading status tooltip when the assessment is partially graded (undergoing manual grading). It should render as an orange clock.",status:Wt.submitted,story:"mission-3",xp:800,gradingStatus:zt.grading},{category:Yt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",grade:1950,id:5,maxGrade:3e3,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (not graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is not graded. It should render as a red cross.",status:Wt.submitted,story:null,xp:500,gradingStatus:zt.none},{category:Yt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",grade:300,id:5,maxGrade:700,maxXp:500,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (fully graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is fully graded. It should render as a green tick. This sidequest links to the mock Sidequest 4.",status:Wt.submitted,story:null,xp:150,gradingStatus:zt.graded},{category:Yt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",grade:0,id:5,maxGrade:0,maxXp:0,openAt:"2007-07-18T05:24:26.026Z",title:"Ungraded assessment",shortSummary:"This is a test for the grading status tooltip when the assessment does not require manual grading (e.g. paths and contests). It should render as a blue disable sign. This sidequest links to the mock Sidequest 4.",status:Wt.submitted,story:null,xp:100,gradingStatus:zt.excluded}]],yr=[["testNumber",3.141592653589793],["testString","who dat boi"],["testBooleanTrue",!0],["testBooleanFalse",!1],["testBooleanUndefined",void 0],["testBooleanNull",null],["testObject",{a:1,b:2}],["testArray",[1,2,"a","b"]]],Er={chapter:4,external:{name:yt.SOUNDS,symbols:wt.get(yt.SOUNDS)},globals:yr},br={chapter:1,external:{name:yt.RUNES,symbols:wt.get(yt.RUNES)},globals:yr},vr={chapter:4,external:{name:yt.CURVES,symbols:wt.get(yt.CURVES)},globals:yr},Sr={chapter:4,external:{name:yt.SOUNDS,symbols:["get_matrix"]},globals:yr},fr=[{autogradingResults:[],answer:null,content:"\n  This question has an id of `0`.\n  \n  ```\n  What's your favourite dinner food?\n  ```\n  ",roomId:null,id:0,library:Er,prepend:'const pizza = "pizza";\n  const sushi = "sushi";\n  const chickenrice = "chicken rice";',postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:$t.public,program:"answer();",score:1,answer:'"pizza"'},{type:$t.public,program:"answer();",score:1,answer:'"sushi"'},{type:$t.public,program:"answer();",score:1,answer:'"chicken rice"'}],solutionTemplate:"function answer() {\n      // Write something here!\n  }\n  ",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2},{autogradingResults:[],answer:"function areaOfCircle(x) {\n      return square(x) * pi;\n  }\n  \n  function volumeOfSphere(x) {\n      return 4 / 3 * cube(x) * pi;\n  }",roomId:"19422043",content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:br,prepend:"const square = x => x * x;\n  const cube = x => x * x * x;\n  const pi = 3.1415928;",postpend:"",testcases:[{type:$t.public,program:"areaOfCircle(5);",score:1,answer:"78.53982"},{type:$t.public,program:"volumeOfSphere(5);",score:1,answer:"523.5988"}],solutionTemplate:"function areaOfCircle(x) {\n      // return area of circle\n  }\n  \n  function volumeOfSphere(x) {\n      // return volume of sphere\n  }",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2},{answer:3,roomId:"19422046",content:"This is the 3rd question. Oddly enough, it is an ungraded MCQ question that uses the curves library! Option C has a null hint!",choices:[{content:"**Option** `A`",hint:"_hint_ A is `here`"},{content:"### B",hint:"hint B"},{content:"C",hint:null},{content:"D",hint:"hint D"}],id:2,library:vr,type:"mcq",solution:0,xp:0,grade:0,maxGrade:2,maxXp:2},{answer:3,roomId:null,content:"This is the 4rth question. Oddly enough, it is a graded MCQ question that uses the curves library!",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:3,library:vr,type:"mcq",solution:null,xp:0,grade:0,maxGrade:2,maxXp:2},{autogradingResults:[],answer:null,roomId:"19422032",content:"You have reached the last question! Have some fun with the tone matrix...",id:4,library:Sr,prepend:"",postpend:"",testcases:[],solutionTemplate:"5th question mock solution template",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2}],Cr=[{answer:"function fibonacci(n) {\n      if (n <= 2) {\n          return 1;\n      } else {\n          return fibonacci(n-1) + fibonacci(n-2);\n      }\n  }",roomId:"19422032",content:"You can see autograding results!!!",id:0,library:vr,prepend:"",postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:$t.public,program:"fibonacci(3);",score:1,answer:"2"},{type:$t.public,program:"fibonacci(4);",score:1,answer:"3"},{type:$t.public,program:"fibonacci(5);",score:1,answer:"5"}],solutionTemplate:"function fibonacci(n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,grade:0,maxGrade:2,maxXp:2,comments:"Good job. You are awarded the full marks!\n  \n  ----\n  ## markdown test\n  \n  # header\n  \n  **bold**\n  \n  _italics_\n  \n  * list\n  \n  1. numbered list\n  \n  - [] checkboxes\n  \n  > quote\n  \n      code\n  \n  [link to Source Academy](https://sourceacademy.nus.edu.sg)  \n  \n  ![](image-url-goes-here)",autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},{answer:"function recurse(rune, n) {\n      return n <= 1 ? rune : make_cross(recurse(rune, n - 1));\n  }",roomId:"19422033",content:"This is a runes question - there are no testcases nor autograding results.",id:1,library:br,prepend:"",postpend:"",testcases:[],solutionTemplate:"function recurse(rune, n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"some avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,grade:0,maxGrade:2,maxXp:2,comments:"You open the Report Card, not knowing what to expect...\n  \n      ## WOW!\n      Amazing grasp of runes. We can now move on to the next assignment.\n      \n      <br/>\n      \n      Robot Dog: `woof`\n      \n      You look at the display of the robot dog.\n      \n          FEED ME\n      1. Bread\n      2. Water\n      \n      <br/>\n      \n      * I am hungry.\n      * I am thirsty.\n      \n      <br/>\n      <br/>\n          \n      New message from **Avenger**!\n      \n      > _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n      \n      > _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n      \n      > Best regards, Avocado A. Avenger\n      \n      #### Upcoming Tasks\n      - [] Meet Avenger Avenger at Level X-05\n      - [] Open the Pod Bay Doors",autogradingResults:[]}],wr=[{answer:null,roomId:null,content:"As a recap: which of the following is not a valid logic gate?",choices:[{content:"XOR gate",hint:"This is the exclusive-OR gate!"},{content:"IF gate",hint:"Correct!"},{content:"AND gate",hint:"This logic gate exists!"},{content:"OR gate",hint:"This logic gate exists!"}],id:0,library:br,type:"mcq",solution:1,xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"An AND gate is a digital logic gate that implements logical conjunction on its inputs. It returns a single output that is HIGH (active) iff all the inputs to the AND gate are HIGH (active).\n  \n  In this question, let us model an AND gate as a function, and treat HIGH (active) inputs as the boolean value `true` and LOW (inactive) inputs as the boolean value `false`.\n  \n  As an AND gate is not restricted to exactly two inputs, our function shall be the same. Implement the function `AND(inputs)` which takes in the list `inputs` (a list of boolean values), and returns the output of the AND gate as a boolean. You may assume the list `inputs` is of minimum length 2.\n  \n  This question makes use of the sentinel function method to throw custom errors for each testcase.",id:1,library:br,prepend:"const OR = (x, y) => x || y;",postpend:"\n  const __AND = (xs) => {\n    if (AND(list(true, true)) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = AND(xs);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (equal(xs, list(true, false)) && result) {\n      error('Check the truth table for an AND gate again!');\n    } else if (equal(xs, list(true, true, false)) && result) {\n      error('Are you using all inputs in the list?');\n    } else if (equal(xs, list(true, true, true)) && !result) {\n      error('Are you sure your base case is correct?');\n    } else if (AND(list(true, true)) === AND(list(false, false))) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:$t.public,program:"__AND(list(true, false));",score:0,answer:"false"},{type:$t.public,program:"__AND(list(true, true, false));",score:0,answer:"false"},{type:$t.public,program:"__AND(list(true, OR(true, false), OR(true, true)));",score:0,answer:"true"},{type:$t.hidden,program:"__AND(list(true, OR(false, true), AND(list(true, false)), false));",score:0,answer:"false"},{type:$t.hidden,program:"__AND(list(true, OR(true, false), OR(true, AND(list(false, true))), true));",score:0,answer:"true"}],solutionTemplate:"function AND(inputs) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"The XOR (exclusive-OR) gate is a digital logic gate that accepts two inputs and returns a single output that is HIGH (active) iff one of the inputs are HIGH (active), but not both.\n  \n  In this question, let us model the XOR gate as a function. Implement the function `XOR(x, y)` which takes two boolean inputs `x` and `y` and which returns the output of the XOR gate as a boolean.\n  \n  This question makes use of the wrapping container method to throw custom errors for each testcase.",id:2,library:br,prepend:"",postpend:"\n  const __XOR = (x, y) => {\n    if (XOR(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = XOR(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (((x && !y) || (y && !x)) && !result) {\n      error('Check your truth tables!');\n    } else if (XOR(false, false) === XOR(false, true)) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:$t.public,program:"__XOR(true, false);",score:0,answer:"true"},{type:$t.public,program:"__XOR(false, true);",score:0,answer:"true"},{type:$t.hidden,program:"__XOR(true, XOR(true, false));",score:0,answer:"false"}],solutionTemplate:"function XOR(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"The NOR logic gate is special in that it is an _universal logic gate_, that is to say, they can be composed to form any other logic gate.\n  \n  Implement the AND logic gate **using ONLY the NOR logic gate**, as the `NOR_AND(x, y)` function that takes in two booleans as input.\n  \n  The `NOR` function modeled after a NOR gate is provided for you - it accepts two boolean values and returns `true` iff both inputs are `false`.",id:3,library:br,prepend:"\n  let counter = 0;\n  const NOR = (x, y) => {\n    counter = counter + 1;\n    return !(x || y);\n  };",postpend:"\n  const __NOR_AND = (x, y) => {\n    if (NOR_AND(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    counter = 0;\n    const result = NOR_AND(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (!x && y && result) {\n      error('Check your truth tables!');\n    } else if (x && y && !result && counter > 0) {\n      error('Nope! Try again :)');\n    } else if (x && y && !result) {\n      error('...You did not use NOR and still got it wrong!');\n    } else if (x && y && result && counter !== 3) {\n      error('Did you use NOR in your solution? >:(');\n    } else if (x && !y && counter !== 6) {\n      error('Incorrect number of calls.');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:$t.public,program:"__NOR_AND(false, true);",score:0,answer:"false"},{type:$t.public,program:"__NOR_AND(true, true);",score:0,answer:"true"},{type:$t.hidden,program:"__NOR_AND(true, NOR_AND(false, true));",score:0,answer:"false"}],solutionTemplate:"function NOR_AND(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],Ar=[{category:"Mission",id:1,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:fr,title:"An Odessey to Runes"},{category:"Mission",id:2,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:fr,title:"The Secret to Streams"},{category:Yt.Sidequest,id:3,longSummary:"###This is the sidequest briefing.\n  \n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit.\n  \n  > Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin\n  enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis\n  vestibulum.\n  \n  - Etiam in egestas dolor.\n  - Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum,\n    vel ornare metus turpis sed justo.\n  - Vivamus at tellus sed ex convallis commodo at in lectus.\n  \n  ```\n  Pellentesque\n  pharetra\n  pulvinar\n  sapien\n  ```",missionPDF:"www.google.com",questions:fr,title:"A sample Sidequest"},{category:Yt.Mission,id:4,longSummary:"This is the closed mission briefing. The save button should not be there. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:Cr,title:"A Closed Mission"},{category:Yt.Sidequest,id:5,longSummary:"This is the closed sidequest briefing. The save button should not exist. This is a placeholder sidequest for testing rendering of grading statuses.",missionPDF:"www.google.com",questions:Cr,title:"A Closed Sidequest"},{category:Yt.Path,id:6,longSummary:"### Basic logic gates\n  \n  This path is intended to demonstrate concepts from the lecture **Logic Circuits**. You are strongly encouraged to attempt this path to check your understanding, prior to the next Studio session. For this, you will be granted a small amount of XP!\n  \n  The path comprises 4 questions and is fully autograded and guided, and there are **no private test cases** - there will be no manual review by default. Please consult your Avenger if you require assistance!</TEXT>",missionPDF:"www.google.com",questions:wr,title:"A sample guided path"}];let Or;!function(e){e.student="student",e.trainer="trainer",e.admin="admin"}(Or||(Or={}));const Tr=(e,t=Or.trainer)=>t,Ir=[{id:1,type:Bs.deadline,assessment_id:3,assessment_type:Yt.Sidequest,assessment_title:"The Secret to Streams"},{id:2,type:Bs.autograded,assessment_id:4,assessment_type:Yt.Mission,assessment_title:"A Closed Mission"},{id:3,type:Bs.graded,assessment_id:4,assessment_type:Yt.Mission,assessment_title:"A Closed Mission"},{id:4,type:Bs.new,assessment_id:6,assessment_type:Yt.Path,assessment_title:"Basic Logic"},{id:5,type:Bs.new,assessment_id:7,assessment_type:Yt.Mission,assessment_title:"Symphony of the Winds"},{id:6,type:Bs.submitted,submission_id:1,assessment_type:Yt.Mission,assessment_title:"Mission 0"},{id:7,type:Bs.submitted,submission_id:2,assessment_type:Yt.Mission,assessment_title:"Mission 1"},{id:8,type:Bs.submitted,submission_id:3,assessment_type:Yt.Mission,assessment_title:"Mission 0"}],kr=[{gradeAdjustment:0,xpAdjustment:0,assessmentCategory:"Mission",assessmentId:0,assessmentName:"Mission 0 ",currentGrade:69,currentXp:69,xpBonus:10,initialGrade:69,initialXp:69,maxGrade:100,maxXp:100,studentId:0,studentName:"Al Gorithm",submissionId:1,submissionStatus:"submitted",groupName:"1D",gradingStatus:"graded",questionCount:6,gradedCount:6},{gradeAdjustment:-2,xpAdjustment:-2,assessmentCategory:"Mission",assessmentId:1,assessmentName:"Mission 1",currentGrade:-2,currentXp:-2,xpBonus:12,initialGrade:0,initialXp:0,maxGrade:400,maxXp:400,studentId:0,studentName:"Dee Sign",submissionId:2,submissionStatus:"submitted",groupName:"1F",gradingStatus:"grading",questionCount:6,gradedCount:2},{gradeAdjustment:4,xpAdjustment:4,assessmentCategory:"Mission",assessmentId:0,assessmentName:"Mission 0",currentGrade:1e3,currentXp:1e3,xpBonus:12,initialGrade:996,initialXp:996,maxGrade:1e3,maxXp:1e3,studentId:1,studentName:"May Trix",submissionId:3,submissionStatus:"submitted",groupName:"1F",gradingStatus:"none",questionCount:6,gradedCount:0}],Pr=[{question:{answer:"function remainder(n, d) {\n  return (n - d) < 0 ? n : remainder(n - d, d);\n}",content:"\nHello and welcome to this assessment! This is the *0th question*.\n\n```\n>>> import this\n```\n",prepend:"// THIS IS A PREPEND",postpend:"// THIS IS A POSTPEND",testcases:[{type:$t.public,program:"remainder(12, 7);",score:1,answer:"5"},{type:$t.public,program:"remainder(6, 1);",score:2,answer:"0"},{type:$t.private,program:"remainder(-15, 6);",score:2,answer:"-3"},{type:$t.private,program:"remainder(17, 23) === 17;",score:2,answer:"true"}],roomId:null,id:0,library:br,solutionTemplate:"0th question mock solution template",solution:"This is how the 0th question is solved. [7 points]\n\nfunction remainder(n, d) {\n  return n % d;\n}",type:"programming",maxGrade:1e3,maxXp:1e3,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:0,xp:0,roomId:"19422040",comments:"Good job. You are awarded the full marks!\n\n----\n## markdown test\n\n# header\n\n**bold**\n\n_italics_\n\n* list\n\n1. numbered list\n\n- [] checkboxes\n\n> quote\n\n    code\n\n[link to Source Academy](https://sourceacademy.nus.edu.sg)\n\n![](image-url-goes-here)\n      ",grader:{name:"HARTIN MENZ",id:100},gradedAt:"2019-08-16T13:26:32+00:00"},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:"This student's answer to the 1st question",roomId:null,content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:br,solutionTemplate:"1st question mock solution template",solution:null,type:"programming",maxGrade:200,maxXp:200,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:100,xp:100,roomId:"19422040",comments:"You open the Report Card, not knowing what to expect...\n\n## WOW!\nAmazing grasp of runes. We can now move on to the next assignment.\n\n<br/>\n\nRobot Dog: `woof`\n\nYou look at the display of the robot dog.\n\n    FEED ME\n1. Bread\n2. Water\n\n<br/>\n\n* I am hungry.\n* I am thirsty.\n\n<br/>\n<br/>\n\nNew message from **Avenger**!\n\n> _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n\n> _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n\n> Best regards, Avocado A. Avenger\n\n#### Upcoming Tasks\n- [] Meet Avenger Avenger at Level X-05\n- [] Open the Pod Bay Doors\n      "},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:3,roomId:null,solution:2,content:"Hello and welcome to this assessment! This is the 2nd question. Oddly enough, it is an MCQ question!",choices:[{content:"A",hint:"hint A"},{content:"B",hint:"hint B"},{content:"C",hint:"hint C"},{content:"D",hint:"hint D"}],id:2,library:br,type:"mcq",maxGrade:100,maxXp:100,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:50,xp:50,roomId:"19422030"},student:{name:"Al Gorithm",id:0}}],xr=[{leaderName:"John",groupName:"Mock Group 1",ungradedMissions:123,submittedMissions:200,ungradedSidequests:100,submittedSidequests:117},{leaderName:"Molly",groupName:"Mock Group 2",ungradedMissions:1232,submittedMissions:205430,ungradedSidequests:345,submittedSidequests:11547},{leaderName:"Lenny",groupName:"Mock Group 3",ungradedMissions:1532,submittedMissions:22200,ungradedSidequests:134500,submittedSidequests:6777}];function*Rr(){yield Object(fi.h)("FETCH_AUTH",(function*(e){wo.dispatch(mr.setTokens({accessToken:"accessToken",refreshToken:"refreshToken"})),wo.dispatch(mr.setUser({name:"DevStaff",role:"staff",group:"1F",story:{story:"mission-1",playStory:!0},grade:0,gameState:{}})),yield Ra.push("/academy")})),yield Object(fi.h)("FETCH_ASSESSMENT_OVERVIEWS",(function*(){yield Object(fi.d)(mr.updateAssessmentOverviews([...gr]))})),yield Object(fi.h)("FETCH_ASSESSMENT",(function*(e){const t=e.payload,a=Ar[t-1];yield Object(fi.d)(mr.updateAssessment({...a}))})),yield Object(fi.h)("FETCH_GRADING_OVERVIEWS",(function*(e){yield Object(fi.f)(e=>e.session.accessToken);const t=e.payload,a=yield Object(fi.a)(()=>((e,t)=>{const a=[Or.admin,Or.trainer],s=Tr();return null!==s&&a.includes(s)?t?[kr[0]]:kr.sort((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId):null})(0,t));null!==a&&(yield Object(fi.d)(mr.updateGradingOverviews([...a])))})),yield Object(fi.h)("FETCH_GRADING",(function*(e){const t=e.payload,a=(yield Object(fi.f)(e=>e.session.accessToken),yield Object(fi.a)(()=>((e,t)=>{const a=[Or.admin,Or.trainer],s=Tr();return null!==s&&a.includes(s)?Pr:null})()));null!==a&&(yield Object(fi.d)(mr.updateGrading(t,[...a])))})),yield Object(fi.h)("SUBMIT_ANSWER",(function*(e){const t=e.payload.id,a=e.payload.answer,s=yield Object(fi.f)(e=>e.workspaces.assessment.currentAssessment),n=yield Object(fi.f)(e=>e.session.assessments.get(s)),i=n.questions.slice().map(e=>(e.id===t&&(e.answer=a),e)),r={...n,questions:i};return yield Object(fi.d)(mr.updateAssessment(r)),yield Object(fi.a)(Ma,"Saved!",1e3),yield Object(fi.d)(mr.updateHasUnsavedChanges("assessment",!1))})),yield Object(fi.h)("UNSUBMIT_SUBMISSION",(function*(e){const{submissionId:t}=e.payload,a=yield Object(fi.f)(e=>e.session.gradingOverviews||[]);if(-1===a.findIndex(e=>e.submissionId===t&&"submitted"===e.submissionStatus))return void(yield Object(fi.a)(_a,"400: Bad Request"));const s=a.map(e=>e.submissionId===t?{...e,submissionStatus:"attempted"}:e);yield Object(fi.a)(Ma,"Unsubmitted!",1e3),yield Object(fi.d)(mr.updateGradingOverviews(s))}));const e=function*(e){const{submissionId:t,questionId:a,gradeAdjustment:s,xpAdjustment:n,comments:i}=e.payload,r=(yield Object(fi.f)(e=>e.session.gradings.get(t))).slice().map(e=>(e.question.id===a&&(e.grade={gradeAdjustment:s,xpAdjustment:n,roomId:e.grade.roomId,grade:e.grade.grade,xp:e.grade.xp,comments:i}),e));yield Object(fi.d)(mr.updateGrading(t,r)),yield Object(fi.a)(Ma,"Submitted!",1e3)};yield Object(fi.h)("SUBMIT_GRADING",e),yield Object(fi.h)("SUBMIT_GRADING_AND_CONTINUE",(function*(t){const{submissionId:a}=t.payload;yield*e(t);const s=yield Object(fi.f)(e=>e.workspaces.grading.currentQuestion);yield Ra.push(`/academy/grading/${a}/${(s||0)+1}`)})),yield Object(fi.h)("ACKNOWLEDGE_NOTIFICATIONS",(function*(e){const t=e.payload.withFilter,a=yield Object(fi.f)(e=>e.session.notifications);let s=a;if(t&&(s=t(a)),0===s.length)return;const n=s.map(e=>e.id),i=a.filter(e=>!n.includes(e.id));yield Object(fi.d)(mr.updateNotifications(i))})),yield Object(fi.h)("FETCH_NOTIFICATIONS",(function*(e){yield Object(fi.d)(mr.updateNotifications(Ir))})),yield Object(fi.h)("FETCH_GROUP_GRADING_SUMMARY",(function*(){yield Object(fi.d)(mr.updateGroupGradingSummary([...xr]))}))}function Nr(e){const t=ze.authProviders.get(e);if(!t)return;const a=""===window.location.port?"":":"+window.location.port;return`${window.location.protocol}//${window.location.hostname}${a}/login${t.isDefault?"":"?provider="+encodeURIComponent(e)}`}var Mr=function*(){yield Object(fi.h)("FETCH_AUTH",(function*(e){const{code:t,providerId:a}=e.payload,s=a||([...ze.authProviders.entries()].find(([e,{isDefault:t}])=>t)||[null])[0];if(!s)return yield Object(fi.a)(_a,"Could not log in; invalid provider or no providers configured."),yield Ra.push("/");const n=function(e){const t=ze.authProviders.get(e);if(t)try{return new URL(t.endpoint).searchParams.get("client_id")||void 0}catch(a){return t.endpoint||void 0}}(s),i=Nr(s),r=yield Object(fi.a)(Ao,t,s,n,i);if(!r)return yield Ra.push("/");const o=yield Object(fi.a)(Oo,r);if(!o)return yield Ra.push("/");yield Object(fi.d)(mr.setTokens(r)),yield Object(fi.d)(mr.setUser(o)),yield Ra.push("/academy")})),yield Object(fi.h)("FETCH_ASSESSMENT_OVERVIEWS",(function*(){const e=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),t=yield Object(fi.a)(To,e);t&&(yield Object(fi.d)(mr.updateAssessmentOverviews(t)))})),yield Object(fi.h)("FETCH_ASSESSMENT",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield Object(fi.a)(Io,a,t);s&&(yield Object(fi.d)(mr.updateAssessment(s)))})),yield Object(fi.h)("SUBMIT_ANSWER",(function*(e){if((yield Object(fi.f)(e=>e.session.role))!==Ot.Student)return yield Object(fi.a)(_a,"Answer rejected - only students can submit answers.");const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload.id,s=e.payload.answer,n=yield Object(fi.a)(ko,a,s,t),i=new Map([[400,"Answer rejected - can't save an empty answer."],[403,"Answer rejected - assessment not open or already finalised."]]);if(!n||!n.ok)return void(yield Vo(n,i));yield Object(fi.a)(Ma,"Saved!",1e3);const r=yield Object(fi.f)(e=>e.workspaces.assessment.currentAssessment),o=yield Object(fi.f)(e=>e.session.assessments.get(r)),l=o.questions.slice().map(e=>e.id===a?{...e,answer:s}:e),c={...o,questions:l};return yield Object(fi.d)(mr.updateAssessment(c)),yield Object(fi.d)(mr.updateHasUnsavedChanges("assessment",!1))})),yield Object(fi.h)("SUBMIT_ASSESSMENT",(function*(e){if((yield Object(fi.f)(e=>e.session.role))!==Ot.Student)return yield Object(fi.a)(_a,"Submission rejected - only students can submit assessments.");const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield Object(fi.a)(Po,a,t),n=new Map([[400,"Not allowed to finalise - some questions are unattempted."],[403,"Not allowed to finalise - assessment not open or already finalised."]]);if(!s||!s.ok)return void(yield Vo(s,n));yield Object(fi.a)(Ma,"Submitted!",2e3);const i=(yield Object(fi.f)(e=>e.session.assessmentOverviews)).map(e=>e.id===a?{...e,status:Wt.submitted}:e);return yield Object(fi.d)(mr.updateAssessmentOverviews(i))})),yield Object(fi.h)("FETCH_GRADING_OVERVIEWS",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield Object(fi.a)(xo,t,a);s&&(yield Object(fi.d)(mr.updateGradingOverviews(s)))})),yield Object(fi.h)("FETCH_GRADING",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield Object(fi.a)(Ro,a,t);s&&(yield Object(fi.d)(mr.updateGrading(a,s)))})),yield Object(fi.h)("UNSUBMIT_SUBMISSION",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),{submissionId:a}=e.payload,s=yield async function(e,t){return await Uo(`grading/${e}/unsubmit`,"POST",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(a,t),n=new Map([[400,"Not allowed to unsubmit - submission incomplete or not submitted."],[403,"Not allowed to unsubmit - not this student's Avenger or an Admin."]]);if(!s||!s.ok)return void(yield Vo(s,n));const i=(yield Object(fi.f)(e=>e.session.gradingOverviews||[])).map(e=>e.submissionId===a?{...e,submissionStatus:"attempted"}:e);yield Object(fi.a)(Ma,"Unsubmit successful",1e3),yield Object(fi.d)(mr.updateGradingOverviews(i))}));const e=function*(e){if((yield Object(fi.f)(e=>e.session.role))===Ot.Student)return yield Object(fi.a)(_a,"Only staff can submit answers.");const{submissionId:t,questionId:a,gradeAdjustment:s,xpAdjustment:n,comments:i}=e.payload,r=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),o=yield No(t,a,s,n,r,i),l=new Map([[400,"Grading rejected - missing permissions or invalid grade parameters."],[405,"Not allowed to grade - submission incomplete or not submitted."]]);if(!o||!o.ok)return void(yield Vo(o,l));yield Object(fi.a)(Ma,"Submitted!",1e3);const c=(yield Object(fi.f)(e=>e.session.gradings.get(t))).slice().map(e=>(e.question.id===a&&(e.grade={gradeAdjustment:s,xpAdjustment:n,roomId:e.grade.roomId,grade:e.grade.grade,xp:e.grade.xp,comments:i}),e));yield Object(fi.d)(mr.updateGrading(t,c))};yield Object(fi.h)("SUBMIT_GRADING",e),yield Object(fi.h)("SUBMIT_GRADING_AND_CONTINUE",(function*(t){const{submissionId:a}=t.payload;yield*e(t);const s=yield Object(fi.f)(e=>e.workspaces.grading.currentQuestion);yield Ra.push(`/academy/grading/${a}/${(s||0)+1}`)})),yield Object(fi.h)("FETCH_NOTIFICATIONS",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=yield Object(fi.a)(Mo,t);yield Object(fi.d)(mr.updateNotifications(a))})),yield Object(fi.h)("ACKNOWLEDGE_NOTIFICATIONS",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload.withFilter,s=yield Object(fi.f)(e=>e.session.notifications);let n=s;if(a&&(n=a(s)),0===n.length)return;const i=n.map(e=>e.id),r=s.filter(e=>!i.includes(e.id));yield Object(fi.d)(mr.updateNotifications(r));const o=yield Object(fi.a)(_o,t,i);o&&o.ok||(yield Vo(o))})),yield Object(fi.h)("DELETE_SOURCECAST_ENTRY",(function*(e){if((yield Object(fi.f)(e=>e.session.role))===Ot.Student)return yield Object(fi.a)(_a,"Only staff can delete sourcecasts.");const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),{id:a}=e.payload,s=yield async function(e,t){return await Uo("sourcecast/"+e,"DELETE",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(a,t);if(!s||!s.ok)return void(yield Vo(s));const n=yield Object(fi.a)(Do,t);n&&(yield Object(fi.d)(mr.updateSourcecastIndex(n,e.payload.workspaceLocation))),yield Object(fi.a)(Ma,"Deleted successfully!",1e3)})),yield Object(fi.h)("FETCH_SOURCECAST_INDEX",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=yield Object(fi.a)(Do,t);a&&(yield Object(fi.d)(mr.updateSourcecastIndex(a,e.payload.workspaceLocation)))})),yield Object(fi.h)("SAVE_SOURCECAST_DATA",(function*(e){if((yield Object(fi.f)(e=>e.session.role))===Ot.Student)return yield Object(fi.a)(_a,"Only staff can save sourcecast.");const{title:t,description:a,audio:s,playbackData:n}=e.payload,i=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),r=yield Lo(t,a,s,n,i);r&&r.ok?(yield Object(fi.a)(Ma,"Saved successfully!",1e3),yield Ra.push("/sourcecast")):yield Vo(r,new Map)})),yield Object(fi.h)("CHANGE_CHAPTER",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield Object(fi.a)(Go,a.chapter,a.variant,t);s&&s.ok?(yield Object(fi.d)(mr.updateChapter(a.chapter,a.variant)),yield Object(fi.a)(Ma,"Updated successfully!",1e3)):yield Vo(s)})),yield Object(fi.h)("FETCH_GROUP_GRADING_SUMMARY",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=yield Object(fi.a)(Bo,t);a&&(yield Object(fi.d)(mr.updateGroupGradingSummary(a)))})),yield Object(fi.h)("CHANGE_DATE_ASSESSMENT",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload.id,s=e.payload.closeAt,n=e.payload.openAt,i=yield async function(e,t,a,s){const n=await Uo("assessments/update/"+e,"POST",{accessToken:s.accessToken,body:{closeAt:t,openAt:a},noHeaderAccept:!0,refreshToken:s.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});return n?await n.text():null}(a,s,n,t);null!=i?"OK"===i?(yield Object(fi.d)(mr.fetchAssessmentOverviews()),yield Object(fi.a)(Ma,"Updated successfully!",1e3)):yield Object(fi.a)(_a,i,5e3):yield Vo(i)})),yield Object(fi.h)("DELETE_ASSESSMENT",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload,s=yield async function(e,t){return await Uo("assessments/"+e,"DELETE",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(a,t);s&&s.ok?(yield Object(fi.d)(mr.fetchAssessmentOverviews()),yield Object(fi.a)(Ma,"Deleted successfully!",1e3)):yield Vo(s)})),yield Object(fi.h)("PUBLISH_ASSESSMENT",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload.id,s=e.payload.togglePublishTo,n=yield async function(e,t,a){return await Uo("assessments/publish/"+e,"POST",{accessToken:a.accessToken,body:{togglePublishTo:t},noHeaderAccept:!0,refreshToken:a.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(a,s,t);n&&n.ok?(yield Object(fi.d)(mr.fetchAssessmentOverviews()),s?yield Object(fi.a)(Ma,"Published successfully!",1e3):yield Object(fi.a)(Ma,"Unpublished successfully!",1e3)):yield Vo(n)})),yield Object(fi.h)("UPLOAD_ASSESSMENT",(function*(e){const t=yield Object(fi.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),a=e.payload.file,s=e.payload.forceUpdate,n=yield jo(a,t,s);if(n)if("OK"===n)yield Object(fi.a)(Ma,"Uploaded successfully!",2e3);else{if("Force Update OK"!==n)return void(yield Object(fi.a)(_a,n,1e4));yield Object(fi.a)(Ma,"Assessment force updated successfully!",2e3)}else yield Vo(n);yield Object(fi.d)(mr.fetchAssessmentOverviews())}))};function*_r(){yield Object(fi.h)("LOGIN",Dr)}function*Dr({payload:e}){const t=function(e){const t=ze.authProviders.get(e);if(t)try{const a=new URL(t.endpoint);return a.searchParams.set("redirect_uri",Nr(e)),a.toString()}catch(a){return t.endpoint||""}}(e);t?window.location.href=t:yield Object(fi.a)(_a,"Could not log in; invalid provider name provided.")}function Lr(e){const t=e.choices.map((t,a)=>v.createElement(Gt.Button,Object.assign({key:a,onClick:()=>e.onResponse&&e.onResponse(t.key),intent:t.intent,fill:e.largeButtons,className:Xt()(e.largeButtons&&"large-button")},t.props),t.label)),{escapeResponse:a}=e,s="undefined"===typeof a?void 0:()=>e.onResponse&&e.onResponse(a);return v.createElement(Gt.Dialog,Object.assign({className:Xt()(Gt.Classes.DARK,"ConfirmDialog"),title:e.title,isCloseButtonShown:"undefined"===typeof e.title&&void 0,canEscapeKeyClose:!!s,onClose:s,isOpen:e.isOpen},e.props),v.createElement("div",{className:Gt.Classes.DIALOG_BODY},e.contents),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},e.largeButtons&&t,!e.largeButtons&&v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER_ACTIONS},t)))}function jr(e){const{enterResponse:t,validationFunction:a}=e,s=v.useRef(null),[n,i]=v.useState(!a||a(e.defaultValue||""));v.useEffect(()=>{s.current&&i(!a||a(s.current.value))},[a]);const r=t=>{var n;t!==e.escapeResponse&&a&&!a(s.current.value)||e.onResponse(t,(null===(n=s.current)||void 0===n?void 0:n.value)||"")},o=e.choices.map(e=>({...e,props:{...e.props,disabled:e.disableOnInvalid&&!n}})),l=t?e=>{13===e.keyCode&&r(t)}:void 0,c=a?e=>{a(e.target.value)!==n&&i(!n)}:void 0;return v.createElement(Lr,Object.assign({},e,{onResponse:r,choices:o,contents:v.createElement(v.Fragment,null,e.contents,v.createElement(Gt.InputGroup,{autoFocus:!0,defaultValue:e.defaultValue,inputRef:s,onKeyDown:l,onChange:c,intent:n?Gt.Intent.NONE:Gt.Intent.DANGER}))}))}class Br extends v.PureComponent{constructor(...e){super(...e),this.state={dialog:null,dialogOnClose:null}}static create(){const e=document.createElement("div");document.body.appendChild(e);const t=f.render(v.createElement(Br,null),e);if(null==t)throw new Error("Could not create DialogHelper - are you in a React lifecycle method?");return t}show(e,t){this.setState(()=>({dialog:e,dialogOnClose:t||null}))}close(){this.state.dialogOnClose&&this.state.dialogOnClose(),this.setState(()=>({dialog:null,dialogOnClose:null}))}render(){return this.state.dialog}}const Gr=Br.create();function Ur(){Gr.close()}function Vr(e,t){return new Promise((a,s)=>{var n,i;n=v.createElement(e,t(a)),i=s,Gr.show(n,i)}).finally(Ur)}function Hr(e){return function(e){return Vr(Lr,t=>({...e,onResponse:t,isOpen:!0}))}({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"No"},{key:!0,label:e.positiveLabel||"Yes",intent:Gt.Intent.SUCCESS,props:{type:"submit"}}],escapeResponse:!1,...e.props})}function Fr(e){return Vr(jr,t=>({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"Cancel"},{key:!0,label:e.positiveLabel||"Accept",intent:Gt.Intent.SUCCESS,disableOnInvalid:!0}],escapeResponse:!1,enterResponse:!0,onResponse:(e,a)=>t({buttonResponse:e,value:a}),isOpen:!0,...e.props}))}const qr=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],Xr="https://www.googleapis.com/upload/drive/v3/files";let Wr;const zr=new Promise(e=>{Wr=e}).then((async function(){await new Promise((e,t)=>gapi.load("client:auth2",{callback:e,onerror:t})),await gapi.client.init({apiKey:ze.googleApiKey,clientId:ze.googleClientId,discoveryDocs:qr,scope:"profile https://www.googleapis.com/auth/drive.file"}),gapi.auth2.getAuthInstance().currentUser.listen(Yr),Yr(gapi.auth2.getAuthInstance().currentUser.get())}));function Yr(e){wo.dispatch(mr.setGoogleUser(e.isSignedIn()?e.getBasicProfile().getEmail():void 0))}function*$r(){Wr(),yield zr}function*Kr(){yield Object(fi.a)($r),gapi.auth2.getAuthInstance().isSignedIn.get()||(yield gapi.auth2.getAuthInstance().signIn())}function Qr(e,t){const a="undefined"!==typeof(null===t||void 0===t?void 0:t.pickFolders)&&(null===t||void 0===t?void 0:t.pickFolders),s="undefined"===typeof(null===t||void 0===t?void 0:t.showFolders)||(null===t||void 0===t?void 0:t.showFolders),n="undefined"===typeof(null===t||void 0===t?void 0:t.showFiles)||(null===t||void 0===t?void 0:t.showFiles);return new Promise(i=>{gapi.load("picker",()=>{const r=new google.picker.DocsView(n?google.picker.ViewId.DOCS:google.picker.ViewId.FOLDERS);(null===t||void 0===t?void 0:t.rootFolder)&&r.setParent(t.rootFolder),r.setOwnedByMe(!0),r.setIncludeFolders(s),r.setSelectFolderEnabled(a),r.setMode(google.picker.DocsViewMode.LIST);(new google.picker.PickerBuilder).setTitle(e).enableFeature(google.picker.Feature.NAV_HIDDEN).addView(r).setOAuthToken(gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token).setAppId(ze.googleAppId).setDeveloperKey(ze.googleApiKey).setCallback(e=>{switch(e[google.picker.Response.ACTION]){case google.picker.Action.PICKED:{const{id:t,name:a,mimeType:s,parentId:n}=e.docs[0];i({id:t,name:a,mimeType:s,parentId:n,picked:!0});break}case google.picker.Action.CANCEL:i({picked:!1})}}).build().setVisible(!0)})})}function Jr(e,t,a,s="",n){const i={name:e,mimeType:a,parents:[t],appProperties:{source:!0,...n}},{body:r,headers:o}=eo(i,s,a);return gapi.client.request({path:Xr,method:"POST",params:{uploadType:"multipart"},headers:o,body:r}).then(({result:e})=>({id:e.id,name:e.name}))}function Zr(e,t,a,s="",n){const i={name:t,mimeType:a,appProperties:{source:!0,...n}},{body:r,headers:o}=eo(i,s,a);return gapi.client.request({path:Xr+"/"+e,method:"PATCH",params:{uploadType:"multipart"},headers:o,body:r})}function eo(e,t,a){const s=JSON.stringify(e);let n;do{n=to()}while(s.includes(n)||t.includes(n));return{body:`--${n}\nContent-Type: application/json; charset=utf-8\n\n${JSON.stringify(e)}\n--${n}\nContent-Type: ${a}\n\n${t}\n--${n}--\n`,boundary:n,headers:{"Content-Type":"multipart/related; boundary="+n}}}function to(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(10*Math.random()).toString(16);return e}var ao=function*(){yield Object(fi.i)("LOGOUT_GOOGLE",(function*(){yield Object(fi.d)($i(void 0)),yield Object(fi.a)($r),yield Object(fi.a)([gapi.auth2.getAuthInstance(),"signOut"])})),yield Object(fi.i)("PERSISTENCE_OPEN_PICKER",(function*(){let e;try{yield Object(fi.a)(Kr);const{id:t,name:a,picked:s}=yield Object(fi.a)(Qr,"Pick a file to open");if(!s)return;if(!(yield Object(fi.a)(Hr,{title:"Opening from Google Drive",contents:v.createElement("p",null,"Opening ",v.createElement("strong",null,a)," will overwrite the current contents of your workspace. Are you sure?"),positiveLabel:"Open",negativeLabel:"Cancel"})))return;e=yield Object(fi.a)(Da,{message:"Opening file...",timeout:0,intent:Gt.Intent.PRIMARY});const{result:n}=yield Object(fi.a)([gapi.client.drive.files,"get"],{fileId:t,fields:"appProperties"}),i=yield Object(fi.a)([gapi.client.drive.files,"get"],{fileId:t,alt:"media"});yield Object(fi.d)(mr.updateEditorValue(i.body,"playground")),yield Object(fi.d)(mr.playgroundUpdatePersistenceFile({id:t,name:a,lastSaved:new Date})),n&&n.appProperties&&(yield Object(fi.d)(mr.chapterSelect(parseInt(n.appProperties.chapter||"4",10),n.appProperties.variant||"default","playground")),yield Object(fi.d)(mr.externalLibrarySelect(Object.values(yt).find(e=>e===n.appProperties.external)||yt.NONE,"playground"))),yield Object(fi.a)(Ma,`Loaded ${a}.`,1e3)}catch(t){console.error(t),yield Object(fi.a)(_a,"Error while opening file.",1e3)}finally{e&&La(e)}})),yield Object(fi.i)("PERSISTENCE_SAVE_FILE_AS",(function*(){let e;try{yield Object(fi.a)(Kr);const[t,a,s,n]=yield Object(fi.f)(e=>[e.workspaces.playground.editorValue,e.workspaces.playground.context.chapter,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary]),i=yield Object(fi.a)(Qr,"Pick a folder, or cancel to pick the root folder",{pickFolders:!0,showFolders:!0,showFiles:!1}),r=i.picked?i:{id:"root",name:"My Drive"},o=yield Object(fi.a)(Qr,`Saving to ${r.name}; pick a file to overwrite, or cancel to save as a new file`,{pickFolders:!1,showFolders:!1,showFiles:!0,rootFolder:r.id});if(o.picked){if(!(yield Object(fi.a)(Hr,{title:"Saving to Google Drive",contents:v.createElement("span",null,"Really overwrite ",v.createElement("strong",null,o.name),"?")})))return;yield Object(fi.d)(mr.playgroundUpdatePersistenceFile(o)),yield Object(fi.d)(mr.persistenceSaveFile(o))}else{const i=yield Object(fi.a)(Fr,{title:"Saving to Google Drive",contents:v.createElement(v.Fragment,null,v.createElement("p",null,"Saving to folder ",v.createElement("strong",null,r.name),"."),v.createElement("p",null,"Save as name?")),positiveLabel:"Save as new file",negativeLabel:"Cancel",props:{validationFunction:e=>!!e}});if(!i.buttonResponse)return;const o={chapter:a,variant:s,external:n};e=yield Object(fi.a)(Da,{message:`Saving as ${i.value}...`,timeout:0,intent:Gt.Intent.PRIMARY});const l=yield Object(fi.a)(Jr,i.value,r.id,"text/plain",t,o);yield Object(fi.d)(mr.playgroundUpdatePersistenceFile({...l,lastSaved:new Date})),yield Object(fi.a)(Ma,i.value+" successfully saved to Google Drive.",1e3)}}catch(t){console.error(t),yield Object(fi.a)(_a,"Error while saving file.",1e3)}finally{e&&La(e)}})),yield Object(fi.h)("PERSISTENCE_SAVE_FILE",(function*({payload:{id:e,name:t}}){let a;try{a=yield Object(fi.a)(Da,{message:`Saving as ${t}...`,timeout:0,intent:Gt.Intent.PRIMARY}),yield Object(fi.a)(Kr);const[s,n,i,r]=yield Object(fi.f)(e=>[e.workspaces.playground.editorValue,e.workspaces.playground.context.chapter,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary]),o={chapter:n,variant:i,external:r};yield Object(fi.a)(Zr,e,t,"text/plain",s,o),yield Object(fi.d)(mr.playgroundUpdatePersistenceFile({id:e,name:t,lastSaved:new Date})),yield Object(fi.a)(Ma,t+" successfully saved to Google Drive.",1e3)}catch(s){console.error(s),yield Object(fi.a)(_a,"Error while saving file.",1e3)}finally{a&&La(a)}})),yield Object(fi.h)("PERSISTENCE_INITIALISE",$r)},so=a(318);function*no(){yield Object(fi.h)("GENERATE_LZ_STRING",io),yield Object(fi.h)("SHORTEN_URL",(function*(e){const t=yield Object(fi.f)(e=>e.playground.queryString),a=e.payload;let s,n;try{const{result:e,hasTimedOut:i}=yield Object(fi.e)({result:Object(fi.a)(ro,t,a),hasTimedOut:Object(fi.b)(1e4)});s=e,n=i}catch(i){}return!s||n?(yield Object(fi.d)(Wi("ERROR")),yield Object(fi.a)(_a,"Something went wrong trying to create the link.")):"success"===s.status||s.shorturl?("success"!==s.status&&(yield Object(fi.a)(Ma,s.message)),void(yield Object(fi.d)(Wi(s.shorturl)))):(yield Object(fi.d)(Wi("ERROR")),yield Object(fi.a)(_a,s.message))}))}function*io(){const e=yield Object(fi.f)(e=>e.workspaces.playground.editorValue);if(!e||"// Type your program in here!"===e)return void(yield Object(fi.d)(Yi("")));const t=e,a=yield Object(fi.f)(e=>e.workspaces.playground.context.chapter),s=yield Object(fi.f)(e=>e.workspaces.playground.context.variant),n=yield Object(fi.f)(e=>e.workspaces.playground.externalLibrary),i=yield Object(fi.f)(e=>e.workspaces.playground.execTime),r=so.stringify({prgrm:Object(pe.compressToEncodedURIComponent)(t),chap:a,variant:s,ext:n,exec:i});yield Object(fi.d)(Yi(r))}async function ro(e,t){let a=`${window.location.protocol}//${window.location.hostname}/playground#${e}`;""!==window.location.port&&(a=`${window.location.protocol}//${window.location.hostname}:${window.location.port}/playground#${e}`);const s={signature:ze.urlShortenerSignature,action:"shorturl",format:"json",keyword:t,url:a},n={method:"POST",body:Object.entries(s).reduce((e,[t,a])=>(e.append(t,a),e),new FormData)},i=await fetch(ze.urlShortener,n);if(!i||!i.ok)return null;return await i.json()}var oo=a(83),lo=a(84),co=a(164),uo=a(231),ho=a(295),po=a(463),mo=a(472);let go,yo,Eo=[];function*bo(){let e;function*t(){const{loadedScripts:e,timeout:t}=yield Object(fi.e)({loadedScripts:Object(fi.a)((function*(){for(;void 0===window.getReadyWebGLForCanvas;)yield Object(fi.b)(250);return!0})),timeout:Object(fi.b)(4e3)});return void 0===t||void 0!==e||(yield Object(fi.a)(_a,"Error loading libraries",750),!1)}yield Object(fi.h)("EVAL_EDITOR",(function*(t){const a=t.payload.workspaceLocation,s=yield Object(fi.f)(e=>[e.workspaces[a].editorPrepend,e.workspaces[a].editorValue]),[n,i]=s,r=i.split("\n");for(const e in Eo)if("string"===typeof e){const t=+e;r[t]="debugger;"+r[t]}const o=r.join("\n"),l=yield Object(fi.f)(e=>e.workspaces[a].context.chapter),c=yield Object(fi.f)(e=>e.workspaces[a].execTime),d=yield Object(fi.f)(e=>e.workspaces[a].context.externalSymbols),u=yield Object(fi.f)(e=>e.workspaces[a].globals),h={chapter:l,variant:yield Object(fi.f)(e=>e.workspaces[a].context.variant),external:{name:yt.NONE,symbols:d},globals:u};if(yield Object(fi.d)(mr.beginInterruptExecution(a)),yield Object(fi.d)(mr.beginClearContext(h,a)),yield Object(fi.d)(mr.clearReplOutput(a)),e=yield Object(fi.f)(e=>e.workspaces[a].context),n.length){const t=mt(e);yield Object(fi.a)(fo,n,t,c,a,"EVAL_SILENT"),yield*So(t,e,c,a)}yield Object(fi.a)(fo,o,e,c,a,"EVAL_EDITOR")})),yield Object(fi.h)("PROMPT_AUTOCOMPLETE",(function*(t){const a=t.payload.workspaceLocation;e=yield Object(fi.f)(e=>e.workspaces[a].context);const s=yield Object(fi.f)(e=>[e.workspaces[a].editorPrepend,e.workspaces[a].editorValue]),[n,i]=s;let r,o=0;n?(o=n.split("\n").length,r=n+"\n"+i):r=i;const[l,c]=yield Object(fi.a)(ga.getNames,r,t.payload.row+o,t.payload.column,e);if(!c)return void(yield Object(fi.a)(t.payload.callback));const d=l.map(e=>({caption:e.name,value:e.name,meta:e.meta,score:e.score?e.score+1e3:1e3}));let u=e.chapter.toString();"default"!==e.variant&&(u+="_"+e.variant);const h=$a.builtins[u]||[],p=yield Object(fi.f)(e=>e.workspaces[a].externalLibrary),m=$a.externalLibraries[p]||[];yield Object(fi.a)(t.payload.callback,null,d.concat(h,m))})),yield Object(fi.h)("TOGGLE_EDITOR_AUTORUN",(function*(e){const t=e.payload.workspaceLocation,a=yield Object(fi.f)(e=>e.workspaces[t].isEditorAutorun);yield Object(fi.a)(_a,"Autorun "+(a?"Started":"Stopped"),750)})),yield Object(fi.h)("INVALID_EDITOR_SESSION_ID",(function*(e){yield Object(fi.a)(_a,"Invalid ID Input",1e3)})),yield Object(fi.h)("EVAL_REPL",(function*(t){const a=t.payload.workspaceLocation,s=yield Object(fi.f)(e=>e.workspaces[a].replValue),n=yield Object(fi.f)(e=>e.workspaces[a].execTime);yield Object(fi.d)(mr.beginInterruptExecution(a)),yield Object(fi.d)(mr.clearReplInput(a)),yield Object(fi.d)(mr.sendReplInputToOutput(s,a)),e=yield Object(fi.f)(e=>e.workspaces[a].context),yield Object(fi.a)(fo,s,e,n,a,"EVAL_REPL")})),yield Object(fi.h)("DEBUG_RESUME",(function*(t){const a=t.payload.workspaceLocation,s=yield Object(fi.f)(e=>e.workspaces[a].editorValue),n=yield Object(fi.f)(e=>e.workspaces[a].execTime);yield Object(fi.d)(mr.beginInterruptExecution(a)),yield Object(fi.d)(mr.clearReplOutput(a)),e=yield Object(fi.f)(e=>e.workspaces[a].context),yield Object(fi.d)(mr.highlightEditorLine([],a)),yield Object(fi.a)(fo,s,e,n,a,"DEBUG_RESUME")})),yield Object(fi.h)("DEBUG_RESET",(function*(t){const a=t.payload.workspaceLocation;e=yield Object(fi.f)(e=>e.workspaces[a].context),yield Object(fi.d)(mr.clearReplOutput(a)),ut(void 0),dt(void 0),yield Object(fi.d)(mr.clearReplOutput(a)),e.runtime.break=!1,go=void 0})),yield Object(fi.h)("HIGHLIGHT_LINE",(function*(e){dt(e.payload.highlightedLines[0]),yield})),yield Object(fi.h)("UPDATE_EDITOR_BREAKPOINTS",(function*(e){Eo=e.payload.breakpoints,yield})),yield Object(fi.h)("EVAL_TESTCASE",(function*(t){const a=t.payload.workspaceLocation,s=t.payload.testcaseId,n=yield Object(fi.f)(e=>[e.workspaces[a].editorPrepend,e.workspaces[a].editorValue,e.workspaces[a].editorPostpend,e.workspaces[a].editorTestcases[s].program]),[i,r,o,l]=n,c=yield Object(fi.f)(e=>e.workspaces[a].editorTestcases[s].type),d=yield Object(fi.f)(e=>e.workspaces[a].execTime);e=yield Object(fi.f)(e=>e.workspaces[a].context);const u=mt(e);yield Object(fi.a)(fo,i,u,d,a,"EVAL_SILENT");const h=String(Object(Qe.random)(1048576,68719476736));yield*So(u,e,d,a,h),yield Object(fi.a)(fo,r,e,d,a,"EVAL_SILENT"),e.errors.length||(o&&(yield*function*(e,t,a,s,n){const i=function(e,t){const a="_____"+t;return e.map((e,t)=>"makeUndefinedErrorFunction"===e?"":`const ${e} = ${a}[${t}];`).join("\n")}(gt(e,t),n);yield Object(fi.a)(fo,i,e,a,s,"EVAL_SILENT")}(u,e,d,a,h),yield Object(fi.a)(fo,o,u,d,a,"EVAL_SILENT"),yield*So(u,e,d,a,h)),yield*function*(e,t,a,s,n,i){yield Object(fi.d)(mr.resetTestcase(s,n));const{result:r,interrupted:o}=yield Object(fi.e)({result:Object(fi.a)(ga.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:a}),interrupted:Object(fi.g)("BEGIN_INTERRUPT_EXECUTION")});if(o)return Object(ga.interrupt)(t),t.errors.push(new lo.InterruptedError(t.runtime.nodes[0])),yield Object(fi.d)(mr.endInterruptExecution(s)),void(yield Object(fi.a)(_a,`Execution of testcase ${n} aborted`,750));"error"===r.status?(yield Object(fi.d)(mr.evalInterpreterError(t.errors,s)),yield Object(fi.d)(mr.evalTestcaseFailure(t.errors,s,n))):"finished"===r.status&&(yield Object(fi.d)(mr.evalInterpreterSuccess(r.value,s)),yield Object(fi.d)(mr.evalTestcaseSuccess(r.value,s,n)));i===$t.hidden&&(yield Object(fi.d)(mr.clearReplOutputLast(s)))}(l,u,d,a,s,c))})),yield Object(fi.h)("CHAPTER_SELECT",(function*(e){const t=e.payload.workspaceLocation,a=e.payload.chapter,s=yield Object(fi.f)(e=>e.workspaces[t].context.variant),n=e.payload.variant,i=yield Object(fi.f)(e=>e.workspaces[t].context.chapter),r=yield Object(fi.f)(e=>e.workspaces[t].context.externalSymbols),o=yield Object(fi.f)(e=>e.workspaces[t].globals);if(a!==i||n!==s){const e={chapter:a,variant:n,external:{name:yt.NONE,symbols:r},globals:o};yield Object(fi.d)(mr.beginClearContext(e,t)),yield Object(fi.d)(mr.clearReplOutput(t)),yield Object(fi.d)(mr.debuggerReset(t)),yield Object(fi.a)(Ma,"Switched to "+kt(a,n),1e3)}})),yield Object(fi.h)("PLAYGROUND_EXTERNAL_SELECT ",(function*(e){const t=e.payload.workspaceLocation,a=yield Object(fi.f)(e=>e.workspaces[t].context.chapter),s=yield Object(fi.f)(e=>e.workspaces[t].globals),n=e.payload.externalLibraryName,i=yield Object(fi.f)(e=>e.workspaces[t].externalLibrary),r={chapter:a,external:{name:n,symbols:wt.get(n)},globals:s};n!==i&&(yield Object(fi.d)(mr.changeExternalLibrary(n,t)),yield Object(fi.d)(mr.beginClearContext(r,t)),yield Object(fi.d)(mr.clearReplOutput(t)),yield Object(fi.a)(Ma,`Switched to ${n} library`,1e3))})),yield Object(fi.h)("ENSURE_LIBRARIES_LOADED",(function*(e){yield*t()})),yield Object(fi.h)("BEGIN_CLEAR_CONTEXT",(function*(e){yield*t();switch(e.payload.library.external.name){case yt.RUNES:window.loadLib("RUNES"),window.getReadyWebGLForCanvas("3d");break;case yt.CURVES:window.loadLib("CURVES"),window.getReadyWebGLForCanvas("curve");break;case yt.MACHINELEARNING:window.loadLib("MACHINELEARNING")}const a=e.payload.library.globals;for(const[t,s]of a)window[t]=s;e.payload.library.moduleParams={runes:{},phaser:tn.a},yield Object(fi.d)(mr.endClearContext(e.payload.library,e.payload.workspaceLocation)),yield})),yield Object(fi.h)("NAV_DECLARATION",(function*(t){const a=t.payload.workspaceLocation,s=yield Object(fi.f)(e=>e.workspaces[a].editorValue);e=yield Object(fi.f)(e=>e.workspaces[a].context);const n=Object(ga.findDeclaration)(s,e,{line:t.payload.cursorPosition.row+1,column:t.payload.cursorPosition.column});n&&(yield Object(fi.d)(mr.moveCursor(t.payload.workspaceLocation,{row:n.start.line-1,column:n.start.column})))}))}function*vo(e){try{const t=go.context.runtime.nodes[0].loc.start.line-1,a=go.context.runtime.nodes[0].loc.end.line-1;yield Object(fi.d)(mr.highlightEditorLine([t,a],e)),ut(go),function(e){if(!window.EnvVisualizer)throw new Error("Env visualizer is not enabled");window.EnvVisualizer.draw_env({context:e})}(go)}catch(t){yield Object(fi.d)(mr.highlightEditorLine([],e))}}function*So(e,t,a,s,n){const i=gt(e,t);if(n){const t=function(e,t){return`const _____${t} = [${e.join(", ")}];`}(i,n);yield Object(fi.a)(fo,t,e,a,s,"EVAL_SILENT")}const r=i.map(e=>"makeUndefinedErrorFunction"===e?"":`const ${e} = makeUndefinedErrorFunction('${e}');`).join("\n");yield Object(fi.a)(fo,r,e,a,s,"EVAL_SILENT")}function*fo(e,t,a,s,n){t.runtime.debuggerOn=("EVAL_EDITOR"===n||"DEBUG_RESUME"===n)&&t.chapter>2,!t.runtime.debuggerOn&&t.chapter>2&&"EVAL_SILENT"!==n&&ut(void 0);const i=yield Object(fi.f)(e=>e.playground.usingSubst),r=t.chapter<=2&&"playground"===s&&i;if(r){t.executionMethod="interpreter";const e=document.getElementById(T.substVisualizer+"-icon");e&&e.classList.add("side-content-tab-alert")}async function o(e,a){return mo.compile(e,a).then(e=>mo.run(e,a)).then(e=>({status:"finished",context:t,value:e}),e=>({status:"error"}))}const l="non-det"===t.variant,c="lazy"===t.variant,d="wasm"===t.variant,{result:u,interrupted:h,paused:p}=yield Object(fi.e)({result:"DEBUG_RESUME"===n?Object(fi.a)(ga.resume,go):l||c||d?function(s){if("non-det"===s)return e.trim()===oo.TRY_AGAIN?Object(fi.a)(ga.resume,yo):Object(fi.a)(ga.runInContext,e,t,{executionMethod:"interpreter",originalMaxExecTime:a,useSubst:r});if("lazy"===s)return Object(fi.a)(ga.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:a,useSubst:r});if("wasm"===s)return Object(fi.a)(o,e,t);throw new Error("Unknown variant: "+s)}(t.variant):Object(fi.a)(ga.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:a,useSubst:r}),interrupted:Object(fi.g)("BEGIN_INTERRUPT_EXECUTION"),paused:Object(fi.g)("BEGIN_DEBUG_PAUSE")});if(h)return Object(ga.interrupt)(t),t.errors.push(new lo.InterruptedError(t.runtime.nodes[0])),yield Object(fi.d)(mr.debuggerReset(s)),yield Object(fi.d)(mr.endInterruptExecution(s)),void(yield Object(fi.a)(_a,"Execution aborted",750));if(p)return yield Object(fi.d)(mr.endDebuggerPause(s)),go=Object(uo.manualToggleDebugger)(t),yield Object(fi.a)(vo,s),void(yield Object(fi.a)(_a,"Execution paused",750));if("EVAL_EDITOR"===n&&(go=u),yield Object(fi.a)(vo,s),"suspended"!==u.status&&"finished"!==u.status&&"suspended-non-det"!==u.status){yield Object(fi.d)(mr.evalInterpreterError(t.errors,s));const a=t.errors;t.errors=[];const n=Object(co.parse)(e,t),i=n&&Object(ho.typeCheck)(Object(po.validateAndAnnotate)(n,t),t)[1];return t.errors=a,void(i&&i.length>0&&(yield Object(fi.d)(mr.sendReplInputToOutput("Hints:\n"+Object(ga.parseError)(i),s))))}if("suspended"===u.status)return yield Object(fi.d)(mr.endDebuggerPause(s)),void(yield Object(fi.d)(mr.evalInterpreterSuccess("Breakpoint hit!",s)));if(l&&("cut"===u.value&&(u.value=void 0),yo=u),"EVAL_SILENT"!==n&&(yield Object(fi.d)(mr.evalInterpreterSuccess(u.value,s))),"EVAL_EDITOR"!==n&&"EVAL_REPL"!==n||(yield Object(fi.d)(ue(u,go,e,t,s))),"EVAL_EDITOR"===n){if((yield Object(fi.f)(e=>e.workspaces[s].sideContentActiveTab))===T.autograder&&("assessment"===s||"grading"===s)){const e=yield Object(fi.f)(e=>e.workspaces[s].editorTestcases);if(e.length>0){yield Object(fi.a)(Ma,"Running all testcases!",750);for(const t of e.keys()){yield Object(fi.d)(mr.evalTestcase(s,t));const{success:e,error:a}=yield Object(fi.e)({success:Object(fi.g)("EVAL_TESTCASE_SUCCESS"),error:Object(fi.g)("EVAL_TESTCASE_FAILURE")});if(a||!e)return}}}}}function*Co(){yield Object(fi.c)(ze.useBackend?Mr:Rr),yield Object(fi.c)(bo),yield Object(fi.c)(_r),yield Object(fi.c)(no),yield Object(fi.c)(ao)}const wo=function(e){const t=Object(wi.a)(),a=[t,Object(Ci.a)(e)],s=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({serialize:!0,maxAge:300})||A.d,n=function(e){if(!e)return;return{...Lt,session:{...Lt.session,...e.session?e.session:{}},workspaces:{...Lt.workspaces,playground:{...Lt.workspaces.playground,editorValue:e.playgroundEditorValue?e.playgroundEditorValue:Lt.workspaces.playground.editorValue,isEditorAutorun:e.playgroundIsEditorAutorun?e.playgroundIsEditorAutorun:Lt.workspaces.playground.isEditorAutorun,externalLibrary:e.playgroundExternalLibrary?e.playgroundExternalLibrary:Lt.workspaces.playground.externalLibrary,context:{...Lt.workspaces.playground.context,chapter:e.playgroundSourceChapter?e.playgroundSourceChapter:Lt.workspaces.playground.context.chapter,variant:e.playgroundSourceVariant?e.playgroundSourceVariant:Lt.workspaces.playground.context.variant}}}}}((()=>{try{const e=localStorage.getItem("storedState");if(!e)return;const t=Object(pe.decompressFromUTF16)(e);if(!t)return;return JSON.parse(t)}catch(e){return void _a("Error loading from local storage")}})())||Lt,i=s(Object(A.a)(...a)),r=Object(A.e)(Pi(e),n,i);return t.run(Co),r.subscribe(Object(Qe.throttle)(()=>{(e=>{try{const t={session:{accessToken:e.session.accessToken,refreshToken:e.session.refreshToken,role:e.session.role,name:e.session.name},playgroundEditorValue:e.workspaces.playground.editorValue,playgroundIsEditorAutorun:e.workspaces.playground.isEditorAutorun,playgroundSourceChapter:e.workspaces.playground.context.chapter,playgroundSourceVariant:e.workspaces.playground.context.variant,playgroundExternalLibrary:e.workspaces.playground.externalLibrary},a=Object(pe.compressToUTF16)(JSON.stringify(t));localStorage.setItem("storedState",a)}catch(t){_a("Error saving to local storage")}})(r.getState())},1e3)),r}(Ra);async function Ao(e,t,a,s){const n=await Uo("auth","POST",{body:{code:e,provider:t,...a?{client_id:a}:{},...s?{redirect_uri:s}:{}},errorMessage:"Could not login. Please contact the module administrator."});if(!n)return null;const i=await n.json();return{accessToken:i.access_token,refreshToken:i.refresh_token}}async function Oo(e){const t=await Uo("user","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});return t&&t.ok?await t.json():null}async function To(e){const t=await Uo("assessments","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map(e=>(e.category=Ho(e.type),delete e.type,e.gradingStatus=Fo(e.category,e.status,e.gradedCount,e.questionCount),delete e.gradedCount,delete e.questionCount,e))}async function Io(e,t){let a=await Uo("assessments/"+e,"POST",{accessToken:t.accessToken,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});for(;a&&403===a.status;){const s=window.prompt("Please enter password.","");if(!s)return a=null,window.history.back(),null;a=await Uo("assessments/"+e,"POST",{accessToken:t.accessToken,refreshToken:t.refreshToken,body:{password:s},shouldAutoLogout:!1,shouldRefresh:!0})}if(!a||!a.ok)return null;const s=await a.json();return s.category=Ho(s.type),delete s.type,s.questions=s.questions.map(e=>{if(e.type===Kt.programming){const t=e;t.autogradingResults=t.autogradingResults||[],t.prepend=t.prepend||"",t.postpend=t.postpend||"",t.testcases=t.testcases||[],e=t}return null===e.grader&&(delete e.grader,delete e.gradedAt),e.library.external.name=e.library.external.name.toUpperCase(),e.library.globals=Object.entries(e.library.globals).map(e=>{try{e[1]=window.eval(e[1])}catch(t){}return e}),e}),s}async function ko(e,t,a){return await Uo(`assessments/question/${e}/submit`,"POST",{accessToken:a.accessToken,body:{answer:""+t},noHeaderAccept:!0,refreshToken:a.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function Po(e,t){return await Uo(`assessments/${e}/submit`,"POST",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function xo(e,t){const a=await Uo("grading?group="+t,"GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});if(!a)return null;return(await a.json()).map(e=>{const t={assessmentId:e.assessment.id,assessmentName:e.assessment.title,assessmentCategory:Ho(e.assessment.type),studentId:e.student.id,studentName:e.student.name,submissionId:e.id,submissionStatus:e.status,groupName:e.student.groupName,initialGrade:e.grade,gradeAdjustment:e.adjustment,currentGrade:e.grade+e.adjustment,maxGrade:e.assessment.maxGrade,gradingStatus:"none",questionCount:e.assessment.questionCount,gradedCount:e.gradedCount,initialXp:e.xp,xpAdjustment:e.xpAdjustment,currentXp:e.xp+e.xpAdjustment,maxXp:e.assessment.maxXp,xpBonus:e.xpBonus};return t.gradingStatus=Fo(t.assessmentCategory,t.submissionStatus,t.gradedCount,t.questionCount),t}).sort((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId)}async function Ro(e,t){const a=await Uo("grading/"+e,"GET",{accessToken:t.accessToken,refreshToken:t.refreshToken,shouldRefresh:!0});if(!a)return null;return(await a.json()).map(e=>{const{student:t,question:a,grade:s}=e,n={question:{answer:a.answer,autogradingResults:a.autogradingResults||[],choices:a.choices,content:a.content,roomId:null,id:a.id,library:(i=a.library,{chapter:i.chapter,external:{name:i.external.name.toUpperCase(),symbols:i.external.symbols},globals:Object.entries(i.globals).map(e=>{try{e[1]=window.eval(e[1])}catch(t){}return e})}),solution:e.solution||a.solution||null,solutionTemplate:a.solutionTemplate,prepend:a.prepend||"",postpend:a.postpend||"",testcases:a.testcases||[],type:a.type,maxGrade:a.maxGrade,maxXp:a.maxXp},student:t,grade:{grade:s.grade,xp:s.xp,roomId:s.roomId||"",gradeAdjustment:s.adjustment,xpAdjustment:s.xpAdjustment,comments:s.comments}};var i;return null!==e.grade.grader&&(n.grade.grader=e.grade.grader,n.grade.gradedAt=e.grade.gradedAt),n})}const No=async(e,t,a,s,n,i)=>await Uo(`grading/${e}/${t}`,"POST",{accessToken:n.accessToken,body:{grading:{adjustment:a,xpAdjustment:s,comments:i}},noHeaderAccept:!0,refreshToken:n.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});async function Mo(e){const t=await Uo("notification","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldAutoLogout:!1});let a=[];if(!t||!t.ok)return a;return a=(await t.json()).map(e=>({id:e.id,type:e.type,assessment_id:e.assessment_id||void 0,assessment_type:e.assessment?Ho(e.assessment.type):void 0,assessment_title:e.assessment?e.assessment.title:void 0,submission_id:e.submission_id||void 0})),a}async function _o(e,t){return await Uo("notification/acknowledge","POST",{accessToken:e.accessToken,refreshToken:e.refreshToken,body:{notificationIds:t},shouldAutoLogout:!1})}async function Do(e){const t=await Uo("sourcecast","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});if(!t||!t.ok)return null;return await t.json()}const Lo=async(e,t,a,s,n)=>{const i=new FormData,r=Date.now().toString()+".wav";i.append("sourcecast[title]",e),i.append("sourcecast[description]",t),i.append("sourcecast[audio]",a,r),i.append("sourcecast[playbackData]",JSON.stringify(s));return await Uo("sourcecast","POST",{accessToken:n.accessToken,body:i,noContentType:!0,noHeaderAccept:!0,refreshToken:n.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})};const jo=async(e,t,a)=>{const s=new FormData;s.append("assessment[file]",e),s.append("forceUpdate",String(a));const n=await Uo("assessments","POST",{accessToken:t.accessToken,body:s,noContentType:!0,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});return n?await n.text():null};async function Bo(e){const t=await Uo("grading/summary","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});return t&&t.ok?await t.json():null}async function Go(e,t,a){return await Uo("chapter/update/1","POST",{accessToken:a.accessToken,body:{chapterno:e,variant:t},noHeaderAccept:!0,refreshToken:a.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function Uo(e,t,a){const s=new Headers;a.noHeaderAccept||s.append("Accept","application/json"),a.accessToken&&s.append("Authorization","Bearer "+a.accessToken);const n={method:t,headers:s};a.body&&(a.noContentType?n.body=a.body:(s.append("Content-Type","application/json"),n.body=JSON.stringify(a.body)));try{const s=await fetch(`${ze.backendUrl}/v1/${e}`,n);if(a.shouldRefresh&&s&&401===s.status){const s=await async function(e){const t=await Uo("auth/refresh","POST",{body:{refresh_token:e}});if(!t)return null;const a=await t.json();return{accessToken:a.access_token,refreshToken:a.refresh_token}}(a.refreshToken);wo.dispatch(mr.setTokens(s));return Uo(e,t,{...a,accessToken:s.accessToken,shouldRefresh:!1})}if(s&&!s.ok&&!1===a.shouldAutoLogout)return s;if(!s||!s.ok)throw new Error("API call failed or got non-OK response");return s}catch(i){return wo.dispatch(mr.logOut()),_a(a.errorMessage?a.errorMessage:"Please login again."),null}}function*Vo(e,t){if(!e)return void(yield Object(fi.a)(_a,"Couldn't reach our servers. Are you online?"));let a;if(e.status)if(t&&t.has(e.status))a=t.get(e.status);else switch(e.status){case 401:a="Session expired. Please login again.";break;default:a=`Something went wrong (got ${e.status} response)`}else a="Something went wrong (received response with no status code)";yield Object(fi.a)(_a,a)}const Ho=e=>e.charAt(0).toUpperCase()+e.slice(1),Fo=(e,t,a,s)=>["Mission","Sidequest","Practical"].includes(e)&&"submitted"===t?0===a?"none":a===s?"graded":"grading":"excluded";function qo(e,{assetKey:t,message:a="",textConfig:s={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:n=dn.defaultFontStyle,onDown:i=dn.nullFunction,onUp:r=dn.nullFunction,onHover:o=dn.nullFunction,onOut:l=dn.nullFunction,onPointerMove:c=dn.nullFunction,onHoverEffect:d=!0,onClickSound:u=En.buttonClick.key,onHoverSound:h=En.buttonHover.key}){const p=new Phaser.GameObjects.Container(e,0,0),m=new Phaser.GameObjects.Sprite(e,0,0,t);m.setInteractive({pixelPerfect:!0,useHandCursor:!0}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{gd.getInstance().getSoundManager().playSound(u),r()}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{gd.getInstance().getSoundManager().playSound(h),d&&p.setAlpha(1),o()}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{d&&p.setAlpha(.9),l()}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{i()}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e,t,a)=>{c(e,t,a)});const g=_n(e,a,s,n);return p.add([m,g]),d&&p.setAlpha(.9),p}const Xo={key:an.zektonFont.key,size:35,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Wo{constructor(){this.userState=void 0,this.getUserState=()=>Tn(this.userState),this.userState={}}initialise(){this.userState.collectibles=gd.getInstance().getSaveManager().getLoadedUserState().collectibles}addToList(e,t){this.userState[e]||(this.userState[e]=[]),this.userState[e].push(t)}getList(e){return this.userState[e]||(this.userState[e]=[]),this.userState[e]}async doesIdExistInList(e,t){return e===Gn.assessments&&gd.getInstance().isGameType(md.Simulator)?this.askAssessmentComplete(t):this.getUserState()[e].includes(t)}async askAssessmentComplete(e){const t=Hn.getInstance().getGameManager(),a=new Phaser.GameObjects.Container(t,0,0);Hn.getInstance().addContainerToLayer(pn.UI,a);const s=new Promise(s=>{a.add(qo(t,{assetKey:Cn.longButton.key,message:`Assessment#${e} completed?`,textConfig:{x:0,y:0,oriX:.5,oriY:.4},bitMapTextStyle:Xo}).setPosition(hn.x,100)),a.add(["Yes","No"].map((e,n)=>qo(t,{assetKey:Cn.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.4},bitMapTextStyle:Xo,onUp:()=>{a.destroy(),s("Yes"===e)}}).setPosition(hn.x,200*n+400)))});return await s}async loadAssessments(){if(gd.getInstance().isGameType(md.Simulator))return;const e=await To(gd.getInstance().getAccountInfo());this.userState.assessments=null===e||void 0===e?void 0:e.filter(e=>"submitted"===e.status).map(e=>e.id.toString())}async loadAchievements(){this.userState.achievements=["301","302"],this.userState.collectibles=["cookies","computer"]}}const zo={y:0,duration:300,ease:"Power2"},Yo={y:-un.y,duration:250,ease:"Power2"},$o={key:an.alienLeagueFont.key,size:35,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Ko={key:an.zektonFont.key,size:25,fill:nn.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Qo={key:an.alienLeagueFont.key,size:50,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Jo={key:an.zektonFont.key,size:25,fill:nn.offWhite,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Zo={fontFamily:"Verdana",fontSize:"20px",fill:sn.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},el=.3*-un.x,tl=.05*-un.y;var al={backButtonYPos:.3*un.y,pageYStartPos:.3*-un.y,pageYSpacing:150,pageTextXPos:.3*un.x,listYStartPos:.31*-un.y,listYSpacing:100,listTextXPos:.09*-un.x,previewXPos:el,previewYPos:tl,previewDim:430,previewTitleTextConfig:{x:el,y:tl-275,oriX:.3,oriY:.5},previewKeyTextConfig:{x:el,y:tl+275,oriX:.3,oriY:.5},previewDescTextYOffset:310,arrowDownYPos:.34*un.y,arrowXMidPos:.08*un.x,arrowXOffset:80,arrowXScale:.4,arrowYScale:.3,itemsPerPage:7};const sl=e=>e.map(e=>nl(e)),nl=e=>Tn(gd.getInstance().getAwardsMapping().get(e));let il;!function(e){e.Collectibles="Collectibles",e.Achievements="Achievements"}(il||(il={}));var rl=class{constructor(){this.scene=void 0,this.layerManager=void 0,this.userStateManager=void 0,this.phaseManager=void 0,this.uiContainer=void 0,this.previewContainer=void 0,this.itemsContainer=void 0,this.pageChosenContainer=void 0,this.currActivePage=void 0,this.activePageNumber=void 0,this.getScene=()=>Tn(this.scene),this.getLayerManager=()=>Tn(this.layerManager),this.getPhaseManager=()=>Tn(this.phaseManager),this.getSoundManager=()=>gd.getInstance().getSoundManager(),this.getUserStateManager=()=>Tn(this.userStateManager),this.activePageNumber=new Map,this.currActivePage=il.Collectibles}initialise(e,t,a){this.scene=e,this.layerManager=e.layerManager,this.userStateManager=t,this.phaseManager=a,Object.keys(il).forEach((e,t)=>{const a=e;this.activePageNumber.set(a,0)})}setPage(e){if(this.uiContainer){this.itemsContainer&&this.itemsContainer.destroy(),this.pageChosenContainer&&this.pageChosenContainer.destroy(),this.currActivePage=e,this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer);const t=this.getPageOptPositions(),a=Object.keys(il).findIndex(t=>t===e),s=new Phaser.GameObjects.Sprite(this.getScene(),t[a][0],t[a][1]+al.pageYStartPos,Cn.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.getScene(),0,0,[s]),this.uiContainer.add(this.pageChosenContainer),this.setPreview()}}createUIContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=new Phaser.GameObjects.Rectangle(this.getScene(),0,0,un.x,4*un.y,0).setAlpha(.7).setInteractive(),a=new Phaser.GameObjects.Image(this.getScene(),0,0,Cn.awardsMenu.key);e.add([t,a]);const s=Object.keys(il).map((e,t)=>({text:e,callback:()=>this.setPage(e)})),n=this.getPageOptPositions();e.add(s.map((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+al.pageYStartPos,e.callback)));const i=this.createPageOpt("Back",0,al.backButtonYPos,async()=>{this.getPhaseManager().isCurrentPhase(jn.AwardMenu)&&await this.getPhaseManager().popPhase()});e.add(i);const r=qo(this.getScene(),{assetKey:Cn.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(al.arrowXScale,al.arrowYScale).setRotation(-90*Math.PI/180).setPosition(al.arrowXMidPos-al.arrowXOffset,al.arrowDownYPos),o=qo(this.getScene(),{assetKey:Cn.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(al.arrowXScale,al.arrowYScale).setRotation(90*Math.PI/180).setPosition(al.arrowXMidPos+al.arrowXOffset,al.arrowDownYPos);e.add([r,o]);const l=new Phaser.GameObjects.Sprite(this.getScene(),al.previewXPos,al.previewYPos,Cn.popUpFrame.key).setScale(1.2);return e.add(l),e}getPageOptPositions(){return cn({numOfItems:Object.keys(il).length,xSpacing:0,ySpacing:al.pageYSpacing})}setPreview(e){if(this.uiContainer){if(this.previewContainer&&this.previewContainer.destroy(),this.previewContainer=new Phaser.GameObjects.Container(this.getScene(),0,0),e){const t=new Phaser.GameObjects.Sprite(this.getScene(),0,0,e.assetKey);$n(t,al.previewDim,al.previewDim),t.setPosition(al.previewXPos,al.previewYPos).setOrigin(.428,.468);const a=_n(this.getScene(),e.title,al.previewTitleTextConfig,Qo),s=_n(this.getScene(),e.assetKey,al.previewKeyTextConfig,Jo),n=new Phaser.GameObjects.Text(this.getScene(),al.previewXPos,al.previewYPos+al.previewDescTextYOffset,e.description,Zo).setOrigin(.4,0);this.previewContainer.add([t,a,s,n])}this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber.get(this.currActivePage),a=An(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(a).length>0&&(this.activePageNumber.set(this.currActivePage,a),this.setPage(this.currActivePage))}createPageOpt(e,t,a,s){return qo(this.getScene(),{assetKey:Cn.awardsPage.key,message:e,textConfig:{x:al.pageTextXPos,y:0,oriX:.1,oriY:.5},bitMapTextStyle:$o,onUp:s}).setPosition(t,a)}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=this.getItems(this.activePageNumber.get(this.currActivePage)),a=cn({numOfItems:t.length,xSpacing:0,ySpacing:al.listYSpacing});return e.add(t.map((e,t)=>this.createItemButton(e.title,a[t][0],a[t][1]+al.listYStartPos,()=>this.setPreview(e)))),e}createItemButton(e,t,a,s){return qo(this.getScene(),{assetKey:Cn.awardsBanner.key,message:e,textConfig:{x:al.listTextXPos,y:0,oriX:0,oriY:.55},bitMapTextStyle:Ko,onUp:s}).setPosition(t,a)}getItems(e){let t;switch(this.currActivePage){case il.Achievements:t=this.getUserStateManager().getList(Gn.achievements);break;case il.Collectibles:t=this.getUserStateManager().getList(Gn.collectibles);break;default:t=[]}const a=sl(t),s=e*al.itemsPerPage;return a.slice(s,s+al.itemsPerPage)}async activateUI(){this.uiContainer=this.createUIContainer(),this.getLayerManager().addToLayer(pn.UI,this.uiContainer),this.getSoundManager().playSound(En.menuEnter.key),this.setPage(this.currActivePage),this.uiContainer.setPosition(hn.x,-un.y),this.getScene().tweens.add({targets:this.uiContainer,...zo,y:hn.y})}async deactivateUI(){this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound(En.menuExit.key),this.getScene().tweens.add({targets:this.uiContainer,...Yo}),await wn(Yo.duration),Pn(this.getScene(),this.uiContainer,{fadeDuration:50}))}};class ol{constructor(){this.observerId=void 0,this.observerId="GameBackgroundManager"}renderBackgroundLayerContainer(e){const t=Hn.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){Hn.getInstance().clearSeveralLayers([pn.Background]);const t=new Phaser.GameObjects.Image(Hn.getInstance().getGameManager(),hn.x,hn.y,e);Yn(t,un.x,un.y),Hn.getInstance().addContainerToLayer(pn.Background,t),Hn.getInstance().fadeInLayer(pn.Background)}}class ll extends Phaser.GameObjects.Container{constructor(e,{choices:t,defaultChoiceIdx:a=0,maxXSpace:s=un.x,radioChoiceConfig:n={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:i={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:r=dn.defaultFontStyle},o,l,c=En.radioButtonClick.key){super(e,o,l),this.buttonClickSoundKey=void 0,this.activeChoice=void 0,this.activeChoiceIdx=void 0,this.choices=void 0,this.buttonPositions=void 0,this.radioChoiceConfig=void 0,this.choiceTextConfig=void 0,this.bitmapTextStyle=void 0,this.activeChoiceIdx=a,this.choices=t,this.choiceTextConfig=i,this.bitmapTextStyle=r,this.radioChoiceConfig=n,this.buttonClickSoundKey=c;const d=this.getRadioButtons(t);this.buttonPositions=on({numOfItems:d.length,maxXSpace:s}),this.renderRadioButtons(d,this.buttonPositions,this.radioChoiceConfig),this.activate(a)}getRadioButtons(e){return e.map((e,t)=>({text:e,callback:()=>this.activate(t)}))}renderRadioButtons(e,t,a){this.add(e.map((e,s)=>this.createRadioButton(t[s][0],t[s][1],e.callback,a)))}createRadioButton(e,t,a,s){return new Phaser.GameObjects.Ellipse(this.scene,e,t,s.circleDim,s.circleDim,nn.lightBlue).setStrokeStyle(s.outlineThickness,nn.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{gd.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),a()})}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=_n(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),a=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,nn.darkBlue);this.activeChoice.add([t,a]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:dn.nullInteractionId}}var cl=ll;const dl={key:an.zektonFont.key,size:25,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ul={key:an.zektonFont.key,size:35,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},hl={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var pl={optHeaderTextConfig:{x:.25*un.x,y:0,oriX:.5,oriY:.75},optXSpace:.4*un.x,optYSpace:.7*un.y,optXPos:140,volContainerOpts:["0","0.5","1.0","1.5","2.0"]};const ml={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},gl={key:an.zektonFont.key,size:20,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},yl={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var El={buttonYPos:.15*un.y,escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settingsTextConfig:{x:.38*un.x,y:.1*-hn.y,oriX:0,oriY:.5},settingsYOffset:.1*-hn.y,settingsYSpace:.3*un.y,radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},radioButtonsXSpace:.2*un.x,volOptXPos:.05*un.x,volOptYPos:.1*-un.y};var bl=class{constructor(){this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.scene=void 0,this.layerManager=void 0,this.phaseManager=void 0,this.inputManager=void 0,this.getScene=()=>Tn(this.scene),this.getLayerManager=()=>Tn(this.layerManager),this.getSoundManager=()=>gd.getInstance().getSoundManager(),this.getSettingsSaveManager=()=>gd.getInstance().getSaveManager(),this.getPhaseManager=()=>Tn(this.phaseManager),this.getInputManager=()=>Tn(this.inputManager)}initialise(e,t){this.scene=e,this.layerManager=e.layerManager,this.inputManager=e.inputManager,this.phaseManager=t}createUIContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=new Phaser.GameObjects.Image(this.getScene(),hn.x,hn.y,Cn.escapeMenuBackground.key).setDisplaySize(un.x,un.y).setInteractive({pixelPerfect:!0});e.add(t);const a=this.getSettings(),s=on({direction:rn.Column,numOfItems:a.length,maxYSpace:El.settingsYSpace});e.add(a.map((e,t)=>_n(this.getScene(),e,{...El.settingsTextConfig,y:s[t][1]+El.settingsTextConfig.y},yl)));const{bgmVolume:n,sfxVolume:i}=this.getSettingsSaveManager().getSettings(),r=pl.volContainerOpts.findIndex(e=>parseFloat(e)===i),o=pl.volContainerOpts.findIndex(e=>parseFloat(e)===n);this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(r,s[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(o,s[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);const l=this.getOptButtons(),c=on({numOfItems:l.length});return e.add(l.map((e,t)=>this.createEscapeOptButton(e.text,c[t][0],c[t][1]+El.buttonYPos,e.callback))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new cl(this.getScene(),{choices:pl.volContainerOpts,defaultChoiceIdx:e,maxXSpace:El.radioButtonsXSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:El.radioChoiceTextConfig,bitmapTextStyle:gl},El.volOptXPos,-hn.y+t+El.settingsYOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),gd.getInstance().isGameType(md.Simulator)?this.getScene().scene.start("StorySimulatorMenu"):this.getScene().scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.getPhaseManager().isCurrentPhase(jn.EscapeMenu)&&await this.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,a,s){return qo(this.getScene(),{assetKey:Cn.mediumButton.key,message:e,textConfig:El.escapeOptTextConfig,bitMapTextStyle:ml,onUp:s}).setPosition(t,a)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSettingsSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),gd.getInstance().getSoundManager().applyUserSettings(this.getSettingsSaveManager().getSettings())}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}activateUI(){const e=this.createUIContainer();this.getSoundManager().playSound(En.menuEnter.key),this.getLayerManager().addToLayer(pn.Escape,e)}deactivateUI(){this.getSoundManager().playSound(En.menuExit.key),this.getLayerManager().clearSeveralLayers([pn.Escape])}};var vl=class{constructor(){this.scene=void 0,this.keyboardListeners=void 0,this.eventListeners=void 0,this.getScene=()=>Tn(this.scene),this.keyboardListeners=[],this.eventListeners=[]}initialise(e){this.scene=e}enableMouseInput(e){this.getScene().input.mouse.enabled=e}enableKeyboardInput(e){this.getScene().input.keyboard.enabled=e}registerKeyboardListener(e,t,a){const s=this.getScene().input.keyboard.addKey(e).addListener(t,a);this.keyboardListeners.push(s)}registerEventListener(e,t){const a=this.getScene().input.addListener(e,t);this.eventListeners.concat(a)}clearListeners(){this.keyboardListeners.forEach(e=>e.removeAllListeners()),this.eventListeners.forEach(e=>e.removeAllListeners())}};class Sl{constructor(){this.phaseMap=void 0,this.phaseStack=void 0,this.inputManager=void 0,this.phaseTransitionCallback=void 0,this.getInputManager=()=>Tn(this.inputManager),this.phaseStack=[jn.None],this.phaseMap=new Map,this.phaseTransitionCallback=dn.nullFunction}initialise(e,t){this.phaseMap=e,this.inputManager=t}setCallback(e){this.phaseTransitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e===t||this.isCurrentPhase(jn.EscapeMenu)||(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e===t||this.isCurrentPhase(jn.EscapeMenu)||(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.getInputManager().enableKeyboardInput(!1),this.getInputManager().enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),await this.phaseTransitionCallback(t))return this.getInputManager().enableMouseInput(!0),void this.getInputManager().enableKeyboardInput(!0);await this.phaseMap.get(t).activateUI(),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[jn.None]),this.phaseStack[this.phaseStack.length-1]}}const fl=.975*-hn.y,Cl={key:an.zektonFont.key,size:25,fill:nn.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class wl extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){const t=qo(this.scene,{assetKey:Cn.topButton.key,message:"Back",textConfig:{x:0,y:fl,oriX:.5,oriY:.25},bitMapTextStyle:Cl,onUp:e}).setPosition(hn.x,hn.y);this.add(t)}}var Al=wl;const Ol=`url(${dn.assetsFolder}/ui/magnifying.png), pointer`,Tl=`url(${dn.assetsFolder}/ui/magnifying_trigg.png), pointer`,Il=`url(${dn.assetsFolder}/ui/magnifying_check.png), pointer`;var kl=class{constructor(){this.uiContainer=void 0}createUIContainer(){const e=Hn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Al(e,()=>{Hn.getInstance().popPhase(),Hn.getInstance().fadeInLayer(pn.Character,300)});return t.add(a),t}async activateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Hn.getInstance().addContainerToLayer(pn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-un.y),e.tweens.add({targets:this.uiContainer,...zo}),Hn.getInstance().enableObjectAction({onClick:this.explorePointerUp,onHover:this.explorePointerOver,onPointerout:this.explorePointerOut}),Hn.getInstance().enableBBoxAction({onClick:this.explorePointerUp,onHover:this.explorePointerOver,onPointerout:this.explorePointerOut}),e.input.setDefaultCursor(Ol),Hn.getInstance().playSound(En.modeEnter.key)}async deactivateUI(){const e=Hn.getInstance().getGameManager();e.input.setDefaultCursor(""),Hn.getInstance().disableBBoxAction(),Hn.getInstance().disableObjectAction(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Yo}),await wn(500),Pn(e,this.uiContainer))}explorePointerOver(e){const t=Hn.getInstance().getGameManager();Hn.getInstance().hasTriggeredInteraction(e)?t.input.setDefaultCursor(Il):t.input.setDefaultCursor(Tl)}explorePointerOut(){Hn.getInstance().getGameManager().input.setDefaultCursor(Ol)}explorePointerUp(e){const t=Hn.getInstance().getGameManager();t.input.setDefaultCursor(""),Hn.getInstance().triggerInteraction(e),t.input.setDefaultCursor(Ol)}};const Pl={key:an.zektonFont.key,size:45,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var xl={buttonYPosOffset:.3*un.y,entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*un.y,duration:300,ease:"Power2"}};var Rl=class{constructor(){this.uiContainer=void 0}getLatestLocationModes(){const e=Hn.getInstance().getCurrLocId();let t=Hn.getInstance().getModesByLocId(e);return 0===Hn.getInstance().getLocationAttr(qn.talkTopics,e).length&&(t=t.filter(e=>e!==mi.Talk)),t}createUIContainer(){const e=Hn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Image(e,hn.x,hn.y,Cn.modeMenuBanner.key);t.add(a);const s=this.getLatestLocationModes(),n=this.getModeButtons(s),i=on({numOfItems:n.length});return t.add(n.map((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+xl.buttonYPosOffset,e.callback))),t}getModeButtons(e){return e.sort().map(e=>({text:e,callback:()=>{Hn.getInstance().pushPhase(gi[e]),e!==mi.Talk&&Hn.getInstance().fadeOutLayer(pn.Character,300)}}))}createModeButton(e,t,a,s){return qo(Hn.getInstance().getGameManager(),{assetKey:Cn.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:Pl,onUp:s}).setPosition(t,a)}async activateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Hn.getInstance().addContainerToLayer(pn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,un.y),e.tweens.add({targets:this.uiContainer,...xl.entryTweenProps}),Hn.getInstance().playSound(En.modeEnter.key)}async deactivateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...xl.exitTweenProps}),await wn(500),Pn(e,this.uiContainer))}};const Nl={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Ml={buttonYSpace:.8*un.y,buttonXPosOffset:.25*un.x,previewFrameXPos:.3*un.x,previewWidth:.473*un.x,previewHeight:.56*un.y,previewXPos:.3125*un.x,previewYPos:.515*un.y};var _l=class{constructor(){this.uiContainer=void 0,this.previewMask=void 0}setPreview(e,t){e.setTexture(t).setPosition(Ml.previewXPos,Ml.previewYPos),Yn(e,Ml.previewWidth,Ml.previewHeight)}getLatestNavigations(){return Hn.getInstance().getLocationAttr(qn.navigation,Hn.getInstance().getCurrLocId())}createUIContainer(){const e=Hn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Graphics(e).fillRect(Ml.previewXPos-Ml.previewWidth/2,Ml.previewYPos-Ml.previewHeight/2,Ml.previewWidth,Ml.previewHeight).setAlpha(0),s=new Phaser.GameObjects.Sprite(e,Ml.previewFrameXPos,hn.y,Cn.locationPreviewFrame.key),n=new Phaser.GameObjects.Sprite(e,hn.x,hn.y,Cn.locationPreviewFill.key).setMask(a.createGeometryMask());t.add([s,n]);const i=this.getLatestNavigations(),r=this.getMoveButtons(i,n),o=on({numOfItems:r.length,numItemLimit:1,maxYSpace:Ml.buttonYSpace});t.add(r.map((e,t)=>this.createMoveButton(e.text,o[t][0]+Ml.buttonXPosOffset,o[t][1],e.callback,e.onHover,e.onOut)));const l=new Al(e,()=>{Hn.getInstance().popPhase(),Hn.getInstance().fadeInLayer(pn.Character,300)});return t.add(l),this.setPreview(n,Cn.defaultLocationImg.key),this.previewMask=a,t}getMoveButtons(e,t){const a=e=>this.setPreview(t,e),s=()=>this.setPreview(t,Cn.defaultLocationImg.key);return e.map(e=>{const t=Hn.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await Hn.getInstance().popPhase(),await Hn.getInstance().changeLocationTo(e)},onHover:()=>a(t.assetKey),onOut:()=>s()}})}createMoveButton(e,t,a,s,n,i){return qo(Hn.getInstance().getGameManager(),{assetKey:Cn.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:Nl,onUp:s,onHover:n,onOut:i}).setPosition(t,a)}async activateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Hn.getInstance().addContainerToLayer(pn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-un.y),this.previewMask.setPosition(this.uiContainer.x,-un.y),e.tweens.add({targets:[this.uiContainer,this.previewMask],...zo}),Hn.getInstance().playSound(En.modeEnter.key)}async deactivateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),this.previewMask.setPosition(this.uiContainer.x,0),e.tweens.add({targets:[this.uiContainer,this.previewMask],...Yo}),await wn(500),Pn(e,this.uiContainer),this.previewMask.destroy())}};var Dl=class{activateUI(){}deactivateUI(){}};const Ll=.7*un.y,jl={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Bl=class{constructor(){this.uiContainer=void 0}getLatestTalkTopics(){return Hn.getInstance().getLocationAttr(qn.talkTopics,Hn.getInstance().getCurrLocId())}createUIContainer(){const e=Hn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=this.getLatestTalkTopics(),s=this.getTalkTopicButtons(a),n=on({numOfItems:s.length,maxYSpace:Ll});t.add(s.map((e,t)=>this.createTalkTopicButton(e.text,n[t][0],n[t][1],e.callback))),s.forEach((a,s)=>{const i=new Phaser.GameObjects.Sprite(e,n[s][0],n[s][1],Cn.talkOptCheck.key);!!a.interactionId&&Hn.getInstance().hasTriggeredInteraction(a.interactionId)&&t.add(i)});const i=new Al(e,()=>Hn.getInstance().popPhase());return t.add(i),t}getTalkTopicButtons(e){return e.map(e=>({text:Tn(Hn.getInstance().getDialogue(e)).title,callback:async()=>{Hn.getInstance().triggerInteraction(e),await Hn.getInstance().showDialogue(e)},interactionId:e}))}createTalkTopicButton(e,t,a,s){return qo(Hn.getInstance().getGameManager(),{assetKey:Cn.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:jl,onUp:s}).setPosition(t,a)}async activateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Hn.getInstance().addContainerToLayer(pn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-un.y),e.tweens.add({targets:this.uiContainer,...zo}),Hn.getInstance().playSound(En.modeEnter.key)}async deactivateUI(){const e=Hn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Yo}),await wn(500),Pn(e,this.uiContainer))}};class Gl extends Phaser.Scene{constructor(){super("GameManager"),this.currentLocationId=void 0,this.currentCheckpoint=void 0,this.layerManager=void 0,this.stateManager=void 0,this.objectManager=void 0,this.characterManager=void 0,this.dialogueManager=void 0,this.actionManager=void 0,this.userStateManager=void 0,this.boundingBoxManager=void 0,this.popUpManager=void 0,this.saveManager=void 0,this.escapeManager=void 0,this.phaseManager=void 0,this.backgroundManager=void 0,this.inputManager=void 0,this.awardsManager=void 0,this.getCurrentCheckpoint=()=>Tn(this.currentCheckpoint),this.getSaveManager=()=>gd.getInstance().getSaveManager(),this.currentCheckpoint=void 0,this.currentLocationId=dn.nullInteractionId,this.layerManager=new li,this.stateManager=new Si,this.characterManager=new Qn,this.objectManager=new di,this.dialogueManager=new ai,this.actionManager=new Xn,this.userStateManager=new Wo,this.boundingBoxManager=new Wn,this.popUpManager=new pi,this.escapeManager=new bl,this.phaseManager=new Sl,this.backgroundManager=new ol,this.inputManager=new vl,this.awardsManager=new rl}init({gameCheckpoint:e,continueGame:t,chapterNum:a,checkpointNum:s}){gd.getInstance().setCurrentSceneRef(this),gd.getInstance().getSaveManager().registerGameInfo(a,s,t),this.currentCheckpoint=e,this.layerManager=new li,this.stateManager=new Si,this.characterManager=new Qn,this.objectManager=new di,this.dialogueManager=new ai,this.actionManager=new Xn,this.userStateManager=new Wo,this.boundingBoxManager=new Wn,this.popUpManager=new pi,this.escapeManager=new bl,this.phaseManager=new Sl,this.backgroundManager=new ol,this.inputManager=new vl,this.awardsManager=new rl}preload(){var e,t;Hn.getInstance().setGameManager(this),oi(this),this.currentLocationId=this.getSaveManager().getLoadedLocation()||this.getCurrentCheckpoint().startingLoc,this.stateManager.initialise(this),this.userStateManager.initialise(),this.dialogueManager.initialise(this),this.characterManager.initialise(this),this.actionManager.initialise(this),this.inputManager.initialise(this),this.boundingBoxManager.initialise(),this.objectManager.initialise(),this.layerManager.initialise(this),this.awardsManager.initialise(this,this.userStateManager,this.phaseManager),this.phaseManager.initialise((e=this.escapeManager,t=this.awardsManager,new Map([[jn.Menu,new Rl],[jn.Move,new _l],[jn.Explore,new kl],[jn.Talk,new Bl],[jn.Sequence,new Dl],[jn.None,new Dl],[jn.EscapeMenu,e],[jn.AwardMenu,t]])),this.inputManager),this.escapeManager.initialise(this,this.phaseManager),this.phaseManager.setCallback(async e=>await this.checkpointTransition(e)),this.preloadLocationsAssets(this.getCurrentCheckpoint()),this.bindKeyboardTriggers()}preloadLocationsAssets(e){Hn.getInstance().loadSounds(e.map.getSoundAssets()),e.map.getMapAssets().forEach((e,t)=>{this.load.image(t,On(e))})}async create(){await this.userStateManager.loadAssessments(),await this.userStateManager.loadAchievements(),await this.changeLocationTo(this.currentLocationId,!0),await Hn.getInstance().saveGame()}async renderLocation(e,t){const a=Hn.getInstance().getLocationAtId(e);await Hn.getInstance().playBgMusic(a.bgmKey),this.backgroundManager.renderBackgroundLayerContainer(e),this.objectManager.renderObjectsLayerContainer(e),this.boundingBoxManager.renderBBoxLayerContainer(e),this.characterManager.renderCharacterLayerContainer(e),this.layerManager.showLayer(pn.Character),await this.phaseManager.swapPhase(jn.Sequence),t&&await this.actionManager.processGameActions(this.getCurrentCheckpoint().map.getStartActions()),this.stateManager.hasTriggeredInteraction(e)||await Hn.getInstance().bringUpUpdateNotif(a.name),await this.actionManager.processGameActions(a.actionIds),await this.phaseManager.swapPhase(jn.Menu)}async changeLocationTo(e,t=!1){this.currentLocationId=e,await xn(this,300,500,async()=>{await this.layerManager.clearAllLayers(),await this.renderLocation(e,t)}),this.stateManager.triggerInteraction(e)}bindKeyboardTriggers(){this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",async()=>{this.phaseManager.isCurrentPhase(jn.EscapeMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(jn.EscapeMenu)}),this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",async()=>{this.phaseManager.isCurrentPhase(jn.AwardMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(jn.AwardMenu)})}cleanUp(){this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}async checkpointTransition(e){const t=e===jn.Menu&&Hn.getInstance().isAllComplete();return t&&(await this.actionManager.processGameActions(this.getCurrentCheckpoint().map.getEndActions()),this.cleanUp(),this.scene.start("CheckpointTransition")),t}}var Ul=Gl;class Vl{constructor(){this.fullSaveState=void 0,this.chapterNum=void 0,this.checkpointNum=void 0,this.continueGame=void 0,this.getChapterNum=()=>Tn(this.chapterNum),this.getCheckpointNum=()=>Tn(this.checkpointNum),this.getFullSaveState=()=>Tn(this.fullSaveState),this.fullSaveState={gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}}async loadLastSaveState(){this.fullSaveState=await async function(){const e={method:"GET",headers:bd(gd.getInstance().getAccountInfo().accessToken)},t=await fetch(ze.backendUrl+"/v1/user/",e),a=await t.text(),s=JSON.parse(a).gameStates.collectibles;return Je.a.isEmpty(s)?{gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}:s}()}registerGameInfo(e,t,a){this.chapterNum=e,this.checkpointNum=t,this.continueGame=a}async saveGame(){gd.getInstance().isGameType(md.Game)&&gd.getInstance().getCurrentSceneRef()instanceof Ul&&(this.fullSaveState=function(e,t,a){const s=Hn.getInstance().getGameManager(),n=s.stateManager,i=s.userStateManager,r=s.phaseManager,o={currentLocation:s.currentLocationId,currentPhase:r.getCurrentPhase(),chapterObjective:Ei(n.getCheckpointObjectives().getObjectives()),locationStates:vi(n.getLocationStates()),objectPropertyMap:Ei(n.getObjPropertyMap()),bboxPropertyMap:Ei(n.getBBoxPropertyMap()),triggeredInteractions:Ei(n.getTriggeredInteractions()),lastCheckpointPlayed:a},l={settings:{...e.userSaveState.settings},recentlyPlayedCheckpoint:[t,a],collectibles:i.getList(Gn.collectibles),largestCompletedChapter:e.userSaveState.largestCompletedChapter};return{gameSaveStates:{...e.gameSaveStates,[t]:o},userSaveState:l}}(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await Ed(this.fullSaveState))}async saveChapterComplete(e){gd.getInstance().isGameType(md.Game)&&e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e,await Ed(this.fullSaveState))}async saveSettings(e){this.fullSaveState=function(e,t){return{gameSaveStates:e.gameSaveStates,userSaveState:{...e.userSaveState,settings:t}}}(this.fullSaveState,e),await Ed(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getLoadedGameStoryState(){return this.continueGame?this.fullSaveState.gameSaveStates[this.getChapterNum()]:void 0}getLoadedLocation(){return this.continueGame&&this.fullSaveState.gameSaveStates[this.getChapterNum()]?this.fullSaveState.gameSaveStates[this.getChapterNum()].currentLocation:void 0}getLoadedPhase(){return this.fullSaveState.gameSaveStates[this.getChapterNum()].currentPhase}}const Hl={defaultScrollSpeed:20,itemPerCol:4,tileDim:2048,maxAwardsPerCol:4,awardsXSpacing:300,arrowXOffset:875,awardYStartPos:300,awardYSpace:hn.y-50,awardDim:200,hoverWidth:300,bannerXOffset:.28*-un.x,bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},Fl={key:an.alienLeagueFont.key,size:35,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},ql={fontFamily:"Verdana",fontSize:"20px",fill:sn.lightBlue,align:"left",wordWrap:{width:Hl.hoverWidth-20}},Xl={fontFamily:"Verdana",fontSize:"15px",fill:sn.offWhite,align:"left",wordWrap:{width:Hl.hoverWidth-20}},Wl={fontFamily:"Verdana",fontSize:"15px",fill:sn.lightBlue,align:"left",wordWrap:{width:Hl.hoverWidth-20}};class zl extends Phaser.Scene{constructor(){super("AwardsHall"),this.layerManager=void 0,this.inputManager=void 0,this.userStateManager=void 0,this.backgroundTile=void 0,this.awardsContainer=void 0,this.isScrollLeft=void 0,this.isScrollRight=void 0,this.scrollLim=void 0,this.awardXSpace=void 0,gd.getInstance().setCurrentSceneRef(this),this.layerManager=new li,this.inputManager=new vl,this.userStateManager=new Wo,this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new li,this.inputManager=new vl,this.userStateManager=new Wo}preload(){oi(this),this.userStateManager.initialise(),this.layerManager.initialise(this),this.inputManager.initialise(this)}async create(){await this.userStateManager.loadAchievements();const e=this.userStateManager.getList(Gn.achievements).length,t=this.userStateManager.getList(Gn.achievements).length;this.awardXSpace=Math.ceil(Math.max(e,t)/Hl.maxAwardsPerCol)*Hl.awardsXSpacing,this.scrollLim=this.awardXSpace<un.x?0:this.awardXSpace-un.x,this.renderBackground(),this.renderAwards()}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=Hl.defaultScrollSpeed:this.isScrollLeft&&(e+=Hl.defaultScrollSpeed),e=An(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,Hl.tileDim,Hl.tileDim,Cn.awardsBackground.key).setOrigin(0,.25),this.layerManager.addToLayer(pn.Background,this.backgroundTile);const e=["Achievements","Collectibles"],t=on({direction:rn.Column,numOfItems:e.length});e.forEach((e,a)=>{const s=this.createBanner(e,t[a][1]);this.layerManager.addToLayer(pn.UI,s)});const a=qo(this,{assetKey:Cn.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(hn.x-Hl.arrowXOffset,hn.y),s=qo(this,{assetKey:Cn.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(hn.x+Hl.arrowXOffset,hn.y).setScale(-1,1),n=new Al(this,()=>{this.cleanUp(),this.scene.start("MainMenu")});this.layerManager.addToLayer(pn.UI,a),this.layerManager.addToLayer(pn.UI,s),this.layerManager.addToLayer(pn.UI,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);const e=this.getAwards(Gn.achievements),t=on({direction:rn.Column,numOfItems:e.length,maxXSpace:this.awardXSpace,maxYSpace:Hl.awardYSpace});this.awardsContainer.add(e.map((e,a)=>this.createAward(e,t[a][0],t[a][1]+Hl.awardYStartPos-hn.y)));const a=this.getAwards(Gn.collectibles),s=on({direction:rn.Column,numOfItems:a.length,maxXSpace:this.awardXSpace,maxYSpace:Hl.awardYSpace});this.awardsContainer.add(a.map((e,t)=>this.createAward(e,s[t][0],s[t][1]+Hl.awardYStartPos))),this.layerManager.addToLayer(pn.Objects,this.awardsContainer)}getAwards(e){const t=this.userStateManager.getList(e);return sl(t)}createAward(e,t,a){const s=new Phaser.GameObjects.Container(this,t,a),n=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),i=((e,t)=>{const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Text(e,20,20,t.title,ql),n=new Phaser.GameObjects.Text(e,20,s.getBounds().bottom+20,t.assetKey,Xl),i=new Phaser.GameObjects.Text(e,20,n.getBounds().bottom+20,t.description,Wl),r=new Phaser.GameObjects.Rectangle(e,0,0,Hl.hoverWidth,i.getBounds().bottom+20,nn.darkBlue).setOrigin(0,0).setAlpha(.8),o=new Phaser.GameObjects.Sprite(e,Hl.hoverWidth/2,0,Cn.scrollFrame.key),l=new Phaser.GameObjects.Sprite(e,Hl.hoverWidth/2,r.getBounds().bottom,Cn.scrollFrame.key);return a.add([r,s,n,i,o,l]),a.setVisible(!1),a})(this,e);return $n(n,Hl.awardDim,Hl.awardDim),n.setInteractive({pixelPerfect:!0,useHandCursor:!0}),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>i.setVisible(!0)),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>i.setVisible(!1)),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,e=>{i.x=e.x+10,i.y=e.y-10}),this.layerManager.addToLayer(pn.UI,i),s.add(n),s}cleanUp(){this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}createBanner(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Sprite(this,Hl.bannerXOffset,0,Cn.awardsPage.key),n=_n(this,e,Hl.bannerTextConfig,Fl);return a.add([s,n]),a}}var Yl=zl;const $l={keyTextConfig:{x:hn.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:hn.x+100,y:0,oriX:.5,oriY:.5},keyIconXPos:hn.x-100,keyStartYPos:.9*hn.y,keyYSpacing:150},Kl={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ql={key:an.zektonFont.key,size:25,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Jl extends Phaser.Scene{constructor(){super("Bindings"),this.layerManager=void 0,this.inputManager=void 0,this.layerManager=new li,this.inputManager=new vl}preload(){this.layerManager.initialise(this),this.inputManager.initialise(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.settingBackground.key),t=new Phaser.GameObjects.Rectangle(this,hn.x,hn.y,un.x,un.y,0).setAlpha(.3);this.layerManager.addToLayer(pn.Background,e),this.layerManager.addToLayer(pn.Background,t)}renderBindings(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),a=cn({numOfItems:t.length,xSpacing:0,ySpacing:$l.keyYSpacing});e.add(t.map((e,t)=>this.createBinding(e.key,e.text,a[t][0],a[t][1]+$l.keyStartYPos)));const s=new Al(this,()=>{this.layerManager.clearAllLayers(),this.scene.start("MainMenu")});this.layerManager.addToLayer(pn.UI,e),this.layerManager.addToLayer(pn.UI,s)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Awards Menu"}]}createBinding(e,t,a,s){const n=new Phaser.GameObjects.Container(this,a,s),i=new Phaser.GameObjects.Sprite(this,$l.keyIconXPos,0,Cn.squareKeyboardIcon.key);switch(e){case"Tab":i.setTexture(Cn.medKeyboardIcon.key)}const r=_n(this,e,$l.keyTextConfig,Kl),o=_n(this,t,$l.keyDescTextConfig,Ql);return n.add([i,r,o]),n}}var Zl=Jl;const ec=(e,t,a)=>new Promise(s=>{"__MISSING"!==e.textures.get(t).key?s(t):(e.load.image(t,a),e.load.once("filecomplete-image-"+t,s),e.load.once("loaderror",s),e.load.start())}),tc=(e,t,a)=>new Promise(s=>{e.cache.text.exists(t)?s(t):(e.load.text(t,a),e.load.once("filecomplete-text-"+t,s),e.load.start())}),ac={key:an.zektonFont.key,size:25,fill:nn.offWhite,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},sc={key:an.zektonFont.key,size:35,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},nc={key:an.zektonFont.key,size:20,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};var ic={defaultScrollSpeed:20,buttonsYOffset:200,buttonsXOffset:100,frameXOffset:15,frameYOffset:-10,indexTextConfig:{x:0,y:-160,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-100,oriX:.5,oriY:.5},arrowXOffset:875,maskRect:{x:0-hn.x,y:100-hn.y,width:un.x-0,height:un.y-200},imageRect:{width:500,height:700},imageDist:650};class rc extends Phaser.GameObjects.Container{constructor(e,t,a,s,n=dn.defaultFontStyle){super(e,t,a),this.renderTextHover(s,n)}renderTextHover(e,t){const a=new Phaser.GameObjects.Rectangle(this.scene,0,0,e.length*t.size*.7,2*t.size,nn.darkBlue).setOrigin(0,.5).setAlpha(.8),s=_n(this.scene,e,{x:10,y:0,oriX:0,oriY:.5},t);this.add([a,s]),this.setVisible(!1)}}var oc=rc;const lc=e=>`${dn.assetsFolder}/stories/${e}`;var cc={defaultCheckpoint:{key:"default-chap",path:lc("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:lc("awardsMapping.txt")}};var dc=class{constructor(){this.soundAssets=void 0,this.mapAssets=void 0,this.locations=void 0,this.talkTopics=void 0,this.objects=void 0,this.boundingBoxes=void 0,this.characters=void 0,this.actions=void 0,this.gameStartActions=void 0,this.checkpointCompleteActions=void 0,this.getLocationAtId=e=>Tn(this.locations.get(e),`Location ${e} was not found!`),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.talkTopics=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getStartActions(){return this.gameStartActions}getEndActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjects(){return this.objects}getBBoxes(){return this.boundingBoxes}getDialogues(){return this.talkTopics}getCharacters(){return this.characters}getActions(){return this.actions}getSoundAssets(){return this.soundAssets}addItemToMap(e,t,a){this[e].set(t,a)}setItemAt(e,t,a){this.getLocationAtId(e)[t].add(a)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}};const uc={left:Zn.Left,middle:Zn.Middle,right:Zn.Right},hc={talk:mi.Talk,explore:mi.Explore,move:mi.Move,menu:mi.Menu},pc={navigation:qn.navigation,talkTopics:qn.talkTopics,objects:qn.objects,boundingBoxes:qn.boundingBoxes,characters:qn.characters,actions:qn.actions,bgmKey:qn.bgmKey,collectibles:qn.collectibles},mc={move_character:Fn.MoveCharacter,update_character:Fn.UpdateCharacter,obtain_collectible:Fn.ObtainCollectible,complete_objective:Fn.CompleteObjective,change_location:Fn.LocationChange,add_item:Fn.AddItem,remove_item:Fn.RemoveItem,change_background:Fn.ChangeBackground,show_dialogue:Fn.BringUpDialogue,add_mode:Fn.AddLocationMode,remove_mode:Fn.RemoveLocationMode,add_popup:Fn.AddPopup,make_object_glow:Fn.MakeObjectGlow,make_object_blink:Fn.MakeObjectBlink,play_bgm:Fn.PlayBGM,play_sfx:Fn.PlaySFX},gc={checklist:Bn.ChecklistState,userstate:Bn.UserState},yc={achievements:Gn.achievements,collectibles:Gn.collectibles};class Ec{static stringToPosition(e){return uc[e]||Zn.Middle}static stringToGameMode(e){const t=hc[e];if(!t)throw new Error("Invalid location mode, "+e);return t}static stringToActionType(e){const t=mc[e];if(!t)throw new Error("Invalid action type, "+e);return t}static stringToGameStateStorage(e){const t=gc[e];if(!t)throw new Error("Invalid condition type, "+e);return t}static stringToLocAttr(e){const t=pc[e];if(!t)throw new Error("Invalid entity type, "+e);return t}static stringToUserState(e){const t=yc[e];if(!t)throw new Error("Invalid user state type, "+e);return t}}let bc;!function(e){e.locations="locations",e.objectives="objectives",e.bgms="bgms",e.sfxs="sfxs"}(bc||(bc={}));class vc{constructor(){this.locAttrAssertions=void 0,this.attrAssertions=void 0,this.locAttrAssertions=new Map,this.attrAssertions=new Map}assertLocAttr(e,t,a){return this.locAttrAssertions.get(e)||this.locAttrAssertions.set(e,[]),this.locAttrAssertions.get(e).push({itemId:t,actionType:a}),t}assertAttr(e,t,a){return this.attrAssertions.get(e)||this.attrAssertions.set(e,[]),this.attrAssertions.get(e).push({itemId:t,actionType:a}),t}assertLocAttrs(e,t,a){t.forEach(t=>this.assertLocAttr(e,t,a))}verifyAssertions(){this.verifyLocAttrAssertions(),this.verifyAttrAssertions()}verifyLocAttrAssertions(){this.locAttrAssertions.forEach((e,t)=>{e.forEach(e=>{const{itemId:a,actionType:s}=e;if(!Pc.checkpoint.map[t].has(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find id "${a}" under ${t} entity type`)})})}verifyAttrAssertions(){this.attrAssertions.forEach((e,t)=>{e.forEach(e=>{const{itemId:a,actionType:s}=e;switch(t){case bc.locations:Pc.checkpoint.map.getLocationAtId(a);break;case bc.objectives:if(void 0===Pc.checkpoint.objectives.getObjectives().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find objective id "${a}"`);break;case bc.bgms:const e=Pc.checkpoint.map.getSoundAssets().filter(e=>e.soundType===yn.BGM&&e.key===a).length;if(0===e)throw new Error(`Cannot find bgm key "${a}"`);if(e>1)throw new Error(`More than 1 bgm key "${a}"`);break;case bc.sfxs:const n=Pc.checkpoint.map.getSoundAssets().filter(e=>e.soundType===yn.SFX&&e.key===a).length;if(0===n)throw new Error(`Cannot find sfx key "${a}"`);if(n>1)throw new Error(`More than 1 sfx key "${a}"`)}})})}actionAssertionError(e,t,a){throw new Error(`Expected type of "${t}" as argument for "${a}", obtained "${e}" which is either undefined or the wrong id.`)}}class Sc{static parseActions(e){return e.map(e=>this.parseAction(e))}static parseAction(e){const[t,a]=ei.splitByChar(e,"if"),s=this.parseActionContent(t);return a&&(s.actionConditions=ei.splitByChar(a,"AND").map(e=>class{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[a,...s]=ei.splitByChar(e,".");switch(Ec.stringToGameStateStorage(a)){case Bn.ChecklistState:return{state:Bn.ChecklistState,conditionParams:{id:Pc.validator.assertAttr(bc.objectives,s[0])},boolean:!t};case Bn.UserState:return{state:Bn.UserState,conditionParams:{listName:s[0],id:s[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}.parse(e))),Pc.checkpoint.map.addItemToMap(qn.actions,s.interactionId,s),s.interactionId}static parseActionContent(e){const[t,a]=ei.splitByChar(e,"(");let s=!1,n=t;"*"===t[t.length-1]&&(s=!0,n=n.slice(0,-1));const i=Ec.stringToActionType(n),r=ei.splitByChar(a.slice(0,-1),","),o={};switch(i){case Fn.ObtainCollectible:o.id=Pc.validator.assertLocAttr(qn.collectibles,r[0],n);break;case Fn.CompleteObjective:o.id=Pc.validator.assertAttr(bc.objectives,r[0],n);break;case Fn.LocationChange:case Fn.ChangeBackground:o.id=Pc.validator.assertAttr(bc.locations,r[0],n);break;case Fn.BringUpDialogue:o.id=Pc.validator.assertLocAttr(qn.talkTopics,r[0],n);break;case Fn.AddItem:case Fn.RemoveItem:const e=Ec.stringToLocAttr(r[0]);o.attr=e,o.locationId=Pc.validator.assertAttr(bc.locations,r[1],n),o.id=Pc.validator.assertLocAttr(e,r[2],n);break;case Fn.AddLocationMode:case Fn.RemoveLocationMode:o.locationId=Pc.validator.assertAttr(bc.locations,r[0],n),o.mode=Ec.stringToGameMode(r[1]);break;case Fn.AddPopup:o.id=Pc.validator.assertLocAttr(qn.objects,r[0],n),o.position=Ec.stringToPosition(r[1]);break;case Fn.MakeObjectBlink:case Fn.MakeObjectGlow:o.id=Pc.validator.assertLocAttr(qn.objects,r[0],n),o.turnOn="false"!==r[1];break;case Fn.PlayBGM:o.id=Pc.validator.assertAttr(bc.bgms,r[0],n);break;case Fn.PlaySFX:o.id=Pc.validator.assertAttr(bc.sfxs,r[0],n)}return{actionType:i,actionParams:o,actionConditions:[],interactionId:Pc.generateActionId(),isInteractive:!1,isRepeatable:s}}}class fc{static parse(e,t){t.forEach(t=>this.parseCharacterDetails(e,t))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r]=ei.splitByChar(t,","),o=new Map,l={id:s,name:n,expressions:o,defaultExpression:i,defaultPosition:Ec.stringToPosition(r)};o.set(i,this.characterAssetKey(s,i)),Pc.checkpoint.map.addMapAsset(this.characterAssetKey(s,i),this.characterAssetPath(s,i)),Pc.checkpoint.map.addItemToMap(qn.characters,s,l),a&&Pc.checkpoint.map.setItemAt(e,qn.characters,s)}}class Cc{static parse(e){const[t,a,s]=ei.splitByChar(e.slice(1),","),n=Ec.stringToPosition(s);return this.addCharacterExprToMap(t,a),{speakerId:t,expression:a,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const a=Pc.checkpoint.map.getCharacters().get(e);if(!a)throw new Error(`Character "${e}" not in map`);const s=t||a.defaultExpression;a.expressions.set(t,fc.characterAssetKey(e,t||s)),Pc.checkpoint.map.addMapAsset(fc.characterAssetKey(e,s),fc.characterAssetPath(e,s))}}const wc=e=>new RegExp(/^[0-9]+$/).test(e),Ac=e=>new RegExp(/^goto [0-9]+$/).test(e),Oc=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),Tc=e=>e&&"@"===e[0];class Ic{static parse(e,t,a){t.forEach((t,s)=>{const[n,i,r]=ei.splitByChar(t,",");Pc.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:a===yn.BGM},soundType:a}),a===yn.BGM&&0===s&&Pc.checkpoint.map.setBGMusicAt(e,n)})}}class kc{static generateActionId(){return kc.actionIdNum++,"action#"+kc.actionIdNum}static init(){kc.actionIdNum=0,kc.checkpoint={map:new dc,startingLoc:"",objectives:new yi},kc.validator=new vc}static parse(e,t=!1){t||kc.init();const a=ei.splitToLines(e);return ei.splitToParagraph(a).forEach(([e,t])=>{0===t.length&&e.includes(":")?kc.parseCheckpointConfig(e):kc.parseCheckpointParagraphs(e,t)||class{static parse(e,t){const a=Pc.checkpoint.map.getLocationAtId(e);ei.splitToParagraph(t).forEach(([e,t])=>{0===t.length?this.parseLocationConfig(a,e):this.parseLocationParagraphs(a,e,t)})}static parseLocationConfig(e,t){const[a,s]=ei.splitByChar(t,":"),n=ei.splitByChar(s,",");switch(a){case"modes":n.forEach(t=>{const a=Ec.stringToGameMode(t);e.modes.add(a)});break;case"nav":n.forEach(t=>{Pc.validator.assertAttr(bc.locations,t),e.navigation.add(t)});break;case"talkTopics":const t=n;Pc.validator.assertLocAttrs(qn.talkTopics,t),e.talkTopics=new Set(t);break;default:throw new Error(`Invalid config key "${a}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,a){switch(t){case"objects":(class{static parse(e,t){ei.splitToParagraph(t).forEach(([t,a])=>{const s=this.parseObjectConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=Sc.parseActions(a))})}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o,l]=ei.splitByChar(t,","),c={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(l)||void 0,isInteractive:!1,interactionId:s};return Pc.checkpoint.map.addMapAsset(this.objectAssetKey(n),this.objectPath(n)),Pc.checkpoint.map.addItemToMap(qn.objects,s,c),a&&Pc.checkpoint.map.setItemAt(e,qn.objects,s),c}}).parse(e.id,a);break;case"boundingBoxes":(class{static parse(e,t){ei.splitToParagraph(t).forEach(([t,a])=>{const s=this.parseBBoxConfig(e,t);a.length&&(s.isInteractive=!0,s.actionIds=Sc.parseActions(a))})}static parseBBoxConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=ei.splitByChar(t,","),l={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:s};return Pc.checkpoint.map.addItemToMap(qn.boundingBoxes,s,l),a&&Pc.checkpoint.map.setItemAt(e,qn.boundingBoxes,s),l}}).parse(e.id,a);break;case"characters":fc.parse(e.id,a);break;case"bgm":Ic.parse(e.id,a,yn.BGM);break;case"sfx":Ic.parse(e.id,a,yn.SFX);break;case"actions":e.actionIds=Sc.parseActions(a);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}.parse(e,t)}),kc.validator.verifyAssertions(),this.checkpoint}static parseCheckpointConfig(e){const[t,a]=ei.splitByChar(e,":");switch(t){case"startingLoc":kc.validator.assertAttr(bc.locations,a),kc.checkpoint.startingLoc=a;break;default:throw new Error(`Invalid checkpoint config key, "${e}"`)}}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":kc.checkpoint.objectives.addObjectives(t);break;case"locations":(class{static parse(e){e.forEach(e=>{const[t,a,s]=ei.splitByChar(e,",",2);Pc.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:s,assetKey:this.locationAssetKey(a)}),Pc.checkpoint.map.addMapAsset(this.locationAssetKey(a),this.locationPath(a))})}static locationAssetKey(e){return e}static locationPath(e){return e}}).parse(t);break;case"gameStartActions":kc.checkpoint.map.setGameStartActions(Sc.parseActions(t));break;case"checkpointCompleteActions":kc.checkpoint.map.setCheckpointCompleteActions(Sc.parseActions(t));break;case"dialogues":(class{static parse(e){ei.splitToParagraph(e).forEach(([e,t])=>{0!==t.length?this.parseDialogue(e,t):console.error("No dialogue found for dialogueId")})}static parseDialogue(e,t){const[a,s]=ei.splitByChar(e,",",1),n={title:s,content:this.parseDialogueContent(t)};Pc.checkpoint.map.addItemToMap(qn.talkTopics,a,n)}static parseDialogueContent(e){return function(e,t){const a=new Map;return e.forEach((e,s)=>{const n=t(e,s);a.set(s,n)}),a}(ei.mapByHeader(e,wc),this.createDialogueLines)}static createDialogueLines(e){const t=[];let a=0;for(;a!==e.length;){const s=e[a];switch(!0){case Ac(s):t[t.length-1].goto=s.split(" ")[1];break;case Oc(s):const n=t[t.length-1];!n.actionIds&&(n.actionIds=[]),n.actionIds.push(Sc.parseAction(s));break;case Tc(s):a++;const i=e[a];if(!i)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:i}),t[t.length-1].speakerDetail=Cc.parse(s);break;default:t.push({line:s})}a++}return t}}).parse(t);break;default:return!1}return!0}}kc.checkpoint=void 0,kc.actionIdNum=void 0,kc.validator=void 0;var Pc=kc;async function xc(e,t,a){const s=gd.getInstance().getCurrentSceneRef(),n=gd.getInstance().getGameChapters()[t].filenames[a];if(!n)return;await tc(s,n,n),await tc(s,cc.defaultCheckpoint.key,cc.defaultCheckpoint.path);const i=s.cache.text.get(n),r=s.cache.text.get(cc.defaultCheckpoint.key);Pc.parse(r),Pc.parse(i,!0);const o=Pc.checkpoint;s.scene.start("GameManager",{gameCheckpoint:o,continueGame:e,chapterNum:t,checkpointNum:a})}async function Rc(){const e=gd.getInstance().getCurrentSceneRef(),t=gd.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("StorySimulatorMenu");const a=t.pop();await tc(e,a,lc(a)),await tc(e,cc.defaultCheckpoint.key,cc.defaultCheckpoint.path);const s=e.cache.text.get(a),n=e.cache.text.get(cc.defaultCheckpoint.key);Pc.parse(n),Pc.parse(s,!0);const i=Pc.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:i,chapterNum:-1,checkpointNum:-1}),!0}function Nc(e,{title:t,imageUrl:a},s,n){const[i,r]=[hn.x+ic.imageDist*s,hn.y];const o=new Phaser.GameObjects.Container(e,i,r),l=new Phaser.GameObjects.Image(e,0,0,a).setDisplaySize(ic.imageRect.width,ic.imageRect.height),c=new Phaser.GameObjects.Sprite(e,ic.frameXOffset,ic.frameYOffset,Cn.chapterSelectFrame.key),d=new oc(e,0,0,"Reset progress",nc),u=new oc(e,0,0,"Play/Continue",nc),h=qo(e,{assetKey:Cn.chapterRepeatButton.key,onUp:async()=>await xc(!1,s,0),onHover:()=>d.setVisible(!0),onOut:()=>d.setVisible(!1),onPointerMove:e=>{d.x=e.worldX-o.x,d.y=e.worldY-o.y}}).setPosition(ic.buttonsXOffset,ic.buttonsYOffset),p=qo(e,{assetKey:Cn.chapterContinueButton.key,onUp:async()=>await xc(!0,s,n),onHover:()=>u.setVisible(!0),onOut:()=>u.setVisible(!1),onPointerMove:e=>{u.x=e.worldX-o.x,u.y=e.worldY-o.y}}).setPosition(-ic.buttonsXOffset,ic.buttonsYOffset),m=_n(e,"Chapter "+s,ic.indexTextConfig,ac),g=_n(e,t,ic.titleTextConfig,sc),y=s<=gd.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,E=new Phaser.GameObjects.Rectangle(e,0,0,ic.imageRect.width,ic.imageRect.height,0).setOrigin(.5).setAlpha(y?0:.8).setInteractive();return o.add([l,c,h,p,d,u,m,g,E]),o}class Mc extends Phaser.Scene{constructor(){super("ChapterSelect"),this.layerManager=void 0,this.chapterContainer=void 0,this.backButtonContainer=void 0,this.loadedGameState=void 0,this.autoScrolling=void 0,this.isScrollLeft=void 0,this.isScrollRight=void 0,this.getGameChapters=()=>gd.getInstance().getGameChapters(),this.chapterContainer=void 0,this.backButtonContainer=void 0,this.layerManager=new li,this.autoScrolling=!0,this.isScrollLeft=!1,this.isScrollRight=!1}init(){gd.getInstance().setCurrentSceneRef(this)}preload(){oi(this),this.layerManager.initialise(this)}async create(){await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters(),this.autoScroll()}update(){if(!this.chapterContainer||this.autoScrolling)return;let e=this.chapterContainer.x;this.isScrollRight?e-=ic.defaultScrollSpeed:this.isScrollLeft&&(e+=ic.defaultScrollSpeed),this.chapterContainer.x=An(e,-ic.imageDist*(this.getGameChapters().length-1),0)}cleanUp(){this.layerManager.clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map(async e=>await ec(this,e.imageUrl,On(e.imageUrl))))}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.chapterSelectBackground.key),t=new Phaser.GameObjects.Rectangle(this,hn.x,hn.y,un.x,un.y,0).setAlpha(.3);this.layerManager.addToLayer(pn.Background,e),this.layerManager.addToLayer(pn.Background,t)}renderChapters(){const e=this.createMask();this.backButtonContainer=new Al(this,()=>{this.cleanUp(),this.scene.start("MainMenu")}),this.chapterContainer=this.createChapterContainer(),this.chapterContainer.mask=new Phaser.Display.Masks.GeometryMask(this,e);const t=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.chapterSelectBorder.key),a=qo(this,{assetKey:Cn.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(hn.x-ic.arrowXOffset,hn.y),s=qo(this,{assetKey:Cn.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(hn.x+ic.arrowXOffset,hn.y).setScale(-1,1);this.layerManager.addToLayer(pn.UI,this.chapterContainer),this.layerManager.addToLayer(pn.UI,this.backButtonContainer),this.layerManager.addToLayer(pn.UI,t),this.layerManager.addToLayer(pn.UI,a),this.layerManager.addToLayer(pn.UI,s)}createMask(){const e=this.add.graphics().fillRect(ic.maskRect.x,ic.maskRect.y,ic.maskRect.width,ic.maskRect.height).setPosition(hn.x,hn.y);return e.alpha=0,e}createChapterContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map((e,t)=>{let a=0;return this.loadedGameState&&this.loadedGameState.gameSaveStates[t]&&(a=this.loadedGameState.gameSaveStates[t].lastCheckpointPlayed),Nc(this,e,t,a)})),e}async autoScroll(){const e=Math.min(gd.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);await this.scrollToIndex(e),this.autoScrolling=!1}async scrollToIndex(e){if(!this.chapterContainer)return;const t=-e*ic.imageDist;this.tweens.add({targets:this.chapterContainer,x:t,ease:"Power2",duration:800}),await wn(800)}}var _c=Mc;const Dc={key:an.alienCowsFont.key,size:80,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Lc={chapterText:"Chapter completed.",checkpointText:"Checkpoint reached.",transitionTextConfig:{x:hn.x,y:hn.y,oriX:.5,oriY:.5},tweenDuration:1500,entryTween:{alpha:1,duration:1500,ease:"Power2"},exitTween:{alpha:0,duration:1500,ease:"Power2"}};class jc extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){gd.getInstance().setCurrentSceneRef(this)}async create(){if(gd.getInstance().isGameType(md.Simulator))return await this.showTransitionText(Lc.checkpointText),void await Rc();const e=gd.getInstance().getSaveManager().getFullSaveState(),t=gd.getInstance().getGameChapters(),[a,s]=e.userSaveState.recentlyPlayedCheckpoint;return this.isLastCheckpoint(t,a,s)?(await gd.getInstance().getSaveManager().saveChapterComplete(a),this.isLastChapter(t,a)?void this.scene.start("MainMenu"):(await this.showTransitionText(Lc.chapterText),void await xc(!0,a+1,0))):(await this.showTransitionText(Lc.checkpointText),void await xc(!1,a,s+1))}async showTransitionText(e){const t=_n(this,e,Lc.transitionTextConfig,Dc).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...Lc.entryTween}),await wn(2*Lc.tweenDuration),this.tweens.add({targets:t,...Lc.exitTween}),await wn(Lc.tweenDuration)}isLastCheckpoint(e,t,a){return a>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}var Bc=jc;const Gc={key:an.zektonFont.key,size:30,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT};var Uc={optionsText:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},buttonYSpace:.5*un.y,optXOffset:80,textXOffset:600,bannerHide:300,bannerShow:200,onFocusOptTween:{x:hn.x+200,duration:200,ease:"Power2"},outFocusOptTween:{x:hn.x+300,duration:200,ease:"Power2"}};class Vc extends Phaser.Scene{constructor(){super("MainMenu"),this.layerManager=void 0,this.layerManager=new li}preload(){gd.getInstance().setCurrentSceneRef(this),this.layerManager.initialise(this)}async create(){this.renderBackground(),this.renderOptionButtons()}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.mainMenuBackground.key);e.setDisplaySize(un.x,un.y),this.layerManager.addToLayer(pn.Background,e)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=on({direction:rn.Column,numOfItems:t.length,maxYSpace:Uc.buttonYSpace});e.add(t.map((e,t)=>this.createOptionButton(e.text,a[t][0]+Uc.bannerHide,a[t][1],e.callback))),this.layerManager.addToLayer(pn.UI,e)}createOptionButton(e,t,a,s){const n=e=>{this.tweens.add({targets:e,...Uc.onFocusOptTween})},i=e=>{this.tweens.add({targets:e,...Uc.outFocusOptTween})},r=qo(this,{assetKey:Cn.mainMenuOptBanner.key,message:e,textConfig:{x:Uc.textXOffset,y:0,oriX:1,oriY:.1},bitMapTextStyle:Gc,onUp:s,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,a);return r}getOptionButtons(){return[{text:Uc.optionsText.chapterSelect,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("ChapterSelect")}},{text:Uc.optionsText.awards,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("AwardsHall")}},{text:Uc.optionsText.studentRoom,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("RoomPreview")}},{text:Uc.optionsText.settings,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("Settings")}},{text:Uc.optionsText.bindings,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("Bindings")}}]}}var Hc=Vc;const Fc='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n',qc={key:an.pixelFont.key,size:25,fill:nn.paleYellow,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Xc="VERIFIED",Wc=128,zc=50,Yc=200,$c={x:0,y:0,oriX:0,oriY:.6};async function Kc(){return function(e){if(e){const t=e.questions[0],a=t.answer;return a||t.solutionTemplate}return Fc}(await Io(405,gd.getInstance().getAccountInfo()))}class Qc extends Phaser.Scene{constructor(){super("RoomPreview"),this.layerManager=void 0,this.inputManager=void 0,this.phaseManager=void 0,this.userStateManager=void 0,this.escapeManager=void 0,this.awardManager=void 0,this.studentCode=void 0,this.preloadImageMap=void 0,this.preloadSoundMap=void 0,this.verifCont=void 0,this.verifMask=void 0,this.context=void 0,this.getVerifCont=()=>Tn(this.verifCont),this.getVerifMask=()=>Tn(this.verifMask),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.layerManager=new li,this.phaseManager=new Sl,this.inputManager=new vl,this.escapeManager=new bl,this.userStateManager=new Wo,this.awardManager=new rl,this.studentCode=Fc}init(){gd.getInstance().setCurrentSceneRef(this),this.studentCode=gd.getInstance().getRoomCode(),this.userStateManager=new Wo,this.layerManager=new li,this.phaseManager=new Sl,this.inputManager=new vl,this.escapeManager=new bl,this.awardManager=new rl,this.createContext()}preload(){var e,t;oi(this),this.userStateManager.initialise(),this.layerManager.initialise(this),this.inputManager.initialise(this),this.awardManager.initialise(this,this.userStateManager,this.phaseManager),this.phaseManager.initialise((e=this.escapeManager,t=this.awardManager,new Map([[jn.None,new Dl],[jn.EscapeMenu,e],[jn.AwardMenu,t]])),this.inputManager),this.escapeManager.initialise(this,this.phaseManager),this.bindKeyboardTriggers();const[a,s]=(e=>{const t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Rectangle(e,0,0,Wc,zc,nn.darkBlue).setOrigin(0,.5).setAlpha(.8),s=new Phaser.GameObjects.Sprite(e,0,0,Cn.verifiedFrame.key).setOrigin(0,.5),n=new Phaser.GameObjects.Graphics(e).fillRect(a.x-a.height*a.originX*.5,a.y-a.width*a.originY*.5,a.width,a.height).setAlpha(0),i=_n(e,Xc,$c,qc).setPosition(Yc,0).setMask(n.createGeometryMask());return e.tweens.add({targets:i,x:-Yc,duration:5e3,ease:"Power0",loop:-1,onLoop:()=>i.x=Yc+50}),t.add([a,i,s]),t.setVisible(!1),[t,n]})(this);this.verifCont=a,this.verifMask=s}async create(){await this.userStateManager.loadAchievements(),await this.eval(this.studentCode),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map(async([e,t])=>{await ec(this,e,t)})),await Promise.all(Array.from(this.preloadSoundMap).map(async([e,t])=>{var a,s,n;await(a=this,s=e,n=t,new Promise(e=>{null!==a.sound.get(s)?e(s):(a.load.audio(s,n),a.load.once("filecomplete-text-"+s,e),a.load.start())}))})),await this.eval("create();"),gd.getInstance().getSoundManager().playBgMusic(dn.nullInteractionId),this.layerManager.addToLayer(pn.UI,this.getVerifCont())}update(){this.eval("update();")}createContext(){this.context=pt(4,[],{},"gpu",{scene:this,phaser:Phaser,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,layerManager:this.layerManager,layerTypes:pn,remotePath:dn.assetsFolder,screenSize:un,createAward:(e,t,a)=>this.createAward(e,t,a)}),this.context.externalContext="playground"}async eval(e){await Object(ga.runInContext)(e,this.context)}bindKeyboardTriggers(){this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",async()=>{this.phaseManager.isCurrentPhase(jn.EscapeMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(jn.EscapeMenu)}),this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",async()=>{this.phaseManager.isCurrentPhase(jn.AwardMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(jn.AwardMenu)})}cleanUp(){this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}createAward(e,t,a){const s=this.userStateManager.getList(Gn.achievements),n=this.userStateManager.getList(Gn.collectibles);if(s.includes(a)||n.includes(a)){const s=nl(a),n=new Phaser.GameObjects.Sprite(this,e,t,s.assetKey);return this.attachVerificationTag(n)}return new Phaser.GameObjects.Sprite(this,e,t,Cn.cookies.key)}attachVerificationTag(e){const t=this.getVerifCont(),a=this.getVerifMask();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>t.setVisible(!0)),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>t.setVisible(!1)),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,e=>{t.x=e.x+10,t.y=e.y-10,a.x=e.x+10,a.y=e.y-10}),e}}class Jc extends Phaser.Scene{constructor(){super("Settings"),this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.layerManager=void 0,this.getSaveManager=()=>gd.getInstance().getSaveManager(),this.layerManager=new li}preload(){gd.getInstance().setCurrentSceneRef(this),this.layerManager.initialise(this)}async create(){this.renderBackground(),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.settingBackground.key),t=new Phaser.GameObjects.Image(this,hn.x,hn.y,Cn.settingBanner.key);this.layerManager.addToLayer(pn.Background,e),this.layerManager.addToLayer(pn.Background,t)}renderOptions(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),a=on({direction:rn.Column,numOfItems:t.length,maxYSpace:pl.optYSpace});e.add(t.map((e,t)=>this.createOptionHeader(e,a[t][1])));const{bgmVolume:s,sfxVolume:n}=this.getSaveManager().getSettings(),i=pl.volContainerOpts.findIndex(e=>parseFloat(e)===n),r=pl.volContainerOpts.findIndex(e=>parseFloat(e)===s);this.sfxVolumeRadioButtons=this.createOptRadioOptions(i,a[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(r,a[1][1]);const o=qo(this,{assetKey:Cn.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:hl,onUp:()=>this.applySettings()}).setPosition(hn.x,.925*un.y),l=new Al(this,()=>{this.layerManager.clearAllLayers(),this.scene.start("MainMenu")});this.layerManager.addToLayer(pn.UI,e),this.layerManager.addToLayer(pn.UI,this.sfxVolumeRadioButtons),this.layerManager.addToLayer(pn.UI,this.bgmVolumeRadioButtons),this.layerManager.addToLayer(pn.UI,o),this.layerManager.addToLayer(pn.UI,l)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Image(this,hn.x,0,Cn.settingOption.key),n=_n(this,e,pl.optHeaderTextConfig,ul);return a.add([s,n]),a}createOptRadioOptions(e,t){return new cl(this,{choices:pl.volContainerOpts,defaultChoiceIdx:e,maxXSpace:pl.optXSpace,choiceTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},bitmapTextStyle:dl},pl.optXPos,-hn.y+t)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),gd.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}}var Zc=Jc;var ed=class{constructor(){this.soundAssetMap=void 0,this.bgmVol=void 0,this.sfxVol=void 0,this.currBgMusicKey=void 0,this.currBgMusic=void 0,this.getBaseSoundManager=()=>Tn(gd.getInstance().sound),this.getCurrentScene=()=>Tn(gd.getInstance().getCurrentSceneRef()),this.getBaseSoundManager().unlock(),this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=dn.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){const e=Tn(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach(e=>{this.addSoundAsset(e),this.loadSound(e.key,On(e.path))})}loadSoundAssetMap(e){Object.values(e).forEach(e=>{this.addSoundAsset(e),this.loadSound(e.key,On(e.path))})}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){const t=this.getSoundAsset(e);if(t){const e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!gd.getInstance().isMounted)return;if(this.currBgMusicKey===e)return;if(e===dn.nullInteractionId&&this.currBgMusic)return this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,void(this.currBgMusicKey=e);this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);const a=Tn(this.getSoundAsset(e)),s=void 0!==a.config.volume?a.config.volume:1;this.currBgMusic=this.getCurrentScene().sound.add(a.key,{...a.config,volume:s*this.bgmVol}),this.currBgMusicKey=a.key,this.currBgMusic.play()}fadeOutAndDestroyMusic(e,t=1e3){this.getCurrentScene().tweens.add({targets:e,...gn,duration:t}),setTimeout(()=>e.destroy(),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}};const td=e=>async(t,a,s={},n={})=>{try{const i=function(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization","Bearer "+e),t}(gd.getInstance().getAccountInfo().accessToken||"");Object.entries(s).forEach(([e,t])=>{i.append(e,t)});const r={method:a,headers:i,...n};return fetch(ze.backendUrl+`/v1/${e}/`+t,r)}finally{}},ad=td("assets"),sd=td("stories");const nd=["locations","objects","images","avatars","ui","sfx","bgm","stories"];async function id(e){return(await Promise.all(e.map(async e=>{const t=await async function(e){const t=await ad(e,"GET",{"Content-Type":"application/json"});return 200===t.status?t.json():[]}(e);return t.length?t:[""+e]}))).reduce((e,t)=>e.concat(t),[])}async function rd(e,t){return(await Promise.all(Array.from(e).map(async e=>{const a=await async function(e,t){const a=new FormData;a.set("upload",e);const s=await ad(`${t}/${e.name}`,"POST",{},{body:a,mode:"cors"});return s?s.text():""}(e,t);return e.name+" => "+a}))).join("\n")}async function od(){const e=await sd("","GET"),t=200===e.status?await e.json():[];return Je.a.sortBy(t,e=>new Date(e.openAt))}async function ld(e,t){const a=await sd(e,"POST",{"Content-Type":"application/json"},{body:JSON.stringify(t)});return 200===a.status?"Chapter successfully created/updated":a.text()}var cd=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../assets/mockChapter0.txt","../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../assets/mockChapter2.txt"]}];class dd{static parse(e){dd.awardsMapping=new Map;const t=ei.splitToLines(e);return ei.splitToParagraph(t).forEach(([e,t])=>{dd.parseAwardParagraphs(e,t)}),this.awardsMapping}static parseAwardParagraphs(e,t){ei.splitToParagraph(t).forEach(([t,a])=>{const[s,n,i,r]=ei.splitByChar(a[0],",",3);dd.awardsMapping.set(t,{id:t,assetKey:s,assetPath:On(n),title:i,description:r,awardType:Ec.stringToUserState(e)})})}}dd.awardsMapping=void 0;var ud=dd;class hd extends Phaser.Scene{constructor(){super("EntryScene")}preload(){gd.getInstance().setCurrentSceneRef(this),this.preloadAssets(),oi(this)}async create(){"staff"!==gd.getInstance().getAccountInfo().role?(await gd.getInstance().loadGameChapters(),await gd.getInstance().loadRoomCode(),await gd.getInstance().getSaveManager().loadLastSaveState(),await this.preloadAwards(),this.applyLoadedSettings(),this.scene.start("MainMenu")):console.log("Staff do not have accounts")}applyLoadedSettings(){const e=gd.getInstance().getSaveManager().getSettings();gd.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){const e=this.cache.text.get(cc.awardsMapping.key),t=ud.parse(e);gd.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map(async e=>await ec(this,e.assetKey,e.assetPath)))}preloadAssets(){gd.getInstance().getSoundManager().loadSoundAssetMap(En),Object.values(Cn).forEach(e=>this.load.image(e.key,On(e.path))),Object.values(an).forEach(e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath)),Object.values(cc).forEach(e=>this.load.text(e.key,e.path))}}var pd=hd;let md;!function(e){e.Simulator="Simulator",e.Game="Game"}(md||(md={}));class gd extends en.Game{constructor(e,t){super(e),this.global=void 0,this.isMounted=void 0,this.getAwardsMapping=()=>Tn(this.global.awardsMapping),this.getAccountInfo=()=>Tn(this.global.accountInfo),this.getSoundManager=()=>Tn(this.global.soundManager),this.getSaveManager=()=>Tn(this.global.saveManager),this.getCurrentSceneRef=()=>Tn(this.global.currentSceneRef),this.isGameType=e=>this.global.gameType===e,this.getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames,this.getIsUsingMock=()=>this.global.isUsingMock,this.getRoomCode=()=>this.global.roomCode,this.getGameChapters=()=>this.global.isUsingMock?cd:this.global.gameChapters,gd.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,setStorySimState:dn.nullFunction,currentSceneRef:void 0,soundManager:new ed,saveManager:new Vl,gameType:t,gameChapters:[],ssChapterSimFilenames:[],isUsingMock:!1,roomCode:""}}stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAwardsMapping(e){this.global.awardsMapping=e}setStorySimStateSetter(e){this.setStorySimState=e}async loadGameChapters(){const e=await od();e.forEach(e=>e.filenames=e.filenames.map(lc)),this.global.gameChapters=e}async loadRoomCode(){this.global.roomCode=await Kc()}setStorySimState(e){this.global.setStorySimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(){this.global.isUsingMock=!this.global.isUsingMock}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}}gd.instance=void 0,gd.getInstance=()=>Tn(gd.instance);const yd={debug:!0,type:en.WEBGL,width:un.x,height:un.y,physics:{default:"arcade"},scale:{mode:en.Scale.FIT,parent:"game-display"},scene:[pd,Hc,Zc,_c,Ul,Bc,Yl,Qc,Zl]};async function Ed(e){const t={method:"PUT",headers:bd(gd.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:{collectibles:e,completed_quests:[]}})},a=await fetch(ze.backendUrl+"/v1/user/game_states/save",t);if(a&&a.ok)return a}function bd(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization","Bearer "+e),t.append("Content-Type","application/json"),t}var vd=function(){const e=Object(C.e)(e=>e.session),[t,a]=v.useState(!1),[s,n]=v.useState(!1);return v.useEffect(()=>(new gd(yd,md.Game),()=>{gd.getInstance().isMounted=!1,gd.getInstance().stopAllSounds()}),[]),v.useEffect(()=>{gd.getInstance().setAccountInfo(e),"Test Student"===e.name&&(a(!0),n(!0),gd.getInstance().toggleUsingMock())},[e]),v.createElement(v.Fragment,null,v.createElement("div",{id:"game-display"}),t&&v.createElement("div",{className:"Horizontal"},v.createElement("button",{onClick:async()=>{await async function(){const e={method:"PUT",headers:bd(gd.getInstance().getAccountInfo().accessToken)},t=await fetch(ze.backendUrl+"/v1/user/game_states/clear",e);t&&t.ok&&alert("Game cleared!")}()}},"Clear data"),v.createElement("button",{onClick:()=>{n(!s),gd.getInstance().toggleUsingMock()}},s?"Use Game Chapters":"Use Mock Chapters")))};class Sd extends v.Component{render(){return v.createElement(Vt.a,{to:"/academy/grading/"+this.props.data.submissionId,activeClassName:Gt.Classes.ACTIVE},sa("",Ut.a.ANNOTATION,()=>this.props.handleAcknowledgeNotifications(Ls(this.props.data.submissionId)),{fullWidth:!0}))}}var fd=Sd;class Cd extends v.Component{render(){if(this.props.data.maxGrade){const e=`Initial Grade: ${this.props.data.initialGrade}\n        (${this.props.data.gradeAdjustment>=0?"+":""}${this.props.data.gradeAdjustment} adj.)`;return v.createElement("div",null,v.createElement(Gt.Tooltip,{content:e,position:Gt.Position.LEFT,hoverOpenDelay:10,lazy:!0},`${this.props.data.currentGrade} / ${this.props.data.maxGrade}`))}return v.createElement("div",null,"N/A")}}var wd=Cd;class Ad extends v.Component{render(){let e,t,a;switch(this.props.data.gradingStatus){case zt.graded:e=Ut.a.TICK,t=`Fully graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,a=Gt.Intent.SUCCESS;break;case zt.grading:e=Ut.a.TIME,t=`Partially graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,a=Gt.Intent.WARNING;break;case zt.none:e=Ut.a.CROSS,t=`Not graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,a=Gt.Intent.DANGER;break;default:e=Ut.a.DISABLE,t="Not applicable",a=Gt.Intent.PRIMARY}return v.createElement("div",null,v.createElement(Gt.Tooltip,{content:t,position:Gt.Position.LEFT,hoverOpenDelay:10,lazy:!0},v.createElement(Gt.Icon,{icon:e,intent:a})))}}var Od=Ad;class Td extends v.Component{constructor(e){super(e),this.handleConfirmUnsubmit=()=>{this.props.handleUnsubmitSubmission(this.props.data.submissionId),this.setState({isAlertOpen:!1})},this.handleUnsubmitAlertClose=()=>this.setState({isAlertOpen:!1}),this.state={isAlertOpen:!1}}render(){return"submitted"!==this.props.data.submissionStatus||this.props.group!==this.props.data.groupName&&this.props.role!==Ot.Admin?null:v.createElement("div",null,v.createElement(Gt.Alert,{canEscapeKeyCancel:!0,canOutsideClickCancel:!0,cancelButtonText:"Cancel",className:"unsubmit-alert alert",intent:Gt.Intent.DANGER,onConfirm:this.handleConfirmUnsubmit,isOpen:this.state.isAlertOpen,onCancel:this.handleUnsubmitAlertClose},"Are you sure you want to unsubmit?"),sa("",Ut.a.ARROW_LEFT,()=>this.setState({isAlertOpen:!0}),{fullWidth:!0}))}}var Id=Td,kd=a(464),Pd=a.n(kd);class xd extends v.Component{constructor(e){super(e),this.validateGradesBeforeSave=e=>()=>{const t=Ba(this.state.gradeAdjustmentInput||void 0)||void 0,a=this.props.initialGrade+(t||0),s=Ba(this.state.xpAdjustmentInput||void 0)||void 0,n=this.props.initialXp+(s||0);a<0||a>this.props.maxGrade?_a(`Grade ${a.toString()} is out of bounds. Maximum grade is ${this.props.maxGrade.toString()}.`):n<0||n>this.props.maxXp?_a(`XP ${n.toString()} is out of bounds. Maximum xp is ${this.props.maxXp.toString()}.`):e(this.props.submissionId,this.props.questionId,t,s,this.state.editorValue)},this.onClickSaveAndContinue=(e,t,a,s,n)=>{this.setState({...this.state,currentlySaving:!0},()=>{this.props.handleGradingSaveAndContinue(e,t,a,s,n)})},this.discardChanges=()=>{this.hasUnsavedChanges()&&!window.confirm("This will reset the editor. Are you sure?")||this.setState({...this.state,gradeAdjustmentInput:this.props.gradeAdjustment.toString(),xpAdjustmentInput:this.props.xpAdjustment.toString(),editorValue:this.props.comments||""},()=>{Ma("Discarded!",1e3)})},this.onGradeAdjustmentInputChange=(e,t)=>{this.setState({...this.state,gradeAdjustmentInput:t,xpAdjustmentInput:String(Math.round(e/this.props.maxGrade*this.props.maxXp)||0)})},this.onXpAdjustmentInputChange=(e,t)=>{this.setState({...this.state,xpAdjustmentInput:t})},this.handleEditorValueChange=e=>{this.setState({...this.state,editorValue:e})},this.hasUnsavedChanges=()=>{const e=Ba(this.state.gradeAdjustmentInput||void 0),t=Ba(this.state.xpAdjustmentInput||void 0);return this.props.gradeAdjustment!==e||this.props.xpAdjustment!==t||this.props.comments!==this.state.editorValue},this.generateMarkdownPreview=e=>Promise.resolve(v.createElement(ma,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),this.state={gradeAdjustmentInput:e.gradeAdjustment.toString(),xpAdjustmentInput:e.xpAdjustment.toString(),editorValue:e.comments,selectedTab:"write",currentlySaving:!1}}render(){const e=this.hasUnsavedChanges(),t={intent:e?Gt.Intent.WARNING:Gt.Intent.NONE,minimal:!e,className:"grading-editor-button"},a={intent:e?Gt.Intent.DANGER:Gt.Intent.NONE,minimal:!e,className:"grading-editor-button"},s={intent:e?Gt.Intent.SUCCESS:Gt.Intent.NONE,minimal:!e,className:"grading-editor-button"},n=this.props.initialGrade+(Ba(this.state.gradeAdjustmentInput||void 0)||0),i=this.props.initialXp+(Ba(this.state.xpAdjustmentInput||void 0)||0),r=`${this.props.initialGrade>0?"-":""}${this.props.initialGrade} to ${this.props.maxGrade-this.props.initialGrade}`,o=`${this.props.initialXp>0?"-":""}${this.props.initialXp} to ${this.props.maxXp-this.props.initialXp}`;return v.createElement("div",{className:"GradingEditor"},!this.state.currentlySaving&&e?v.createElement(w.a,{message:"You have unsaved changes. Are you sure you want to leave?"}):null,v.createElement("div",{className:"grading-editor-header"},v.createElement(Gt.H3,null,"Currently Grading: ",this.props.studentName)),null!==this.props.solution?v.createElement("div",{className:"grading-editor-marking-scheme"},v.createElement(Gt.Pre,null,this.props.solution.toString()," ")):null,v.createElement("div",{className:"grading-editor-container"},v.createElement("div",{className:"grading-editor-grades"},v.createElement("div",{className:"autograder-grade"},v.createElement("div",null,"Autograder grade:"),v.createElement("div",null,`${this.props.initialGrade} / ${this.props.maxGrade}`)),v.createElement("div",{className:"grade-adjustment"},v.createElement("div",null,"Grade adjustment:"),v.createElement("div",null,v.createElement(Gt.NumericInput,{className:"adjustment-input",onValueChange:this.onGradeAdjustmentInputChange,value:this.state.gradeAdjustmentInput||"",buttonPosition:Gt.Position.RIGHT,fill:!0,placeholder:r,intent:n<0||n>this.props.maxGrade?Gt.Intent.DANGER:Gt.Intent.NONE,min:0-this.props.initialGrade,max:this.props.maxGrade>this.props.initialGrade?this.props.maxGrade-this.props.initialGrade:void 0}))),v.createElement("div",{className:"final-grade"},v.createElement("div",null,"Final grade:"),v.createElement("div",null,`${n} / ${this.props.maxGrade}`))),v.createElement("div",{className:"grading-editor-xp"},v.createElement("div",{className:"autograder-grade"},v.createElement("div",null,"Autograder XP:"),v.createElement("div",null,`${this.props.initialXp} / ${this.props.maxXp}`)),v.createElement("div",{className:"grade-adjustment"},v.createElement("div",null,"XP adjustment:"),v.createElement("div",null,v.createElement(Gt.NumericInput,{className:"adjustment-input",onValueChange:this.onXpAdjustmentInputChange,value:this.state.xpAdjustmentInput||"",buttonPosition:Gt.Position.RIGHT,fill:!0,placeholder:o,intent:i<0||i>this.props.maxXp?Gt.Intent.DANGER:Gt.Intent.NONE,min:0-this.props.initialXp,max:this.props.maxXp>this.props.initialXp?this.props.maxXp-this.props.initialXp:void 0}))),v.createElement("div",{className:"final-grade"},v.createElement("div",null,"Final XP:"),v.createElement("div",null,`${i} / ${this.props.maxXp}`)))),v.createElement("div",{className:"react-mde-parent"},v.createElement(Pd.a,{value:this.state.editorValue||"",onChange:this.handleEditorValueChange,selectedTab:this.state.selectedTab,onTabChange:e=>this.setState({...this.state,selectedTab:e}),generateMarkdownPreview:this.generateMarkdownPreview,minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:this.blueprintIconProvider})),"write"===this.state.selectedTab&&v.createElement("div",{className:"grading-editor-draft-buttons"},v.createElement("div",{className:"grading-editor-save-button"},sa("Save Changes",Ut.a.FLOPPY_DISK,this.validateGradesBeforeSave(this.props.handleGradingSave),t)),v.createElement("div",{className:"grading-editor-discard-button"},sa("Discard Changes",Ut.a.TRASH,this.discardChanges,a))),v.createElement("div",{className:"grading-editor-save-continue-button"},sa("Save and Continue",Ut.a.UPDATED,this.validateGradesBeforeSave(this.onClickSaveAndContinue),s)),this.props.graderName&&this.props.gradedAt&&v.createElement(v.Fragment,null,v.createElement(Gt.Divider,null),v.createElement("div",{className:"grading-editor-last-graded-details"},"Last edited by ",v.createElement("b",null,this.props.graderName)," on ",Pa(this.props.gradedAt))))}blueprintIconProvider(e){const t=Rd(e);return v.createElement(Gt.Icon,{icon:t.iconName,htmlTitle:t.title})}}const Rd=e=>{switch(e){case"header":return{iconName:Ut.a.HEADER,title:"Header Styles"};case"bold":return{iconName:Ut.a.BOLD,title:"Bold"};case"italic":return{iconName:Ut.a.ITALIC,title:"Italic"};case"strikethrough":return{iconName:Ut.a.STRIKETHROUGH,title:"Strikethrough"};case"link":return{iconName:Ut.a.LINK,title:"Link"};case"quote":return{iconName:Ut.a.CITATION,title:"Quote"};case"code":return{iconName:Ut.a.CODE,title:"Monospaced"};case"image":return{iconName:Ut.a.MEDIA,title:"Image"};case"unordered-list":return{iconName:Ut.a.UNGROUP_OBJECTS,title:"Bullets"};case"ordered-list":return{iconName:Ut.a.NUMBERED_LIST,title:"Numbering"};case"checked-list":return{iconName:Ut.a.SQUARE,title:"Checkboxes"};default:return{iconName:Ut.a.HELP}}};var Nd=xd;var Md=Object(C.c)(null,e=>Object(A.b)({handleGradingSave:Ie,handleGradingSaveAndContinue:ke},e))(Nd);class _d extends v.Component{constructor(...e){super(...e),this.sideContentProps=(e,t)=>{const a=[{label:"Grading: Question "+(t+1),iconName:Ut.a.TICK,body:v.createElement(Md,{solution:e.grading[t].question.solution,questionId:e.grading[t].question.id,submissionId:e.submissionId,initialGrade:e.grading[t].grade.grade,gradeAdjustment:e.grading[t].grade.gradeAdjustment,maxGrade:e.grading[t].question.maxGrade,initialXp:e.grading[t].grade.xp,xpAdjustment:e.grading[t].grade.xpAdjustment,maxXp:e.grading[t].question.maxXp,studentName:e.grading[t].student.name,comments:e.grading[t].grade.comments,graderName:e.grading[t].grade.grader?e.grading[t].grade.grader.name:void 0,gradedAt:e.grading[t].grade.grader?e.grading[t].grade.gradedAt:void 0}),id:T.grading,toSpawn:()=>!0},{label:"Task "+(t+1),iconName:Ut.a.NINJA,body:v.createElement(ma,{content:e.grading[t].question.content}),id:T.questionOverview,toSpawn:()=>!0},{label:"Autograder",iconName:Ut.a.AIRPLANE,body:v.createElement(wa,{testcases:e.editorTestcases,autogradingResults:e.autogradingResults,handleTestcaseEval:this.props.handleTestcaseEval}),id:T.autograder,toSpawn:()=>!0}];e.grading[t].question.library.external.symbols.includes("get_matrix")&&a.push({label:"Tone Matrix",iconName:Ut.a.GRID_VIEW,body:v.createElement(Oa,null),id:T.toneMatrix,toSpawn:()=>!0});return{handleActiveTabChange:e.handleActiveTabChange,tabs:a,workspaceLocation:"grading"}},this.controlBarProps=e=>{const t="/academy/grading/"+this.props.submissionId,a=[e+1,this.props.grading.length],s=v.createElement(na,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),n=v.createElement(ia,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),i=v.createElement(oa,{onClickNext:()=>Ra.push(t+"/"+(e+1).toString()),onClickReturn:()=>Ra.push("/academy/grading"),questionProgress:a,key:"next_question"}),r=v.createElement(la,{onClick:()=>Ra.push(t+"/"+(e-1).toString()),questionProgress:a,key:"previous_question"}),o=v.createElement(ca,{questionProgress:a,key:"question_view"});return{editorButtons:[v.createElement(ua,{handleEditorEval:this.props.handleEditorEval,key:"run"})],flowButtons:[r,o,i],replButtons:[n,s]}}}componentDidMount(){if(this.props.handleGradingFetch(this.props.submissionId),!this.props.grading)return;let e=this.props.questionId;this.props.questionId>=this.props.grading.length&&(e=this.props.grading.length-1);const t=this.props.grading[e].question;let a="";t.type===Kt.programming&&(a=t.answer?t.answer:t.solutionTemplate||""),this.props.handleEditorValueChange(a)}componentDidUpdate(){if(void 0===this.props.grading)return;const e=this.props.questionId;void 0===this.props.grading[e]?Ra.push("/academy/grading"):this.checkWorkspaceReset(this.props)}render(){if(void 0===this.props.grading)return v.createElement(Gt.NonIdealState,{className:Xt()("WorkspaceParent",Gt.Classes.DARK),description:"Getting assessment ready...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})});const e=this.props.questionId>=this.props.grading.length?this.props.grading.length-1:this.props.questionId,t=this.props.grading[e].question,a={controlBarProps:this.controlBarProps(e),editorProps:t.type===Kt.programming?{editorSessionId:"",editorValue:this.props.editorValue,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,mcqProps:{mcq:t,handleMCQSubmit:e=>{}},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,e),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:Xt()("WorkspaceParent",Gt.Classes.DARK)},v.createElement(Is,a))}checkWorkspaceReset(e){const t=e.submissionId,a=e.questionId;if(e.storedSubmissionId===t&&e.storedQuestionId===a)return;const s=e.grading[a].question;let n=[],i="",r="",o="",l=[];if(s.type===Kt.programming){const e=s;n=e.autogradingResults,r=e.prepend,o=e.postpend,l=e.testcases,i=e.answer,i||(i=e.solutionTemplate)}e.handleEditorUpdateBreakpoints([]),e.handleUpdateCurrentSubmissionId(t,a),e.handleResetWorkspace({autogradingResults:n,editorPrepend:r,editorValue:i,editorPostpend:o,editorTestcases:l}),e.handleClearContext(s.library),e.handleUpdateHasUnsavedChanges(!1),i&&e.handleEditorValueChange(i)}}var Dd=_d;var Ld=Object(C.c)((e,t)=>({autogradingResults:e.workspaces.grading.autogradingResults,editorPrepend:e.workspaces.grading.editorPrepend,editorValue:e.workspaces.grading.editorValue,editorPostpend:e.workspaces.grading.editorPostpend,editorTestcases:e.workspaces.grading.editorTestcases,editorHeight:e.workspaces.grading.editorHeight,editorWidth:e.workspaces.grading.editorWidth,breakpoints:e.workspaces.grading.breakpoints,highlightedLines:e.workspaces.grading.highlightedLines,grading:e.session.gradings.get(t.submissionId),hasUnsavedChanges:e.workspaces.grading.hasUnsavedChanges,isRunning:e.workspaces.grading.isRunning,isDebugging:e.workspaces.grading.isDebugging,enableDebugging:e.workspaces.grading.enableDebugging,newCursorPosition:e.workspaces.grading.newCursorPosition,output:e.workspaces.grading.output,replValue:e.workspaces.grading.replValue,sideContentHeight:e.workspaces.grading.sideContentHeight,storedSubmissionId:e.workspaces.grading.currentSubmission,storedQuestionId:e.workspaces.grading.currentQuestion}),e=>Object(A.b)({handleActiveTabChange:e=>j(e,"grading"),handleBrowseHistoryDown:()=>I("grading"),handleBrowseHistoryUp:()=>k("grading"),handleChapterSelect:(e,t)=>_(e,"default","grading"),handleClearContext:e=>B(e,"grading"),handleDeclarationNavigate:e=>Z("grading",e),handleEditorEval:()=>q("grading"),handleEditorValueChange:e=>z(e,"grading"),handleEditorHeightChange:e=>x(e,"grading"),handleEditorWidthChange:e=>R(e.toString(),"grading"),handleEditorUpdateBreakpoints:e=>Y(e,"grading"),handleGradingFetch:Ee,handleInterruptEval:()=>nt("grading"),handleReplEval:()=>X("grading"),handleReplOutputClear:()=>U("grading"),handleReplValueChange:e=>K(e,"grading"),handleResetWorkspace:e=>te("grading",e),handleSideContentHeightChange:e=>M(e,"grading"),handleTestcaseEval:e=>W("grading",e),handleUpdateCurrentSubmissionId:ie,handleUpdateHasUnsavedChanges:e=>re("grading",e),handleDebuggerPause:()=>rt("grading"),handleDebuggerResume:()=>lt("grading"),handleDebuggerReset:()=>ct("grading"),handlePromptAutocomplete:(e,t,a)=>de("grading",e,t,a)},e))(Dd);class jd extends v.Component{render(){if(this.props.data.maxXp||this.props.data.xpBonus){const e=`Initial XP: ${this.props.data.initialXp}\n        (${this.props.data.xpBonus>0?`+${this.props.data.xpBonus} bonus `:""}\n        ${this.props.data.xpAdjustment>=0?"+":""}${this.props.data.xpAdjustment} adj.)`;return v.createElement("div",null,v.createElement(Gt.Tooltip,{content:e,position:Gt.Position.LEFT,hoverOpenDelay:10,lazy:!0},`${this.props.data.currentXp+this.props.data.xpBonus} / ${this.props.data.maxXp}`))}return v.createElement("div",null,"No Exp")}}var Bd=jd;class Gd extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.GradingStatus=e=>v.createElement(Od,{data:e.data}),this.GradingMarks=e=>v.createElement(wd,{data:e.data}),this.NotificationBadgeCell=e=>v.createElement(Vs,{notificationFilter:Ls(e.data.submissionId)}),this.GradingExp=e=>v.createElement(Bd,{data:e.data}),this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.updatePaginationState=()=>{if(this.gridApi){const e=this.gridApi.paginationGetTotalPages(),t=0===e?0:this.gridApi.paginationGetCurrentPage()+1;this.setState({currPage:t,maxPages:e,rowCountString:this.formatRowCountString(25,t,e,this.gridApi.paginationGetRowCount()),isBackDisabled:0===e||1===t,isForwardDisabled:0===e||t===e})}},this.formatRowCountString=(e,t,a,s)=>0===a?"(none)":t!==a?`(#${e*t-24} - #${e*t})`:`(#${e*t-24} - #${s})`,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t})},this.handleFilterKeypress=e=>{"Enter"===e.key&&this.handleApplyFilter()},this.handleApplyFilter=()=>{this.gridApi&&this.gridApi.setQuickFilter(this.state.filterValue)},this.handleGroupsFilter=()=>{this.gridApi&&(this.setState({groupFilterEnabled:!this.state.groupFilterEnabled}),this.props.handleFetchGradingOverviews(this.state.groupFilterEnabled))},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),this.updatePaginationState()},this.exportCSV=()=>{this.gridApi&&this.gridApi.exportDataAsCsv({fileName:`SA submissions (${(new Date).toISOString()}).csv`,columnKeys:["assessmentName","assessmentCategory","studentName","groupName","submissionStatus","gradingStatus","questionCount","gradedCount","initialGrade","gradeAdjustment","currentGrade","maxGrade","initialXp","xpAdjustment","currentXp","maxXp","xpBonus"]})},this.changePaginationView=e=>()=>{if(this.gridApi)switch(e){case"first":return this.gridApi.paginationGoToFirstPage();case"prev":return this.gridApi.paginationGoToPreviousPage();case"next":return this.gridApi.paginationGoToNextPage();case"last":return this.gridApi.paginationGoToLastPage()}},this.sortSubmissionsByNotifications=()=>this.props.gradingOverviews?this.props.gradingOverviews.map(e=>({...e,notifications:Ls(e.submissionId)(this.props.notifications)})).sort((e,t)=>t.notifications.length-e.notifications.length):[],this.columnDefs=[{headerName:"",field:"notifications",cellRendererFramework:this.NotificationBadgeCell,width:30,suppressMovable:!0,suppressMenu:!0,suppressSizeToFit:!0,resizable:!1},{headerName:"Assessment Name",field:"assessmentName"},{headerName:"Category",field:"assessmentCategory",maxWidth:100},{headerName:"Student Name",field:"studentName"},{headerName:"Group",field:"groupName",maxWidth:100},{headerName:"Status",field:"submissionStatus",maxWidth:100,valueFormatter:e=>{const t=e.value;return t.charAt(0).toUpperCase()+t.slice(1)},cellStyle:e=>"submitted"===e.data.submissionStatus?{backgroundColor:Gt.Colors.GREEN5}:{backgroundColor:Gt.Colors.RED5}},{headerName:"Grading",field:"gradingStatus",cellRendererFramework:this.GradingStatus,maxWidth:110},{headerName:"Grade",field:"",cellRendererFramework:this.GradingMarks,maxWidth:100,cellStyle:e=>e.data.currentGrade<e.data.maxGrade?{backgroundColor:Gt.Colors.RED5}:{},comparator:(e,t,a,s,n)=>a&&s?a.data.currentGrade-s.data.currentGrade:e-t},{headerName:"XP",field:"",cellRendererFramework:this.GradingExp,maxWidth:100,comparator:(e,t,a,s,n)=>a&&s?a.data.currentXp-s.data.currentXp:e-t},{headerName:"Edit",cellRendererFramework:fd,cellRendererParams:{handleAcknowledgeNotifications:this.props.handleAcknowledgeNotifications},width:65,filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0,cellStyle:{padding:0}},{headerName:"Unsubmit",colId:"Unsubmit",width:100,field:"",cellRendererFramework:Id,cellRendererParams:{group:this.props.group,handleUnsubmitSubmission:this.props.handleUnsubmitSubmission,role:this.props.role},filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0,cellStyle:{padding:0}},{headerName:"Question Count",field:"questionCount",hide:!0},{headerName:"Questions Graded",field:"gradedCount",hide:!0},{headerName:"Initial Grade",field:"initialGrade",hide:!0},{headerName:"Grade Adjustment",field:"gradeAdjustment",hide:!0},{headerName:"Initial XP",field:"initialXp",hide:!0},{headerName:"XP Adjustment",field:"xpAdjustment",hide:!0},{headerName:"Current Grade",field:"currentGrade",hide:!0},{headerName:"Max Grade",field:"maxGrade",hide:!0},{headerName:"Current XP (excl. bonus)",field:"currentXp",hide:!0},{headerName:"Max XP",field:"maxXp",hide:!0},{headerName:"Bonus XP",field:"xpBonus",hide:!0}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0},this.state={filterValue:"",groupFilterEnabled:!1,currPage:1,maxPages:1,rowCountString:"(none)",isBackDisabled:!0,isForwardDisabled:!0}}render(){const e=Ba(this.props.match.params.submissionId),t=Ba(this.props.match.params.questionId)||0;if(null!==e){const a={submissionId:e,questionId:t};return v.createElement(Ld,a)}const a=v.createElement(Gt.NonIdealState,{className:"Grading",description:"Fetching submissions...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})}),s=this.sortSubmissionsByNotifications(),n=v.createElement("div",{className:"GradingContainer"},v.createElement("div",null,v.createElement(Gt.FormGroup,{label:"Filter:",labelFor:"text-input",inline:!0},v.createElement(Gt.InputGroup,{id:"filterBar",large:!1,leftIcon:"filter",placeholder:"Enter any text (e.g. mission)",value:this.state.filterValue,onChange:this.handleFilterChange,onKeyPress:this.handleFilterKeypress,onBlur:this.handleApplyFilter})),v.createElement("div",{className:"ag-grid-controls"},v.createElement("div",{className:"left-controls"},v.createElement(Gt.Button,{active:this.state.groupFilterEnabled,icon:Ut.a.GIT_REPO,intent:this.state.groupFilterEnabled?Gt.Intent.PRIMARY:Gt.Intent.NONE,onClick:this.handleGroupsFilter},v.createElement("div",{className:"ag-grid-button-text hidden-xs"},"Show all groups"))),v.createElement("div",{className:"centre-controls"},v.createElement(Gt.Button,{icon:Ut.a.CHEVRON_BACKWARD,onClick:this.changePaginationView("first"),minimal:!0,disabled:this.state.isBackDisabled}),v.createElement(Gt.Button,{icon:Ut.a.CHEVRON_LEFT,onClick:this.changePaginationView("prev"),minimal:!0,disabled:this.state.isBackDisabled}),v.createElement(Gt.Button,{className:"pagination-details hidden-xs",disabled:!0,minimal:!0},v.createElement("div",null,`Page ${this.state.currPage} of ${this.state.maxPages}`),v.createElement("div",null,this.state.rowCountString)),v.createElement(Gt.Button,{icon:Ut.a.CHEVRON_RIGHT,onClick:this.changePaginationView("next"),minimal:!0,disabled:this.state.isForwardDisabled}),v.createElement(Gt.Button,{icon:Ut.a.CHEVRON_FORWARD,onClick:this.changePaginationView("last"),minimal:!0,disabled:this.state.isForwardDisabled})),v.createElement("div",{className:"right-controls"},v.createElement(Gt.Button,{icon:Ut.a.EXPORT,onClick:this.exportCSV},v.createElement("div",{className:"ag-grid-button-text hidden-xs"},"Export to CSV"))))),v.createElement(Gt.Divider,null),v.createElement("div",{className:"Grading"},v.createElement("div",{className:"ag-grid-parent ag-theme-balham"},v.createElement(Ks.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,onPaginationChanged:this.updatePaginationState,rowData:s,rowHeight:30,pagination:!0,paginationPageSize:25,suppressMovableColumns:!0,suppressPaginationPanel:!0}))));return v.createElement("div",null,v.createElement(_s,{loadContentDispatch:this.props.handleFetchGradingOverviews,display:void 0===this.props.gradingOverviews?a:n,fullWidth:!1}))}componentDidUpdate(e,t){this.gridApi&&this.props.notifications.length!==e.notifications.length&&this.gridApi.setRowData(this.sortSubmissionsByNotifications())}}var Ud=Gd;var Vd=Object(C.c)(e=>({gradingOverviews:e.session.gradingOverviews,group:e.session.group,notifications:e.session.notifications,role:e.session.role}),e=>Object(A.b)({handleAcknowledgeNotifications:Le,handleFetchGradingOverviews:be,handleUnsubmitSubmission:_e},e))(Ud);class Hd extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handleDeleteAssessment(e.id),this.handleCloseDialog()},this.state={dialogOpen:!1}}render(){return v.createElement("div",null,sa("",Ut.a.TRASH,this.handleOpenDialog),v.createElement(Gt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Delete Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure that you want to delete this Assessment?"),v.createElement("p",null,"Students' answers and submissions will be deleted as well.")),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER_ACTIONS},sa("Confirm Delete",Ut.a.TRASH,this.handleDelete),sa("Cancel",Ut.a.CROSS,this.handleCloseDialog)))))}}var Fd=Hd,qd=a(864);const Xd={flex:1,display:"flex",height:"30vh",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderWidth:2,borderRadius:2,borderColor:"#eeeeee",borderStyle:"dashed",backgroundColor:"#fafafa",color:"#bdbdbd",outline:"none",transition:"border .24s ease-in-out"},Wd={borderColor:"#2196f3"},zd={borderColor:"#00e676"},Yd={borderColor:"#ff1744"};var $d=e=>{const[t,a]=v.useState(),[s,n]=v.useState(),{getRootProps:i,getInputProps:r,isDragActive:o,isDragAccept:l,isDragReject:c,isFocused:d}=Object(qd.a)({onDrop:e=>{a(e[0]),n(e[0].name)}}),u=v.useMemo(()=>({...Xd,...o?Wd:{},...l?zd:{},...c?Yd:{},...d?Wd:{}}),[o,l,c,d]),h=()=>{e.forceUpdate||e.toggleDisplayConfirmation(),e.toggleForceUpdate()},p=()=>{e.toggleDisplayConfirmation()},m=()=>{e.toggleDisplayConfirmation(),e.toggleForceUpdate()};return v.createElement(v.Fragment,null,v.createElement(Gt.Card,{className:"contentdisplay-content",elevation:Gt.Elevation.THREE},v.createElement("div",i({style:u}),v.createElement("input",r()),v.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))),t&&v.createElement(Gt.Card,null,v.createElement("div",null,s),v.createElement("br",null),!e.displayConfirmation&&sa("Confirm Upload",Ut.a.UPLOAD,()=>{e.handleUploadAssessment(t),a(void 0)}),!e.displayConfirmation&&sa("Cancel Upload",Ut.a.DELETE,()=>a(void 0)),v.createElement("br",null),v.createElement("br",null),!e.displayConfirmation&&v.createElement("p",null,"Force update opened assessment"),e.displayConfirmation&&v.createElement("div",null,v.createElement("p",null,"Are you sure that you want to force update the assessment?"),sa("Yes",Ut.a.CONFIRM,p),sa("No",Ut.a.CROSS,m)),!e.displayConfirmation&&v.createElement("div",{className:"toggle-button-wrapper"},v.createElement(Gt.Switch,{checked:e.forceUpdate,onChange:h}))))},Kd=a(2438);class Qd extends v.Component{constructor(e){super(e),this.maxDate=new Date(new Date(Date.now()).setFullYear(2100)),this.dateInput=()=>v.createElement(Kd.a,{formatDate:this.formatDate,onChange:this.handleDateChange,parseDate:this.parseDate,value:this.props.forOpenDate?this.state.openAt:this.state.closeAt,timePrecision:"minute",fill:!0,maxDate:this.maxDate,closeOnSelection:!1}),this.parseDate=e=>new Date(e),this.formatDate=e=>e.toLocaleString(),this.handleDateChange=e=>{this.props.forOpenDate?this.setState({openAt:e}):this.setState({closeAt:e})},this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleUpdate=()=>{const{data:e}=this.props;this.props.handleAssessmentChangeDate(e.id,this.state.openAt.toISOString(),this.state.closeAt.toISOString()),this.handleCloseDialog()},this.state={dialogOpen:!1,openAt:new Date(Date.parse(this.props.data.openAt)),closeAt:new Date(Date.parse(this.props.data.closeAt))}}render(){const e=this.props.forOpenDate?"Opening":"Closing";return v.createElement("div",null,this.props.forOpenDate?this.props.data.prettyOpenAt:this.props.data.prettyCloseAt,sa("",Ut.a.EDIT,this.handleOpenDialog),v.createElement(Gt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Update Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},e," Date: ",this.dateInput()),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER_ACTIONS},sa("Confirm Update",Ut.a.TICK,this.handleUpdate),sa("Cancel",Ut.a.CROSS,this.handleCloseDialog)))))}}var Jd=Qd;class Zd extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handlePublishAssessment(!e.isPublished,e.id),this.handleCloseDialog()},this.state={dialogOpen:!1,isPublished:void 0!==this.props.data.isPublished&&this.props.data.isPublished}}render(){const e=this.props.data.isPublished?"Unpublish":"Publish",t=e.toLowerCase();return v.createElement("div",null,(()=>v.createElement("div",{className:"toggle-button-wrapper"},v.createElement(Gt.Switch,{checked:this.state.isPublished,onChange:this.handleOpenDialog})))(),v.createElement(Gt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:e+" Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure that you want to ",t," this Assessment?")),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER_ACTIONS},sa("Confirm "+e,Ut.a.CONFIRM,this.handleDelete),sa("Cancel",Ut.a.CROSS,this.handleCloseDialog)))))}}var eu=Zd;class tu extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.sortByCategoryAndDate=()=>{if(!this.props.assessmentOverviews)return[];const e=this.props.assessmentOverviews.slice().map(e=>{const t=JSON.parse(JSON.stringify(e));return t.prettyCloseAt=Pa(t.closeAt),t.prettyOpenAt=Pa(t.openAt),t.formattedOpenAt=new Date(Date.parse(t.openAt)),t.formattedCloseAt=new Date(Date.parse(t.closeAt)),t});return Object(Qe.sortBy)(e,["category","formattedOpenAt","formattedCloseAt"])},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit()},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.handleUploadAssessment=e=>{this.props.handleUploadAssessment(e,this.state.forceUpdate),this.setState({forceUpdate:!1})},this.toggleForceUpdate=()=>{this.setState({forceUpdate:!this.state.forceUpdate})},this.toggleDisplayConfirmation=()=>{this.setState({displayConfirmation:!this.state.displayConfirmation})},this.state={forceUpdate:!1,displayConfirmation:!1},this.columnDefs=[{headerName:"Title",field:"title"},{headerName:"Category",field:"category",width:100},{headerName:"Open Date",field:"",cellRendererFramework:Jd,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!0},width:150,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0}},{headerName:"Close Date",field:"",cellRendererFramework:Jd,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!1},width:150,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0}},{headerName:"Publish",field:"",cellRendererFramework:eu,cellRendererParams:{handlePublishAssessment:this.props.handlePublishAssessment},width:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0},hide:!this.props.handlePublishAssessment},{headerName:"Delete",field:"",cellRendererFramework:Fd,cellRendererParams:{handleDeleteAssessment:this.props.handleDeleteAssessment},width:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0},hide:!this.props.handleDeleteAssessment}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidUpdate(e){this.gridApi&&this.props.assessmentOverviews.length!==e.assessmentOverviews.length&&this.gridApi.setRowData(this.sortByCategoryAndDate())}render(){const e=this.sortByCategoryAndDate(),t=()=>v.createElement("div",{className:"GradingContainer"},v.createElement("div",{className:"Grading ag-grid-parent ag-theme-balham"},v.createElement(Ks.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,rowData:e,rowHeight:30,pagination:!0,paginationPageSize:25,suppressMovableColumns:!0,suppressPaginationPanel:!0}))),a=v.createElement("div",{className:"GroundControl"},v.createElement($d,{handleUploadAssessment:this.handleUploadAssessment,toggleForceUpdate:this.toggleForceUpdate,toggleDisplayConfirmation:this.toggleDisplayConfirmation,forceUpdate:this.state.forceUpdate,displayConfirmation:this.state.displayConfirmation}),v.createElement(t,null));return v.createElement("div",null,v.createElement(_s,{display:a,loadContentDispatch:this.props.handleAssessmentOverviewFetch}))}}var au=tu;var su=Object(C.c)(e=>({assessmentOverviews:e.session.assessmentOverviews?e.session.assessmentOverviews:[]}),e=>Object(A.b)({handleAssessmentChangeDate:Li,handleAssessmentOverviewFetch:ye,handleDeleteAssessment:ji,handleUploadAssessment:Gi,handlePublishAssessment:Bi},e))(au);function nu(e){const t=v.createElement("div",{className:"Switch"},v.createElement(Gt.Switch,{label:"",checked:e.isEditorAutorun,onChange:e.handleToggleEditorAutorun})),a=sa("Auto",Ut.a.AUTOMATIC_UPDATES),s=sa("Stop",Ut.a.STOP,e.handleInterruptEval),n=sa("Stop Debugger",Ut.a.STOP,e.handleDebuggerReset),i=sa("Pause",Ut.a.STOP,e.handleDebuggerPause),r=sa("Resume",Ut.a.CHEVRON_RIGHT,e.handleDebuggerResume);return v.createElement(v.Fragment,null,t,e.isEditorAutorun?a:e.isRunning?s:e.isDebugging?null:v.createElement(ua,{handleEditorEval:e.handleEditorEval,key:"run"}),e.isRunning&&!e.isDebugging?i:!e.isRunning&&e.isDebugging?r:null,e.isDebugging?n:null)}function iu(e){const t=Array.from(wt.entries()).map((e,t)=>({name:e[0],key:t,symbols:e[1]})),a=ea.a.ofType(),s=(e,{handleClick:t,modifiers:a,query:s})=>v.createElement(Gt.MenuItem,{active:!1,key:e.key,onClick:t,text:e.name});return n=e.externalLibraryName,i=e.handleExternalSelect,v.createElement(a,{className:Gt.Classes.MINIMAL,items:t,onItemSelect:i,itemRenderer:s,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:n,rightIcon:Ut.a.DOUBLE_CARET_VERTICAL}));var n,i}class ru extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.EnvVisualizer;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:Xt()("sa-env-visualizer",Gt.Classes.DARK)},v.createElement("p",{id:"env-visualizer-default-text",className:Gt.Classes.RUNNING_TEXT},"The environmental visualizer generates the environmental model diagram based on breakpoints set in the editor.",v.createElement("br",null),v.createElement("br",null),"It is activated by clicking on the gutter of the editor (where all the line numbers are, on the left) to set a breakpoint, and then running the program.",v.createElement("br",null),v.createElement("br",null),"The environment model diagram follows a notation introduced in"," ",v.createElement("a",{href:We.sourceDocsChapter3_2,rel:"noopener noreferrer",target:"_blank"},v.createElement("i",null,"Structure and Interpretation of Computer Programs, JavaScript Adaptation, Chapter 3, Section 2")),"."),this.state.loading&&v.createElement(Gt.NonIdealState,{description:"Loading Env Visualizer...",icon:v.createElement(Gt.Spinner,null)}))}}var ou=ru;class lu extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.Inspector;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:"sa-inspector"},v.createElement("p",{id:"inspector-default-text",className:Gt.Classes.RUNNING_TEXT},"The inspector generates a list of variable bindings based on breakpoints set in the editor.",v.createElement("br",null),v.createElement("br",null),"It is activated by clicking on the gutter of the editor (where all the line numbers are, on the left) to set a breakpoint, and then running the program. Only the first line of a statement can have a breakpoint. The program halts just before the statement is evaluated."),this.state.loading&&v.createElement(Gt.NonIdealState,{description:"Loading Inspector...",icon:v.createElement(Gt.Spinner,null)}))}}var cu=lu;class du extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.ListVisualizer;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:Xt()("sa-list-visualizer",Gt.Classes.DARK)},v.createElement("p",{id:"data-visualizer-default-text",className:Gt.Classes.RUNNING_TEXT},"The data visualizer visualises data structures.",v.createElement("br",null),v.createElement("br",null),"It is activated by calling the function ",v.createElement("code",null,"draw_data(the_data)"),", where",v.createElement("code",null,"the_data")," would be the data structure that you want to visualise.",v.createElement("br",null),v.createElement("br",null),"The data visualizer uses box-and-pointer diagrams, as introduced in"," ",v.createElement("a",{href:We.sourceDocsChapter2_2,rel:"noopener noreferrer",target:"_blank"},v.createElement("i",null,"Structure and Interpretation of Computer Programs, JavaScript Adaptation, Chapter 2, Section 2")),"."),this.state.loading&&v.createElement(Gt.NonIdealState,{description:"Loading Data Visualizer...",icon:v.createElement(Gt.Spinner,null)}))}}var uu=du;class hu extends v.PureComponent{constructor(e){super(e),this.audio=void 0,this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},()=>this.applyPlaybackDataFromStart(e))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise(t=>setTimeout(t,e)),a=this.state.currentDeltaRevision;let s=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter(e=>e.time<=s&&"codeDelta"===e.type).map(e=>e.data);this.applyDeltas(n);const i=e.inputs.filter(e=>e.time>s),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===a;)s=1e3*this.audio.current.currentTime,i[o].time<s?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetEditorReadonly(!1),this.props.handleSetSourcecastStatus(Ge.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetEditorReadonly(!0),this.props.handleSetSourcecastStatus(Ge.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handlePlayerStopping=()=>{this.props.handleSetEditorReadonly(!1),this.props.handleSetSourcecastStatus(Ge.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration})},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,a=Math.floor(t/60),s=Math.floor(t-60*a);return(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)}return"00:00"},this.audio=v.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=sa("Play",Ut.a.PLAY,this.handlePlayerPlaying,{},!this.props.duration),t=sa("Pause",Ut.a.PAUSE,this.handlePlayerPausing);return v.createElement("div",{className:"Bar"},v.createElement("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),v.createElement("br",null),v.createElement("div",null,v.createElement("div",{className:"PlayerControl"},v.createElement("div",{className:"PlayerControl"},this.props.playbackStatus===Ge.paused&&e,this.props.playbackStatus===Ge.playing&&t)),v.createElement("div",{className:"Slider"},v.createElement(Gt.Slider,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel}))),v.createElement("br",null))}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}var pu=hu;a(1995);class mu extends v.PureComponent{constructor(e){super(e),this.ShareAce=void 0,this.AceEditor=void 0,this.onChangeMethod=void 0,this.onCursorChange=void 0,this.onSelectionChange=void 0,this.getMarkers=()=>{const e=[];for(const t of this.props.highlightedLines)e.push({startRow:t[0],startCol:0,endRow:t[1],endCol:1,className:"myMarker",type:"fullLine"});return e},this.handleGutterClick=e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const a=e.getDocumentPosition().row,s=e.editor.session.getLine(a);void 0!==e.editor.session.getBreakpoints(a,0)[a]||0===s.length||s.includes("//")||s.includes("debugger;")?e.editor.session.clearBreakpoint(a):e.editor.session.setBreakpoint(a),e.stop(),this.props.handleEditorUpdateBreakpoints(e.editor.session.$breakpoints)},this.handleAnnotationChange=e=>()=>{const t=e.getAnnotations();let a=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",a++);0!==a&&e.setAnnotations(t)},this.handleEvaluate=()=>{this.props.handleEditorEval(),this.props.isRecording&&this.props.handleRecordInput({type:"keyboardCommand",time:this.props.getTimerDuration(),data:Be.run})},this.moveCursor=e=>{this.AceEditor.current.editor.selection.clearSelection(),this.AceEditor.current.editor.moveCursorToPosition(e),this.AceEditor.current.editor.renderer.showCursor(),this.AceEditor.current.editor.renderer.scrollCursorIntoView(e,.5)},this.handleDeclarationNavigate=()=>{this.props.handleDeclarationNavigate(this.AceEditor.current.editor.getCursorPosition())},this.AceEditor=v.createRef(),this.ShareAce=null,this.onChangeMethod=(e,t)=>{this.props.handleUpdateHasUnsavedChanges&&this.props.handleUpdateHasUnsavedChanges(!0),this.props.handleEditorValueChange(e),this.props.isRecording&&this.props.handleRecordInput({type:"codeDelta",time:this.props.getTimerDuration(),data:t});const a=this.AceEditor.current.editor.getSession().getAnnotations();this.props.isEditorAutorun&&0===a.length&&this.props.handleEditorEval()},this.onCursorChange=e=>{if(!this.props.isRecording)return;const t=e.getCursor();this.props.handleRecordInput({type:"cursorPositionChange",time:this.props.getTimerDuration(),data:t})},this.onSelectionChange=e=>{if(!this.props.isRecording)return;const t=e.getRange(),a=e.isBackwards();Object(Qe.isEqual)(t.start,t.end)||this.props.handleRecordInput({type:"selectionRangeData",time:this.props.getTimerDuration(),data:{range:t,isBackwards:a}})}}componentDidUpdate(e){const{codeDeltasToApply:t,inputToApply:a,newCursorPosition:s}=this.props;if(t&&t!==e.codeDeltasToApply&&(this.AceEditor.current.editor.session.getDocument().applyDeltas(t),this.AceEditor.current.editor.selection.clearSelection()),s&&s!==e.newCursorPosition&&this.moveCursor(s),a&&a!==e.inputToApply)switch(a.type){case"codeDelta":this.AceEditor.current.editor.session.getDocument().applyDelta(a.data),this.AceEditor.current.editor.selection.clearSelection();break;case"cursorPositionChange":this.moveCursor(a.data);break;case"selectionRangeData":const{range:e,isBackwards:t}=a.data;this.AceEditor.current.editor.selection.setRange(e,t);break;case"keyboardCommand":switch(a.data){case"run":this.props.handleEditorEval()}}}getBreakpoints(){return this.AceEditor.current.editor.session.getBreakpoints().filter(e=>null!=e)}componentDidMount(){if(!this.AceEditor||!this.AceEditor.current||!this.AceEditor.current.editor)return;const e=this.AceEditor.current.editor,t=e.getSession();e.on("gutterclick",this.handleGutterClick),t.on("changeAnnotation",this.handleAnnotationChange(t))}componentWillUnmount(){null!==this.ShareAce&&this.ShareAce.WS.close(),this.ShareAce=null}render(){return v.createElement(Xa.HotKeys,{className:"Editor",handlers:gu},v.createElement("div",{className:"row editor-react-ace"},v.createElement(qa.a,{className:"react-ace",commands:[{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.handleEvaluate},{name:"navigate",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:this.handleDeclarationNavigate}],editorProps:{$blockScrolling:1/0},ref:this.AceEditor,markers:this.getMarkers(),fontSize:17,height:"100%",highlightActiveLine:!1,mode:"javascript",onChange:this.onChangeMethod,onCursorChange:this.onCursorChange,onSelectionChange:this.onSelectionChange,readOnly:!!this.props.editorReadonly&&this.props.editorReadonly,theme:"source",value:this.props.editorValue,width:"100%",setOptions:{fontFamily:"'Inconsolata', monospace"}})))}}const gu={goGreen:()=>{}};var yu=mu;class Eu extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handleDeleteSourcecastEntry(e.id)},this.state={dialogOpen:!1}}render(){return v.createElement("div",null,sa("",Ut.a.TRASH,this.handleOpenDialog),v.createElement(Gt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Delete Sourcecast",canOutsideClickClose:!0},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure to delete this sourcecast entry?")),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER_ACTIONS},sa("Confirm Delete",Ut.a.TRASH,this.handleDelete),sa("Cancel",Ut.a.CROSS,this.handleCloseDialog)))))}}var bu=Eu;class vu extends v.Component{constructor(e){super(e),this.handleSelect=()=>{const{data:e}=this.props,t=e.url,a=JSON.parse(e.playbackData);this.props.handleSetSourcecastData(e.title,e.description,t,a)}}render(){return v.createElement("div",null,sa(""+this.props.data.title,Ut.a.PLAY,this.handleSelect))}}var Su=vu;class fu extends v.Component{constructor(e){super(e),this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRendererFramework:Su,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},width:400,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",width:200,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",width:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>{return t=e.data.inserted_at,Ia()(t).format("MMMM Do YYYY");var t},maxWidth:200,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRendererFramework:bu,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},width:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidMount(){this.props.handleFetchSourcecastIndex()}render(){const e=v.createElement(Gt.NonIdealState,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})}),t=Object(Qe.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),a=v.createElement("div",{className:"SourcecastContainer"},v.createElement("br",null),v.createElement("div",null,v.createElement(Gt.FormGroup,{label:"",labelFor:"text-input"},v.createElement(Gt.InputGroup,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange}))),v.createElement(Gt.Divider,null),v.createElement("div",{className:"SourcecastTable"},v.createElement("div",{className:"ag-grid-parent"},v.createElement(Ks.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50}))),v.createElement("br",null));return v.createElement("div",null,void 0===this.props.sourcecastIndex?e:a)}}var Cu=fu,wu=a(473),Au=a.n(wu);class Ou extends v.PureComponent{constructor(e){super(e),this.recorder=void 0,this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter(e=>e.time<=1e3*this.props.currentPlayerTime);this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:a}=this.props;clearInterval(this.state.updater),e(!0),a(),this.recorder.pause();t("","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new Au.a;const{handleRecordInit:e,handleSetEditorReadonly:t,handleTimerStart:a}=this.props;this.recorder.start().then(()=>{e(),t(!1),a();const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s})},e=>{alert("Microphone not found: "+e)})},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetEditorReadonly:t,handleTimerResume:a}=this.props;this.handleTruncatePlaybackData(),t(!1),a(1e3*e);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),a=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.state={duration:0,updater:void 0,saveTitle:"Title",saveDescription:"Description"}}async componentDidMount(){Au.a.getPermission().then(()=>{},e=>{alert("Microphone not found: "+e)})}render(){const e=sa("Pause",Ut.a.PAUSE,this.handleRecorderPausing),t=sa("Resume",Ut.a.PLAY,this.handleRecorderResuming),a=sa("Resume Here",Ut.a.PLAY,this.handleRecorderResumingFromCurrent),s=sa("Record",Ut.a.PLAY,this.handleRecorderStarting),n=sa("Stop",Ut.a.STOP,this.handleRecorderStopping),i=sa("Reset",Ut.a.REFRESH,this.handleRecorderResetting),r=v.createElement(Gt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},sa("Save",Ut.a.FLOPPY_DISK),v.createElement("ul",{className:"Sourcereel-save-form"},v.createElement("li",{className:"form-row"},v.createElement("label",{htmlFor:"title"},"Title: "),v.createElement("input",{id:"title",value:this.state.saveTitle,onChange:this.handleSaveTitleInputChange})),v.createElement("li",{className:"form-row"},v.createElement("label",{htmlFor:"description"},"Description: "),v.createElement("input",{id:"description",value:this.state.saveDescription,onChange:this.handleSaveDescriptionInputChange})),v.createElement("li",null,sa("Submit",Ut.a.TICK,this.handleRecorderSaving))));return v.createElement("div",null,v.createElement("br",null),v.createElement("div",{className:"Timer"},v.createElement(Gt.Card,{elevation:2,style:{background:"#24323F"}},v.createElement(Gt.H1,null,this.renderLabel(this.props.recordingStatus!==Ue.paused?this.state.duration/1e3:this.props.currentPlayerTime)))),v.createElement("br",null),v.createElement("div",{className:"RecorderControl"},this.props.recordingStatus===Ue.notStarted&&s,this.props.recordingStatus===Ue.paused&&t,this.props.recordingStatus===Ue.paused&&a,this.props.recordingStatus===Ue.recording&&e,this.props.recordingStatus===Ue.paused&&n,this.props.recordingStatus===Ue.finished&&r,this.props.recordingStatus!==Ue.notStarted&&i),v.createElement("br",null))}}var Tu=Ou;class Iu extends v.Component{constructor(...e){super(...e),this.getTimerDuration=()=>this.props.timeElapsedBeforePause+Date.now()-this.props.timeResumed,this.handleRecordInit=()=>this.props.handleRecordInit({chapter:this.props.sourceChapter,externalLibrary:this.props.externalLibraryName,editorValue:this.props.editorValue})}componentDidUpdate(e){const{inputToApply:t}=this.props;if(t&&t!==e.inputToApply)switch(t.type){case"activeTabChange":this.props.handleActiveTabChange(t.data);break;case"chapterSelect":this.props.handleChapterSelect(t.data);break;case"externalLibrarySelect":this.props.handleExternalSelect(t.data)}}render(){const e=v.createElement(nu,{handleDebuggerPause:this.props.handleDebuggerPause,handleDebuggerReset:this.props.handleDebuggerReset,handleDebuggerResume:this.props.handleDebuggerResume,handleEditorEval:()=>{this.props.handleEditorEval(),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"keyboardCommand",data:Be.run})},handleInterruptEval:this.props.handleInterruptEval,handleToggleEditorAutorun:this.props.handleToggleEditorAutorun,isDebugging:this.props.isDebugging,isEditorAutorun:this.props.isEditorAutorun,isRunning:this.props.isRunning,key:"autorun"}),t=v.createElement(ta,{handleChapterSelect:({chapter:e},t)=>{this.props.handleChapterSelect(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"chapterSelect",data:e})},sourceChapter:this.props.sourceChapter,sourceVariant:this.props.sourceVariant,key:"chapter"}),a=v.createElement(na,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),s=v.createElement(ia,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),n=v.createElement(iu,{externalLibraryName:this.props.externalLibraryName,handleExternalSelect:({name:e},t)=>{this.props.handleExternalSelect(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"externalLibrarySelect",data:e})},key:"external_library"}),i={codeDeltasToApply:this.props.codeDeltasToApply,editorReadonly:this.props.editorReadonly,editorValue:this.props.editorValue,editorSessionId:"",getTimerDuration:this.getTimerDuration,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,isEditorAutorun:this.props.isEditorAutorun,inputToApply:this.props.inputToApply,isPlaying:this.props.playbackStatus===Ge.playing,isRecording:this.props.recordingStatus===Ue.recording,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handleRecordInput:this.props.handleRecordInput},r={controlBarProps:{editorButtons:[e,t,n],replButtons:[s,a]},customEditor:v.createElement(yu,i),editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,replProps:{output:this.props.output,replValue:this.props.replValue,handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange},sideContentHeight:this.props.sideContentHeight,sideContentProps:{handleActiveTabChange:e=>{this.props.handleActiveTabChange(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"activeTabChange",data:e})},selectedTabId:this.props.sideContentActiveTab,tabs:[{label:"Recording Panel",iconName:Ut.a.COMPASS,body:v.createElement("div",null,v.createElement("span",{className:"Multi-line"},v.createElement(Gt.Pre,null," ",ku," ")),v.createElement(Tu,{currentPlayerTime:this.props.currentPlayerTime,editorValue:this.props.editorValue,getTimerDuration:this.getTimerDuration,playbackData:this.props.playbackData,handleRecordInit:this.handleRecordInit,handleResetInputs:this.props.handleResetInputs,handleSaveSourcecastData:this.props.handleSaveSourcecastData,handleSetSourcecastData:this.props.handleSetSourcecastData,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleTimerPause:this.props.handleTimerPause,handleTimerReset:this.props.handleTimerReset,handleTimerResume:this.props.handleTimerResume,handleTimerStart:this.props.handleTimerStart,handleTimerStop:this.props.handleTimerStop,recordingStatus:this.props.recordingStatus})),id:T.sourcereel,toSpawn:()=>!0},{label:"Sourcecast Table",iconName:Ut.a.EDIT,body:v.createElement("div",null,v.createElement(Cu,{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry,handleFetchSourcecastIndex:this.props.handleFetchSourcecastIndex,sourcecastIndex:this.props.sourcecastIndex})),id:T.introduction,toSpawn:()=>!0},Pu,xu,Ru],workspaceLocation:"sourcereel"}},o={handleEditorValueChange:this.props.handleEditorValueChange,handlePromptAutocomplete:this.props.handlePromptAutocomplete,handleSetCurrentPlayerTime:this.props.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:this.props.handleSetCodeDeltasToApply,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleSetInputToApply:this.props.handleSetInputToApply,handleSetSourcecastDuration:this.props.handleSetSourcecastDuration,handleSetSourcecastStatus:this.props.handleSetSourcecastStatus,audioUrl:this.props.audioUrl,currentPlayerTime:this.props.currentPlayerTime,duration:this.props.playbackDuration,playbackData:this.props.playbackData,playbackStatus:this.props.playbackStatus,handleChapterSelect:this.props.handleChapterSelect,handleExternalSelect:this.props.handleExternalSelect};return v.createElement("div",{className:Xt()("Sourcereel",Gt.Classes.DARK)},this.props.recordingStatus===Ue.paused?v.createElement(pu,o):void 0,v.createElement(Is,r))}}const ku="Welcome to Sourcereel!",Pu={label:"Data Visualizer",iconName:Ut.a.EYE_OPEN,body:v.createElement(uu,null),id:T.dataVisualiser,toSpawn:()=>!0},xu={label:"Inspector",iconName:Ut.a.SEARCH,body:v.createElement(cu,null),id:T.inspector,toSpawn:()=>!0},Ru={label:"Env Visualizer",iconName:Ut.a.GLOBE,body:v.createElement(ou,null),id:T.envVisualiser,toSpawn:()=>!0};var Nu=Iu;var Mu=Object(C.c)(e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,breakpoints:e.workspaces.sourcereel.breakpoints,editorReadonly:e.workspaces.sourcereel.editorReadonly,editorValue:e.workspaces.sourcereel.editorValue,editorWidth:e.workspaces.sourcereel.editorWidth,enableDebugging:e.workspaces.sourcereel.enableDebugging,externalLibraryName:e.workspaces.sourcereel.externalLibrary,highlightedLines:e.workspaces.sourcereel.highlightedLines,inputToApply:e.workspaces.sourcecast.inputToApply,isDebugging:e.workspaces.sourcereel.isDebugging,isEditorAutorun:e.workspaces.sourcereel.isEditorAutorun,isRunning:e.workspaces.sourcereel.isRunning,newCursorPosition:e.workspaces.sourcereel.newCursorPosition,output:e.workspaces.sourcereel.output,playbackData:e.workspaces.sourcereel.playbackData,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackStatus:e.workspaces.sourcecast.playbackStatus,recordingStatus:e.workspaces.sourcereel.recordingStatus,replValue:e.workspaces.sourcereel.replValue,sideContentHeight:e.workspaces.sourcereel.sideContentHeight,sideContentActiveTab:e.workspaces.sourcereel.sideContentActiveTab,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:e.workspaces.sourcereel.context.chapter,sourceVariant:e.workspaces.sourcereel.context.variant,timeElapsedBeforePause:e.workspaces.sourcereel.timeElapsedBeforePause,timeResumed:e.workspaces.sourcereel.timeResumed}),e=>Object(A.b)({handleActiveTabChange:e=>j(e,"sourcereel"),handleBrowseHistoryDown:()=>I("sourcereel"),handleBrowseHistoryUp:()=>k("sourcereel"),handleChapterSelect:e=>_(e,"default","sourcereel"),handleDeclarationNavigate:e=>Z("sourcereel",e),handleDeleteSourcecastEntry:e=>ir(e,"sourcecast"),handleEditorEval:()=>q("sourcereel"),handleEditorValueChange:e=>z(e,"sourcereel"),handleEditorHeightChange:e=>x(e,"sourcereel"),handleEditorWidthChange:e=>R(e.toString(),"sourcereel"),handleEditorUpdateBreakpoints:e=>Y(e,"sourcereel"),handleExternalSelect:e=>D(e,"sourcereel"),handleFetchSourcecastIndex:()=>Ki("sourcecast"),handleInterruptEval:()=>nt("sourcereel"),handleRecordInput:e=>or(e,"sourcereel"),handleReplEval:()=>X("sourcereel"),handleReplOutputClear:()=>U("sourcereel"),handleReplValueChange:e=>K(e,"sourcereel"),handleSaveSourcecastData:(e,t,a,s)=>Ji(e,t,a,s,"sourcecast"),handleSetCurrentPlayerTime:e=>Zi(e,"sourcecast"),handleSetCodeDeltasToApply:e=>er(e,"sourcecast"),handleSetInputToApply:e=>tr(e,"sourcecast"),handleSetSourcecastData:(e,t,a,s)=>ar(e,t,a,s,"sourcecast"),handleSetSourcecastDuration:e=>sr(e,"sourcecast"),handleSetSourcecastStatus:e=>nr(e,"sourcecast"),handleSetEditorReadonly:e=>se("sourcereel",e),handleResetInputs:e=>lr(e,"sourcereel"),handleRecordInit:e=>rr(e,"sourcereel"),handleSideContentHeightChange:e=>M(e,"sourcereel"),handleTimerPause:()=>cr("sourcereel"),handleTimerReset:()=>dr("sourcereel"),handleTimerResume:e=>ur(e,"sourcereel"),handleTimerStart:()=>hr("sourcereel"),handleTimerStop:()=>pr("sourcereel"),handleToggleEditorAutorun:()=>L("sourcereel"),handleDebuggerPause:()=>rt("sourcereel"),handleDebuggerResume:()=>lt("sourcereel"),handleDebuggerReset:()=>ct("sourcereel"),handlePromptAutocomplete:(e,t,a)=>de("sourcereel",e,t,a)},e))(Nu);let _u;!function(e){e.Default="Default",e.ObjectPlacement="ObjectPlacement",e.AssetUploader="AssetUploader",e.CheckpointSim="CheckpointSim",e.ChapterSim="ChapterSim"}(_u||(_u={}));var Du=()=>{const[e,t]=S.a.useState(),[a,s]=S.a.useState(nd[0]),[n,i]=S.a.useState(),[r,o]=S.a.useState(!1);function l(e){e.target.innerText&&(s(e.target.innerText),o(!1))}return S.a.createElement("div",{className:"LeftAlign"},S.a.createElement("h4",null,"Choose Folder"),S.a.createElement(Gt.Popover,{position:Gt.Position.BOTTOM},S.a.createElement(Gt.Button,{text:a}),S.a.createElement(Gt.Menu,null,nd.map(e=>S.a.createElement(Gt.MenuItem,{onClick:l,id:e,key:e,text:e})),S.a.createElement(Gt.MenuItem,{onClick:function(e){e.target.innerText&&(s(e.target.innerText),o(!0))},id:"Specify own folder...",key:"Specify own folder...",text:"Specify own folder..."}))),r&&S.a.createElement(Gt.InputGroup,{placeholder:"Or specify your own, e.g. 'locations/hallway'",onChange:function(e){i(e.target.value)}}),S.a.createElement("br",null),S.a.createElement("h4",null,"Choose File"),S.a.createElement("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const a=e.target.files;t(a)}}),S.a.createElement(Gt.Button,{onClick:async function(){const t=n||a;if(!e||!t)return;const s=await rd(e,t);alert(s)}},"Upload"))};function Lu(e,t,a=[]){const s={};return e.forEach(e=>Je.a.set(s,e.split("/"),"FILE")),a.forEach(e=>{s[e]&&"FILE"!==s[e]||(s[e]=[])}),function e(a,s){return Object.keys(s).map(n=>{const i="/"+a.join("/")+"/"+n;return{id:i,label:n,secondaryLabel:t(i),childNodes:"FILE"===s[n]?void 0:e([...a,n],s[n])}})}([],s)}var ju=Object(v.memo)(({assetPath:e})=>{const t=e||dn.defaultAssetPath;return S.a.createElement(S.a.Fragment,null,S.a.createElement("img",{alt:"asset",crossOrigin:"anonymous",src:dn.assetsFolder+t,width:"150px"}))});const Bu=e=>S.a.createElement(Gt.Tooltip,{content:"Delete"},S.a.createElement(Gt.Icon,{icon:"trash",onClick:Gu(e)})),Gu=e=>async()=>{const t=window.confirm(`Are you sure you want to delete ${e}?\nThere is no undoing this action!`);alert(t?await async function(e){const t=await ad(e,"DELETE");return await t.text()||"Successfully Deleted"}(e):"Whew")};var Uu=({assetPaths:e})=>{const[t,a]=S.a.useState(""),[s,n]=S.a.useState({nodes:[]});S.a.useEffect(()=>{n({nodes:Lu(e,Bu,nd)})},[e]);return S.a.createElement(S.a.Fragment,null,S.a.createElement(ju,{assetPath:t}),S.a.createElement(Gt.Tree,{contents:s.nodes,onNodeClick:e=>{!function e(t,a){t&&t.forEach(t=>{a(t),e(t.childNodes,a)})}(s.nodes,e=>e.isSelected=!1),e.isSelected=!e.isSelected,e.isExpanded=!e.isExpanded;const t=e.id.toString();e.childNodes||(a(t),sessionStorage.setItem("selectedAsset",t)),n({...s})}}))},Vu=a(863),Hu=a(861),Fu=a.n(Hu),qu=a(474);const Xu=S.a.memo(Object(qu.b)(({value:e})=>S.a.createElement("div",null,S.a.createElement(Gt.Button,null,e)))),Wu=S.a.memo(Object(qu.a)(({items:e})=>S.a.createElement("div",null,e&&e.map((e,t)=>S.a.createElement(Xu,{key:"item-"+e,index:t,value:e})))));var zu=S.a.memo(({chapterDetail:e,checkpointFilenames:t})=>{const{id:a}=e,{value:s,setValue:n,inputProps:i}=Qa(""),{value:r,setValue:o,inputProps:l}=Qa(""),{items:c,setItems:d,onSortEnd:u}=(()=>{const[e,t]=S.a.useState([]),a=S.a.useCallback(({oldIndex:e,newIndex:a})=>{t(t=>Fu()(t,e,a))},[]);return{items:e,setItems:t,onSortEnd:a}})(),[h,p]=S.a.useState(!1),[m,g]=S.a.useState(new Date),[y,E]=S.a.useState([]),[b,v]=S.a.useState(!1);S.a.useEffect(()=>{n(e.title),o(e.imageUrl),g(new Date(e.openAt)),d(e.filenames),p(e.isPublished),E((t||[]).filter(t=>!e.filenames.includes(t)))},[e,d,o,g,n,t,b]);const f=S.a.useCallback(e=>{d(t=>t.filter(t=>t!==e)),E(t=>[...t,e])},[d]),C=S.a.useCallback(e=>{d(t=>[...t,e]),E(t=>t.filter(t=>t!==e))},[d]);return S.a.createElement(S.a.Fragment,null,S.a.createElement("h4",null,"Title: ",S.a.createElement("input",Object.assign({className:"bp3-input",type:"text"},i))),S.a.createElement("b",null,"Open date: "),m&&(w=m.toISOString(),Ia()(w).format("MMMM Do YYYY, HH:mm")),S.a.createElement(Vu.a,{onChange:e=>{e&&g(e)}}),S.a.createElement("h4",null,"Image url: ",S.a.createElement("input",Object.assign({className:"bp3-input",type:"text"},l)),S.a.createElement(Gt.Button,{onClick:e=>window.open(On(r))},"View")),S.a.createElement("b",null,"Checkpoint Txt Files"),S.a.createElement(Wu,{items:c,onSortEnd:u}),S.a.createElement("br",null),c.length>0&&S.a.createElement(Gt.Button,{icon:"delete",onClick:()=>c.map(f)},"Clear checkpoint files"),S.a.createElement("br",null),S.a.createElement("b",null,"All Txt Files"),y&&y.map(e=>S.a.createElement("div",{key:"choice-"+e},S.a.createElement(Gt.Button,{onClick:()=>C(e),icon:"add"},e))),S.a.createElement("br",null),S.a.createElement(Gt.Button,{icon:"play",onClick:async()=>{gd.getInstance().setChapterSimStack(c),await Rc()}},"Simulate Chapter"),S.a.createElement("br",null),S.a.createElement("br",null),S.a.createElement(Gt.Switch,{checked:h,labelElement:"Published",onChange:()=>p(!h)}),S.a.createElement(Gt.Button,{onClick:async()=>{const e={openAt:m.toISOString(),closeAt:Yu(m).toISOString(),title:s,filenames:c,imageUrl:r,isPublished:h};if(!window.confirm("Are you sure you want to save changes to "+JSON.stringify(e)))return;const t=parseInt(a)===$u?await ld("",e):await ld(a,{story:e});alert(t)}},"Save Changes"),S.a.createElement(Gt.Button,{intent:Gt.Intent.WARNING,onClick:()=>{window.confirm("Are you you want to clear changes for this chapter?")&&(v(!b),alert("Cleared changes"))}},"Clear Changes"),S.a.createElement("br",null),S.a.createElement("br",null),S.a.createElement(Gt.Button,{icon:"trash",intent:Gt.Intent.DANGER,onClick:async()=>{if(window.confirm("Are you sure you want to delete this chapter?")){const e=await async function(e){const t=await sd(e,"DELETE");return 204===t.status?"Chapter successfully deleted":t.text()}(a);alert(e)}}},"Delete Chapter"));var w});const Yu=e=>(e.setFullYear(e.getFullYear()+1),e),$u=-1,Ku={id:$u,title:"title goes here",imageUrl:"/locations/telebay/emergency.png",openAt:(new Date).toISOString(),closeAt:Yu(new Date).toISOString(),isPublished:!1,filenames:[]};var Qu=S.a.memo(({textAssets:e})=>{const{value:t}=function(e,t){const[a,s]=S.a.useState(t);return S.a.useEffect(()=>{(async()=>{const t=await e();s(t)})()},[e]),{value:a,setValue:s}}(od,[]),[a,s]=S.a.useState($u);return S.a.createElement(S.a.Fragment,null,S.a.createElement("h3",null,"Chapter Simulator"),S.a.createElement("select",{className:"bp3-menu",onChange:e=>s(e.target.value)},t.map((e,t)=>S.a.createElement("option",{value:t,key:t},`Chapter ${t}: ${e.title}`)),S.a.createElement("option",{value:$u,key:$u},"Create new chapter")),S.a.createElement("hr",null),S.a.createElement(zu,{chapterDetail:t[a]||Ku,checkpointFilenames:e}))});const Ju={key:an.zektonFont.key,size:35,fill:nn.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Zu={maxOptButtonsRow:2,optButtonsXSpace:.9*un.x,optButtonsYSpace:.5*un.y,gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}};a(1996);const eh=(e,t)=>{const a=new FileReader;a.readAsText(t),a.onloadend=t=>{a.result&&sessionStorage.setItem(e,a.result.toString())}};var th=function({storageName:e,s3TxtFiles:t}){const[a,s]=S.a.useState(t[0]),n=S.a.createElement("input",{type:"file",onChange:function(t){if(!t.target.files)return;const[a]=t.target.files;eh(e,a)},style:{width:"250px"}}),i=S.a.createElement(S.a.Fragment,null,S.a.createElement("select",{className:"bp3-menu",onChange:async function(t){const a=t.target.value;s(a);const n=await fetch(`${dn.assetsFolder}/stories/${a}`,{headers:ah()}),i=await n.text();sessionStorage.setItem(e,i)}},t.map(e=>S.a.createElement("option",{value:e,key:e},e))),S.a.createElement(Gt.Button,{icon:"download",onClick:()=>window.open(lc(a))}));return S.a.createElement("div",{className:"LeftAlign"},S.a.createElement("hr",null),S.a.createElement(Gt.Tabs,{id:"Tabs",key:"vertical",renderActiveTabPanelOnly:!0},S.a.createElement(Gt.Tab,{id:"own",title:"Local",panel:n}),S.a.createElement(Gt.Tab,{id:"s3",title:"S3",panel:i})),S.a.createElement("hr",null))};function ah(){const e=new Headers;return e.append("Access-Control-Allow-Origin","*"),e}function sh({textAssets:e}){return S.a.createElement(S.a.Fragment,null,S.a.createElement("h3",null,"Checkpoint Text Loader"),S.a.createElement("b",null,"Step 1: Choose default checkpoint"),S.a.createElement(th,{s3TxtFiles:e,storageName:Zu.gameTxtStorageName.defaultChapter}),S.a.createElement("b",null,"Step 2: Choose checkpoint text"),S.a.createElement(th,{s3TxtFiles:e,storageName:Zu.gameTxtStorageName.checkpointTxt}),S.a.createElement("br",null),S.a.createElement(Gt.Button,{onClick:function(){gd.getInstance().getCurrentSceneRef().simulateCheckpoint()},icon:"play"},"Simulate Checkpoint"),S.a.createElement("br",null),S.a.createElement("br",null),S.a.createElement(Gt.Button,{onClick:nh},"Reset All Files"),S.a.createElement("br",null))}function nh(e){sessionStorage.setItem(Zu.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem(Zu.gameTxtStorageName.defaultChapter,"")}var ih={storySimBg:{key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},mainMenuOptBanner:{key:"menu-option",path:"/ui/menuOption.png"},shortButton:{key:"short-button",path:"/ui/shortButton.png"},invertedButton:{key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{key:"top-button",path:"/ui/topButton.png"},colorIcon:{key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{key:"icon-bg",path:"/ui/modeIconBg.png"},longButton:{key:"long-button",path:"/ui/longButton.png"}};class rh extends Phaser.Scene{constructor(){super("StorySimulatorMenu"),this.layerManager=void 0,this.layerManager=new li}init(){gd.getInstance().setCurrentSceneRef(this),this.layerManager.initialise(this)}preload(){oi(this),Object.values(Cn).forEach(e=>this.load.image(e.key,On(e.path))),Object.values(ih).forEach(e=>this.load.image(e.key,On(e.path))),Object.values(an).forEach(e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath)),gd.getInstance().getSoundManager().loadSoundAssetMap(En)}async create(){"student"!==gd.getInstance().getAccountInfo().role?(this.renderBackground(),this.renderOptionButtons()):console.log("Students cannot use story sim")}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=on({numOfItems:t.length,maxXSpace:Zu.optButtonsXSpace,maxYSpace:Zu.optButtonsYSpace,numItemLimit:Zu.maxOptButtonsRow,redistributeLast:!0});e.add(t.map((e,t)=>this.createOptButton(e.text,a[t][0],a[t][1],e.callback))),this.layerManager.addToLayer(pn.UI,e)}getOptionButtons(){return[{text:"Object Placement",callback:()=>{gd.getInstance().setStorySimState(_u.ObjectPlacement),this.layerManager.clearAllLayers(),this.scene.start("ObjectPlacement")}},{text:"Checkpoint Simulator",callback:()=>{gd.getInstance().setStorySimState(_u.CheckpointSim)}},{text:"Asset Uploader",callback:()=>{gd.getInstance().setStorySimState(_u.AssetUploader)}},{text:"Chapter Simulator",callback:()=>{gd.getInstance().setStorySimState(_u.ChapterSim)}}]}createOptButton(e,t,a,s){return qo(this,{assetKey:ih.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:Ju,onUp:s}).setPosition(t,a)}simulateCheckpoint(){const e=sessionStorage.getItem(Zu.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem(Zu.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.layerManager.clearAllLayers(),Pc.parse(e),t&&Pc.parse(t,!0);const a=Pc.checkpoint;this.scene.start("GameManager",{gameCheckpoint:a,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,ih.storySimBg.key);e.setDisplaySize(un.x,un.y);const t=new Phaser.GameObjects.Image(this,hn.x,hn.y,ih.blueUnderlay.key).setAlpha(.5);this.layerManager.addToLayer(pn.Background,e),this.layerManager.addToLayer(pn.Background,t)}}var oh=rh;class lh{constructor(){this.backgroundAssetPath=void 0,this.objectPlacement=void 0,this.x=void 0,this.y=void 0,this.getObjectPlacement=()=>Tn(this.objectPlacement),this.x=hn.x,this.y=hn.y}initialise(e){this.objectPlacement=e}async loadBackground(){const e=sessionStorage.getItem("selectedAsset");if(!e||!e.startsWith("/locations/"))return;this.backgroundAssetPath=e;const t="!"+e;this.getObjectPlacement().addAsset(t,e);const a=await ec(this.getObjectPlacement(),t,dn.assetsFolder+e);this.renderBackground(a)}renderBackground(e){if("!"!==e[0])return;this.getObjectPlacement().layerManager.clearLayerContents(pn.Background);const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),hn.x,hn.y,e).setInteractive();this.getObjectPlacement().layerManager.addToLayer(pn.Background,t)}getBackgroundAssetPath(){return this.backgroundAssetPath}screenLog(){return this.backgroundAssetPath+"\n"}}let ch;!function(e){e[e.DrawBBox=0]="DrawBBox",e[e.DragResizeObj=1]="DragResizeObj"}(ch||(ch={}));class dh{constructor(){this.checkpointTitle="boundingBoxes",this.objectPlacement=void 0,this.bboxBeingDrawn=void 0,this.startingCoordinates=void 0,this.bboxDetailMap=void 0,this.getObjectPlacement=()=>Tn(this.objectPlacement),this.bboxDetailMap=new Map}initialise(e){this.objectPlacement=e,this.addBBoxListeners(e)}addBBoxListeners(e){this.getObjectPlacement().inputManager.registerEventListener("pointerdown",()=>{this.getObjectPlacement().isCursorMode(ch.DrawBBox)&&(this.bboxBeingDrawn=this.createNewBBox())}),this.getObjectPlacement().inputManager.registerEventListener("pointerup",()=>{if(this.getObjectPlacement().isCursorMode(ch.DrawBBox)&&this.bboxBeingDrawn){if(this.bboxBeingDrawn.displayWidth<=2||this.bboxBeingDrawn.displayHeight<=2)return void this.bboxBeingDrawn.destroy();this.bboxBeingDrawn.x+=this.bboxBeingDrawn.displayWidth/2,this.bboxBeingDrawn.y+=this.bboxBeingDrawn.displayHeight/2,this.bboxBeingDrawn.setOrigin(.5),this.registerBBox(this.bboxBeingDrawn),e.input.setDraggable(this.bboxBeingDrawn),this.getObjectPlacement().setActiveSelection(this.bboxBeingDrawn),this.startingCoordinates=void 0,this.bboxBeingDrawn=void 0}})}createNewBBox(){const[e,t]=this.getObjectPlacement().getCoordinates(),a=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e,t,1,1,nn.white).setOrigin(0).setAlpha(.1).setInteractive().setDataEnabled();return this.startingCoordinates=[e,t],this.getObjectPlacement().layerManager.addToLayer(pn.BBox,a),a}registerBBox(e){const t="bbox"+this.getObjectPlacement().generateItemIdNumber(),a={id:t,x:e.x,y:e.y,width:e.displayWidth,height:e.displayHeight};this.bboxDetailMap.set(t,a),e.data.set("itemId",t),e.data.set("type","bbox")}getLoggables(){return[...this.bboxDetailMap.values()]}getItemById(e){return this.bboxDetailMap.get(e)}resizeWhileBeingDrawn(e){if(!this.getObjectPlacement().isCursorMode(ch.DrawBBox)||!this.startingCoordinates||!this.bboxBeingDrawn)return;const[t,a]=this.startingCoordinates,s=e.input.x,n=e.input.y;zn(this.bboxBeingDrawn,s-t,n-a)}checkpointTxtLog(){const e=[];return this.bboxDetailMap.forEach(t=>{const a=["+"+t.id,ei.toIntString(t.x),ei.toIntString(t.y),ei.toIntString(t.width),ei.toIntString(t.height)];e.push(a.join(", ")),e.push("    show_dialogue*(click)")}),e}setAttribute(e,t,a){const s=e.data.get("itemId"),n=this.bboxDetailMap.get(s);n&&(n[t]=a)}deleteAll(){this.bboxDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.bboxDetailMap.delete(t)}}const uh={key:an.zektonFont.key,size:20,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};var hh={iconBgSize:55,iconSize:40,iconSpacing:15,inactiveAlpha:.7,onHoverAlpha:1,activeAlpha:.9};class ph extends Phaser.GameObjects.Container{constructor(e,t,a,s=ch.DragResizeObj){super(e,t,a),this.isModes=void 0,this.currCursorMode=void 0,this.cursorModes=void 0,this.currActiveModeIdx=void 0,this.currCursorMode=s,this.isModes=new Array,this.cursorModes=new Array,this.currActiveModeIdx=dn.nullSequenceNumber}getCurrCursorMode(){return this.currCursorMode}setCursorMode(e){this.currCursorMode=e}addCursorMode(e,t,a=!0,s="",n=dn.nullFunction,i=dn.nullFunction,r=dn.nullFunction){const o=new Phaser.GameObjects.Container(e,0,0);this.isModes.push(a),this.cursorModes.push(o);const l=this.cursorModes.length-1,c=new oc(e,0,0,s,uh),d=qo(e,{assetKey:ih.iconBg.key,onUp:()=>{this.isModes[l]&&(this.currActiveModeIdx=l),n(),this.renderCursorModesContainer()},onHover:()=>{""!==s&&c.setVisible(!0),o.setAlpha(hh.onHoverAlpha),i()},onOut:()=>{c.setVisible(!1);const e=l===this.currActiveModeIdx&&this.isModes[l];o.setAlpha(e?hh.activeAlpha:hh.inactiveAlpha),r()},onPointerMove:e=>{c.x=e.x-o.x-100,c.y=e.y-o.y-100},onHoverEffect:!1}),u=new Phaser.GameObjects.Sprite(e,0,0,t).setDisplaySize(hh.iconSize,hh.iconSize);d.add(u),o.add([d,c])}renderCursorModesContainer(){this.removeAll(!1);let e=0;this.cursorModes.forEach((t,a)=>{t.setPosition(0,e);const s=a===this.currActiveModeIdx&&this.isModes[a];t.setAlpha(s?hh.activeAlpha:hh.inactiveAlpha),this.add(t),e+=hh.iconBgSize+hh.iconSpacing})}}const mh={key:an.zektonFont.key,size:27,fill:nn.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};function gh(e){return e.split("/").pop().split(".")[0]}const yh=e=>"    "+e;class Eh{constructor(){this.detailMapContainer=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>Tn(this.objectPlacement)}initialise(e){this.objectPlacement=e}printCheckpoint(e="/locations/yourRoom-dim/normal.png",t){const a=""===e?"default":gh(e),s=t.map(e=>{const t=e.checkpointTxtLog();if(!t)return"";return`${e.checkpointTitle}\n${t.map(yh).map(yh).join("\n")}`}),n=`\nstartingLoc: ${a}\n\nobjectives\n    talk\n\nlocations\n    ${a}, ${e}, ${ei.toCapitalizedWords(e)}\n\n${a}\n    modes: explore\n    actions\n        show_dialogue(welcome)\n${s.map(yh).join("\n")}\n\ndialogues\n    welcome\n        Congrats on creating your scene\n    click\n        Invisible bounding box is right here\n`;alert("Chapter ready!"),console.log(n)}showDetailMap(e){this.detailMapContainer=new Phaser.GameObjects.Container(this.getObjectPlacement(),0,0),e.forEach(e=>{const t=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e.x,e.y,400,210,nn.darkBlue).setOrigin(0,.5).setAlpha(.9),a=_n(this.getObjectPlacement(),this.formatObjectDetails(e),{x:e.x+20,y:e.y+10,oriX:0,oriY:.6},mh).setLetterSpacing(3);this.detailMapContainer.add([t,a])}),this.getObjectPlacement().add.existing(this.detailMapContainer)}formatObjectDetails(e){return Object.entries(e).map(([e,t])=>`${e}: ${"number"===typeof t?ei.toIntString(t):t.toString()}`).join("\n")}hideDetailMap(){this.detailMapContainer&&this.detailMapContainer.destroy()}}class bh{constructor(){this.checkpointTitle="objects",this.objectPlacement=void 0,this.objectDetailMap=void 0,this.getObjectPlacement=()=>Tn(this.objectPlacement),this.objectDetailMap=new Map}initialise(e){this.objectPlacement=e,this.objectDetailMap=new Map}async loadObject(){const e=sessionStorage.getItem("selectedAsset");if(!e)return;const t="#"+e;this.getObjectPlacement().addAsset(t,e);const a=await ec(this.getObjectPlacement(),t,dn.assetsFolder+e);this.renderObject(a)}renderObject(e){if("#"!==e[0])return;const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),hn.x,hn.y,e).setInteractive().setDataEnabled();this.getObjectPlacement().input.setDraggable(t),this.getObjectPlacement().layerManager.addToLayer(pn.Objects,t),this.registerObject(e,t)}registerObject(e,t){const a=this.generateItemId(e,this.getObjectPlacement().generateItemIdNumber()),s={id:a,assetKey:e,assetPath:Tn(this.getObjectPlacement().getAssetPath(e)),x:hn.x,y:hn.y};this.objectDetailMap.set(a,s),t.data.set("itemId",a),t.data.set("type","object"),this.getObjectPlacement().setActiveSelection(t)}generateItemId(e,t){return`${gh(e)}${t}`}getLoggables(){return[...this.objectDetailMap.values()]}checkpointTxtLog(){return Array.from(this.objectDetailMap.values()).map(e=>{const t=["+"+e.id,e.assetPath,ei.toIntString(e.x),ei.toIntString(e.y)];return e.width&&(t.push(ei.toIntString(e.width)),t.push(ei.toIntString(e.height))),t.join(", ")})}setAttribute(e,t,a){const s=e.data.get("itemId"),n=this.objectDetailMap.get(s);n&&(n[t]=a)}deleteAll(){this.objectDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.objectDetailMap.delete(t)}}var vh={activeSelectMargin:30,scaleFactor:1.02};class Sh{constructor(){this.activeSelection=void 0,this.activeSelectRect=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>Tn(this.objectPlacement)}initialise(e){this.objectPlacement=e,this.trackDraggables(e),this.drawActiveSelectRect(),this.bindDeleteKey()}drawActiveSelectRect(){this.activeSelectRect=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),0,0,1,1,0).setAlpha(.3),this.getObjectPlacement().layerManager.addToLayer(pn.Selector,this.activeSelectRect)}trackDraggables(e){e.inputManager.registerEventListener("drag",(t,a,s,n)=>{e.isCursorMode(ch.DrawBBox)||(e.getCursorManager().setCursorMode(ch.DragResizeObj),a.x=s,a.y=n),"object"===a.data.get("type")&&(e.setObjAttribute(a,"x",s),e.setObjAttribute(a,"y",n),this.setActiveSelection(a)),"bbox"===a.data.get("type")&&(e.setBBoxAttribute(a,"x",s),e.setBBoxAttribute(a,"y",n),this.setActiveSelection(a))})}resizeActive(e){const t=this.getObjectPlacement();if(!this.activeSelection||!this.activeSelectRect)return;const a=e?vh.scaleFactor:1/vh.scaleFactor;!function(e,t){e.displayWidth*=t,e.displayHeight*=t}(this.activeSelection,a),this.activeSelectRect.displayHeight=this.activeSelection.displayHeight+vh.activeSelectMargin,this.activeSelectRect.displayWidth=this.activeSelection.displayWidth+vh.activeSelectMargin,"object"===this.activeSelection.data.get("type")&&(t.setObjAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setObjAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight))),"bbox"===this.activeSelection.data.get("type")&&(t.setBBoxAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setBBoxAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight)))}setActiveSelection(e){this.activeSelectRect&&(this.activeSelectRect.setAlpha(.3),this.activeSelection=e,this.activeSelectRect.x=e.x,this.activeSelectRect.y=e.y,this.activeSelectRect.displayHeight=e.displayHeight+vh.activeSelectMargin,this.activeSelectRect.displayWidth=e.displayWidth+vh.activeSelectMargin)}deselect(){this.activeSelectRect.setAlpha(0),this.activeSelection=void 0}bindDeleteKey(){[Phaser.Input.Keyboard.KeyCodes.BACKSPACE,Phaser.Input.Keyboard.KeyCodes.DELETE].forEach(e=>this.getObjectPlacement().inputManager.registerKeyboardListener(e,"up",()=>{this.deleteActiveSelection(),this.deselect()}))}deleteActiveSelection(){if(this.activeSelection){switch(this.getType(this.activeSelection)){case"object":this.getObjectPlacement().deleteObj(this.activeSelection);break;case"bbox":this.getObjectPlacement().deleteBBox(this.activeSelection)}this.activeSelection.destroy()}}getType(e){var t;return null===(t=this.activeSelection)||void 0===t?void 0:t.data.get("type")}}var fh={cursorModeXPos:100,cursorModeYPos:100};class Ch extends Phaser.Scene{constructor(){super("ObjectPlacement"),this.layerManager=void 0,this.inputManager=void 0,this.transformManager=void 0,this.cursorModes=void 0,this.bboxManager=void 0,this.objectManager=void 0,this.backgroundManager=void 0,this.logManager=void 0,this.assetMap=void 0,this.itemIdNumber=void 0,this.openBracket=void 0,this.closedBracket=void 0,this.getCursorManager=()=>Tn(this.cursorModes),this.layerManager=new li,this.inputManager=new vl,this.objectManager=new bh,this.bboxManager=new dh,this.backgroundManager=new lh,this.logManager=new Eh,this.transformManager=new Sh,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}init(){this.layerManager=new li,this.inputManager=new vl,this.objectManager=new bh,this.bboxManager=new dh,this.backgroundManager=new lh,this.logManager=new Eh,this.transformManager=new Sh,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}create(){gd.getInstance().setCurrentSceneRef(this),this.layerManager.initialise(this),this.inputManager.initialise(this),this.renderBackground(),this.createUIButtons(),this.backgroundManager.initialise(this),this.objectManager.initialise(this),this.bboxManager.initialise(this),this.transformManager.initialise(this),this.logManager.initialise(this),this.openBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET),this.closedBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET)}update(){this.openBracket&&this.openBracket.isDown&&this.transformManager.resizeActive(!1),this.closedBracket&&this.closedBracket.isDown&&this.transformManager.resizeActive(!0),this.bboxManager.resizeWhileBeingDrawn(this)}createUIButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=new Al(this,()=>{this.cleanUp(),gd.getInstance().setStorySimState(_u.Default),this.scene.start("StorySimulatorMenu")});this.cursorModes=new ph(this,fh.cursorModeXPos,fh.cursorModeYPos),this.populateCursorModes(),e.add(this.cursorModes),e.add(t),this.layerManager.addToLayer(pn.UI,e)}renderBackground(){const e=new Phaser.GameObjects.Image(this,hn.x,hn.y,ih.storySimBg.key);e.setDisplaySize(un.x,un.y),this.layerManager.addToLayer(pn.Background,e)}populateCursorModes(){this.cursorModes&&(this.cursorModes.addCursorMode(this,ih.colorIcon.key,!1,"Set background",async()=>await this.backgroundManager.loadBackground()),this.cursorModes.addCursorMode(this,ih.imageIcon.key,!1,"Add selected object",async()=>await this.objectManager.loadObject()),this.cursorModes.addCursorMode(this,ih.bboxIcon.key,!0,"Draw bounding boxes",()=>this.cursorModes.setCursorMode(ch.DrawBBox)),this.cursorModes.addCursorMode(this,ih.handIcon.key,!0,"Drag or resize",()=>this.cursorModes.setCursorMode(ch.DragResizeObj)),this.cursorModes.addCursorMode(this,ih.listIcon.key,!1,"Print coordinates",()=>this.logManager.printCheckpoint(this.backgroundManager.getBackgroundAssetPath(),[this.objectManager,this.bboxManager]),()=>this.logManager.showDetailMap([...this.objectManager.getLoggables(),...this.bboxManager.getLoggables()]),()=>this.logManager.hideDetailMap()),this.cursorModes.addCursorMode(this,ih.eraseIcon.key,!1,"Erase all",()=>{window.confirm("Are you sure you want to delete?")&&(this.layerManager.clearSeveralLayers([pn.Background,pn.BBox,pn.Objects]),this.objectManager.deleteAll(),this.bboxManager.deleteAll(),this.transformManager.deselect(),this.renderBackground())}),this.cursorModes.renderCursorModesContainer())}getCoordinates(){return[this.input.x,this.input.y]}isCursorMode(e){return this.getCursorManager().getCurrCursorMode()===e}cleanUp(){this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}addAsset(e,t){this.assetMap.set(e,t)}getAssetPath(e){return this.assetMap.get(e)}generateItemIdNumber(){return this.itemIdNumber++}setActiveSelection(e){this.transformManager.setActiveSelection(e)}setObjAttribute(e,t,a){this.objectManager.setAttribute(e,t,a)}deleteObj(e){this.objectManager.delete(e)}setBBoxAttribute(e,t,a){this.bboxManager.setAttribute(e,t,a)}deleteBBox(e){this.bboxManager.delete(e)}}const wh={debug:!0,type:en.WEBGL,width:un.x,height:un.y,physics:{default:"arcade"},scale:{mode:en.Scale.FIT,parent:"game-display"}};var Ah=function(){const e=Object(C.e)(e=>e.session),[t,a]=v.useState([]),[s,n]=v.useState([]),[i,r]=v.useState(_u.Default);return v.useEffect(()=>{(()=>{const e=new gd(wh,md.Simulator);return e.scene.add("StorySimulatorMenu",oh,!0),e.scene.add("ObjectPlacement",Ch),e.scene.add("GameManager",Ul),e.scene.add("CheckpointTransition",Bc),e})().setStorySimStateSetter(r)},[]),v.useEffect(()=>{(async()=>{gd.getInstance().setAccountInfo(e);const t=await id(nd);a(t),n(function(e){return e.filter(e=>e.startsWith("stories")&&e.endsWith("txt")).map(e=>e.slice(8))}(t))})()},[e]),v.createElement(v.Fragment,null,v.createElement("div",{className:"StorySimulatorWrapper"},v.createElement("div",{id:"game-display"}),v.createElement("div",{className:"LeftAlign StorySimulatorPanel"},i===_u.Default&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Welcome to story simulator!")),i===_u.CheckpointSim&&v.createElement(sh,{textAssets:s}),i===_u.ObjectPlacement&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Asset Selection"),v.createElement(Uu,{assetPaths:t})),i===_u.AssetUploader&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Asset uploader"),v.createElement(Du,null),v.createElement("h3",null,"Asset Viewer"),v.createElement(Uu,{assetPaths:t})),i===_u.ChapterSim&&v.createElement(Qu,{textAssets:s}))))};var Oh=Object(w.h)(Object(C.c)(e=>({sourceChapter:e.workspaces.playground.context.chapter,sourceVariant:e.workspaces.playground.context.variant}),e=>Object(A.b)({handleFetchChapter:()=>oe(),handleUpdateChapter:e=>le(e.chapter,e.variant)},e))((function(e){e.handleFetchChapter();const t=Tt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:kt(e.chapter,e.variant)})),a=(e,{handleClick:t})=>v.createElement(Gt.MenuItem,{active:!1,key:e.chapter+e.variant,onClick:t,text:e.displayName}),s=ea.a.ofType();return v.createElement("div",null," ",((e,n,i=(e=>{}))=>v.createElement(s,{className:Gt.Classes.MINIMAL,items:t,onItemSelect:i,itemRenderer:a,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:kt(e,n),rightIcon:Ut.a.DOUBLE_CARET_VERTICAL})))(e.sourceChapter,e.sourceVariant,e.handleUpdateChapter)," ")})));var Th=e=>v.createElement(Gt.Navbar,{className:"NavigationBar secondary-navbar"},v.createElement(Gt.NavbarGroup,{align:Gt.Alignment.LEFT},v.createElement(Vt.a,{to:"/academy/"+ja(Yt.Mission),activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.FLAME}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Missions"),v.createElement(Vs,{notificationFilter:js(Yt.Mission),disableHover:!0})),v.createElement(Vt.a,{to:"/academy/"+ja(Yt.Sidequest),activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.LIGHTBULB}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Quests"),v.createElement(Vs,{notificationFilter:js(Yt.Sidequest),disableHover:!0})),v.createElement(Vt.a,{to:"/academy/"+ja(Yt.Path),activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.PREDICTIVE_ANALYSIS}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Paths"),v.createElement(Vs,{notificationFilter:js(Yt.Path),disableHover:!0})),v.createElement(Vt.a,{to:"/academy/"+ja(Yt.Contest),activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.COMPARISON}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Contests"),v.createElement(Vs,{notificationFilter:js(Yt.Contest),disableHover:!0})),v.createElement(Vt.a,{to:"/academy/"+ja(Yt.Practical),activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.MANUAL}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Practical"))),e.role===Ot.Admin||e.role===Ot.Staff?v.createElement(Gt.NavbarGroup,{align:Gt.Alignment.RIGHT},v.createElement(Oh,null),v.createElement(Vt.a,{to:"/academy/groundcontrol",activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:"satellite"}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Ground Control")),v.createElement(Vt.a,{to:"/academy/dashboard",activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:"globe"}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Dashboard")),v.createElement(Vt.a,{to:"/academy/sourcereel",activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.MOBILE_VIDEO}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Sourcereel")),v.createElement(Vt.a,{to:"/academy/grading",activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.ENDORSED}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Grading"),v.createElement(Vs,{notificationFilter:js("Grading"),disableHover:!0})),v.createElement(Vt.a,{to:"/academy/storysimulator",activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL)},v.createElement(Gt.Icon,{icon:Ut.a.CROWN}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Story Simulator"))):null);class Ih extends v.Component{constructor(...e){super(...e),this.assessmentRenderFactory=e=>t=>v.createElement(Ws,{assessmentCategory:e}),this.dynamicRedirect=e=>{const t=e.historyHelper.lastGeneralLocations[0],a=e.historyHelper.lastAcademyLocations[0];return null!=t&&null==Bt.exec(t)&&null!=a?()=>v.createElement(w.b,{to:a}):this.redirectToGame},this.redirectTo404=()=>v.createElement(w.b,{to:"/404"}),this.redirectToGame=()=>v.createElement(w.b,{to:"/academy/game"})}componentDidMount(){this.props.handleFetchNotifications()}render(){return v.createElement("div",{className:"Academy"},v.createElement(Th,{role:this.props.role}),v.createElement(w.e,null,v.createElement(w.c,{path:`/academy/${ja(Yt.Contest)}/${zs}`,render:this.assessmentRenderFactory(Yt.Contest)}),v.createElement(w.c,{path:"/academy/game",component:vd}),v.createElement(w.c,{path:`/academy/${ja(Yt.Mission)}/${zs}`,render:this.assessmentRenderFactory(Yt.Mission)}),v.createElement(w.c,{path:`/academy/${ja(Yt.Path)}/${zs}`,render:this.assessmentRenderFactory(Yt.Path)}),v.createElement(w.c,{path:`/academy/${ja(Yt.Sidequest)}/${zs}`,render:this.assessmentRenderFactory(Yt.Sidequest)}),v.createElement(w.c,{path:`/academy/${ja(Yt.Practical)}/${zs}`,render:this.assessmentRenderFactory(Yt.Practical)}),v.createElement(w.c,{path:"/academy/groundcontrol",component:su}),v.createElement(w.c,{path:"/academy/dashboard",component:Zs}),v.createElement(w.c,{path:"/academy/grading/:submissionId(\\d+)?/:questionId(\\d+)?",component:Vd}),v.createElement(w.c,{path:"/academy/sourcereel",component:Mu}),v.createElement(w.c,{path:"/academy/storysimulator",component:Ah}),v.createElement(w.c,{exact:!0,path:"/academy",component:this.dynamicRedirect(this.props)}),v.createElement(w.c,{component:this.redirectTo404})))}}var kh=Ih;var Ph=Object(w.h)(Object(C.c)(e=>({historyHelper:e.session.historyHelper}),e=>Object(A.b)({handleFetchNotifications:De},e))(kh));const xh=v.createElement("span",{className:"dot"},"\u2022");class Rh extends v.Component{render(){return v.createElement("div",{className:"outsideDetails"},v.createElement(Gt.Card,{className:"contributorsDetails",elevation:Gt.Elevation.ONE},v.createElement(Gt.H3,null,"The people behind Source Academy"),v.createElement("p",null,"The ",v.createElement("i",null,"Source Academy"),' is designed by and for students of the National University of Singapore. Students who completed the CS1101S module come back to coach their juniors as "Avengers" or to further develop and improve the Academy. This page includes all developers who contributed to the Source Academy ',v.createElement("i",null,"Knight")," (2020) and its its precursor, ",v.createElement("i",null,"Cadet")," (2018). Both of these succeeded Source Academy 2 (2017) and ultimately the original Source Academy (2016)."),v.createElement("div",{className:"leadership"},v.createElement(Gt.H5,null,v.createElement("strong",null,v.createElement("u",null,"2020 Leadership"))),v.createElement("p",null,"Tiffany Chong",v.createElement("br",null),v.createElement("strong",null,"(Game)")),xh,v.createElement("p",null,"Anthony Halim",v.createElement("br",null),v.createElement("strong",null,"(Architecture)")),xh,v.createElement("p",null,"Kan Yip Keng, Jet",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),xh,v.createElement("p",null,"Low Jun Kai, Sean",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),xh,v.createElement("p",null,"Daryl Tan",v.createElement("br",null),v.createElement("strong",null,"(Source)")),xh,v.createElement("p",{className:"wider"},"Tee Hao Wei",v.createElement("br",null),v.createElement("strong",null,"(Backend & DevOps)")),xh,v.createElement("p",null,"Martin Henz",v.createElement("br",null),v.createElement("strong",null,"(Coordination)"))),v.createElement("div",{className:"hallOfFame"},v.createElement(Gt.H5,null,v.createElement("strong",null,v.createElement("u",null,"Hall of Fame"))),v.createElement("p",null,v.createElement("strong",null,"Cadet architect")),v.createElement("p",null,"Evan Sebastian"),v.createElement("p",null,v.createElement("strong",null,"Cadet core team")),v.createElement("p",null,"Julius Putra Tanu Setiaji ",xh," Lee Ning Yuan ",xh," Vignesh Shankar ",xh," Thomas Tan"," ",xh," Chen Shaowei"),v.createElement("p",null,v.createElement("strong",null,"Graphic design")),v.createElement("p",null,"Ng Tse Pei ",xh," Joey Yeo ",xh," Tan Yu Wei")),v.createElement("div",{className:"leadership"},v.createElement(Gt.H5,null,v.createElement("strong",null,v.createElement("u",null,"2019 Leadership"))),v.createElement("p",null,"Liow Jia Chen",v.createElement("br",null),v.createElement("strong",null,"(Backend)")),xh,v.createElement("p",null,"Ge Shuming",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),xh,v.createElement("p",null,"Rahul Rajesh",v.createElement("br",null),v.createElement("strong",null,"(DevOps)")),xh,v.createElement("p",null,"Daryl Tan",v.createElement("br",null),v.createElement("strong",null,"(Source)")),xh,v.createElement("p",null,"She Jiayu",v.createElement("br",null),v.createElement("strong",null,"(Tools)"))),v.createElement("div",{className:"contributors"},v.createElement(Gt.H5,null,v.createElement("strong",null,v.createElement("u",null,"All Contributors"))),v.createElement("p",null,"Below are all contributors to the"," ",v.createElement("a",{href:We.githubOrg},"GitHub repositories of the Source Academy"),"."))))}}var Nh=Rh;const Mh=["assessments","tools","source-academy2"],_h=["dependabot[bot]","dependabot-preview[bot]"];class Dh extends v.Component{constructor(e){super(e),this.state={repos:[],contributors:[]}}componentDidMount(){(async()=>{const e=await fetch("https://api.github.com/orgs/source-academy/repos"),t=await e.json();return await t.filter(e=>!Mh.includes(e.name)).map(e=>({key:e.id,name:e.name,description:e.description,link:e.contributors_url}))})().then(e=>(this.setState({repos:e}),e)).then(e=>{(async e=>{const t=await Promise.all(e.map(e=>fetch(e.link))),a=await Promise.all(t.map(e=>e.json()));return await Promise.all(a.map(e=>e.filter(e=>!_h.includes(e.login)).map(e=>({key:e.id,photo:e.avatar_url,githubPage:e.html_url,githubName:e.login,commits:e.contributions}))))})(e).then(e=>{this.setState({contributors:e})})})}render(){const{contributors:e,repos:t}=this.state,a=e.length?e.map((e,a)=>{const s=t[a],n=e.map(e=>v.createElement("div",{key:e.key},v.createElement("img",{src:e.photo,alt:"Contributor"}),v.createElement("p",null,v.createElement("a",{href:e.githubPage,rel:"noopener noreferrer",target:"_blank"},e.githubName)),v.createElement("p",null,"Commits: ",e.commits)));return v.createElement(Gt.Card,{key:s.key,className:"containerPermalink",elevation:Gt.Elevation.ONE},v.createElement("div",{className:"repoDetailsPermalink"},v.createElement(Gt.H3,null,s.name),v.createElement(Gt.H5,null,s.description)),v.createElement("div",{className:"inPermalink"},n))}):v.createElement(Gt.H2,null,"Loading...");return v.createElement("div",null,a)}}var Lh=Dh;class jh extends v.Component{render(){return v.createElement("div",{className:"fullpage"},v.createElement(Gt.Card,{className:"fullpage-content",elevation:Gt.Elevation.THREE},v.createElement(Nh,null),v.createElement(Lh,null)))}}var Bh=jh;const Gh=({handleClick:e,id:t,name:a})=>v.createElement(Gt.Button,{className:Gt.Classes.LARGE,rightIcon:Ut.a.LOG_IN,onClick:v.useCallback(()=>e(t),[e,t])},"Log in with "+a),Uh=v.createElement(Vt.a,{to:"/playground"},v.createElement(Gt.Button,{className:Gt.Classes.LARGE,rightIcon:Ut.a.CODE},"Try out the playground"));var Vh=e=>{const{code:t,providerId:a,handleFetchAuth:s}=e;return v.useEffect(()=>{t&&s(t,a)},[t,a,s]),t?v.createElement("div",{className:Xt()("Login",Gt.Classes.DARK)},v.createElement(Gt.Card,{className:Xt()("login-card",Gt.Classes.ELEVATION_4)},v.createElement("div",{className:"login-body"},v.createElement(Gt.NonIdealState,{description:"Logging In...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})})))):v.createElement("div",{className:Xt()("Login",Gt.Classes.DARK)},v.createElement(Gt.Card,{className:Xt()("login-card",Gt.Classes.ELEVATION_4)},v.createElement("div",{className:"login-header"},v.createElement(Gt.H4,null,v.createElement(Gt.Icon,{icon:Ut.a.LOCK}),"LOGIN")),v.createElement("div",{className:"login-body"},v.createElement(Gt.ButtonGroup,{fill:!0,vertical:!0},e.providers.map(({id:t,name:a})=>v.createElement(Gh,{handleClick:e.handleLogin,name:a,id:t,key:t})),Uh))))};var Hh=e=>{const t=Object(C.d)(),a=v.useMemo(()=>Object(A.b)({handleFetchAuth:me,handleLogin:ve},t),[t]);return v.createElement(Vh,Object.assign({},a,e))},Fh=a(321),qh=a(319);const Xh=e=>e.charAt(0).toUpperCase()+e.slice(1),Wh=()=>{const e=localStorage.getItem("MissionEditingAssessmentSA");return e?JSON.parse(e):null},zh=()=>{const e=localStorage.getItem("MissionEditingOverviewSA");return e?JSON.parse(e):null},Yh=e=>{localStorage.setItem("MissionEditingAssessmentSA",JSON.stringify(e))},$h=e=>{localStorage.setItem("MissionEditingOverviewSA",JSON.stringify(e))},Kh=(e,t,a)=>{const s=e.CONTENT.TASK[0],n=s.$;return{category:Xh(n.kind),closeAt:n.duedate,coverImage:n.coverimage,grade:1,id:-1,maxGrade:t,maxXp:a,number:n.number||"",openAt:n.startdate,title:n.title,reading:s.READING?s.READING[0]:"",shortSummary:s.WEBSUMMARY?s.WEBSUMMARY[0]:"",status:Wt.attempting,story:n.story,xp:0,gradingStatus:"none"}},Qh=e=>{const t=e.CONTENT.TASK[0],a=t.$,s=Zh(t);return[{category:Xh(a.kind),id:-1,globalDeployment:Jh(t.DEPLOYMENT),graderDeployment:Jh(t.GRADERDEPLOYMENT),longSummary:t.TEXT[0],missionPDF:"google.com",questions:s[0],title:a.title},s[1],s[2]]},Jh=e=>{if(void 0===e)return{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]};{const t=e[0],a=t.IMPORT||t.EXTERNAL,s=a?a[0].$.name:"NONE",n=a&&a[0].SYMBOL||[],i=t.GLOBAL?t.GLOBAL.map(e=>{return[e.IDENTIFIER[0],(t=e.VALUE[0],Function('"use strict";return ('+t+")")()),e.VALUE[0]];var t}):[];return{chapter:parseInt(t.$.interpreter,10),external:{name:s,symbols:n},globals:i}}},Zh=e=>{let t=0,a=0;const s=[];return e.PROBLEMS[0].PROBLEM.forEach((e,n)=>{const i=e.$.maxxp?parseInt(e.$.maxxp,10):0,r={answer:null,roomId:null,content:e.TEXT[0],id:n,library:Jh(e.DEPLOYMENT),graderLibrary:Jh(e.GRADERDEPLOYMENT),type:e.$.type,xp:0,grade:0,maxGrade:parseInt(e.$.maxgrade,10),maxXp:i};t+=parseInt(e.$.maxgrade,10),a+=i,"programming"===r.type&&s.push(tp(e,r)),"mcq"===r.type&&s.push(ep(e,r))}),[s,t,a]},ep=(e,t)=>{const a=[],s=e.SNIPPET?e.SNIPPET[0].SOLUTION:void 0;let n=0;return e.CHOICE.forEach((e,t)=>{a.push({content:e.TEXT[0],hint:null}),n="true"===e.$.correct?t:n}),{...t,type:"mcq",answer:s?parseInt(s[0],10):0,choices:a,solution:n}},tp=(e,t)=>{const a=e.SNIPPET[0].TESTCASES,s=a&&a[0].PUBLIC||[],n=a&&a[0].PRIVATE||[],i=e.SNIPPET[0].PREPEND,r=e.SNIPPET[0].POSTPEND,o=e.SNIPPET[0].SOLUTION,l={...t,autogradingResults:[],prepend:i?i[0].trim():"",solutionTemplate:e.SNIPPET[0].TEMPLATE[0].trim(),postpend:r?r[0].trim():"",testcases:s.map(e=>ap(e)),testcasesPrivate:n.map(e=>ap(e)),answer:o?o[0].trim():"",type:"programming"};return e.SNIPPET[0].GRADER&&(l.graderTemplate=e.SNIPPET[0].GRADER[0]),l},ap=e=>({type:$t.public,answer:e.$.answer,score:parseInt(e.$.score,10),program:e._}),sp=(e,t)=>{const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},np=e=>{const t={$:{interpreter:e.chapter.toString()},EXTERNAL:{$:{name:e.external.name}}};return 0!==e.external.symbols.length&&(t.EXTERNAL.SYMBOL=e.external.symbols),0!==e.globals.length&&(t.GLOBAL=e.globals.map(e=>({IDENTIFIER:e[0],VALUE:e[2]}))),t},ip=(e,t)=>{const a={},s={coverimage:t.coverImage,duedate:t.closeAt,kind:t.category.toLowerCase(),number:t.number||"",startdate:t.openAt,story:t.story,title:t.title};return a.$=s,t.reading&&""!==t.reading&&(a.READING=t.reading),a.WEBSUMMARY=t.shortSummary,a.TEXT=e.longSummary,a.PROBLEMS={PROBLEM:[]},a.DEPLOYMENT=np(e.globalDeployment),-1!==e.graderDeployment.chapter&&(a.GRADERDEPLOYMENT=np(e.graderDeployment)),e.questions.forEach(e=>{const t={$:{type:e.type,maxgrade:e.maxGrade},SNIPPET:{SOLUTION:e.answer},TEXT:e.content,CHOICE:[]};if(-1!==e.library.chapter&&(t.$.DEPLOYMENT=np(e.library)),-1!==e.graderLibrary.chapter&&(t.$.GRADERDEPLOYMENT=np(e.graderLibrary)),e.maxXp&&(t.$.maxxp=e.maxXp),"programming"===e.type){e.graderTemplate&&(t.SNIPPET.GRADER=e.graderTemplate);const a={...t.SNIPPET,TEMPLATE:e.solutionTemplate,PREPEND:e.prepend,POSTPEND:e.postpend,TESTCASES:""};if(e.testcases.length||e.testcasesPrivate.length){if(a.TESTCASES={},e.testcases.length){const t=e.testcases.map(e=>({$:{answer:e.answer,score:e.score},_:e.program}));a.TESTCASES.PUBLIC=t}if(e.testcasesPrivate&&e.testcasesPrivate.length){const t=e.testcasesPrivate.map(e=>({$:{answer:e.answer,score:e.score},_:e.program}));a.TESTCASES.PRIVATE=t}}t.SNIPPET=a}"mcq"===e.type&&e.choices.forEach((a,s)=>{t.CHOICE.push({$:{correct:e.solution===s?"true":"false"},TEXT:a.content})}),a.PROBLEMS.PROBLEM.push(t)}),a};class rp extends v.Component{constructor(e){super(e),this.saveEditOverview=e=>t=>{const a={...this.props.overview,[e]:this.state.fieldValue};this.setState({editingOverviewField:"",fieldValue:""}),$h(a),this.props.updateEditingOverview(a)},this.handleEditOverview=()=>e=>{this.setState({fieldValue:e.target.value})},this.toggleEditField=e=>t=>{this.state.editingOverviewField!==e&&this.setState({editingOverviewField:e,fieldValue:this.props.overview[e]})},this.toggleOptionsOverlay=()=>{this.setState({showOptionsOverlay:!this.state.showOptionsOverlay})},this.handleExportXml=e=>{(()=>{const e=localStorage.getItem("MissionEditingAssessmentSA"),t=localStorage.getItem("MissionEditingOverviewSA");if(e&&t){const a=JSON.parse(e),s=JSON.parse(t),n=s.fileName||s.title,i=new qh.Builder,r={CONTENT:{$:{"xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance"},TASK:ip(a,s)}};let o=i.buildObject(r);o=o.replace(/(&#xD;)+/g,""),sp(n+".xml",o)}})()},this.makeEditingOverviewTextarea=e=>v.createElement(Fh.a,{autoFocus:!0,className:"editing-textarea",onChange:this.handleEditOverview(),onBlur:this.saveEditOverview(e),value:this.state.fieldValue}),this.makeEditingOverviewCard=e=>v.createElement("div",null,v.createElement(Gt.Card,{className:"row listing",elevation:Gt.Elevation.ONE},v.createElement("div",{className:"col-xs-3 listing-picture",onClick:this.toggleEditField("coverImage")},"coverImage"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("coverImage"):v.createElement("img",{alt:"Assessment cover",className:"cover-image-"+e.status,src:e.coverImage?e.coverImage:Ft.a})),v.createElement("div",{className:"col-xs-9 listing-text"},this.makeEditingOverviewCardTitle(e,e.title),v.createElement("div",{className:"row listing-grade"},v.createElement(Gt.H6,null," ","Max Grade: "+e.maxGrade," ")),v.createElement("div",{className:"row listing-xp"},v.createElement(Gt.H6,null," ","Max XP: "+e.maxXp," ")),v.createElement("div",{className:"row listing-description",onClick:this.toggleEditField("shortSummary")},"shortSummary"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("shortSummary"):v.createElement(ma,{content:op(e.shortSummary)})),v.createElement("div",{className:"listing-controls"},v.createElement(Gt.Text,{className:"listing-due-date"},v.createElement(Gt.Icon,{className:"listing-due-icon",iconSize:12,icon:Ut.a.TIME}),v.createElement("div",{className:"date-container"},"Opens at:\xa0"),v.createElement("div",{className:"date-container",onClick:this.toggleEditField("openAt")},"openAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("openAt"):""+Pa(e.openAt)),v.createElement("div",{className:"date-container"},"\xa0\xa0Due:\xa0"),v.createElement("div",{className:"date-container",onClick:this.toggleEditField("closeAt")},"closeAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("closeAt"):""+Pa(e.closeAt))),this.makeOptionsButton(),lp(e,this.props.listingPath))))),this.makeEditingOverviewCardTitle=(e,t)=>v.createElement("div",{className:"row listing-title"},v.createElement(Gt.Text,{ellipsize:!0,className:"col-xs-10"},v.createElement(Gt.H4,{onClick:this.toggleEditField("title")},"title"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("title"):op(t))),v.createElement("div",{className:"col-xs-2"},this.makeExportButton(e))),this.makeExportButton=e=>v.createElement(Gt.Button,{icon:Ut.a.EXPORT,intent:Gt.Intent.DANGER,minimal:!0,onClick:this.handleExportXml},"Save as XML"),this.makeOptionsButton=()=>v.createElement(Gt.Button,{icon:Ut.a.WRENCH,minimal:!0,onClick:this.toggleOptionsOverlay},"Other Options"),this.saveCategory=(e,t)=>{const a={...this.props.overview,category:e};$h(a),this.props.updateEditingOverview(a)},this.optionsOverlay=()=>v.createElement(Gt.Dialog,{canOutsideClickClose:!1,className:"assessment-reset",icon:Ut.a.WRENCH,isCloseButtonShown:!0,isOpen:this.state.showOptionsOverlay,onClose:this.toggleOptionsOverlay,title:"Other options"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement(Gt.H3,null,"Category"),dp(this.props.overview.category,this.saveCategory),v.createElement(Gt.H3,null,"Number"),v.createElement("div",{onClick:this.toggleEditField("number")},"number"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("number"):op(this.props.overview.number||"")),v.createElement(Gt.H3,null,"Story"),v.createElement("div",{onClick:this.toggleEditField("story")},"story"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("story"):op(this.props.overview.story||"")),v.createElement("br",null),v.createElement(Gt.H3,null,"Filename"),v.createElement("div",{onClick:this.toggleEditField("fileName")},"fileName"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("fileName"):op(this.props.overview.fileName||"")))),this.state={editingOverviewField:"",fieldValue:"",showOptionsOverlay:!1}}render(){return v.createElement("div",null,this.optionsOverlay(),this.makeEditingOverviewCard(this.props.overview))}}const op=e=>e.match("^(\n| )*$")?"Enter Value Here (If Applicable)":e,lp=(e,t)=>(t=t||"/academy/"+ja(e.category),v.createElement(Vt.a,{to:t+`/${e.id.toString()}/${ze.defaultQuestionId}`},sa("Edit mission",Ut.a.EDIT))),cp=[Yt.Mission,Yt.Path,Yt.Sidequest,Yt.Contest],dp=(e,t=((e,t)=>{}))=>v.createElement(up,{className:Gt.Classes.MINIMAL,items:cp,onItemSelect:t,itemRenderer:hp,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:e,rightIcon:Ut.a.DOUBLE_CARET_VERTICAL})),up=ea.a.ofType(),hp=(e,{handleClick:t,modifiers:a,query:s})=>v.createElement(Gt.MenuItem,{active:!1,key:e,onClick:t,text:e});function pp(e){const t="question"===e.editingMode?"Global":"Question Specific";return v.createElement(Gt.Tooltip,{content:"Switch to "+t+" Editing Mode"},sa(t+" Editing Mode",Ut.a.REFRESH,e.toggleEditMode))}const mp=(e,t)=>{for(const a of e)t=t[a];return t},gp=(e,t,a)=>{let s=0;for(s=0;s<e.length-1;s++)a=a[e[s]];a[e[s]]=t},yp=(e=0,t=null)=>a=>{let s;return a="string"===typeof a?parseInt(a,10):a,s=null!==e&&a<e?e:null!==t&&a>t?t:a,s};class Ep extends v.Component{constructor(e){super(e),this.saveEditAssessment=e=>{let t;this.state.isNumber?(t=parseInt(this.state.fieldValue,10),isNaN(t)&&(t=mp(this.props.path,this.props.assessment))):t=this.state.fieldValue;const a=mp(this.props.path,this.props.assessment);if(this.props.processResults&&(t=this.props.processResults(t)),t!==a){const e=this.props.assessment;gp(this.props.path,t,e),this.props.updateAssessment(e)}this.setState({isEditing:!1})},this.handleEditAssessment=e=>{this.setState({fieldValue:e.target.value})},this.makeEditingTextarea=()=>v.createElement(Fh.a,{autoFocus:!0,className:"editing-textarea",onChange:this.handleEditAssessment,onBlur:this.saveEditAssessment,value:this.state.fieldValue}),this.toggleEditField=()=>e=>{if(!this.state.isEditing){const e=mp(this.props.path,this.props.assessment)||"";this.setState({isEditing:!0,fieldValue:"string"===typeof e?e:e.toString()})}};const t=this.props.isNumber||!1;this.state={isEditing:!1,isNumber:t,fieldValue:"",useRawValue:this.props.useRawValue||t}}render(){let e;if(this.state.isEditing)e=this.makeEditingTextarea();else{const t="Please enter value (if applicable)";let a=mp(this.props.path,this.props.assessment);this.props.isNumber||(a=a||"",a=a.match(/^\s*$/)?t:a),e=this.state.useRawValue?a:v.createElement(ma,{content:a})}return v.createElement("div",{onClick:this.toggleEditField()},e)}}var bp=Ep;class vp extends v.Component{constructor(...e){super(...e),this.addTestcase=e=>()=>{e.push({type:$t.public,answer:"",score:0,program:""}),this.props.updateAssessment(this.props.assessment)},this.removeTestcase=(e,t)=>{e.splice(t,1),this.props.updateAssessment(this.props.assessment)},this.autograderCard=(e,t)=>{const a=mp(e,this.props.assessment),s=a[t];return v.createElement("div",null,v.createElement(Gt.Card,{className:"row listing",elevation:Gt.Elevation.ONE},v.createElement("div",{className:"col-xs-9 listing-text"},v.createElement("div",{className:"row listing-program"},v.createElement(Gt.H6,null,"Test Program:",v.createElement(bp,{assessment:this.props.assessment,path:e.concat([t,"program"]),useRawValue:!0,updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"row listing-expected"},v.createElement(Gt.H6,null,"Score:",v.createElement(bp,{assessment:this.props.assessment,isNumber:!0,path:e.concat([t,"score"]),updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"row listing-expected"},v.createElement(Gt.H6,null,"Expected Answer:",v.createElement(bp,{assessment:this.props.assessment,path:e.concat([t,"answer"]),useRawValue:!0,updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"listing-controls"},v.createElement("div",null,sa("Test",Ut.a.PLAY,()=>this.props.handleTestcaseEval(s)),sa("Delete",Ut.a.DELETE,()=>this.removeTestcase(a,t)))))))}}render(){const e=this.props.assessment.questions[this.props.questionId],t=["questions",this.props.questionId,"testcases"],a=e.testcases.map((e,a)=>v.createElement("div",{key:a},this.autograderCard(t,a))),s=["questions",this.props.questionId,"testcasesPrivate"],n=e.testcasesPrivate.map((e,t)=>v.createElement("div",{key:t},this.autograderCard(s,t)));return v.createElement("div",null,"Public Testcases",a,sa("New public testcase",Ut.a.PLUS,this.addTestcase(e.testcases)),v.createElement("br",null),v.createElement("br",null),"Private Testcases",n,sa("New private testcase",Ut.a.PLUS,this.addTestcase(e.testcasesPrivate)))}}class Sp extends v.Component{constructor(...e){super(...e),this.deploymentTab=()=>{const e=this.props.pathToLibrary,t=mp(e,this.props.assessment),a=t.external.symbols.map((t,a)=>v.createElement("tr",{key:a},v.createElement("td",null,this.textareaContent(e.concat(["external","symbols",a]))),v.createElement("td",{style:{width:"100px"}},sa("Delete",Ut.a.MINUS,this.handleSymbolDelete(a))))),s=t.globals.map((t,a)=>v.createElement("tr",{key:a},v.createElement("td",{style:{width:"170px"}},this.textareaContent(e.concat(["globals",a,0]))),v.createElement("td",null,this.globalValueTextareaContent(a)),v.createElement("td",{style:{width:"90px"}},sa("Delete",Ut.a.MINUS,this.handleGlobalDelete(a))))),n=sa("Use this Library",Ut.a.REFRESH,()=>this.props.handleRefreshLibrary(t)),i=v.createElement(v.Fragment,null,"External Library:",v.createElement("br",null),kp(t.external.name,this.handleExternalSelect),v.createElement(Gt.Divider,null),v.createElement("div",null,"Symbols:"),v.createElement("br",null),v.createElement("table",{style:{width:"100%"}},v.createElement("tbody",null,a)),sa("New Symbol",Ut.a.PLUS,this.handleNewSymbol)),r=v.createElement(v.Fragment,null,v.createElement("div",null,"Globals:"),v.createElement("br",null),v.createElement("table",{style:{width:"100%",borderSpacing:"5px"}},v.createElement("tbody",null,s)),sa("New Global",Ut.a.PLUS,this.handleNewGlobal));return v.createElement("div",null,v.createElement(Gt.Divider,null),n,v.createElement(Gt.Divider,null),"Interpreter:",v.createElement("br",null),Ap(t.chapter,t.variant,this.handleChapterSelect),v.createElement(Gt.Divider,null),i,v.createElement(Gt.Divider,null),r)},this.textareaContent=e=>v.createElement(bp,{assessment:this.props.assessment,path:e,processResults:fp,updateAssessment:this.props.updateAssessment,useRawValue:!0}),this.globalValueTextareaContent=e=>{const t=this.props.pathToLibrary.concat(["globals",e,2]);return v.createElement(bp,{assessment:this.props.assessment,path:t,updateAssessment:this.handleGlobalValueUpdate(e),useRawValue:!0})},this.handleGlobalValueUpdate=e=>t=>{const a=mp(this.props.pathToLibrary,this.props.assessment).globals[e];try{a[1]=Cp(a[2]),this.props.updateAssessment(t)}catch(s){a[2]='"Invalid Expression"'}},this.handleSymbolDelete=e=>()=>{const t=this.props.assessment;mp(this.props.pathToLibrary,t).external.symbols.splice(e,1),this.props.updateAssessment(t)},this.handleNewSymbol=()=>{const e=this.props.assessment;mp(this.props.pathToLibrary,e).external.symbols.push("new_symbol"),this.props.updateAssessment(e)},this.handleGlobalDelete=e=>()=>{const t=this.props.assessment;mp(this.props.pathToLibrary,t).globals.splice(e,1),this.props.updateAssessment(t)},this.handleNewGlobal=()=>{const e=this.props.assessment;mp(this.props.pathToLibrary,e).globals.push(["new_global",null,"null"]),this.props.updateAssessment(e)},this.handleChapterSelect=(e,t)=>{const a=this.props.assessment;mp(this.props.pathToLibrary,a).chapter=e.chapter,this.props.updateAssessment(a)},this.handleExternalSelect=(e,t)=>{const a=this.props.assessment,s=mp(this.props.pathToLibrary,a);s.external.name=e.name,s.external.symbols=JSON.parse(JSON.stringify(wt.get(e.name))),this.props.updateAssessment(a)},this.handleSwitchDeployment=()=>{const e=this.props.assessment;if(this.isEmptyLibrary()){let t=mp(this.props.pathToCopy||["globalDeployment"],e);-1===t.chapter&&(t=e.globalDeployment),t=JSON.parse(JSON.stringify(t)),gp(this.props.pathToLibrary,t,e)}else gp(this.props.pathToLibrary,{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},e);this.props.updateAssessment(e)},this.isEmptyLibrary=(e=this.props.pathToLibrary)=>-1===mp(e.concat(["chapter"]),this.props.assessment)}render(){return this.props.isOptionalDeployment?v.createElement("div",null,v.createElement(Gt.Switch,{checked:!this.isEmptyLibrary(),label:"Enable "+this.props.label+" Deployment",onChange:this.handleSwitchDeployment}),this.isEmptyLibrary()?null:this.deploymentTab()):v.createElement("div",null,this.props.label+" Deployment",v.createElement("br",null),this.deploymentTab())}}const fp=e=>"string"===typeof e?e.replace(/\s+/g,""):e,Cp=e=>Function('"use strict";return ('+e+")")(),wp=Tt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:kt(e.chapter,e.variant)})),Ap=(e,t="default",a=((e,t)=>{}))=>v.createElement(Op,{className:Gt.Classes.MINIMAL,items:wp,onItemSelect:a,itemRenderer:Tp,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:kt(e,t),rightIcon:Ut.a.DOUBLE_CARET_VERTICAL})),Op=ea.a.ofType(),Tp=(e,{handleClick:t,modifiers:a,query:s})=>v.createElement(Gt.MenuItem,{active:!1,key:e.chapter,onClick:t,text:e.displayName}),Ip=Array.from(wt.entries()).map((e,t)=>({name:e[0],key:t,symbols:e[1]})),kp=(e,t)=>v.createElement(Pp,{className:Gt.Classes.MINIMAL,items:Ip,onItemSelect:t,itemRenderer:xp,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:e,rightIcon:Ut.a.DOUBLE_CARET_VERTICAL})),Pp=ea.a.ofType(),xp=(e,{handleClick:t,modifiers:a,query:s})=>v.createElement(Gt.MenuItem,{active:!1,key:e.key,onClick:t,text:e.name});class Rp extends v.Component{constructor(e){super(e),this.textareaContent=e=>v.createElement(bp,{assessment:this.props.assessment,isNumber:!0,path:e,processResults:yp(0),updateAssessment:this.props.updateAssessment}),this.gradingTab=()=>v.createElement("div",null,"Max Grade:",this.textareaContent(this.props.path.concat(["maxGrade"])),v.createElement("br",null),"Max Xp:",this.textareaContent(this.props.path.concat(["maxXp"])))}render(){return this.gradingTab()}}class Np extends v.Component{constructor(e){super(e),this.manageQuestionTab=e=>v.createElement("div",null,sa("Clone",Ut.a.DOCUMENT,this.confirmSave(this.makeQuestion(()=>Mp(this.props.assessment.questions[e]),e))),sa("Delete",Ut.a.REMOVE,this.confirmSave(this.deleteQuestion(e))),sa("Shift Up",Ut.a.CARET_UP,this.confirmSave(this.shiftQuestion(-1,e)),{},0===e),sa("Shift Down",Ut.a.CARET_DOWN,this.confirmSave(this.shiftQuestion(1,e)),{},e>=this.props.assessment.questions.length-1),v.createElement("br",null),sa("Insert Programming Question",Ut.a.FONT,this.confirmSave(this.makeQuestion(Jt,e))),sa("Insert MCQ Question",Ut.a.CONFIRM,this.confirmSave(this.makeQuestion(Zt,e)))),this.shiftQuestion=(e,t)=>()=>{const a=this.props.assessment,s=t+e;if(s>=0&&s<a.questions.length){const e=a.questions[t],n=a.questions;n[t]=n[s],n[s]=e,a.questions=n,this.props.updateAssessment(a),Ra.push("/mission-control/-1/"+s.toString())}},this.makeQuestion=(e,t)=>()=>{const a=this.props.assessment;t+=1;const s=a.questions;s.splice(t,0,e()),a.questions=s,this.props.updateAssessment(a),Ra.push("/mission-control/-1/"+t.toString())},this.deleteQuestion=e=>()=>{const t=this.props.assessment;let a=t.questions;a.length>1&&(a=a.slice(0,e).concat(a.slice(e+1))),t.questions=a,this.props.updateAssessment(t)},this.confirmSave=e=>()=>{this.props.hasUnsavedChanges?this.setState({showSaveOverlay:!0,modifyAssessment:e}):e()},this.confirmSaveOverlay=()=>v.createElement(Gt.Dialog,{className:"assessment-reset",icon:Ut.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showSaveOverlay,title:"Confirmation: Save unsaved changes?"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement(ma,{content:"Are you sure you want to save over your unsaved changes?"})),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement(Gt.ButtonGroup,null,sa("Cancel",null,()=>this.setState({showSaveOverlay:!1}),{minimal:!1}),sa("Confirm",null,()=>{this.state.modifyAssessment(),this.setState({showSaveOverlay:!1})},{minimal:!1,intent:Gt.Intent.DANGER})))),this.state={showSaveOverlay:!1,modifyAssessment:()=>{}}}render(){return v.createElement("div",null,this.confirmSaveOverlay(),this.props.assessment.questions.map((e,t)=>v.createElement("div",{key:t},"Question ",t+1,v.createElement("br",null),v.createElement(Gt.Button,{className:"mcq-option col-xs-12",minimal:!0},v.createElement(ma,{content:e.content.length>200?e.content.substring(0,300)+"...":e.content})),this.manageQuestionTab(t),v.createElement("br",null),v.createElement("br",null))))}}const Mp=e=>JSON.parse(JSON.stringify(e));class _p extends v.Component{constructor(e){super(e),this.mcqTab=()=>{const e=this.props.questionId,t=this.props.assessment.questions[e],a=t.choices.map((t,a)=>v.createElement("div",{key:a,className:"mcq-option col-xs-12"},"Option ",a,":",this.textareaContent(["questions",e,"choices",a,"content"]),v.createElement("br",null),"Hint:",this.textareaContent(["questions",e,"choices",a,"hint"]))),s=sa("Delete Option",Ut.a.REMOVE,this.delOption);return v.createElement("div",{className:"MCQChooser row"},v.createElement(Gt.Card,{className:"mcq-content-parent col-xs-12 middle-xs"},v.createElement("div",{className:"row mcq-options-parent between-xs"},a,"Solution:",this.textareaContent(["questions",e,"solution"],!0,[0,t.choices.length]),v.createElement("br",null),sa("Add Option",Ut.a.CONFIRM,this.addOption),t.choices.length>0?s:void 0)))},this.addOption=()=>{const e=this.props.assessment,t=this.props.questionId,a=e.questions[t],s=a.choices.concat([{content:"A",hint:null}]);a.choices=s,e.questions[t]=a,this.props.updateAssessment(e)},this.delOption=()=>{const e=this.props.assessment,t=this.props.questionId,a=e.questions[t],s=a.choices.slice(0,a.choices.length-1);a.choices=s,e.questions[t]=a,this.props.updateAssessment(e)},this.textareaContent=(e,t=!1,a=[0])=>t?v.createElement(bp,{assessment:this.props.assessment,isNumber:!0,path:e,processResults:yp(a[0],a[1]),updateAssessment:this.props.updateAssessment}):v.createElement(bp,{assessment:this.props.assessment,path:e,updateAssessment:this.props.updateAssessment})}render(){return this.mcqTab()}}const Dp=ea.a.ofType(),Lp=[{label:"Prepend",icon:Ut.a.CHEVRON_UP,id:"prepend"},{label:"Postpend",icon:Ut.a.CHEVRON_DOWN,id:"postpend"},{label:"Solution Template",icon:Ut.a.MANUAL,id:"solutionTemplate"},{label:"Suggested Answer",icon:Ut.a.TICK,id:"answer"}];class jp extends v.Component{constructor(e){super(e),this.programmingTab=()=>{const e=["questions",this.props.questionId].concat(this.state.activeEditor.id),t=sa("Copy from Editor",Ut.a.IMPORT,this.handleCopyFromEditor(e)),a=sa("Copy to Editor",Ut.a.EXPORT,this.handleCopyToEditor(e)),s=v.createElement("div",null,t,a,v.createElement(Gt.Divider,null),this.editor(e)),n=(e,{handleClick:t})=>v.createElement(Gt.MenuItem,{active:!1,key:e.id,onClick:t,text:e.label,icon:e.icon});return v.createElement("div",{className:"side-content"},v.createElement(Gt.Card,null,(i=this.state.activeEditor,r=this.handleChangeActiveEditor,v.createElement(Dp,{className:Gt.Classes.MINIMAL,items:Lp,itemRenderer:n,onItemSelect:r,filterable:!1},v.createElement(Gt.Button,{className:Gt.Classes.MINIMAL,text:i.label,icon:Ut.a.EDIT,rightIcon:Ut.a.DOUBLE_CARET_VERTICAL}))),v.createElement(Gt.Divider,null),v.createElement("div",{className:"side-content-text"},s)));var i,r},this.editor=e=>{const t=this.state.templateFocused?this.state.templateValue:mp(e,this.props.assessment);return v.createElement("div",{onClick:this.focusEditor(e),onBlur:this.unFocusEditor(e)},v.createElement(qa.a,{className:"react-ace",editorProps:{$blockScrolling:1/0},fontSize:14,highlightActiveLine:!1,mode:"javascript",onChange:this.handleTemplateChange,theme:"source",value:t,width:"100%"}))},this.handleChangeActiveEditor=e=>{this.setState({activeEditor:e})},this.handleTemplateChange=e=>{this.setState({templateValue:e})},this.focusEditor=e=>t=>{this.state.templateFocused||this.setState({templateValue:mp(e,this.props.assessment),templateFocused:!0})},this.unFocusEditor=e=>t=>{if(this.state.templateFocused){if(mp(e,this.props.assessment)!==this.state.templateValue){const t=this.props.assessment;gp(e,this.state.templateValue,t),this.props.updateAssessment(t)}if("prepend"===this.state.activeEditor.id){const e=this.state.templateValue;this.props.handleUpdateWorkspace({editorPrepend:e})}else if("postpend"===this.state.activeEditor.id){const e=this.state.templateValue;this.props.handleUpdateWorkspace({editorPostpend:e})}this.setState({templateValue:"",templateFocused:!1})}},this.handleCopyFromEditor=e=>()=>{const t=this.props.assessment;gp(e,this.props.editorValue,t),this.props.updateAssessment(t)},this.handleCopyToEditor=e=>()=>{const t=mp(e,this.props.assessment);this.props.handleEditorValueChange(t)},this.state={activeEditor:Lp[0],templateValue:"",templateFocused:!1}}render(){return this.programmingTab()}}class Bp extends v.Component{constructor(e){super(e),this.formatedQuestionId=()=>{let e=this.props.questionId;return e<0?e=0:e>=this.state.assessment.questions.length&&(e=this.state.assessment.questions.length-1),e},this.resetTemplateOverlay=()=>v.createElement(Gt.Dialog,{className:"assessment-reset",icon:Ut.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showResetTemplateOverlay,title:"Confirmation: Reset editor?"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement(ma,{content:"Are you sure you want to reset to your last save?"})),v.createElement("div",{className:Gt.Classes.DIALOG_FOOTER},v.createElement(Gt.ButtonGroup,null,sa("Cancel",null,()=>this.setState({showResetTemplateOverlay:!1}),{minimal:!1}),sa("Confirm",null,()=>{const e=Wh();this.setState({assessment:e,hasUnsavedChanges:!1,showResetTemplateOverlay:!1,originalMaxGrade:this.getMaxMarks("maxGrade"),originalMaxXp:this.getMaxMarks("maxXp")}),this.handleRefreshLibrary(),this.resetWorkspaceValues()},{minimal:!1,intent:Gt.Intent.DANGER})))),this.handleRefreshLibrary=e=>{const t=this.state.assessment.questions[this.formatedQuestionId()];if(e||(e=-1===t.library.chapter?this.state.assessment.globalDeployment:t.library),e&&e.globals.length>0){const t=e.globals.map(e=>e[0]),a=e.external.symbols.concat(t);e={...e,external:{name:e.external.name,symbols:Gp(a)}}}this.props.handleClearContext(e)},this.resetWorkspaceValues=()=>{const e=this.state.assessment.questions[this.formatedQuestionId()];let t,a="",s="";e.type===Kt.programming?(t=e.editorValue?e.editorValue:e.solutionTemplate,a=e.prepend,s=e.postpend):t="//If you see this, this is a bug. Please report bug.",this.props.handleResetWorkspace({editorPrepend:a,editorValue:t,editorPostpend:s}),this.props.handleEditorValueChange(t)},this.handleTestcaseEval=e=>{const t=[e];this.props.handleUpdateWorkspace({editorTestcases:t}),this.props.handleTestcaseEval(0)},this.handleSave=()=>{const e=this.state.assessment;e.questions[this.formatedQuestionId()].editorValue=this.props.editorValue,this.setState({assessment:e,hasUnsavedChanges:!1}),Yh(e),this.handleSaveGradeAndXp()},this.handleSaveGradeAndXp=()=>{const e=this.getMaxMarks("maxGrade"),t=e-this.state.originalMaxGrade,a=this.getMaxMarks("maxXp"),s=a-this.state.originalMaxXp;if(0!==t||0!==s){const n=this.props.assessmentOverview;0!==t&&(n.maxGrade=e),0!==s&&(n.maxXp=a),this.setState({originalMaxGrade:e,originalMaxXp:a}),this.props.updateAssessmentOverview(n),$h(n)}},this.getMaxMarks=e=>{let t=0;const a=this.state.assessment.questions;for(const s of a)t+=s[e];return t},this.updateEditAssessmentState=e=>{this.setState({assessment:e,hasUnsavedChanges:!0})},this.updateAndSaveAssessment=e=>{this.setState({assessment:e}),this.handleRefreshLibrary(),this.handleSave(),this.resetWorkspaceValues()},this.handleActiveTabChange=e=>{this.setState({activeTab:e})},this.toggleEditingMode=()=>{const e="question"===this.state.editingMode?"global":"question";this.setState({editingMode:e})},this.sideContentProps=(e,t)=>{const a=this.state.assessment;let s;if("question"===this.state.editingMode){const e=this.state.assessment.questions[this.props.questionId].type,n="mcq"===e?v.createElement(_p,{assessment:a,questionId:t,updateAssessment:this.updateEditAssessmentState}):v.createElement(jp,{assessment:a,questionId:t,updateAssessment:this.updateEditAssessmentState,editorValue:this.props.editorValue,handleEditorValueChange:this.props.handleEditorValueChange,handleUpdateWorkspace:this.props.handleUpdateWorkspace});s=[{label:"Task "+(t+1),iconName:Ut.a.NINJA,body:v.createElement(Ep,{assessment:a,path:["questions",t,"content"],updateAssessment:this.updateEditAssessmentState}),id:T.editorQuestionOverview,toSpawn:()=>!0},{label:"Question Template",iconName:Ut.a.DOCUMENT,body:n,id:T.editorQuestionTemplate,toSpawn:()=>!0},{label:"Manage Local Deployment",iconName:Ut.a.HOME,body:v.createElement(Sp,{assessment:a,label:"Question Specific",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["questions",t,"library"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorLocalDeployment,toSpawn:()=>!0},{label:"Manage Local Grader Deployment",iconName:Ut.a.CONFIRM,body:v.createElement(Sp,{assessment:a,label:"Question Specific Grader",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["questions",t,"graderLibrary"],pathToCopy:["questions",t,"library"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorLocalGraderDeployment,toSpawn:()=>!0},{label:"Grading",iconName:Ut.a.TICK,body:v.createElement(Rp,{assessment:a,path:["questions",t],updateAssessment:this.updateEditAssessmentState}),id:T.editorGrading,toSpawn:()=>!0}],"programming"===e&&s.push({label:"Autograder",iconName:Ut.a.AIRPLANE,body:v.createElement(vp,{assessment:a,questionId:t,handleTestcaseEval:this.handleTestcaseEval,updateAssessment:this.updateEditAssessmentState}),id:T.editorAutograder,toSpawn:()=>!0});a.globalDeployment.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:Ut.a.GRID_VIEW,body:v.createElement(Oa,null),id:T.toneMatrix,toSpawn:()=>!0})}else s=[{label:a.category+" Briefing",iconName:Ut.a.BRIEFCASE,body:v.createElement(Ep,{assessment:a,path:["longSummary"],updateAssessment:this.updateEditAssessmentState}),id:T.editorBriefing,toSpawn:()=>!0},{label:"Manage Question",iconName:Ut.a.WRENCH,body:v.createElement(Np,{assessment:a,hasUnsavedChanges:this.state.hasUnsavedChanges,questionId:t,updateAssessment:this.updateAndSaveAssessment}),id:T.editorManageQuestion,toSpawn:()=>!0},{label:"Manage Global Deployment",iconName:Ut.a.GLOBE,body:v.createElement(Sp,{assessment:a,label:"Global",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["globalDeployment"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!1}),id:T.editorGlobalDeployment,toSpawn:()=>!0},{label:"Manage Global Grader Deployment",iconName:Ut.a.CONFIRM,body:v.createElement(Sp,{assessment:a,label:"Global Grader",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["graderDeployment"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorGlobalGraderDeployment,toSpawn:()=>!0}];return{handleActiveTabChange:this.handleActiveTabChange,tabs:s}},this.controlBarProps=e=>{const t="/mission-control/"+this.state.assessment.id.toString(),a=[e+1,this.state.assessment.questions.length],s=v.createElement(na,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),n=v.createElement(ia,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),i=v.createElement(oa,{onClickNext:()=>Ra.push(t+"/"+(e+1).toString()),onClickReturn:()=>Ra.push("/mission-control"),questionProgress:a,key:"next_question"}),r=v.createElement(la,{onClick:()=>Ra.push(t+"/"+(e-1).toString()),questionProgress:a,key:"previous_question"}),o=v.createElement(ca,{questionProgress:a,key:"question_view"}),l=v.createElement(da,{onClick:()=>{this.setState(e=>({...e,showResetTemplateOverlay:e.hasUnsavedChanges}))},key:"reset_template"});return{editorButtons:[v.createElement(ua,{handleEditorEval:this.props.handleEditorEval,key:"run"}),v.createElement(ha,{hasUnsavedChanges:this.state.hasUnsavedChanges,onClickSave:this.handleSave,key:"save"}),l],flowButtons:[r,o,i],replButtons:[n,s,v.createElement(pp,{editingMode:this.state.editingMode,toggleEditMode:this.toggleEditingMode,key:"toggle_edit_mode"})]}},this.state={assessment:Wh(),activeTab:T.editorQuestionOverview,editingMode:"question",hasUnsavedChanges:!1,showResetTemplateOverlay:!1,originalMaxGrade:0,originalMaxXp:0}}componentDidMount(){this.state.assessment&&(this.resetWorkspaceValues(),this.setState({originalMaxGrade:this.getMaxMarks("maxGrade"),originalMaxXp:this.getMaxMarks("maxXp")}))}componentDidUpdate(){this.checkWorkspaceReset(this.props)}render(){if(null===this.state.assessment||0===this.state.assessment.questions.length)return v.createElement(Gt.NonIdealState,{className:Xt()("WorkspaceParent",Gt.Classes.DARK),description:"Getting mission ready...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_LARGE})});const e=this.formatedQuestionId(),t=this.state.assessment.questions[e],a={controlBarProps:this.controlBarProps(e),editorProps:t.type===Kt.programming?{editorSessionId:"",editorValue:this.props.editorValue||t.editorValue||t.solutionTemplate,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handleUpdateHasUnsavedChanges:this.props.handleUpdateHasUnsavedChanges,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,hasUnsavedChanges:this.state.hasUnsavedChanges,mcqProps:{mcq:t,handleMCQSubmit:t=>this.props.handleSave(this.state.assessment.questions[e].id,t)},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,e),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:Xt()("WorkspaceParent",Gt.Classes.DARK)},this.resetTemplateOverlay(),v.createElement(Is,a))}checkWorkspaceReset(e){if(void 0===this.state.assessment)return;const t=this.formatedQuestionId();-1===this.props.storedAssessmentId&&this.props.storedQuestionId===t||(this.resetWorkspaceValues(),this.props.handleUpdateCurrentAssessmentId(-1,t),this.props.handleUpdateHasUnsavedChanges(!1),this.state.hasUnsavedChanges&&this.setState({assessment:Wh(),hasUnsavedChanges:!1}),this.handleRefreshLibrary())}}function Gp(e){const t={};return e.filter(e=>!t.hasOwnProperty(e)&&(t[e]=!0))}var Up=Bp;var Vp=Object(C.c)((e,t)=>({editorValue:e.workspaces.assessment.editorValue,editorHeight:e.workspaces.assessment.editorHeight,editorWidth:e.workspaces.assessment.editorWidth,breakpoints:e.workspaces.assessment.breakpoints,highlightedLines:e.workspaces.assessment.highlightedLines,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,newCursorPosition:e.workspaces.assessment.newCursorPosition,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion}),e=>Object(A.b)({handleBrowseHistoryDown:()=>I("assessment"),handleBrowseHistoryUp:()=>k("assessment"),handleChapterSelect:(e,t)=>_(e,"default","assessment"),handleClearContext:e=>B(e,"assessment"),handleDeclarationNavigate:e=>Z("assessment",e),handleEditorEval:()=>q("assessment"),handleEditorValueChange:e=>z(e,"assessment"),handleEditorHeightChange:e=>x(e,"assessment"),handleEditorWidthChange:e=>R(e.toString(),"assessment"),handleEditorUpdateBreakpoints:e=>Y(e,"assessment"),handleInterruptEval:()=>nt("assessment"),handleReplEval:()=>X("assessment"),handleReplOutputClear:()=>U("assessment"),handleReplValueChange:e=>K(e,"assessment"),handleResetWorkspace:e=>te("assessment",e),handleUpdateWorkspace:e=>ae("assessment",e),handleSave:Oe,handleSideContentHeightChange:e=>M(e,"assessment"),handleTestcaseEval:e=>W("assessment",e),handleUpdateHasUnsavedChanges:e=>re("assessment",e),handleUpdateCurrentAssessmentId:ne,handleDebuggerPause:()=>rt("assessment"),handleDebuggerResume:()=>lt("assessment"),handleDebuggerReset:()=>ct("assessment"),handlePromptAutocomplete:(e,t,a)=>de("assessment",e,t,a)},e))(Up);class Hp extends v.Component{constructor(e){super(e),this.fileReader=void 0,this.handleFileRead=e=>t=>{if(!this.fileReader)return;const a=this.fileReader.result;a&&Object(qh.parseString)(a,(t,a)=>{console.dir(e);try{const t=(e=>{const t=Qh(e);return[Kh(e,t[1],t[2]),t[0]]})(a);t[0].fileName=e.name.slice(0,-4),$h(t[0]),this.props.updateEditingOverview(t[0]),Yh(t[1]),this.props.newAssessment(t[1]),this.setState({fileInputText:"Success!"})}catch(t){console.log(t),this.setState({fileInputText:"Invalid XML!"})}})},this.handleChangeFile=e=>{const t=e.target.files;e.target.files&&(this.fileReader=new FileReader,this.fileReader.onloadend=this.handleFileRead(t[0]),this.fileReader.readAsText(t[0]))},this.makeMission=()=>{$h(Qt()),this.props.updateEditingOverview(Qt()),Yh({category:"Mission",globalDeployment:{chapter:1,external:{name:"NONE",symbols:[]},globals:[]},graderDeployment:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},id:-1,longSummary:"Insert mission briefing here",missionPDF:"www.google.com",questions:[{autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],title:"Insert title here"}),this.props.newAssessment({category:"Mission",globalDeployment:{chapter:1,external:{name:"NONE",symbols:[]},globals:[]},graderDeployment:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},id:-1,longSummary:"Insert mission briefing here",missionPDF:"www.google.com",questions:[{autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],title:"Insert title here"})},this.handleFileRead=this.handleFileRead.bind(this),this.handleChangeFile=this.handleChangeFile.bind(this),this.makeMission=this.makeMission.bind(this),this.state={fileInputText:"Import XML"}}componentDidMount(){const e=Wh();e&&this.props.newAssessment(e)}render(){return v.createElement("div",null,v.createElement("div",null,"Please ensure that the xml uploaded is trustable."),v.createElement("div",null,v.createElement(Gt.FileInput,{text:this.state.fileInputText,inputProps:{accept:".xml"},onChange:this.handleChangeFile})),v.createElement("div",null,sa("Make New Mission",Ut.a.NEW_OBJECT,this.makeMission)))}}var Fp=Hp;var qp=Object(C.c)((e,t)=>t,e=>Object(A.b)({newAssessment:Re},e))(Fp);class Xp extends v.Component{constructor(e){super(e),this.updateEditingOverview=e=>{this.setState({editingOverview:e})},this.state={editOverview:"",editingOverview:zh()}}render(){const e=Ba(this.props.match.params.assessmentId),t=Ba(this.props.match.params.questionId)||ze.defaultQuestionId;if(-1===e&&this.state.editingOverview){const a=this.state.editingOverview,s={assessmentId:e,questionId:t,assessmentOverview:a,updateAssessmentOverview:this.updateEditingOverview,notAttempted:a.status===Wt.not_attempted,closeDate:a.closeAt};return v.createElement("div",{className:"Academy"},v.createElement(Vp,s))}const a=this.state.editingOverview?v.createElement(rp,{overview:this.state.editingOverview,updateEditingOverview:this.updateEditingOverview,listingPath:"/mission-control"}):null,s=v.createElement(v.Fragment,null,v.createElement(qp,{updateEditingOverview:this.updateEditingOverview}),a);return v.createElement("div",{className:"Assessment Academy"},v.createElement(_s,{display:s,loadContentDispatch:this.props.handleAssessmentOverviewFetch}))}}var Wp=Xp;var zp=Object(w.h)(Object(C.c)((e,t)=>({isStudent:!e.session.role||e.session.role===Ot.Student}),e=>Object(A.b)({handleAssessmentOverviewFetch:ye,handleSubmitAssessment:Te},e))(Wp));var Yp=()=>v.createElement("div",{className:Xt()("NotFound",Gt.Classes.DARK)},v.createElement(Gt.NonIdealState,{icon:Ut.a.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})),$p=a(232);function Kp(e){return v.createElement(Gt.Tooltip,{content:"Execution Time"},v.createElement(Gt.NumericInput,{leftIcon:Ut.a.TIME,style:{width:80},min:1e3,value:e.execTime,onValueChange:e.handleChangeExecTime}))}const Qp={INACTIVE:Gt.Intent.NONE,SAVED:Gt.Intent.PRIMARY,DIRTY:Gt.Intent.WARNING},Jp=e=>{const t=e.currentFile?e.isDirty?"DIRTY":"SAVED":"INACTIVE",a=sa(e.currentFile&&e.currentFile.name||"Google Drive",Ut.a.CLOUD,null,{intent:Qp[t]}),s=sa("Open",Ut.a.DOCUMENT_OPEN,e.onClickOpen),n=sa("Save",Ut.a.FLOPPY_DISK,e.onClickSave,void 0,"INACTIVE"===t),i=sa("Save as",Ut.a.SEND_TO,e.onClickSaveAs),r=e.loggedInAs&&v.createElement(Gt.Tooltip,{content:"Logged in as "+e.loggedInAs},sa("Log out",Ut.a.LOG_OUT,e.onClickLogOut));return v.createElement(Gt.Popover,{autoFocus:!1,content:v.createElement("div",null,v.createElement(Gt.ButtonGroup,{large:!0},s,n,i,r)),onOpening:e.onPopoverOpening,popoverClassName:Gt.Classes.POPOVER_DISMISS},a)};var Zp=a(320);class em extends v.PureComponent{constructor(e){super(e),this.inviteInputElem=void 0,this.state={joinElemValue:""},this.handleChange=this.handleChange.bind(this),this.inviteInputElem=v.createRef(),this.selectInviteInputText=this.selectInviteInputText.bind(this)}render(){const e=v.createElement(Gt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},sa("Invite",Ut.a.GRAPH,()=>{if(""===this.props.editorSessionId){!function(e){const t=new XMLHttpRequest;t.onreadystatechange=()=>{if(t.readyState===ns.DONE&&t.status===is.OK){const a=JSON.parse(t.responseText).id;e(a)}},t.open("GET","https://"+We.shareDBServer+"gists/latest/",!0),t.send()}(e=>{this.props.handleSetEditorSessionId(e);const t=this.props.editorValue||"// Collaborative Editing Mode!";this.props.handleInitInvite(t)})}}),v.createElement(v.Fragment,null,v.createElement("input",{value:this.props.editorSessionId,readOnly:!0,ref:this.inviteInputElem}),v.createElement(Zp,{text:""+this.props.editorSessionId},sa("",Ut.a.DUPLICATE,this.selectInviteInputText)))),t=v.createElement(Gt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},sa("Join",Ut.a.LOG_IN),v.createElement(v.Fragment,null,v.createElement("form",{onSubmit:e=>{rs(this.state.joinElemValue,()=>this.props.handleSetEditorSessionId(this.state.joinElemValue),()=>{this.props.handleInvalidEditorSessionId(),this.props.handleSetEditorSessionId("")},()=>this.props.handleSetEditorSessionId("")),e.preventDefault()}},v.createElement("input",{type:"text",value:this.state.joinElemValue,onChange:this.handleChange}),v.createElement("span",{className:Gt.Classes.POPOVER_DISMISS},sa("",Ut.a.KEY_ENTER,null,{type:"submit"}))))),a=sa("Leave",Ut.a.FEED,()=>{this.props.handleSetEditorSessionId(""),this.setState({joinElemValue:""})});return v.createElement(Gt.Popover,{content:v.createElement(Gt.Menu,{large:!0},e,""===this.props.editorSessionId?t:a)},sa("Session",Ut.a.SOCIAL_MEDIA,void 0,{iconColor:""===this.props.editorSessionId?void 0:0===this.props.websocketStatus?Gt.Colors.RED3:Gt.Colors.GREEN3}))}selectInviteInputText(){null!==this.inviteInputElem.current&&(this.inviteInputElem.current.focus(),this.inviteInputElem.current.select())}handleChange(e){this.setState({joinElemValue:e.target.value})}}class tm extends v.PureComponent{constructor(e){super(e),this.shareInputElem=void 0,this.selectShareInputText=this.selectShareInputText.bind(this),this.handleChange=this.handleChange.bind(this),this.toggleButton=this.toggleButton.bind(this),this.shareInputElem=v.createRef(),this.state={keyword:"",isLoading:!1}}render(){let e="";const{urlShortener:t}=ze;return t&&(e=t.split("/").slice(0,-1).join("/")+"/"),v.createElement(Gt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},v.createElement(Gt.Tooltip,{content:"Get shareable link"},sa("Share",Ut.a.SHARE,()=>this.toggleButton())),void 0===this.props.queryString?v.createElement(Gt.Text,null,"Share your programs! Type something into the editor (left), then click on this button again."):v.createElement(v.Fragment,null,this.props.shortURL&&"ERROR"!==this.props.shortURL?v.createElement("div",{key:this.props.shortURL},v.createElement("input",{defaultValue:this.props.shortURL,readOnly:!0,ref:this.shareInputElem}),v.createElement(Gt.Tooltip,{content:"Copy link to clipboard"},v.createElement(Zp,{text:this.props.shortURL},sa("",Ut.a.DUPLICATE,this.selectShareInputText)))):this.state.isLoading&&"ERROR"!==this.props.shortURL?v.createElement("div",null,v.createElement(Gt.NonIdealState,{description:"Generating Shareable Link...",icon:v.createElement(Gt.Spinner,{size:Gt.Spinner.SIZE_SMALL})})):v.createElement("div",null,e,"\xa0",v.createElement("input",{placeholder:"custom string (optional)",onChange:this.handleChange,style:{width:175}}),sa("Get Link",Ut.a.SHARE,()=>{this.props.handleShortenURL(this.state.keyword),this.setState({isLoading:!0})}))))}componentDidUpdate(e){this.props.shortURL!==e.shortURL&&this.setState({keyword:"",isLoading:!1})}toggleButton(){this.props.handleGenerateLz&&this.props.handleGenerateLz(),this.props.handleUpdateShortURL(""),this.setState({keyword:"",isLoading:!1})}handleChange(e){this.setState({keyword:e.currentTarget.value})}selectShareInputText(){null!==this.shareInputElem.current&&(this.shareInputElem.current.focus(),this.shareInputElem.current.select())}}class am extends v.Component{constructor(e){super(e),this.state={width:window._WIDTH,height:window._HEIGHT}}takePhotoA(){window.video.takePhotoA()}takePhotoB(){window.video.takePhotoB()}takePhotoC(){window.video.takePhotoC()}resetPhotoA(){window.resetPhotoA()}resetPhotoB(){window.resetPhotoB()}resetPhotoC(){window.resetPhotoC()}render(){return v.createElement("div",{className:"sa-video"},v.createElement("div",{className:"sa-video-element"},v.createElement("video",{id:"video",style:{position:"absolute"},autoPlay:!0,width:333,height:250}),v.createElement("canvas",{id:"canvas",style:{position:"relative",top:0,left:0},width:333,height:250})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-live-video-button",style:{height:20},icon:Ut.a.CAMERA,onClick:this.takePhotoA,text:"Take picture"})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-a",style:{height:30}})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-still-image-button",style:{height:20},icon:Ut.a.RESET,onClick:this.resetPhotoA,text:"Reset"}))),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-live-video-button",style:{height:20},icon:Ut.a.CAMERA,onClick:this.takePhotoB,text:"Take picture"})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-b",style:{height:20}})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-still-image-button",style:{height:20},icon:Ut.a.RESET,onClick:this.resetPhotoB,text:"Reset"}))),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-live-video-button",style:{height:20},icon:Ut.a.CAMERA,onClick:this.takePhotoC,text:"Take picture"})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-c",style:{height:20}})),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.Button,{className:"sa-still-image-button",style:{height:20},icon:Ut.a.RESET,onClick:this.resetPhotoC,text:"Reset"}))))}}var sm=am;const nm=()=>v.createElement("div",null,v.createElement("div",{id:"substituter-default-text",className:Gt.Classes.RUNNING_TEXT},"Welcome to the Stepper!",v.createElement("br",null),v.createElement("br",null),"On this tab, the REPL will be hidden from view, so do check that your code has no errors before running the stepper. You may use this tool by writing your program on the left, then dragging the slider above to see its evaluation.",v.createElement("br",null),v.createElement("br",null),"On even-numbered steps, the part of the program that will be evaluated next is highlighted in yellow. On odd-numbered steps, the result of the evaluation is highlighted in green.",v.createElement("br",null),v.createElement("br",null),v.createElement(Gt.Divider,null),"Some useful keyboard shortcuts:",v.createElement("br",null),v.createElement("br",null),sa("(Comma)",Ut.a.LESS_THAN),": Move to the first step",v.createElement("br",null),sa("(Period)",Ut.a.GREATER_THAN),": Move to the last step",v.createElement("br",null),v.createElement("br",null),"Note that the first and last step shortcuts are only active when the browser focus is on this panel (click on the slider or the text!).",v.createElement("br",null),v.createElement("br",null),"When the focus is on the slider, the arrow keys may also be used to move a single step.")),im={FIRST_STEP:",",LAST_STEP:"."},rm=e=>v.createElement(Gt.Card,null,v.createElement(Gt.Pre,{className:"resultOutput"},e.content));class om extends v.Component{constructor(e){super(e),this.getDiffMarkers=e=>{const t=e<=this.props.content.length?e-1:0,a=this.props.content[t],s=a.code,n=a.redex.split("\n"),i=[];if(n.length>0){const t=s.split("$");let a=t[0],r=a.split("\n"),o=r.length-1,l=r[o].length;for(let s=0;s<t.length-1;s++){const c=o+n.length-1,d=1===n.length?l+n[n.length-1].length:n[n.length-1].length;i.push({startRow:o,startCol:l,endRow:c,endCol:d,className:e%2===0?"beforeMarker":"afterMarker",type:"background"}),a=a+n+t[s+1],r=a.split("\n"),o=r.length-1,l=r[o].length}}return i},this.sliderShift=e=>{this.setState(t=>({value:e}))},this.stepFirst=()=>{this.sliderShift(1)},this.stepLast=e=>()=>{this.sliderShift(e)},this.state={value:1},Object(Ha.HighlightRulesSelector)(2),Object(Ha.ModeSelector)(2)}render(){const e=this.props.content.length,t=0!==e,a=t?{FIRST_STEP:this.stepFirst,LAST_STEP:this.stepLast(e)}:{FIRST_STEP:()=>{},LAST_STEP:()=>{}};return v.createElement(Xa.HotKeys,{keyMap:im,handlers:a},v.createElement("div",null,v.createElement("div",{className:"sa-substituter"},v.createElement(Gt.Slider,{disabled:!t,min:1,max:this.props.content.length,onChange:this.sliderShift,value:this.state.value<=e?this.state.value:1}),t?v.createElement(qa.a,{className:"react-ace",mode:"source2defaultNONE",theme:"source",fontSize:17,highlightActiveLine:!1,wrapEnabled:!0,height:"unset",width:"100%",showGutter:!1,readOnly:!0,maxLines:1/0,value:this.getText(this.state.value),markers:this.getDiffMarkers(this.state.value),setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"}}):v.createElement(nm,null),t?v.createElement(rm,{content:this.state.value<=e?this.props.content[this.state.value-1].explanation:this.props.content[0].explanation}):null)))}getText(e){const t=e<=this.props.content.length?e-1:0,a=this.props.content[t],s=a.code,n=a.redex,i=a.code.split("$");if(i.length>1){let e=i[0];for(let t=1;t<i.length;t++)e=e+n+i[t];return e}return s}}var lm=om;class cm extends v.Component{constructor(e){super(e),this.$video=null,this.$canvas=null,this.swapModes=e=>()=>{switch(e){case"video":this.setState(e=>({...e,mode:"still"}),this.handleSnapPicture);break;case"still":this.setState(e=>({...e,mode:"video"}),this.handleStartVideo)}},this.state={width:window._WIDTH,height:window._HEIGHT,mode:"video"},this.handleWidthChange=this.handleWidthChange.bind(this),this.handleHeightChange=this.handleHeightChange.bind(this)}componentDidMount(){this.$video&&this.$canvas&&window.VD.init(this.$video,this.$canvas)}componentWillUnmount(){window.VD.deinit()}handleStartVideo(){window.VD.handleStartVideo()}handleSnapPicture(){window.VD.handleSnapPicture()}handleCloseVideo(){window.VD.handleCloseVideo()}handleWidthChange(e){e>0&&(this.setState({width:e,height:this.state.height}),this.handleUpdateDimensions(e,this.state.height))}handleHeightChange(e){e>0&&(this.setState({width:this.state.width,height:e}),this.handleUpdateDimensions(this.state.width,e))}handleUpdateDimensions(e,t){window.VD.handleUpdateDimensions(e,t)}render(){const e="video"===this.state.mode,t="still"===this.state.mode;return v.createElement("div",{className:"sa-video"},v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Gt.ButtonGroup,null,v.createElement(Gt.Button,{className:"sa-live-video-button",icon:Ut.a.VIDEO,active:e,onClick:this.swapModes(this.state.mode),text:"Live Video"}),v.createElement(Gt.Button,{className:"sa-still-image-button",icon:Ut.a.CAMERA,active:t,onClick:t?this.handleSnapPicture:this.swapModes(this.state.mode),text:"Still Image"}))),v.createElement(Gt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("div",{className:"sa-video-header-numeric-input"},v.createElement(Gt.Tooltip,{content:"Change width"},v.createElement(Gt.NumericInput,{leftIcon:Ut.a.HORIZONTAL_DISTRIBUTION,style:{width:70},value:this.state.width,onValueChange:this.handleWidthChange,minorStepSize:1,stepSize:10,majorStepSize:100}))),v.createElement("div",{className:"sa-video-header-numeric-input"},v.createElement(Gt.Tooltip,{content:"Change height"},v.createElement(Gt.NumericInput,{leftIcon:Ut.a.VERTICAL_DISTRIBUTION,style:{width:70},value:this.state.height,onValueChange:this.handleHeightChange,minorStepSize:1,stepSize:10,majorStepSize:100}))))),v.createElement("div",{className:"sa-video-element"},v.createElement("video",{ref:e=>this.$video=e,style:{display:"none"},autoPlay:!0,width:window._WIDTH,height:window._HEIGHT}),v.createElement("canvas",{ref:e=>this.$canvas=e,width:window._WIDTH,height:window._HEIGHT})))}}var dm=cm;const um=`\nWelcome to the Source Academy playground!\n\nThe language [_Source_](${We.sourceDocs}) is the official language of the textbook [_Structure and\nInterpretation of Computer Programs, JavaScript Adaptation_](${We.textbook}). `,hm=`\n\nIn the editor on the left, you can use the [_Ace keyboard shortcuts_](${We.aceHotkeys}) \nand also the [_Source Academy keyboard shortcuts_](${We.sourceHotkeys}).\n\n`,pm=e=>um+(e=>{switch(e){case"1 default":return`You have chosen the sublanguage [_Source \xa71_](${We.source_1}).`;case"1 wasm":return`You have chosen the sublanguage [_Source \xa71 WebAssembly_](${We.source_1_Wasm}).`;case"1 lazy":return`You have chosen the sublanguage [_Source \xa71 Lazy_](${We.source_1_Lazy}).`;case"2 default":return`You have chosen the sublanguage [_Source \xa72_](${We.source_2}).`;case"2 lazy":return`You have chosen the sublanguage [_Source \xa72 Lazy_](${We.source_2_Lazy}).`;case"3 default":return`You have chosen the sublanguage [_Source \xa73_](${We.source_3}).`;case"3 non-det":return`You have chosen the sublanguage [_Source \xa73 Non-Det_](${We.source_3_Nondet}).`;case"3 concurrent":return`You have chosen the sublanguage [_Source \xa73 Concurrent_](${We.source_3_Concurrent}).`;case"4 default":return`You have chosen the sublanguage [_Source \xa74_](${We.source_4}).`;case"4 gpu":return`You have chosen the sublanguage [_Source \xa74 GPU_](${We.source_4_Gpu}).`;default:return"You have chosen an invalid sublanguage. Please pick a sublanguage from the dropdown instead."}})(e)+hm,mm=(e,t)=>pm(`${e} ${t}`),gm={goGreen:"h u l k"},ym={label:"Data Visualizer",iconName:Ut.a.EYE_OPEN,body:v.createElement(uu,null),id:T.dataVisualiser,toSpawn:()=>!0},Em={label:"Video Display",iconName:Ut.a.MOBILE_VIDEO,body:v.createElement(dm,null),toSpawn:()=>!0},bm={label:"Face API Display",iconName:Ut.a.MUGSHOT,body:v.createElement(sm,null),toSpawn:()=>!0},vm={label:"Inspector",iconName:Ut.a.SEARCH,body:v.createElement(cu,null),id:T.inspector,toSpawn:()=>!0},Sm={label:"Env Visualizer",iconName:Ut.a.GLOBE,body:v.createElement(ou,null),id:T.envVisualiser,toSpawn:()=>!0};var fm=e=>{const[t,a]=v.useState(new Date),[s,n]=v.useState(!1),[i,r]=v.useState(T.introduction),[o,l]=v.useState(!1),c=v.useMemo(()=>({goGreen:()=>n(!s)}),[s,n]),{handleEditorValueChange:d}=e,u=v.useCallback(e=>{a(new Date),d(e)},[d]),{handleUsingSubst:h,handleReplOutputClear:p,sourceChapter:m}=e,g=v.useCallback((e,t,a)=>{e!==t&&(m<=2&&e===T.substVisualizer&&h(!0),t!==T.substVisualizer||o||(p(),h(!1)),r(e))},[p,h,o,m]),y=e=>{const t=e[0];return t&&"result"===t.type&&t.value instanceof Array&&t.value[0]===Object(t.value[0])&&Object($p.isStepperOutput)(t.value[0])?t.value:[]},E=v.useMemo(()=>v.createElement(nu,{handleDebuggerPause:e.handleDebuggerPause,handleDebuggerReset:e.handleDebuggerReset,handleDebuggerResume:e.handleDebuggerResume,handleEditorEval:e.handleEditorEval,handleInterruptEval:e.handleInterruptEval,handleToggleEditorAutorun:e.handleToggleEditorAutorun,isDebugging:e.isDebugging,isEditorAutorun:e.isEditorAutorun,isRunning:e.isRunning,key:"autorun"}),[e.handleDebuggerPause,e.handleDebuggerReset,e.handleDebuggerResume,e.handleEditorEval,e.handleInterruptEval,e.handleToggleEditorAutorun,e.isDebugging,e.isEditorAutorun,e.isRunning]),{handleChapterSelect:b}=e,S=v.useCallback(({chapter:e,variant:t},a)=>{(e<=2&&o||i===T.substVisualizer)&&h(!0),e>2&&(p(),h(!1)),b(e,t)},[p,h,o,b,i]),f=v.useMemo(()=>v.createElement(ta,{handleChapterSelect:S,sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,key:"chapter"}),[S,e.sourceChapter,e.sourceVariant]),C=v.useMemo(()=>i===T.substVisualizer?null:v.createElement(na,{handleReplOutputClear:e.handleReplOutputClear,key:"clear_repl"}),[e.handleReplOutputClear,i]),w=v.useMemo(()=>i===T.substVisualizer?null:v.createElement(ia,{handleReplEval:e.handleReplEval,isRunning:e.isRunning,key:"eval_repl"}),[e.handleReplEval,e.isRunning,i]),{persistenceUser:A,persistenceFile:O,handlePersistenceUpdateFile:I}=e,k=O&&(!O.lastSaved||O.lastSaved<t),P=v.useMemo(()=>v.createElement(Jp,{currentFile:O,loggedInAs:A,isDirty:k,key:"googledrive",onClickSaveAs:e.handlePersistenceSaveFile,onClickOpen:e.handlePersistenceOpenPicker,onClickSave:O?()=>I(O):void 0,onClickLogOut:e.handlePersistenceLogOut,onPopoverOpening:e.handlePersistenceInitialise}),[A,O,k,e.handlePersistenceSaveFile,e.handlePersistenceOpenPicker,e.handlePersistenceLogOut,e.handlePersistenceInitialise,I]),{handleChangeExecTime:x,execTime:R}=e,N=v.useMemo(()=>v.createElement(Kp,{execTime:R,handleChangeExecTime:e=>x(e),key:"execution_time"}),[R,x]),{handleExternalSelect:M,externalLibraryName:_}=e,D=v.useMemo(()=>v.createElement(iu,{externalLibraryName:_,handleExternalSelect:({name:e},t)=>M(e),key:"external_library"}),[_,M]),L=v.useMemo(()=>v.createElement(em,{editorSessionId:e.editorSessionId,editorValue:e.editorValue,handleInitInvite:e.handleInitInvite,handleInvalidEditorSessionId:e.handleInvalidEditorSessionId,handleSetEditorSessionId:e.handleSetEditorSessionId,websocketStatus:e.websocketStatus,key:"session"}),[e.editorSessionId,e.editorValue,e.handleInitInvite,e.handleInvalidEditorSessionId,e.handleSetEditorSessionId,e.websocketStatus]),j=v.useMemo(()=>v.createElement(tm,{handleGenerateLz:e.handleGenerateLz,handleShortenURL:e.handleShortenURL,handleUpdateShortURL:e.handleUpdateShortURL,queryString:e.queryString,shortURL:e.shortURL,key:"share"}),[e.handleGenerateLz,e.handleShortenURL,e.handleUpdateShortURL,e.queryString,e.shortURL]),B=v.useMemo(()=>({label:"Introduction",iconName:Ut.a.COMPASS,body:v.createElement(ma,{content:mm(e.sourceChapter,e.sourceVariant),openLinksInNewWindow:!0}),id:T.introduction,toSpawn:()=>!0}),[e.sourceChapter,e.sourceVariant]),G=v.useMemo(()=>{const t=[B];return e.externalLibraryName!==yt.PIXNFLIX&&e.externalLibraryName!==yt.ALL||t.push(Em),e.externalLibraryName===yt.MACHINELEARNING&&t.push(bm),e.sourceChapter>=2&&t.push(ym),e.sourceChapter>=3&&"concurrent"!==e.sourceVariant&&"non-det"!==e.sourceVariant&&(t.push(vm),t.push(Sm)),e.sourceChapter<=2&&"wasm"!==e.sourceVariant&&t.push({label:"Stepper",iconName:Ut.a.FLOW_REVIEW,body:v.createElement(lm,{content:y(e.output)}),id:T.substVisualizer,toSpawn:()=>!0}),t},[B,e.externalLibraryName,e.output,e.sourceChapter,e.sourceVariant]),U={controlBarProps:{editorButtons:[E,j,f,"concurrent"!==e.sourceVariant?D:null,L,P,N],replButtons:["concurrent"!==e.sourceVariant?w:null,C]},editorProps:{sourceChapter:e.sourceChapter,externalLibraryName:e.externalLibraryName,sourceVariant:e.sourceVariant,editorValue:e.editorValue,editorSessionId:e.editorSessionId,handleDeclarationNavigate:e.handleDeclarationNavigate,handleEditorEval:e.handleEditorEval,handleEditorValueChange:u,handleSendReplInputToOutput:e.handleSendReplInputToOutput,handlePromptAutocomplete:e.handlePromptAutocomplete,handleFinishInvite:e.handleFinishInvite,sharedbAceInitValue:e.sharedbAceInitValue,sharedbAceIsInviting:e.sharedbAceIsInviting,isEditorAutorun:e.isEditorAutorun,breakpoints:e.breakpoints,highlightedLines:e.highlightedLines,newCursorPosition:e.newCursorPosition,handleEditorUpdateBreakpoints:t=>{const a=t.filter(e=>!!e).length;a>0&&(l(!0),e.sourceChapter<=2&&e.handleUsingSubst(!0)),0===a&&(l(!1),i!==T.substVisualizer&&(e.handleReplOutputClear(),e.handleUsingSubst(!1))),e.handleEditorUpdateBreakpoints(t)},handleSetWebsocketStatus:e.handleSetWebsocketStatus},editorHeight:e.editorHeight,editorWidth:e.editorWidth,handleEditorHeightChange:e.handleEditorHeightChange,handleEditorWidthChange:e.handleEditorWidthChange,handleSideContentHeightChange:e.handleSideContentHeightChange,replProps:{sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,output:e.output,replValue:e.replValue,handleBrowseHistoryDown:e.handleBrowseHistoryDown,handleBrowseHistoryUp:e.handleBrowseHistoryUp,handleReplEval:e.handleReplEval,handleReplValueChange:e.handleReplValueChange,hidden:i===T.substVisualizer,usingSubst:e.usingSubst},sideContentHeight:e.sideContentHeight,sideContentProps:{defaultSelectedTabId:i,handleActiveTabChange:e.handleActiveTabChange,onChange:g,tabs:G,workspaceLocation:"playground"},sideContentIsResizeable:i!==T.substVisualizer};return v.createElement(Xa.HotKeys,{className:Xt()("Playground",Gt.Classes.DARK,s?"GreenScreen":void 0),keyMap:gm,handlers:c},v.createElement(Is,U))};var Cm=Object(w.h)(Object(C.c)(e=>({editorSessionId:e.workspaces.playground.editorSessionId,editorWidth:e.workspaces.playground.editorWidth,editorValue:e.workspaces.playground.editorValue,execTime:e.workspaces.playground.execTime,isEditorAutorun:e.workspaces.playground.isEditorAutorun,breakpoints:e.workspaces.playground.breakpoints,highlightedLines:e.workspaces.playground.highlightedLines,isRunning:e.workspaces.playground.isRunning,isDebugging:e.workspaces.playground.isDebugging,enableDebugging:e.workspaces.playground.enableDebugging,newCursorPosition:e.workspaces.playground.newCursorPosition,output:e.workspaces.playground.output,queryString:e.playground.queryString,shortURL:e.playground.shortURL,replValue:e.workspaces.playground.replValue,sharedbAceIsInviting:e.workspaces.playground.sharedbAceIsInviting,sharedbAceInitValue:e.workspaces.playground.sharedbAceInitValue,sideContentHeight:e.workspaces.playground.sideContentHeight,sourceChapter:e.workspaces.playground.context.chapter,sourceVariant:e.workspaces.playground.context.variant,websocketStatus:e.workspaces.playground.websocketStatus,externalLibraryName:e.workspaces.playground.externalLibrary,usingSubst:e.playground.usingSubst,persistenceUser:e.session.googleUser,persistenceFile:e.playground.persistenceFile}),e=>Object(A.b)({handleActiveTabChange:e=>j(e,"playground"),handleBrowseHistoryDown:()=>I("playground"),handleBrowseHistoryUp:()=>k("playground"),handleChangeExecTime:e=>N(e.toString(),"playground"),handleChapterSelect:(e,t)=>_(e,t,"playground"),handleDeclarationNavigate:e=>Z("playground",e),handleEditorEval:()=>q("playground"),handleEditorValueChange:e=>z(e,"playground"),handleEditorHeightChange:e=>x(e,"playground"),handleEditorWidthChange:e=>R(e.toString(),"playground"),handleEditorUpdateBreakpoints:e=>Y(e,"playground"),handleFinishInvite:()=>xi("playground"),handleGenerateLz:qi,handleShortenURL:e=>Xi(e),handleUpdateShortURL:e=>Wi(e),handleInterruptEval:()=>nt("playground"),handleInvalidEditorSessionId:()=>Ni(),handleExternalSelect:e=>D(e,"playground"),handleInitInvite:e=>Ri(e,"playground"),handleReplEval:()=>X("playground"),handleReplOutputClear:()=>U("playground"),handleReplValueChange:e=>K(e,"playground"),handleSetEditorSessionId:e=>Mi("playground",e),handleSendReplInputToOutput:e=>Q(e,"playground"),handleSetWebsocketStatus:e=>_i("playground",e),handleSideContentHeightChange:e=>M(e,"playground"),handleToggleEditorAutorun:()=>L("playground"),handleUsingSubst:e=>zi(e),handleDebuggerPause:()=>rt("playground"),handleDebuggerResume:()=>lt("playground"),handleDebuggerReset:()=>ct("playground"),handleFetchChapter:oe,handlePromptAutocomplete:(e,t,a)=>de("playground",e,t,a),handlePersistenceOpenPicker:Ui,handlePersistenceSaveFile:Hi,handlePersistenceUpdateFile:Vi,handlePersistenceInitialise:Fi,handlePersistenceLogOut:Se},e))(fm));class wm extends v.Component{componentDidUpdate(e){const{inputToApply:t}=this.props;if(t&&t!==e.inputToApply)switch(t.type){case"activeTabChange":this.props.handleActiveTabChange(t.data);break;case"chapterSelect":this.props.handleChapterSelect(t.data);break;case"externalLibrarySelect":this.props.handleExternalSelect(t.data)}}render(){const e=v.createElement(nu,{handleDebuggerPause:this.props.handleDebuggerPause,handleDebuggerReset:this.props.handleDebuggerReset,handleDebuggerResume:this.props.handleDebuggerResume,handleEditorEval:this.props.handleEditorEval,handleInterruptEval:this.props.handleInterruptEval,handleToggleEditorAutorun:this.props.handleToggleEditorAutorun,isDebugging:this.props.isDebugging,isEditorAutorun:this.props.isEditorAutorun,isRunning:this.props.isRunning,key:"autorun"}),t=v.createElement(ta,{handleChapterSelect:({chapter:e},t)=>this.props.handleChapterSelect(e),sourceChapter:this.props.sourceChapter,sourceVariant:this.props.sourceVariant,key:"chapter"}),a=v.createElement(na,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),s=v.createElement(ia,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),n=v.createElement(iu,{externalLibraryName:this.props.externalLibraryName,handleExternalSelect:({name:e},t)=>this.props.handleExternalSelect(e),key:"external_library"}),i={codeDeltasToApply:this.props.codeDeltasToApply,editorReadonly:this.props.editorReadonly,editorValue:this.props.editorValue,editorSessionId:"",handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,isEditorAutorun:this.props.isEditorAutorun,inputToApply:this.props.inputToApply,isPlaying:this.props.playbackStatus===Ge.playing,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints},r={controlBarProps:{editorButtons:[e,t,n],replButtons:[s,a]},customEditor:v.createElement(yu,i),editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,replProps:{output:this.props.output,replValue:this.props.replValue,handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange},sideContentHeight:this.props.sideContentHeight,sideContentProps:{handleActiveTabChange:this.props.handleActiveTabChange,selectedTabId:this.props.sideContentActiveTab,tabs:[{label:"Sourcecast Table",iconName:Ut.a.COMPASS,body:v.createElement("div",null,v.createElement("span",{className:"Multi-line"},v.createElement(Gt.Pre,null,this.props.title?"Title: "+this.props.title+"\nDescription: "+this.props.description:Am)),v.createElement(Cu,{handleFetchSourcecastIndex:this.props.handleFetchSourcecastIndex,handleSetSourcecastData:this.props.handleSetSourcecastData,sourcecastIndex:this.props.sourcecastIndex})),id:T.introduction,toSpawn:()=>!0},Om,Tm,Im],workspaceLocation:"sourcecast"}},o={handleEditorValueChange:this.props.handleEditorValueChange,handlePromptAutocomplete:this.props.handlePromptAutocomplete,handleSetCurrentPlayerTime:this.props.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:this.props.handleSetCodeDeltasToApply,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleSetInputToApply:this.props.handleSetInputToApply,handleSetSourcecastDuration:this.props.handleSetSourcecastDuration,handleSetSourcecastStatus:this.props.handleSetSourcecastStatus,audioUrl:this.props.audioUrl,currentPlayerTime:this.props.currentPlayerTime,duration:this.props.playbackDuration,playbackData:this.props.playbackData,playbackStatus:this.props.playbackStatus,handleChapterSelect:this.props.handleChapterSelect,handleExternalSelect:this.props.handleExternalSelect};return v.createElement("div",{className:Xt()("Sourcecast",Gt.Classes.DARK)},v.createElement(pu,o),v.createElement(Is,r))}}const Am="Welcome to Sourcecast!",Om={label:"Data Visualizer",iconName:Ut.a.EYE_OPEN,body:v.createElement(uu,null),id:T.dataVisualiser,toSpawn:()=>!0},Tm={label:"Inspector",iconName:Ut.a.SEARCH,body:v.createElement(cu,null),id:T.inspector,toSpawn:()=>!0},Im={label:"Env Visualizer",iconName:Ut.a.GLOBE,body:v.createElement(ou,null),id:T.envVisualiser,toSpawn:()=>!0};var km=wm;var Pm=Object(C.c)(e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,title:e.workspaces.sourcecast.title,description:e.workspaces.sourcecast.description,editorReadonly:e.workspaces.sourcecast.editorReadonly,editorWidth:e.workspaces.sourcecast.editorWidth,editorValue:e.workspaces.sourcecast.editorValue,externalLibraryName:e.workspaces.sourcecast.externalLibrary,isEditorAutorun:e.workspaces.sourcecast.isEditorAutorun,inputToApply:e.workspaces.sourcecast.inputToApply,breakpoints:e.workspaces.sourcecast.breakpoints,highlightedLines:e.workspaces.sourcecast.highlightedLines,isRunning:e.workspaces.sourcecast.isRunning,isDebugging:e.workspaces.sourcecast.isDebugging,enableDebugging:e.workspaces.sourcecast.enableDebugging,newCursorPosition:e.workspaces.sourcecast.newCursorPosition,output:e.workspaces.sourcecast.output,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackData:e.workspaces.sourcecast.playbackData,playbackStatus:e.workspaces.sourcecast.playbackStatus,replValue:e.workspaces.sourcecast.replValue,sideContentActiveTab:e.workspaces.sourcecast.sideContentActiveTab,sideContentHeight:e.workspaces.sourcecast.sideContentHeight,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:e.workspaces.sourcecast.context.chapter,sourceVariant:e.workspaces.sourcecast.context.variant}),e=>Object(A.b)({handleActiveTabChange:e=>j(e,"sourcecast"),handleBrowseHistoryDown:()=>I("sourcecast"),handleBrowseHistoryUp:()=>k("sourcecast"),handleChapterSelect:e=>_(e,"default","sourcecast"),handleDeclarationNavigate:e=>Z("sourcecast",e),handleEditorEval:()=>q("sourcecast"),handleEditorValueChange:e=>z(e,"sourcecast"),handleEditorHeightChange:e=>x(e,"sourcecast"),handleEditorWidthChange:e=>R(e.toString(),"sourcecast"),handleEditorUpdateBreakpoints:e=>Y(e,"sourcecast"),handleExternalSelect:e=>D(e,"sourcecast"),handleFetchSourcecastIndex:()=>Ki("sourcecast"),handleInterruptEval:()=>nt("sourcecast"),handleReplEval:()=>X("sourcecast"),handleReplOutputClear:()=>U("sourcecast"),handleReplValueChange:e=>K(e,"sourcecast"),handleSetCurrentPlayerTime:e=>Zi(e,"sourcecast"),handleSetCodeDeltasToApply:e=>er(e,"sourcecast"),handleSetEditorReadonly:e=>se("sourcecast",e),handleSetInputToApply:e=>tr(e,"sourcecast"),handleSetSourcecastData:(e,t,a,s)=>ar(e,t,a,s,"sourcecast"),handleSetSourcecastDuration:e=>sr(e,"sourcecast"),handleSetSourcecastStatus:e=>nr(e,"sourcecast"),handleSideContentHeightChange:e=>M(e,"sourcecast"),handleToggleEditorAutorun:()=>L("sourcecast"),handleDebuggerPause:()=>rt("sourcecast"),handleDebuggerResume:()=>lt("sourcecast"),handleDebuggerReset:()=>ct("sourcecast"),handlePromptAutocomplete:(e,t,a)=>de("sourcecast",e,t,a)},e))(km);class xm extends v.Component{render(){const{item:e}=this.props,t=e.category!==Yt.Mission||e.maxGrade<=0&&0===e.grade,a=e.maxXp<=0&&0===e.xp,s=v.createElement("div",{className:"grade-details"},v.createElement("div",{className:"title"},"Grade"),v.createElement("div",{className:"value"},e.grade," / ",e.maxGrade),v.createElement(Gt.ProgressBar,{animate:!1,className:"value-bar"+this.props.parseColour(this.props.getFrac(e.grade,e.maxGrade)),stripes:!1,value:this.props.getFrac(e.grade,e.maxGrade)})),n=v.createElement("div",{className:"xp-details"},v.createElement("div",{className:"title"},"XP"),v.createElement("div",{className:"value"},e.xp," / ",e.maxXp),v.createElement(Gt.ProgressBar,{animate:!1,className:"value-bar"+this.props.parseColour(this.props.getFrac(e.xp,e.maxXp)),stripes:!1,value:this.props.getFrac(e.xp,e.maxXp)}));return v.createElement(Vt.a,{className:"profile-summary-navlink",key:`${e.title}-${e.id}`,target:"_blank",to:`/academy/${ja(e.category)}/${e.id}/0`,activeClassName:"profile-summary-navlink"},v.createElement(Gt.Callout,{className:"profile-summary-callout",key:`${e.title}-${e.id}`,icon:this.props.renderIcon(e.category),title:e.title},t?"":s,a?"":n))}}var Rm=xm;class Nm extends v.Component{componentDidMount(){this.props.name&&this.props.role&&!this.props.assessmentOverviews&&this.props.handleAssessmentOverviewFetch()}render(){let e;if(this.props.name&&this.props.role&&this.props.assessmentOverviews){const t=this.props.assessmentOverviews.filter(e=>e.status===Wt.submitted).length,a=v.createElement("div",{className:"profile-header"},v.createElement("div",{className:"profile-username"},v.createElement("div",{className:"name"},this.props.name),v.createElement("div",{className:"role"},this.props.role)));if(0===t)e=v.createElement("div",{className:"profile-content"},a,v.createElement("div",{className:"profile-placeholder"},"There are no closed assessments to render grade and XP of."));else{const[t,s,n,i]=this.props.assessmentOverviews.reduce((e,t)=>t.status===Wt.submitted?t.category===Yt.Mission&&t.gradingStatus===zt.graded?[e[0]+t.grade/t.maxGrade,e[1]+t.xp,e[2]+1,e[3]+t.maxXp]:[e[0],e[1]+t.xp,e[2],e[3]+t.maxXp]:e,[0,0,0,0]),r=(e,t)=>t<=0||e/t>1?1:e/t,o=e=>e<0?"":e>=.8?" progress-steelblue":e>=.45?" progress-deepskyblue":" progress-skyblue",l=e=>{switch(e){case Yt.Mission:return Ut.a.FLAME;case Yt.Sidequest:return Ut.a.LIGHTBULB;case Yt.Path:return Ut.a.PREDICTIVE_ANALYSIS;case Yt.Contest:return Ut.a.COMPARISON;default:return Ut.a.PULSE}},c=this.props.assessmentOverviews.filter(e=>e.status===Wt.submitted).map((e,t)=>v.createElement(Rm,{key:t,item:e,getFrac:r,parseColour:o,renderIcon:l}));e=v.createElement("div",{className:"profile-content"},a,v.createElement("div",{className:"profile-progress"},v.createElement("div",{className:"profile-grade"},v.createElement(Gt.Spinner,{className:"profile-spinner"+o(r(t,n)),size:144,value:r(t,n)}),v.createElement("div",{className:"type"},"Grade"),v.createElement("div",{className:"total-value"},t.toFixed(2)," / ",n.toFixed(2)),v.createElement("div",{className:"percentage"},(100*r(t,n)).toFixed(2),"%")),v.createElement("div",{className:"profile-xp"},v.createElement(Gt.Spinner,{className:"profile-spinner"+o(r(s,i)),size:144,value:r(s,i)}),v.createElement("div",{className:"type"},"XP"),v.createElement("div",{className:"total-value"},s," / ",i),v.createElement("div",{className:"percentage"},(100*r(s,i)).toFixed(2),"%"))),v.createElement("div",{className:"profile-callouts"},c))}}else e=v.createElement(Gt.NonIdealState,{description:"Loading...",icon:v.createElement(Gt.Spinner,null)});return v.createElement(Gt.Drawer,{className:"profile",icon:Ut.a.USER,isCloseButtonShown:!0,isOpen:this.props.isOpen,onClose:this.props.onClose,title:"User Profile",position:"left",size:"30%"},e)}}var Mm=Nm;var _m=Object(C.c)(e=>({assessmentOverviews:e.session.assessmentOverviews,name:e.session.name,role:e.session.role}),e=>Object(A.b)({handleAssessmentOverviewFetch:ye},e))(Mm);var Dm=e=>v.createElement(Gt.Dialog,{className:"about",icon:Ut.a.HELP,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"About"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement("div",{className:"abt"},v.createElement("p",null,"The ",v.createElement("i",null,"Source Academy")," is a computer-mediated learning environment for studying the structure and interpretation of computer programs. Students write and run their programs in their web browser, using sublanguages of JavaScript called"," ",v.createElement("a",{href:We.sourceDocs},"Source"),", designed for the textbook"," ",v.createElement("a",{href:We.textbook},"Structure and Interpretation of Computer Programs, JavaScript Adaptation"),"."),v.createElement("p",null,"The Source Academy is available under the Apache License 2.0 at our GitHub organisation,"," ",v.createElement("a",{href:We.githubOrg},"Source Academy"),". The National University of Singapore uses the Source Academy for teaching Programming Methodology to freshmen Computer Science students in the course ",v.createElement("a",{href:We.moduleDetails},"CS1101S"),"."))));var Lm=e=>v.createElement(Gt.Dialog,{className:"help",icon:Ut.a.ERROR,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"Help"},v.createElement("div",{className:Gt.Classes.DIALOG_BODY},v.createElement("p",null,"Please use the following resources when you encounter issues with this system."),v.createElement("p",null,"As of August 2020, we recommend the browsers ",v.createElement("b",null,"Google Chrome")," or ",v.createElement("b",null,"Microsoft Edge"),", Version 83 or higher, or ",v.createElement("b",null,"Mozilla Firefox"),", Version 78 or higher, to visit the Source Academy. If you encounter issues with the Source Academy using these browsers, please use the following resources."),v.createElement("ul",null,v.createElement("li",null,"For critical technical issues that seriously affect your learning experience, email the Technical Services of the NUS School of Computing at"," ",v.createElement("a",{href:We.techSVC},We.techSVC)," or call ",We.techSVCNumber,"."),v.createElement("li",null,"For non-critical technical issues, such as enhancement suggestions, please use the issue system of the ",v.createElement("a",{href:We.githubIssues},"Source Academy repositories on GitHub"),"."),v.createElement("li",null,"For issues related to the content of missions, quests, paths and contests, use the respective forum at ",v.createElement("a",{href:We.piazza}," piazza"),", or approach your Avenger, Reflection instructor or lecturer."))));class jm extends v.Component{constructor(e){super(e),this.toggleAboutOpen=()=>{this.setState({...this.state,isAboutOpen:!this.state.isAboutOpen})},this.toggleHelpOpen=()=>this.setState({...this.state,isHelpOpen:!this.state.isHelpOpen}),this.toggleProfileOpen=()=>this.setState({...this.state,isProfileOpen:!this.state.isProfileOpen}),this.state={isAboutOpen:!1,isHelpOpen:!1,isProfileOpen:!1}}render(){return v.createElement(v.Fragment,null,v.createElement(Gt.Popover,{content:this.menu(this.props),inheritDarkTheme:!1,position:Gt.Position.BOTTOM},sa("",Ut.a.CARET_DOWN)),v.createElement(Dm,{isOpen:this.state.isAboutOpen,onClose:this.toggleAboutOpen}),v.createElement(Lm,{isOpen:this.state.isHelpOpen,onClose:this.toggleHelpOpen}),this.props.name?v.createElement(_m,{isOpen:this.state.isProfileOpen,onClose:this.toggleProfileOpen}):null)}menu(e){const t=this.props.name?v.createElement(Gt.MenuItem,{icon:Ut.a.USER,onClick:this.toggleProfileOpen,text:Bm(this.props.name)}):null,a=this.props.name?v.createElement(Gt.MenuItem,{icon:Ut.a.LOG_OUT,text:"Logout",onClick:this.props.handleLogOut}):null;return v.createElement(Gt.Menu,null,t,v.createElement(Gt.MenuItem,{icon:Ut.a.HELP,onClick:this.toggleAboutOpen,text:"About"}),v.createElement(Gt.MenuItem,{icon:Ut.a.ERROR,onClick:this.toggleHelpOpen,text:"Help"}),a)}}const Bm=e=>e.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase());var Gm=jm;var Um=e=>v.createElement(Gt.Navbar,{className:Xt()("NavigationBar","primary-navbar",Gt.Classes.DARK)},v.createElement(Gt.NavbarGroup,{align:Gt.Alignment.LEFT},!ze.playgroundOnly&&v.createElement(v.Fragment,null,v.createElement(Vt.a,{activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL),to:"/academy"},v.createElement(Gt.Icon,{icon:Ut.a.SYMBOL_DIAMOND}),v.createElement(Gt.NavbarHeading,{className:"hidden-xs hidden-sm"},"Source Academy"))," ",v.createElement(Vt.a,{activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL),to:"/sourcecast"},v.createElement(Gt.Icon,{icon:Ut.a.MUSIC}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},"Sourcecast"))),v.createElement(Vt.a,{activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL),to:"/playground"},v.createElement(Gt.Icon,{icon:Ut.a.CODE}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},ze.playgroundOnly?"Source Academy Playground":"Playground"))),v.createElement(Gt.NavbarGroup,{align:Gt.Alignment.RIGHT},v.createElement(Vt.a,{activeClassName:Gt.Classes.ACTIVE,className:Xt()("NavigationBar__link",Gt.Classes.BUTTON,Gt.Classes.MINIMAL),to:"/contributors"},v.createElement(Gt.Icon,{icon:Ut.a.HEART}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},"Contributors")),v.createElement("div",{className:"visible-xs"},v.createElement(Gt.NavbarDivider,{className:"thin-divider"})),v.createElement("div",{className:"hidden-xs"},v.createElement(Gt.NavbarDivider,{className:"default-divider"})),v.createElement(Gm,{handleLogOut:e.handleLogOut,name:e.name}))),Vm=a(460);function Hm(e){const t=so.parse(e);for(const[a,s]of Object.entries(t))Object(Vm.isArray)(s)?t[a]=s.join(","):null===s&&delete t[a];return t}class Fm extends v.Component{constructor(...e){super(...e),this.redirectToPlayground=()=>v.createElement(w.b,{to:"/playground"}),this.redirectToAcademy=()=>v.createElement(w.b,{to:"/academy"})}componentDidMount(){Wm(this.props)}render(){return v.createElement("div",{className:"Application"},v.createElement(Um,{handleLogOut:this.props.handleLogOut,role:this.props.role,name:this.props.name,title:this.props.title}),v.createElement("div",{className:"Application__main"},ze.playgroundOnly?v.createElement(w.e,null,v.createElement(w.c,{path:"/playground",component:Cm}),v.createElement(w.c,{path:"/contributors",component:Bh}),v.createElement(w.c,{path:"/sourcecast",component:Pm}),v.createElement(w.c,{exact:!0,path:"/",render:this.redirectToPlayground}),v.createElement(w.c,{component:Yp})):v.createElement(w.e,null,v.createElement(w.c,{path:"/academy",component:qm(this.props)}),v.createElement(w.c,{path:"/mission-control/:assessmentId(-?\\d+)?/:questionId(\\d+)?",render:zm}),v.createElement(w.c,{path:"/playground",component:Cm}),v.createElement(w.c,{path:"/login",render:Xm(this.props)}),v.createElement(w.c,{path:"/contributors",component:Bh}),v.createElement(w.c,{path:"/sourcecast",component:Pm}),v.createElement(w.c,{exact:!0,path:"/",render:this.redirectToAcademy}),v.createElement(w.c,{component:Yp}))))}}const qm=e=>void 0===e.accessToken||void 0===e.role?()=>v.createElement(w.b,{to:"/login"}):()=>v.createElement(Ph,{accessToken:e.accessToken,role:e.role}),Xm=e=>()=>{const t=Hm(e.location.search);return v.createElement(Hh,{code:t.code,providerId:t.provider,providers:[...ze.authProviders.entries()].map(([e,{name:t}])=>({id:e,name:t}))})},Wm=e=>{const t=Ym(e),a=$m(e)||e.currentPlaygroundChapter,s=Km(e,a)||e.currentPlaygroundVariant,n=Qm(e)||e.currentExternalLibrary,i=Jm(e);t&&(e.handleEditorValueChange(t),e.handleEnsureLibrariesLoaded(),e.handleClearContext(a,s,n),e.handleExternalLibrarySelect(n),e.handleSetExecTime(i))},zm=e=>v.createElement(zp,null),Ym=e=>{const t=Hm(e.location.hash),a=void 0!==t.lz?t.lz:t.prgrm;return void 0!==a?Object(pe.decompressFromEncodedURIComponent)(a):void 0},$m=e=>Ba(Hm(e.location.hash).chap)||void 0,Km=(e,t)=>{const a=Hm(e.location.hash).variant,s=Tt.find(e=>e.chapter===t&&e.variant===a);return s?s.variant:"default"},Qm=e=>{const t=Hm(e.location.hash).ext||"";return Object.values(yt).find(e=>e===t)||yt.NONE},Jm=e=>{const t=Hm(e.location.hash).exec||"1000",a=Ba(t)||1e3;return""+(a<1e3?1e3:a)};var Zm=Fm;var eg=Object(w.h)(Object(C.c)(e=>({title:e.application.title,accessToken:e.session.accessToken,role:e.session.role,name:e.session.name,currentPlaygroundChapter:e.workspaces.playground.context.chapter,currentPlaygroundVariant:e.workspaces.playground.context.variant,currentExternalLibrary:e.workspaces.playground.externalLibrary}),e=>Object(A.b)({handleClearContext:(e,t,a)=>B({chapter:e,variant:t,external:{name:a,symbols:wt.get(a)},globals:[]},"playground"),handleEditorValueChange:e=>z(e,"playground"),handlePromptAutocomplete:(e,t,a)=>de("playground",e,t,a),handleEditorUpdateBreakpoints:e=>Y(e,"playground"),handleEnsureLibrariesLoaded:F,handleLogOut:he,handleExternalLibrarySelect:e=>D(e,"playground"),handleSetExecTime:e=>N(e,"playground")},e))(Zm));const tg=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ag(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const a=e.installing;null!=a&&(a.onstatechange=()=>{"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}ze.sentryDsn&&y.a({dsn:ze.sentryDsn});const sg=document.getElementById("root");window.__REDUX_STORE__=wo,console.log(`%c Source Academy ${ze.sourceAcademyVersion}; Please visit ${We.githubIssues} to report bugs or issues.`,"font-weight: bold;"),Object(b.setBackendStaticURL)(ze.moduleBackendUrl),console.log("Using module backend: "+ze.moduleBackendUrl),Object(f.render)(v.createElement(C.a,{store:wo},v.createElement(E.a,{history:Ra},v.createElement(eg,null))),sg),function(e){if("serviceWorker"in navigator){if(new URL("/cadet-frontend",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="/cadet-frontend/service-worker.js";tg?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(a=>{const s=a.headers.get("content-type");404===a.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):ag(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})):ag(t,e)})}}({onUpdate:()=>{_a("A new version of Source Academy is available. Please refresh the browser.",0)}})},316:function(e,t,a){e.exports=a.p+"static/media/default_cover_image.6f45c87a.jpg"},891:function(e,t,a){e.exports=a(2431)},892:function(e,t,a){},929:function(e,t){},931:function(e,t){}},[[891,1,2]]]);
//# sourceMappingURL=main.bb774f7f.chunk.js.map
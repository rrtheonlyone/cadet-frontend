(this["webpackJsonpcadet-frontend"]=this["webpackJsonpcadet-frontend"]||[]).push([[0],{2424:function(e,t,s){"use strict";s.r(t);var a={};s.r(a),s.d(a,"browseReplHistoryDown",(function(){return I})),s.d(a,"browseReplHistoryUp",(function(){return k})),s.d(a,"changeExternalLibrary",(function(){return P})),s.d(a,"changeEditorHeight",(function(){return x})),s.d(a,"changeEditorWidth",(function(){return N})),s.d(a,"changeExecTime",(function(){return R})),s.d(a,"changeSideContentHeight",(function(){return M})),s.d(a,"chapterSelect",(function(){return _})),s.d(a,"externalLibrarySelect",(function(){return D})),s.d(a,"toggleEditorAutorun",(function(){return L})),s.d(a,"updateActiveTab",(function(){return j})),s.d(a,"beginClearContext",(function(){return B})),s.d(a,"clearReplInput",(function(){return G})),s.d(a,"clearReplOutput",(function(){return U})),s.d(a,"clearReplOutputLast",(function(){return H})),s.d(a,"endClearContext",(function(){return V})),s.d(a,"ensureLibrariesLoaded",(function(){return F})),s.d(a,"evalEditor",(function(){return q})),s.d(a,"evalRepl",(function(){return X})),s.d(a,"evalTestcase",(function(){return W})),s.d(a,"updateEditorValue",(function(){return z})),s.d(a,"setEditorBreakpoint",(function(){return Y})),s.d(a,"highlightEditorLine",(function(){return $})),s.d(a,"updateReplValue",(function(){return K})),s.d(a,"sendReplInputToOutput",(function(){return Q})),s.d(a,"resetTestcase",(function(){return J})),s.d(a,"navigateToDeclaration",(function(){return Z})),s.d(a,"moveCursor",(function(){return ee})),s.d(a,"resetWorkspace",(function(){return te})),s.d(a,"updateWorkspace",(function(){return se})),s.d(a,"setEditorReadonly",(function(){return ae})),s.d(a,"updateCurrentAssessmentId",(function(){return ne})),s.d(a,"updateCurrentSubmissionId",(function(){return ie})),s.d(a,"updateHasUnsavedChanges",(function(){return re})),s.d(a,"fetchChapter",(function(){return oe})),s.d(a,"changeChapter",(function(){return le})),s.d(a,"updateChapter",(function(){return ce})),s.d(a,"promptAutocomplete",(function(){return de})),s.d(a,"notifyProgramEvaluated",(function(){return ue}));var n={};s.r(n),s.d(n,"logOut",(function(){return he}));var i={};s.r(i),s.d(i,"fetchAuth",(function(){return me})),s.d(i,"fetchAssessment",(function(){return ge})),s.d(i,"fetchAssessmentOverviews",(function(){return ye})),s.d(i,"fetchGrading",(function(){return Ee})),s.d(i,"fetchGradingOverviews",(function(){return be})),s.d(i,"login",(function(){return ve})),s.d(i,"logoutGoogle",(function(){return Se})),s.d(i,"setGameState",(function(){return fe})),s.d(i,"setTokens",(function(){return Ce})),s.d(i,"setUser",(function(){return Ae})),s.d(i,"setGoogleUser",(function(){return Oe})),s.d(i,"submitAnswer",(function(){return we})),s.d(i,"submitAssessment",(function(){return Te})),s.d(i,"submitGrading",(function(){return Ie})),s.d(i,"submitGradingAndContinue",(function(){return ke})),s.d(i,"updateHistoryHelpers",(function(){return Pe})),s.d(i,"updateAssessmentOverviews",(function(){return xe})),s.d(i,"updateAssessment",(function(){return Ne})),s.d(i,"updateGradingOverviews",(function(){return Re})),s.d(i,"updateGrading",(function(){return Me})),s.d(i,"unsubmitSubmission",(function(){return _e})),s.d(i,"fetchNotifications",(function(){return De})),s.d(i,"acknowledgeNotifications",(function(){return Le})),s.d(i,"updateNotifications",(function(){return je}));var r={};s.r(r),s.d(r,"handleConsoleLog",(function(){return Je})),s.d(r,"evalInterpreterSuccess",(function(){return Ze})),s.d(r,"evalTestcaseSuccess",(function(){return et})),s.d(r,"evalTestcaseFailure",(function(){return tt})),s.d(r,"evalInterpreterError",(function(){return st})),s.d(r,"beginInterruptExecution",(function(){return at})),s.d(r,"endInterruptExecution",(function(){return nt})),s.d(r,"beginDebuggerPause",(function(){return it})),s.d(r,"endDebuggerPause",(function(){return rt})),s.d(r,"debuggerResume",(function(){return ot})),s.d(r,"debuggerReset",(function(){return lt}));var o={};s.r(o),s.d(o,"fetchGroupGradingSummary",(function(){return Va})),s.d(o,"updateGroupGradingSummary",(function(){return Fa}));var l={};s.r(l),s.d(l,"finishInvite",(function(){return dr})),s.d(l,"initInvite",(function(){return ur})),s.d(l,"invalidEditorSessionId",(function(){return hr})),s.d(l,"setEditorSessionId",(function(){return pr})),s.d(l,"setWebsocketStatus",(function(){return mr}));var c={};s.r(c),s.d(c,"saveCanvas",(function(){return gr}));var d={};s.r(d),s.d(d,"changeDateAssessment",(function(){return yr})),s.d(d,"deleteAssessment",(function(){return Er})),s.d(d,"publishAssessment",(function(){return br})),s.d(d,"uploadAssessment",(function(){return vr}));var u={};s.r(u),s.d(u,"persistenceOpenPicker",(function(){return Sr})),s.d(u,"persistenceSaveFile",(function(){return fr})),s.d(u,"persistenceSaveFileAs",(function(){return Cr})),s.d(u,"persistenceInitialise",(function(){return Ar}));var h={};s.r(h),s.d(h,"generateLzString",(function(){return Or})),s.d(h,"shortenURL",(function(){return wr})),s.d(h,"updateShortURL",(function(){return Tr})),s.d(h,"toggleUsingSubst",(function(){return Ir})),s.d(h,"changeQueryString",(function(){return kr})),s.d(h,"playgroundUpdatePersistenceFile",(function(){return Pr}));var p={};s.r(p),s.d(p,"fetchSourcecastIndex",(function(){return xr})),s.d(p,"updateSourcecastIndex",(function(){return Nr}));var m={};s.r(m),s.d(m,"saveSourcecastData",(function(){return Rr})),s.d(m,"setCurrentPlayerTime",(function(){return Mr})),s.d(m,"setCodeDeltasToApply",(function(){return _r})),s.d(m,"setInputToApply",(function(){return Dr})),s.d(m,"setSourcecastData",(function(){return Lr})),s.d(m,"setSourcecastDuration",(function(){return jr})),s.d(m,"setSourcecastStatus",(function(){return Br}));var g={};s.r(g),s.d(g,"deleteSourcecastEntry",(function(){return Gr})),s.d(g,"recordInit",(function(){return Ur})),s.d(g,"recordInput",(function(){return Hr})),s.d(g,"resetInputs",(function(){return Vr})),s.d(g,"timerPause",(function(){return Fr})),s.d(g,"timerReset",(function(){return qr})),s.d(g,"timerResume",(function(){return Xr})),s.d(g,"timerStart",(function(){return Wr})),s.d(g,"timerStop",(function(){return zr}));s(885);var y=s(2430),E=s(232),b=s(289),v=s(0),S=s.n(v),f=s(38),C=s(20),A=s(15),O=s(21),w=s(10);let T;!function(e){e.autograder="autograder",e.briefing="briefing",e.dataVisualiser="data_visualiser",e.editorGrading="editor_grading",e.editorAutograder="editor_autograder",e.editorBriefing="editor_briefing",e.editorGlobalDeployment="editor_global_deployment",e.editorGlobalGraderDeployment="editor_global_grader_deployment",e.editorLocalDeployment="editor_local_deployment",e.editorLocalGraderDeployment="editor_local_grader_deployment",e.editorManageQuestion="editor_manage_question",e.editorQuestionOverview="editor_question_overview",e.editorQuestionTemplate="editor_question_template",e.envVisualiser="env_visualiser",e.grading="grading",e.introduction="introduction",e.inspector="inspector",e.questionOverview="question_overview",e.sourcereel="sourcereel",e.substVisualizer="subst_visualiser",e.toneMatrix="tone_matrix"}(T||(T={}));const I=e=>Object(w.action)("BROWSE_REPL_HISTORY_DOWN",{workspaceLocation:e}),k=e=>Object(w.action)("BROWSE_REPL_HISTORY_UP",{workspaceLocation:e}),P=(e,t)=>Object(w.action)("CHANGE_EXTERNAL_LIBRARY",{newExternal:e,workspaceLocation:t}),x=(e,t)=>Object(w.action)("CHANGE_EDITOR_HEIGHT",{height:e,workspaceLocation:t}),N=(e,t)=>Object(w.action)("CHANGE_EDITOR_WIDTH",{widthChange:e,workspaceLocation:t}),R=(e,t)=>Object(w.action)("CHANGE_EXEC_TIME",{execTime:e,workspaceLocation:t}),M=(e,t)=>Object(w.action)("CHANGE_SIDE_CONTENT_HEIGHT",{height:e,workspaceLocation:t}),_=(e,t,s)=>Object(w.action)("CHAPTER_SELECT",{chapter:e,variant:t,workspaceLocation:s}),D=(e,t)=>Object(w.action)("PLAYGROUND_EXTERNAL_SELECT ",{externalLibraryName:e,workspaceLocation:t}),L=e=>Object(w.action)("TOGGLE_EDITOR_AUTORUN",{workspaceLocation:e}),j=(e,t)=>Object(w.action)("UPDATE_ACTIVE_TAB",{activeTab:e,workspaceLocation:t}),B=(e,t)=>Object(w.action)("BEGIN_CLEAR_CONTEXT",{library:e,workspaceLocation:t}),G=e=>Object(w.action)("CLEAR_REPL_INPUT",{workspaceLocation:e}),U=e=>Object(w.action)("CLEAR_REPL_OUTPUT",{workspaceLocation:e}),H=e=>Object(w.action)("CLEAR_REPL_OUTPUT_LAST",{workspaceLocation:e}),V=(e,t)=>Object(w.action)("END_CLEAR_CONTEXT",{library:e,workspaceLocation:t}),F=()=>Object(w.action)("ENSURE_LIBRARIES_LOADED"),q=e=>Object(w.action)("EVAL_EDITOR",{workspaceLocation:e}),X=e=>Object(w.action)("EVAL_REPL",{workspaceLocation:e}),W=(e,t)=>Object(w.action)("EVAL_TESTCASE",{workspaceLocation:e,testcaseId:t}),z=(e,t)=>Object(w.action)("UPDATE_EDITOR_VALUE",{newEditorValue:e,workspaceLocation:t}),Y=(e,t)=>Object(w.action)("UPDATE_EDITOR_BREAKPOINTS",{breakpoints:e,workspaceLocation:t}),$=(e,t)=>Object(w.action)("HIGHLIGHT_LINE",{highlightedLines:e,workspaceLocation:t}),K=(e,t)=>Object(w.action)("UPDATE_REPL_VALUE",{newReplValue:e,workspaceLocation:t}),Q=(e,t)=>Object(w.action)("SEND_REPL_INPUT_TO_OUTPUT",{type:"code",workspaceLocation:t,value:e}),J=(e,t)=>Object(w.action)("RESET_TESTCASE",{workspaceLocation:e,index:t}),Z=(e,t)=>Object(w.action)("NAV_DECLARATION",{workspaceLocation:e,cursorPosition:t}),ee=(e,t)=>Object(w.action)("MOVE_CURSOR",{workspaceLocation:e,cursorPosition:t}),te=(e,t)=>Object(w.action)("RESET_WORKSPACE",{workspaceLocation:e,workspaceOptions:t}),se=(e,t)=>Object(w.action)("UPDATE_WORKSPACE",{workspaceLocation:e,workspaceOptions:t}),ae=(e,t)=>Object(w.action)("SET_EDITOR_READONLY",{workspaceLocation:e,editorReadonly:t}),ne=(e,t)=>Object(w.action)("UPDATE_CURRENT_ASSESSMENT_ID",{assessmentId:e,questionId:t}),ie=(e,t)=>Object(w.action)("UPDATE_CURRENT_SUBMISSION_ID",{submissionId:e,questionId:t}),re=(e,t)=>Object(w.action)("UPDATE_HAS_UNSAVED_CHANGES",{workspaceLocation:e,hasUnsavedChanges:t}),oe=()=>Object(w.action)("FETCH_CHAPTER"),le=(e,t)=>Object(w.action)("CHANGE_CHAPTER",{chapter:e,variant:t}),ce=(e,t)=>Object(w.action)("UPDATE_CHAPTER",{chapter:e,variant:t}),de=(e,t,s,a)=>Object(w.action)("PROMPT_AUTOCOMPLETE",{workspaceLocation:e,row:t,column:s,callback:a}),ue=(e,t,s,a,n)=>Object(w.action)("NOTIFY_PROGRAM_EVALUATED",{result:e,lastDebuggerResult:t,code:s,context:a,workspaceLocation:n}),he=()=>Object(w.action)("LOG_OUT");var pe=s(161);const me=(e,t)=>Object(w.action)("FETCH_AUTH",{code:e,providerId:t}),ge=e=>Object(w.action)("FETCH_ASSESSMENT",e),ye=()=>Object(w.action)("FETCH_ASSESSMENT_OVERVIEWS"),Ee=e=>Object(w.action)("FETCH_GRADING",e),be=(e=!0)=>Object(w.action)("FETCH_GRADING_OVERVIEWS",e),ve=e=>Object(w.action)("LOGIN",e),Se=()=>Object(w.action)("LOGOUT_GOOGLE"),fe=e=>Object(w.action)("SET_GAME_STATE",e),Ce=({accessToken:e,refreshToken:t})=>Object(w.action)("SET_TOKENS",{accessToken:e,refreshToken:t}),Ae=e=>Object(w.action)("SET_USER",e),Oe=e=>Object(w.action)("SET_GOOGLE_USER",e),we=(e,t)=>Object(w.action)("SUBMIT_ANSWER",{id:e,answer:t}),Te=e=>Object(w.action)("SUBMIT_ASSESSMENT",e),Ie=(e,t,s=0,a=0,n)=>Object(w.action)("SUBMIT_GRADING",{submissionId:e,questionId:t,gradeAdjustment:s,xpAdjustment:a,comments:n}),ke=(e,t,s=0,a=0,n)=>Object(w.action)("SUBMIT_GRADING_AND_CONTINUE",{submissionId:e,questionId:t,gradeAdjustment:s,xpAdjustment:a,comments:n}),Pe=e=>Object(w.action)("UPDATE_HISTORY_HELPERS",e),xe=e=>Object(w.action)("UPDATE_ASSESSMENT_OVERVIEWS",e),Ne=e=>Object(w.action)("UPDATE_ASSESSMENT",e),Re=e=>Object(w.action)("UPDATE_GRADING_OVERVIEWS",e),Me=(e,t)=>Object(w.action)("UPDATE_GRADING",{submissionId:e,grading:t}),_e=e=>Object(w.action)("UNSUBMIT_SUBMISSION",{submissionId:e}),De=()=>Object(w.action)("FETCH_NOTIFICATIONS"),Le=e=>Object(w.action)("ACKNOWLEDGE_NOTIFICATIONS",{withFilter:e}),je=e=>Object(w.action)("UPDATE_NOTIFICATIONS",e);let Be,Ge,Ue;function He(e){return"string"===typeof e&&"TRUE"===e.toUpperCase()}!function(e){e.run="run"}(Be||(Be={})),function(e){e.playing="playing",e.paused="paused"}(Ge||(Ge={})),function(e){e.notStarted="notStarted",e.recording="recording",e.paused="paused",e.finished="finished"}(Ue||(Ue={}));const Ve=He("FALSE"),Fe=He("TRUE"),qe=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""}).REACT_APP_SENTRY_DSN,Xe=new Map;for(let vm=1;;++vm){const e=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})["REACT_APP_OAUTH2_PROVIDER"+vm];if(!e)break;const t=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})[`REACT_APP_OAUTH2_PROVIDER${vm}_NAME`]||"Unnamed provider",s=Object({NODE_ENV:"production",PUBLIC_URL:"/cadet-frontend",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_VERSION:"rr_test",REACT_APP_BACKEND_URL:"http://localhost:4000",REACT_APP_USE_BACKEND:"FALSE",REACT_APP_PLAYGROUND_ONLY:"TRUE",REACT_APP_URL_SHORTENER_SIGNATURE:"",REACT_APP_URL_SHORTENER_DOMAIN:"",REACT_APP_OAUTH2_PROVIDER1:"test_admin",REACT_APP_OAUTH2_PROVIDER1_NAME:"Test login as admin",REACT_APP_OAUTH2_PROVIDER1_ENDPOINT:"http://localhost:8000/login?provider=test&code=admin_code",REACT_APP_OAUTH2_PROVIDER2:"test_staff",REACT_APP_OAUTH2_PROVIDER2_NAME:"Test login as staff",REACT_APP_OAUTH2_PROVIDER2_ENDPOINT:"http://localhost:8000/login?provider=test&code=staff_code",REACT_APP_OAUTH2_PROVIDER3:"test_student",REACT_APP_OAUTH2_PROVIDER3_NAME:"Test login as student",REACT_APP_OAUTH2_PROVIDER3_ENDPOINT:"http://localhost:8000/login?provider=test&code=student_code",REACT_APP_MODULE_BACKEND_URL:"https://source-academy.github.io/modules",REACT_APP_GOOGLE_CLIENT_ID:"",REACT_APP_GOOGLE_API_KEY:"",REACT_APP_GOOGLE_APP_ID:""})[`REACT_APP_OAUTH2_PROVIDER${vm}_ENDPOINT`]||"";Xe.set(e,{name:t,endpoint:s,isDefault:1===vm})}let We;!function(e){e.githubIssues="https://github.com/source-academy/cadet-frontend/issues",e.githubOrg="https://github.com/source-academy",e.moduleDetails="https://www.comp.nus.edu.sg/~cs1101s",e.luminus="https://luminus.nus.edu.sg/modules/41d42e9a-5880-43b5-8ee6-75f5a41355e3/announcements/active",e.piazza="https://piazza.com/class/kas136yscf8605",e.shareDBServer="api2.sourceacademy.nus.edu.sg/",e.sourceDocs="https://source-academy.github.io/source/",e.sourceDocsChapter2_2="https://source-academy.github.io/sicp/chapters/2.2.html",e.sourceDocsChapter3_2="https://source-academy.github.io/sicp/chapters/3.2.html",e.techSVC="mailto:techsvc@comp.nus.edu.sg",e.techSVCNumber="6516 2736",e.textbook="https://source-academy.github.io/sicp/",e.aceHotkeys="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts",e.sourceHotkeys="https://github.com/source-academy/cadet-frontend/wiki/Source-Academy-Keyboard-Shortcuts",e.source_1="https://source-academy.github.io/source/source_1/",e.source_1_Lazy="https://source-academy.github.io/source/source_1_lazy/",e.source_1_Wasm="https://source-academy.github.io/source/source_1_wasm/",e.source_2="https://source-academy.github.io/source/source_2/",e.source_2_Lazy="https://source-academy.github.io/source/source_2_lazy/",e.source_3="https://source-academy.github.io/source/source_1/",e.source_3_Concurrent="https://source-academy.github.io/source/source_3_concurrent/",e.source_3_Nondet="https://source-academy.github.io/source/source_3_non-det/",e.source_4="https://source-academy.github.io/source/source_4/",e.source_4_Gpu="https://source-academy.github.io/source/source_4_gpu/"}(We||(We={}));var ze={sourceAcademyVersion:"rr_test",backendUrl:"http://localhost:4000",useBackend:Ve,defaultSourceChapter:4,defaultSourceVariant:"default",defaultQuestionId:0,maxBrowseIndex:50,urlShortener:"",urlShortenerSignature:"",moduleBackendUrl:"https://source-academy.github.io/modules",authProviders:Xe,playgroundOnly:Fe,sentryDsn:qe,googleClientId:"",googleApiKey:"",googleAppId:""},Ye=s(142),$e=s.n(Ye),Ke=s(56),Qe=s(46);const Je=(e,t)=>Object(w.action)("HANDLE_CONSOLE_LOG",{logString:e,workspaceLocation:t}),Ze=(e,t)=>Object(w.action)("EVAL_INTERPRETER_SUCCESS",{type:"result",value:e,workspaceLocation:t}),et=(e,t,s)=>Object(w.action)("EVAL_TESTCASE_SUCCESS",{type:"result",value:e,workspaceLocation:t,index:s}),tt=(e,t,s)=>Object(w.action)("EVAL_TESTCASE_FAILURE",{type:"errors",value:e,workspaceLocation:t,index:s}),st=(e,t)=>Object(w.action)("EVAL_INTERPRETER_ERROR",{type:"errors",errors:e,workspaceLocation:t}),at=e=>Object(w.action)("BEGIN_INTERRUPT_EXECUTION",{workspaceLocation:e}),nt=e=>Object(w.action)("END_INTERRUPT_EXECUTION",{workspaceLocation:e}),it=e=>Object(w.action)("BEGIN_DEBUG_PAUSE",{workspaceLocation:e}),rt=e=>Object(w.action)("END_DEBUG_PAUSE",{workspaceLocation:e}),ot=e=>Object(w.action)("DEBUG_RESUME",{workspaceLocation:e}),lt=e=>Object(w.action)("DEBUG_RESET",{workspaceLocation:e});function ct(e){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.highlightClean(),window.Inspector.highlightLine(e)}function dt(e){if(!window.Inspector)throw new Error("Inspector not loaded");window.Inspector.updateContext(e,Ke.stringify)}const ut={display:function e(t,s,a){return e((void 0===s?"":s+" ")+Object(Ke.stringify)(t),"",a),t},rawDisplay:function(e,t,s){const a=(void 0===t?"":t+" ")+String(e);return"undefined"!==typeof window.__REDUX_STORE__&&window.__REDUX_STORE__.dispatch(Je(a,s)),e},prompt:function(e){return prompt(e)},alert:function(e){alert(Object(Ke.stringify)(e))},visualiseList:function(e){if(window.ListVisualizer)return window.ListVisualizer.draw(e),e;throw new Error("List visualizer is not enabled")}};function ht(e,t,s,a="default",n){return $e()(e,a,t,s,ut,n)}function pt(e){function t(){}t.prototype=e.runtime.environments[0].head;const s=new t,a=new Proxy(e.runtime.environments[0],{get:(e,t,a)=>"head"===t?s:e[t]}),n=new Proxy(e.runtime.environments,{get:(e,t,s)=>"0"===t?a:e[t]}),i=new Proxy(e.runtime,{get:(e,t,s)=>"environments"===t?n:e[t]}),r=new Proxy(e,{get(e,t,s){switch(t){case"chapter":return 4;case"runtime":return i;default:return e[t]}}});var o,l;return o=r,l=ut,Object(Ye.importBuiltins)(o,l),Object(Ye.defineBuiltin)(o,"makeUndefinedErrorFunction",e=>()=>{throw new Error(`Name ${e} not declared.`)}),r}function mt(e,t){const s=e.runtime.environments[0].head,a=t.runtime.environments[0].head;return Object(Qe.difference)(Object(Qe.keys)(s),Object(Qe.keys)(a))}let gt;!function(e){e.NONE="NONE",e.RUNES="RUNES",e.CURVES="CURVES",e.SOUNDS="SOUNDS",e.BINARYTREES="BINARYTREES",e.PIXNFLIX="PIX&FLIX",e.MACHINELEARNING="MACHINELEARNING",e.ALL="ALL"}(gt||(gt={}));const yt=["show","color","random_color","red","pink","purple","indigo","blue","green","yellow","orange","brown","black","white","scale_independent","scale","translate","rotate","stack_frac","stack","stackn","quarter_turn_right","quarter_turn_left","turn_upside_down","beside_frac","beside","flip_vert","flip_horiz","make_cross","repeat_pattern","square","blank","rcross","sail","corner","nova","circle","heart","pentagram","ribbon","anaglyph","overlay_frac","overlay","hollusion"],Et=["make_point","draw_points_on","draw_connected","draw_points_squeezed_to_window","draw_connected_squeezed_to_window","draw_connected_full_view","draw_connected_full_view_proportional","x_of","y_of","unit_line","unit_line_at","unit_circle","connect_rigidly","connect_ends","put_in_standard_position","translate","scale","rotate_pi_over_2","scale_x_y","gosperize","gosper_curve","show_connected_gosper","repeated","param_gosper","param_gosperize","rotate_around_origin","arc","invert","alternative_unit_circle","full_view_proportional","squeeze_full_view","squeeze_rectangular_portion"],bt=["make_sound","get_wave","get_duration","play","stop","consecutively","simultaneously","noise_sound","sine_sound","silence_sound","letter_name_to_midi_note","letter_name_to_frequency","midi_note_to_frequency","square_sound","triangle_sound","sawtooth_sound","play_unsafe","display_waveform","init_record","record","record_for","adsr","stacking_adsr","trombone","piano","bell","violin","cello"],vt=["make_empty_tree","is_tree","make_tree","is_empty_tree","entry","left_branch","right_branch"],St=["red_of","green_of","blue_of","set_rgb","copy_pixel","copy_image","constrain_color","compose_filter","make_distortion_filter","make_static_distortion_filter","pixel_similar","get_video_width","get_video_height","apply_filter","reset_filter"],ft=[[gt.NONE,[]],[gt.RUNES,yt],[gt.CURVES,Et],[gt.SOUNDS,bt],[gt.BINARYTREES,vt],[gt.PIXNFLIX,St],[gt.MACHINELEARNING,["init_webcam","train_recognition","load_faceapi","change_label","array_push","normalise_data"]],[gt.ALL,yt.concat(Et,bt,vt,St)]],Ct=new Map(ft);let At,Ot;!function(e){e.Development="development",e.Production="production",e.Test="test"}(At||(At={})),function(e){e.Student="student",e.Staff="staff",e.Admin="admin"}(Ot||(Ot={}));const wt=[{chapter:1,variant:"default"},{chapter:1,variant:"wasm"},{chapter:1,variant:"lazy"},{chapter:2,variant:"default"},{chapter:2,variant:"lazy"},{chapter:3,variant:"default"},{chapter:3,variant:"concurrent"},{chapter:3,variant:"non-det"},{chapter:4,variant:"default"},{chapter:4,variant:"gpu"}],Tt=new Map([["wasm","WebAssembly"],["non-det","Non-Det"],["concurrent","Concurrent"],["lazy","Lazy"],["gpu","GPU"]]),It=(e,t="default")=>{let s="Source \xa7"+e;return Tt.has(t)&&(s+=" "+Tt.get(t)),s},kt={gameCanvas:void 0},Pt={title:"Cadet",environment:At.Production},xt={gradingSummary:[]},Nt={usingSubst:!1},Rt=e=>({autogradingResults:[],breakpoints:[],context:ht(ze.defaultSourceChapter,[],e,ze.defaultSourceVariant),editorPrepend:"",editorSessionId:"",editorValue:"// Type your program in here!",editorPostpend:"",editorReadonly:!1,editorTestcases:[],editorHeight:150,editorWidth:"50%",externalLibrary:gt.NONE,execTime:1e3,highlightedLines:[],output:[],replHistory:{browseIndex:null,records:[],originalValue:""},replValue:"",sharedbAceInitValue:"",sharedbAceIsInviting:!1,sideContentActiveTab:T.questionOverview,websocketStatus:0,globals:[],isEditorAutorun:!1,isRunning:!1,isDebugging:!1,enableDebugging:!0,debuggerContext:{}}),Mt={assessment:{...Rt("assessment"),currentAssessment:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},grading:{...Rt("grading"),currentSubmission:void 0,currentQuestion:void 0,hasUnsavedChanges:!1},playground:{...Rt("playground"),usingSubst:!1},sourcecast:{...Rt("sourcecast"),audioUrl:"",codeDeltasToApply:null,currentPlayerTime:0,description:null,inputToApply:null,playbackData:{init:{editorValue:"",chapter:1,externalLibrary:gt.NONE},inputs:[]},playbackDuration:0,playbackStatus:Ge.paused,sourcecastIndex:null,title:null},sourcereel:{...Rt("sourcereel"),playbackData:{init:{editorValue:"",chapter:1,externalLibrary:gt.NONE},inputs:[]},recordingStatus:Ue.notStarted,timeElapsedBeforePause:0,timeResumed:0}},_t={accessToken:void 0,assessments:new Map,assessmentOverviews:void 0,grade:0,gradingOverviews:void 0,gradings:new Map,group:null,historyHelper:{lastAcademyLocations:[null,null],lastGeneralLocations:[null,null]},maxGrade:0,maxXp:0,refreshToken:void 0,role:void 0,name:void 0,story:{story:"",playStory:!1},gameState:{completed_quests:[],collectibles:{}},xp:0,notifications:[]},Dt={academy:kt,application:Pt,dashboard:xt,playground:Nt,session:_t,workspaces:Mt},Lt=(e=_t,t)=>{switch(t.type){case"LOG_OUT":return _t;case"SET_TOKENS":return{...e,accessToken:t.payload.accessToken,refreshToken:t.payload.refreshToken};case"SET_USER":return{...e,...t.payload};case"SET_GOOGLE_USER":return{...e,googleUser:t.payload};case"UPDATE_HISTORY_HELPERS":const s=e.historyHelper,a=null!=jt.exec(t.payload)?[s.lastAcademyLocations[1],t.payload]:[...s.lastAcademyLocations],n=[s.lastGeneralLocations[1],t.payload];return{...e,historyHelper:{lastAcademyLocations:a,lastGeneralLocations:n}};case"UPDATE_ASSESSMENT":const i=new Map(e.assessments);return i.set(t.payload.id,t.payload),{...e,assessments:i};case"UPDATE_ASSESSMENT_OVERVIEWS":return{...e,assessmentOverviews:t.payload};case"UPDATE_GRADING":const r=new Map(e.gradings);return r.set(t.payload.submissionId,t.payload.grading),{...e,gradings:r};case"UPDATE_GRADING_OVERVIEWS":return{...e,gradingOverviews:t.payload};case"UPDATE_NOTIFICATIONS":return{...e,notifications:t.payload};case"SET_GAME_STATE":return{...e,gameState:t.payload};default:return e}},jt=new RegExp("^/academy.*","i");var Bt=s(1),Gt=s(4),Ut=s(41),Ht=s(311),Vt=s.n(Ht),Ft=s(8),qt=s.n(Ft);let Xt,Wt,zt,Yt,$t;!function(e){e.attempting="attempting",e.attempted="attempted",e.not_attempted="not_attempted",e.submitted="submitted"}(Xt||(Xt={})),function(e){e.excluded="excluded",e.graded="graded",e.grading="grading",e.none="none"}(Wt||(Wt={})),function(e){e.Contest="Contest",e.Mission="Mission",e.Path="Path",e.Sidequest="Sidequest",e.Practical="Practical"}(zt||(zt={})),function(e){e.public="public",e.hidden="hidden",e.private="private"}(Yt||(Yt={})),function(e){e.programming="programming",e.mcq="mcq"}($t||($t={}));const Kt=()=>({category:zt.Mission,closeAt:"2100-12-01T00:00+08",coverImage:"https://fakeimg.pl/300/",grade:1,id:-1,maxGrade:0,maxXp:0,openAt:"2000-01-01T00:00+08",title:"Insert title here",reading:"",shortSummary:"Insert short summary here",status:Xt.not_attempted,story:"mission",xp:0,gradingStatus:"none"}),Qt=()=>({autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}),Jt=()=>({answer:3,roomId:null,content:"This is a mock MCQ question",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:2,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},type:"mcq",solution:0,xp:0,grade:0,maxGrade:0,maxXp:0});var Zt=s(2432);function es(e){const t=wt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:It(e.chapter,e.variant)})),s=({items:e,itemsParentRef:t,query:s,renderItem:a})=>{const n=e.filter(e=>"default"===e.variant).map(a),i=e.filter(e=>"default"!==e.variant).map(a);return v.createElement(Bt.Menu,{ulRef:t},n,v.createElement(Bt.MenuItem,{active:!1,key:"variant-menu",text:"Variant",icon:"cog"},i))},a=(e,{handleClick:t})=>v.createElement(Bt.MenuItem,{active:!1,key:e.chapter+e.variant,onClick:t,text:e.displayName}),n=Zt.a.ofType();return((e,i,r=((e,t)=>{}),o)=>v.createElement(n,{className:Bt.Classes.MINIMAL,items:t,onItemSelect:r,itemRenderer:a,itemListRenderer:s,filterable:!1,disabled:o||!1},((e,t,s)=>v.createElement("div",null,v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:It(e,t),rightIcon:s?null:Gt.a.DOUBLE_CARET_VERTICAL,disabled:s||!1})))(e,i,o)))(e.sourceChapter,e.sourceVariant,e.handleChapterSelect,e.disabled||!1)}const ts={className:"",fullWidth:!1,iconOnRight:!1,intent:Bt.Intent.NONE,minimal:!0};var ss=(e,t,s=null,a={},n=!1)=>{const i={...ts,...a},r={disabled:n};if(r.fill=void 0!==i.fullWidth&&i.fullWidth,r.intent=void 0===i.intent?Bt.Intent.NONE:i.intent,r.minimal=void 0!==i.minimal&&i.minimal,r.className=i.className,r.type=i.type,t){const e=v.createElement(Bt.Icon,{icon:t,color:i.iconColor?i.iconColor:void 0});i.iconOnRight?r.rightIcon=e:r.icon=e}return s&&(r.onClick=s),v.createElement(Bt.Button,r,e)};function as(e){return ss("Clear",Gt.a.REMOVE,e.handleReplOutputClear)}function ns(e){return e.isRunning?null:v.createElement(Bt.Tooltip,{content:"...or press shift-enter in the REPL"},ss("Eval",Gt.a.CODE,e.handleReplEval))}function is(e){return ss("Return to Academy",Gt.a.ARROW_RIGHT,e.onClick,{iconOnRight:!0})}function rs(e){return e.questionProgress[0]===e.questionProgress[1]?v.createElement(is,{onClick:e.onClickReturn,key:"return_to_academy"}):ss("Next",Gt.a.ARROW_RIGHT,e.onClickNext,{iconOnRight:!0})}function os(e){return e.questionProgress[0]<=1?null:ss("Previous",Gt.a.ARROW_LEFT,e.onClick)}function ls(e){return ss(`Question ${e.questionProgress[0]} of ${e.questionProgress[1]}  `,null,null,{},!0)}function cs(e){return ss("Reset",Gt.a.REPEAT,e.onClick)}function ds(e){return v.createElement(Bt.Tooltip,{content:"...or press shift-enter in the editor"},ss("Run",Gt.a.PLAY,e.handleEditorEval))}function us(e){const t=e.hasUnsavedChanges?{intent:Bt.Intent.WARNING,minimal:!1}:{};return ss("Save",Gt.a.FLOPPY_DISK,e.onClickSave,t)}var hs=s(852);var ps=v.memo(e=>{const t=new hs.Converter({tables:!0,simplifiedAutoLink:e.simplifiedAutoLink,strikethrough:e.strikethrough,tasklists:e.tasklists,openLinksInNewWindow:e.openLinksInNewWindow});return v.createElement("div",{className:qt()(e.className?e.className:"md",Bt.Classes.RUNNING_TEXT),dangerouslySetInnerHTML:{__html:t.makeHtml(e.content)}})}),ms=s(31);class gs extends v.Component{constructor(...e){super(...e),this.$parent=null}componentDidMount(){this.$parent.appendChild(this.props.canvas),this.props.canvas.hidden=!1}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:"canvas-container"})}}var ys=gs;class Es extends v.Component{constructor(...e){super(...e),this.evalSelf=()=>{this.props.handleTestcaseEval(this.props.index)}}render(){const e=void 0!==this.props.testcase.result||this.props.testcase.errors,t=Object(Ke.stringify)(this.props.testcase.result)===this.props.testcase.answer,s={correct:e&&t,wrong:e&&!t,private:this.props.testcase.type===Yt.private};return this.props.testcase.type===Yt.hidden?v.createElement("div",{className:qt()("AutograderCard",s)},v.createElement(Bt.Card,{className:"bp3-interactive",elevation:Bt.Elevation.ONE,onClick:this.evalSelf},v.createElement(Bt.Pre,{className:"testcase-placeholder"},"Hidden testcase"))):v.createElement("div",{className:qt()("AutograderCard",s)},v.createElement(Bt.Card,{className:Bt.Classes.INTERACTIVE,elevation:Bt.Elevation.ONE,onClick:this.evalSelf},v.createElement(Bt.Pre,{className:"testcase-program"},this.props.testcase.program),v.createElement(Bt.Pre,{className:"testcase-expected"},this.props.testcase.answer),v.createElement(Bt.Pre,{className:"testcase-actual"},this.props.testcase.errors?Object(ms.parseError)(this.props.testcase.errors):void 0!==this.props.testcase.result?(e=>{const t=window.ShapeDrawn;return"undefined"!==typeof t&&e instanceof t?v.createElement(ys,{canvas:e.$canvas}):Object(Ke.stringify)(e)})(this.props.testcase.result):"No Answer")))}}var bs=Es;class vs extends v.Component{render(){const e="pass"===this.props.result.resultType?" correct":" wrong";return v.createElement("div",{className:"ResultCard"+e},v.createElement(Bt.Card,{elevation:Bt.Elevation.ONE},v.createElement("div",{className:"result-data"},v.createElement("div",{className:"result-idx"},this.props.index+1),v.createElement("div",{className:"result-status"},this.props.result.resultType.toUpperCase())),v.createElement(Bt.Pre,{className:"result-expected"},this.props.result.expected),v.createElement(Bt.Pre,{className:"result-actual"},"error"===this.props.result.resultType?this.props.result.errors.map(e=>"timeout"===e.errorType?"Timeout: Submission exceeded time limit for this test case.":`Line ${e.line}: Error: ${e.errorExplanation}`).join("\n"):this.props.result.actual)))}}var Ss=vs;class fs extends v.Component{constructor(e){super(e),this.toggleTestcases=()=>this.setState({...this.state,showTestcases:!this.state.showTestcases}),this.toggleResults=()=>this.setState({...this.state,showResults:!this.state.showResults}),this.state={showTestcases:!0,showResults:!0}}render(){const e=v.createElement("div",{className:"testcases-header"},v.createElement("div",{className:"header-fn"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Testcase (click to run)"),v.createElement("div",{className:"header-expected"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Expected result"),v.createElement("div",{className:"header-actual"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Actual result")),t=v.createElement("div",{className:"results-header"},v.createElement("div",{className:"header-data"},v.createElement("div",{className:"header-sn"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"S/N"),v.createElement("div",{className:"header-status"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Testcase status")),v.createElement("div",{className:"header-expected"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Expected result"),v.createElement("div",{className:"header-actual"},v.createElement(Bt.Icon,{icon:Gt.a.CARET_DOWN}),"Actual result")),s=this.props.testcases.length>0?v.createElement("div",null,e,this.props.testcases.map((e,t)=>v.createElement(bs,{key:t,index:t,testcase:e,handleTestcaseEval:this.props.handleTestcaseEval}))):v.createElement("div",{className:"noResults"},"There are no testcases provided for this question."),a=this.props.autogradingResults.length>0?v.createElement("div",null,t,this.props.autogradingResults.map((e,t)=>v.createElement(Ss,{key:t,index:t,result:e}))):v.createElement("div",{className:"noResults"},"There are no results to show."),n=(e,t,s)=>ss(e,t?Gt.a.CARET_DOWN:Gt.a.CARET_RIGHT,s,{minimal:!0,className:"collapse-button"});return v.createElement("div",{className:"Autograder"},n("Testcases",this.state.showTestcases,this.toggleTestcases),v.createElement(Bt.Collapse,{isOpen:this.state.showTestcases},s),n("Autograder Results",this.state.showResults,this.toggleResults),v.createElement(Bt.Collapse,{isOpen:this.state.showResults},a))}}var Cs=fs;class As extends v.Component{constructor(...e){super(...e),this.$container=null}shouldComponentUpdate(){return!1}componentDidMount(){window.ToneMatrix&&window.ToneMatrix.initialise_matrix(this.$container)}handleClear(){window.ToneMatrix.clear_matrix()}handleRandomise(){window.ToneMatrix.randomise_matrix()}render(){return v.createElement("div",{className:"sa-tone-matrix"},v.createElement("div",{className:"row"},v.createElement("div",{className:qt()("controls","col-xs-12",Bt.Classes.DARK,Bt.Classes.BUTTON_GROUP)},v.createElement(Bt.Button,{id:"clear-matrix",onClick:this.handleClear},"Clear"),v.createElement(Bt.Button,{id:"randomise-matrix",onClick:this.handleRandomise},"Randomise"))),v.createElement("div",{className:"row"},v.createElement("div",{className:"col-xs-12",ref:e=>this.$container=e})))}}var Os=As,ws=s(191),Ts=s.n(ws);const Is=e=>{const t=Ts()(e),s=Ts()();return t.isBefore(s)},ks=e=>Ts()(e).format("Do MMMM, HH:mm");var Ps=s(78);const xs=Object(Ps.a)({basename:"/cadet-frontend"}),Ns=Bt.Toaster.create({position:Bt.Position.TOP}),Rs=(e,t=2e3,s)=>Ns.show({intent:Bt.Intent.SUCCESS,message:e,timeout:t},s),Ms=(e,t=2e3,s)=>Ns.show({intent:Bt.Intent.WARNING,message:e,timeout:t},s),_s=(e,t)=>Ns.show(e,t),Ds=e=>Ns.dismiss(e),Ls=e=>e===zt.Sidequest?"quests":e.toLowerCase().concat("s"),js=e=>{if(void 0===e)return null;const t=parseInt(e,10);return Number.isInteger(t)?t:null};var Bs=s(470);var Gs=function(e){return v.createElement("div",{className:"ControlBar"},v.createElement("div",{className:qt()("ControlBar_editor",Bt.Classes.BUTTON_GROUP)},e.editorButtons),e.flowButtons&&v.createElement("div",{className:qt()("ControlBar_flow",Bt.Classes.BUTTON_GROUP)},e.flowButtons),v.createElement("div",{className:qt()("ControlBar_repl",Bt.Classes.BUTTON_GROUP)},e.replButtons))},Us=s(227),Hs=(s(1e3),s(536),s(330),s(190)),Vs=s(105),Fs=s.n(Vs),qs=s(106),Xs=s(853),Ws=s.n(Xs);let zs,Ys;function $s(e,t,s,a){const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(n.readyState!==zs.DONE)return;if(n.status!==Ys.OK)return void a();JSON.parse(n.responseText).state?t():s()},n.open("GET","https://"+We.shareDBServer+"gists/"+e,!0),n.send()}!function(e){e[e.UNSENT=0]="UNSENT",e[e.OPENED=1]="OPENED",e[e.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",e[e.LOADING=3]="LOADING",e[e.DONE=4]="DONE"}(zs||(zs={})),function(e){e[e.OK=200]="OK",e[e.PAGE_NOT_FOUND=404]="PAGE_NOT_FOUND"}(Ys||(Ys={}));const Ks={};function Qs(e){return e.length<=25?e:e.substring(0,22)+"..."}for(const[vm,Sm]of Ct){const e=Sm.map(e=>e in ms.SourceDocumentation.ext_lib?{caption:Qs(e),value:e,meta:ms.SourceDocumentation.ext_lib[e].meta,docHTML:ms.SourceDocumentation.ext_lib[e].description}:{caption:Qs(e),value:e,meta:"const"});Ks[vm]=e}const Js={};Object.entries(ms.SourceDocumentation.builtins).forEach(e=>{const[t,s]=e;Js[t]=Object.entries(s).map(e=>{const[t,s]=e;return{caption:Qs(t),value:t,meta:s.meta,docHTML:s.description}})});const Zs={builtins:Js,externalLibraries:Ks},ea=window.ace,{Range:ta}=ea.acequire("ace/range");var sa=ta;class aa extends v.PureComponent{constructor(e){super(e),this.ShareAce=void 0,this.AceEditor=void 0,this.markerIds=void 0,this.onChangeMethod=void 0,this.completer=void 0,this.getMarkers=()=>{const e=[];for(const t of this.props.highlightedLines)e.push({startRow:t[0],startCol:0,endRow:t[1],endCol:1,className:"myMarker",type:"fullLine"});return e},this.chapterNo=()=>{let e=this.props.sourceChapter,t=this.props.sourceVariant,s=this.props.externalLibraryName;return void 0===e&&(e=1),void 0===t&&(t="default"),void 0===s&&(s="NONE"),Object(Hs.HighlightRulesSelector)(e,t,s,Zs.externalLibraries[s]),Object(Hs.ModeSelector)(e,t,s),"source"+e.toString()+t+s},this.moveCursor=e=>{this.AceEditor.current.editor.selection.clearSelection(),this.AceEditor.current.editor.moveCursorToPosition(e),this.AceEditor.current.editor.renderer.showCursor(),this.AceEditor.current.editor.renderer.scrollCursorIntoView(e,.5)},this.handleNavigate=()=>{const e=this.props.sourceChapter,t="default"===this.props.sourceVariant?"":"_"+this.props.sourceVariant,s=this.AceEditor.current.editor.selection.getCursor(),a=this.AceEditor.current.editor.session.getTokenAt(s.row,s.column),n=We.textbook,i=void 0===this.props.externalLibraryName?"NONE":this.props.externalLibraryName,r="ALL"===this.props.externalLibraryName?"External%20libraries":i,o=Zs.externalLibraries[i];this.props.handleDeclarationNavigate(this.AceEditor.current.editor.getCursorPosition());const l=this.AceEditor.current.editor.selection.getCursor();l.row===s.row&&l.column===s.column&&(Object(ms.hasDeclaration)(this.props.editorValue,Object(ms.createContext)(e),{line:l.row+1,column:l.column})||(o.some(e=>e.caption===(a&&a.value))?null!==a&&(/\bsupport.function\b/.test(a.type)||/\bbuiltinConsts\b/.test(a.type))&&window.open(`${n}source/${r}/global.html#${a.value}`):null!==a&&(/\bsupport.function\b/.test(a.type)||/\bbuiltinconsts\b/.test(a.type))&&window.open(`${n}source/source_${e}${t}/global.html#${a.value}`),null!==a&&/\bstorage.type\b/.test(a.type)&&window.open(`${n}source/source_${e}.pdf`)))},this.handleRefactor=()=>{const e=this.AceEditor.current.editor;if(!e)return;const t=this.props.editorValue,s=this.props.sourceChapter,a=e.getCursorPosition(),n=Object(ms.getAllOccurrencesInScope)(t,Object(ms.createContext)(s),{line:a.row+1,column:a.column}),i=e.getSelection();n.map(e=>new sa(e.start.line-1,e.start.column,e.end.line-1,e.end.column)).forEach(e=>i.addRange(e))},this.handleHighlightScope=()=>{const e=this.AceEditor.current.editor;if(!e)return;const t=this.props.editorValue,s=this.props.sourceChapter,a=e.getCursorPosition(),n=Object(ms.getScope)(t,Object(ms.createContext)(s),{line:a.row+1,column:a.column});0!==n.length&&n.forEach(t=>{this.markerIds.push(e.session.addMarker(new sa(t.start.line-1,t.start.column,t.end.line-1,t.end.column),"ace_selection","text"))})},this.handleVariableHighlighting=()=>{setTimeout(()=>{if(!this.AceEditor||!this.AceEditor.current||!this.AceEditor.current.editor)return;const e=this.AceEditor.current.editor,t=e.session,s=this.props.editorValue,a=this.props.sourceChapter,n=e.getCursorPosition();if(!t||!t.bgTokenizer)return;this.markerIds.forEach(e=>{t.removeMarker(e)});const i=Object(ms.getAllOccurrencesInScope)(s,Object(ms.createContext)(a),{line:n.row+1,column:n.column}).map(e=>new sa(e.start.line-1,e.start.column,e.end.line-1,e.end.column)),r=i.map(e=>t.addMarker(e,"ace_variable_highlighting","text"));this.markerIds=r},10)},this.handleTypeInferenceDisplay=()=>{const e=this.props.sourceChapter,t=this.props.editorValue,s=this.AceEditor.current.editor,a=s.getCursorPosition(),n=s.session.getTokenAt(a.row,a.column);let i;if(this.props.handleSendReplInputToOutput){if(a&&n){if("comment"===n.type)return;const s=Object(ms.getTypeInformation)(t,Object(ms.createContext)(e),{line:a.row+1,column:a.column},n.value);i=(e=>e.split("\n").filter(e=>""!==e).map(e=>"// "+e).join("\n"))(s),0===s.length&&(i="// type information not found")}else i="// invalid token. Please put cursor on an identifier.";this.props.handleSendReplInputToOutput(i)}},this.handleGutterClick=e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const s=e.getDocumentPosition().row,a=e.editor.session.getLine(s);void 0!==e.editor.session.getBreakpoints(s,0)[s]||0===a.length||a.includes("//")||a.includes("debugger;")?e.editor.session.clearBreakpoint(s):e.editor.session.setBreakpoint(s),e.stop(),this.props.handleEditorUpdateBreakpoints(e.editor.session.$breakpoints)},this.handleAnnotationChange=e=>()=>{const t=e.getAnnotations();let s=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",s++);0!==s&&e.setAnnotations(t)},this.handleStartCollabEditing=e=>{const t=new Ws.a(this.props.editorSessionId,{WsUrl:"wss://"+We.shareDBServer+"ws/",pluginWsUrl:null,namespace:"codepad"});this.ShareAce=t,t.on("ready",()=>{t.add(e,["code"],[]),this.props.sharedbAceIsInviting&&(this.props.handleEditorValueChange(this.props.sharedbAceInitValue),this.props.handleFinishInvite())});const s=t.WS,a=()=>{clearInterval(i),s.close()},n=()=>{s.reconnect()},i=setInterval(()=>{null!==this.ShareAce&&$s(this.props.editorSessionId,()=>{},a,n)},5e3);s.addEventListener("open",e=>{this.props.handleSetWebsocketStatus(1)}),s.addEventListener("close",e=>{this.props.handleSetWebsocketStatus(0)})},this.AceEditor=v.createRef(),this.ShareAce=null,this.markerIds=[],this.onChangeMethod=e=>{this.props.handleUpdateHasUnsavedChanges&&this.props.handleUpdateHasUnsavedChanges(!0),this.props.handleEditorValueChange(e),this.handleVariableHighlighting();const t=this.AceEditor.current.editor.getSession().getAnnotations();this.props.isEditorAutorun&&0===t.length&&this.props.handleEditorEval()},this.completer={getCompletions:(e,t,s,a,n)=>{a&&/\d/.test(a.charAt(0))?n():this.props.handlePromptAutocomplete(s.row+1,s.column,n)}}}getBreakpoints(){return this.AceEditor.current.editor.session.getBreakpoints().filter(e=>null!=e)}componentDidMount(){if(!this.AceEditor.current)return;const e=this.AceEditor.current.editor,t=e.getSession();e.on("gutterclick",this.handleGutterClick),t.on("changeAnnotation",this.handleAnnotationChange(t)),Object(Us.require)("ace/ext/language_tools").setCompleters([this.completer]),""!==this.props.editorSessionId&&this.handleStartCollabEditing(e),this.handleVariableHighlighting()}componentWillUnmount(){null!==this.ShareAce&&this.ShareAce.WS.close(),this.ShareAce=null}componentDidUpdate(e){const t=this.props.newCursorPosition;t&&t!==e.newCursorPosition&&this.moveCursor(t)}render(){return v.createElement(qs.HotKeys,{className:"Editor",handlers:na},v.createElement("div",{className:"row editor-react-ace"},v.createElement(Fs.a,{className:"react-ace",commands:[{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.props.handleEditorEval},{name:"navigate",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:this.handleNavigate},{name:"refactor",bindKey:{win:"Ctrl-M",mac:"Command-M"},exec:this.handleRefactor},{name:"highlightScope",bindKey:{win:"Ctrl-Shift-H",mac:"Command-Shift-H"},exec:this.handleHighlightScope},{name:"TypeInferenceDisplay",bindKey:{win:"Ctrl-Shift-M",mac:"Command-Shift-M"},exec:this.handleTypeInferenceDisplay}],editorProps:{$blockScrolling:1/0},ref:this.AceEditor,markers:this.getMarkers(),fontSize:17,height:"100%",highlightActiveLine:!1,mode:this.chapterNo(),onChange:this.onChangeMethod,onCursorChange:this.handleVariableHighlighting,theme:"source",value:this.props.editorValue,width:"100%",setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,fontFamily:"'Inconsolata', 'Consolas', monospace"}})))}}const na={goGreen:()=>{}};var ia=aa;class ra extends v.PureComponent{constructor(e){super(e),this.onButtonClickFactory=e=>t=>{e!==this.state.mcqOption&&(this.props.handleMCQSubmit(e),this.setState({mcqOption:e}));if(null!==this.props.mcq.solution&&this.props.mcq.choices[e].hint){const t=v.createElement(ps,{className:"markdown-notification",content:this.props.mcq.choices[e].hint});e===this.props.mcq.solution?Rs(t,4e3):Ms(t,4e3)}},this.getButtonIntent=(e,t,s)=>{const a=e===t,n=a&&null!==s&&e===s;return null===s?Bt.Intent.NONE:a&&n?Bt.Intent.SUCCESS:a&&!n?Bt.Intent.DANGER:Bt.Intent.NONE},this.state={mcqOption:e.mcq.answer}}render(){const e=this.props.mcq.choices.map((e,t)=>v.createElement(Bt.Button,{key:t,className:"mcq-option col-xs-12",active:t===this.state.mcqOption,intent:this.getButtonIntent(t,this.state.mcqOption,this.props.mcq.solution),onClick:this.onButtonClickFactory(t),minimal:!0},v.createElement(ps,{content:e.content})));return v.createElement("div",{className:"MCQChooser row"},v.createElement(Bt.Card,{className:"mcq-content-parent col-xs-12 middle-xs"},v.createElement("div",{className:"row mcq-options-parent between-xs"},e)))}}var oa=ra;class la extends v.PureComponent{constructor(e){super(e),this.replInputBottom=void 0,this.execBrowseHistoryDown=void 0,this.execBrowseHistoryUp=void 0,this.execEvaluate=void 0,this.execBrowseHistoryDown=e.handleBrowseHistoryDown,this.execBrowseHistoryUp=e.handleBrowseHistoryUp,this.execEvaluate=()=>{this.replInputBottom&&(this.replInputBottom.scrollIntoView(),this.props.handleReplEval())}}componentDidUpdate(){this.replInputBottom&&(this.replInputBottom.clientWidth>=window.innerWidth-50||this.replInputBottom.scrollIntoView())}render(){return v.createElement(v.Fragment,null,v.createElement(Fs.a,{className:"repl-react-ace react-ace",mode:`source${this.props.sourceChapter||1}defaultNONE`,theme:"source",height:"1px",width:"100%",value:this.props.replValue,onChange:this.props.handleReplValueChange,commands:[{name:"browseHistoryDown",bindKey:{win:"Down",mac:"Down"},exec:this.execBrowseHistoryDown},{name:"browseHistoryUp",bindKey:{win:"Up",mac:"Up"},exec:this.execBrowseHistoryUp},{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.execEvaluate}],minLines:1,maxLines:20,fontSize:17,highlightActiveLine:!1,showGutter:!1,showPrintMargin:!1,setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"}}),v.createElement("div",{className:"replInputBottom",ref:e=>this.replInputBottom=e}))}}var ca=la;class da extends v.PureComponent{constructor(e){super(e)}render(){const e=this.props.output.map((e,t)=>v.createElement(ua,{output:e,key:t,usingSubst:this.props.usingSubst||!1})),t=this.props;return v.createElement("div",{className:"Repl",style:{display:this.props.hidden?"none":void 0}},v.createElement("div",{className:"repl-output-parent"},e,v.createElement(qs.HotKeys,{className:qt()("repl-input-parent","row",Bt.Classes.CARD,Bt.Classes.ELEVATION_0),handlers:pa},"concurrent"!==this.props.sourceVariant?v.createElement(ca,t):null)))}}const ua=e=>{switch(e.output.type){case"code":return v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"codeOutput"},e.output.value));case"running":return v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")));case"result":return e.usingSubst&&e.output.value instanceof Array?v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"logOutput"},"Check out the substituter tab!")):0===e.output.consoleLogs.length?v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"resultOutput"},ha(e.output.value))):v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")),v.createElement(Bt.Pre,{className:"resultOutput"},ha(e.output.value)));case"errors":return 0===e.output.consoleLogs.length?v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"errorOutput"},Object(ms.parseError)(e.output.errors))):v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"logOutput"},e.output.consoleLogs.join("\n")),v.createElement("br",null),v.createElement(Bt.Pre,{className:"errorOutput"},Object(ms.parseError)(e.output.errors)));default:return v.createElement(Bt.Card,null,"''")}},ha=e=>{const t=window.ShapeDrawn;return"undefined"!==typeof t&&e instanceof t?v.createElement(ys,{canvas:e.$canvas}):Object(Ke.stringify)(e)},pa={goGreen:()=>{}};var ma=da;const ga=[],ya=new Map;var Ea=e=>{const{tabs:t,handleActiveTabChange:s,defaultSelectedTabId:a}=e,[n,i]=v.useState(t),r=Object(C.e)(e=>e.workspaces);let o;o=e.workspaceLocation?r[e.workspaceLocation].debuggerContext:{},v.useEffect(()=>{const e=t.concat((e=>{const t=ga.filter(t=>t.toSpawn(e));return e.workspaceLocation&&ya.set(e.workspaceLocation,t.map(e=>e.label)),t})(o));i(e)},[t,o]);const l=e=>{const t=c(e),s=document.getElementById(t);s&&s.classList.remove("side-content-tab-alert")},c=e=>e+"-icon",d=n.map(t=>((e,t)=>{const s=void 0===e.id?e.label:e.id,a=v.createElement(Bt.Tooltip,{content:e.label},v.createElement("div",{className:"side-content-tooltip",id:c(s)},v.createElement(Bt.Icon,{icon:e.iconName,iconSize:20}))),n=t?{...e.body,props:{...e.body.props,workspaceLocation:t}}:e.body,i=v.createElement("div",{className:"side-content-text"},n);return v.createElement(Bt.Tab,{key:s,id:s,title:a,panel:i,disabled:e.disabled,className:"side-content-tab"})})(t,e.workspaceLocation));return v.useEffect(()=>{s(a||t[0].id)},[a,s,t]),v.createElement("div",{className:"side-content"},v.createElement(Bt.Card,null,v.createElement("div",{className:"side-content-tabs"},v.createElement(Bt.Tabs,{id:"side-content-tabs",onChange:(t,s,a)=>{e.handleActiveTabChange(t),void 0===e.onChange||e.onChange(t,s,a),l(s)},defaultSelectedTabId:e.defaultSelectedTabId,renderActiveTabPanelOnly:e.renderActiveTabPanelOnly,selectedTabId:e.selectedTabId},d))))};class ba extends v.Component{constructor(e){super(e),this.editorDividerDiv=void 0,this.leftParentResizable=void 0,this.maxDividerHeight=void 0,this.sideDividerDiv=void 0,this.editorRef=void 0,this.toggleEditorDividerDisplay=(e,t,s)=>{const a=s.clientWidth/window.innerWidth*100;a>95?this.leftParentResizable.updateSize({width:"100%",height:"100%"}):a<2&&this.leftParentResizable.updateSize({width:"0%",height:"100%"}),this.editorDividerDiv.style.marginRight=a<2?"0.6rem":"0"},this.toggleDividerDisplay=(e,t,s)=>{this.maxDividerHeight=this.sideDividerDiv.clientHeight>this.maxDividerHeight?this.sideDividerDiv.clientHeight:this.maxDividerHeight;const a=s.clientHeight,n=s.parentNode.clientHeight;a+this.maxDividerHeight+2>n?this.sideDividerDiv.style.display="none":this.sideDividerDiv.style.display="initial"},this.createWorkspaceInput=e=>e.customEditor?e.customEditor:e.editorProps?v.createElement(ia,Object.assign({},e.editorProps,{key:e.editorProps.editorSessionId,ref:this.editorRef})):v.createElement(oa,e.mcqProps),this.editorRef=v.createRef()}componentDidMount(){this.maxDividerHeight=this.sideDividerDiv.clientHeight}render(){const e=v.createElement(Ea,this.props.sideContentProps),t=v.createElement(Bs.a,this.sideContentResizableProps(),e,v.createElement("div",{className:"side-content-divider",ref:e=>this.sideDividerDiv=e}));return v.createElement("div",{className:"workspace"},this.props.hasUnsavedChanges?v.createElement(A.a,{message:"You have changes that may not be saved. Are you sure you want to leave?"}):null,v.createElement(Gs,this.controlBarProps()),v.createElement("div",{className:"row workspace-parent"},v.createElement("div",{className:"editor-divider",ref:e=>this.editorDividerDiv=e}),v.createElement(Bs.a,this.editorResizableProps(),this.createWorkspaceInput(this.props)),v.createElement("div",{className:"right-parent"},void 0===this.props.sideContentIsResizeable||this.props.sideContentIsResizeable?t:e,v.createElement(ma,this.props.replProps))))}controlBarProps(){return{...this.props.controlBarProps}}editorResizableProps(){return{className:"resize-editor left-parent",enable:va,minWidth:0,onResize:this.toggleEditorDividerDisplay,onResizeStop:(e,t,s,a)=>this.props.handleEditorWidthChange(100*a.width/window.innerWidth),ref:e=>this.leftParentResizable=e,size:{width:this.props.editorWidth,height:"100%"},as:void 0}}sideContentResizableProps(){return{bounds:"parent",className:"resize-side-content",enable:Sa,onResize:this.toggleDividerDisplay,onResizeStop:(e,t,s,a)=>this.props.handleSideContentHeightChange(s.clientHeight),size:void 0===this.props.sideContentHeight?void 0:{height:this.props.sideContentHeight,width:"100%"}}}}const va={top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},Sa={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};var fa=ba;class Ca extends v.Component{render(){return v.createElement("div",{className:"GradingResult"},v.createElement("div",{className:"grading-result-table"},v.createElement(Bt.HTMLTable,null,v.createElement("tbody",null,v.createElement("tr",null,v.createElement("th",null,"Grade:"),v.createElement("td",null,v.createElement(Bt.Text,null,this.props.grade," / ",this.props.maxGrade))),v.createElement("tr",null,v.createElement("th",null,"XP:"),v.createElement("td",null,v.createElement(Bt.Text,null,this.props.xp," / ",this.props.maxXp))),v.createElement("tr",null,v.createElement("th",null,"Comments:"),v.createElement("td",null,!this.props.comments&&v.createElement(Bt.Text,null,"None"))))),this.props.comments&&v.createElement(Bt.HTMLTable,null,v.createElement("tbody",null,v.createElement("tr",null,v.createElement("td",null,v.createElement(Bt.Divider,null),v.createElement(ps,{content:this.props.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),v.createElement(Bt.Divider,null))))),v.createElement("br",null),v.createElement("div",{className:"grading-result-info"},v.createElement(Bt.Text,null,"Graded by ",v.createElement("b",null,this.props.graderName)," on ",ks(this.props.gradedAt)))))}}var Aa=Ca;class Oa extends v.Component{constructor(e){super(e),this.sideContentProps=(e,t)=>{const s=[{label:"Task "+(t+1),iconName:Gt.a.NINJA,body:v.createElement(ps,{content:e.assessment.questions[t].content}),id:T.questionOverview,toSpawn:()=>!0},{label:e.assessment.category+" Briefing",iconName:Gt.a.BRIEFCASE,body:v.createElement(ps,{content:e.assessment.longSummary}),id:T.briefing,toSpawn:()=>!0},{label:e.assessment.category+" Autograder",iconName:Gt.a.AIRPLANE,body:v.createElement(Cs,{testcases:e.editorTestcases,autogradingResults:e.autogradingResults,handleTestcaseEval:this.props.handleTestcaseEval}),id:T.autograder,toSpawn:()=>!0}],a=void 0!==e.assessment.questions[t].grader;a&&s.push({label:"Report Card",iconName:Gt.a.TICK,body:v.createElement(Aa,{graderName:e.assessment.questions[t].grader.name,gradedAt:e.assessment.questions[t].gradedAt,xp:e.assessment.questions[t].xp,grade:e.assessment.questions[t].grade,maxGrade:e.assessment.questions[t].maxGrade,maxXp:e.assessment.questions[t].maxXp,comments:e.assessment.questions[t].comments}),id:T.grading,toSpawn:()=>!0});return e.assessment.questions[t].library.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:Gt.a.GRID_VIEW,body:v.createElement(Os,null),id:T.toneMatrix,toSpawn:()=>!0}),{handleActiveTabChange:e.handleActiveTabChange,defaultSelectedTabId:a?T.grading:T.questionOverview,tabs:s,workspaceLocation:"assessment"}},this.controlBarProps=e=>{const t="/academy/"+Ls(this.props.assessment.category),s=t+"/"+this.props.assessment.id.toString(),a=[e+1,this.props.assessment.questions.length],n=()=>xs.push(s+"/"+(e+1).toString()),i=()=>xs.push(t),r=t=>()=>{const s=this.props.assessment.questions.filter(e=>null!==e.answer).length-1;if(e<s)return t();const a=this.props.assessment.questions[e];if(a.type===$t.mcq){if(a.answer!==a.solution)return Ms("Your MCQ solution is incorrect!",750)}else if(a.type===$t.programming){if(!this.props.editorTestcases.reduce((e,t)=>e&&Object(Ke.stringify)(t.result)===t.answer,!0))return Ms("Your solution has not passed all testcases!",750)}return t()},o=v.createElement(as,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),l=v.createElement(ns,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),c=v.createElement(rs,{onClickNext:this.props.assessment.category===zt.Path?r(n):n,onClickReturn:this.props.assessment.category===zt.Path?r(i):i,questionProgress:a,key:"next_question"}),d=v.createElement(os,{onClick:()=>xs.push(s+"/"+(e-1).toString()),questionProgress:a,key:"previous_question"}),u=v.createElement(ls,{questionProgress:a,key:"question_view"}),h=this.props.assessment.questions[e].type!==$t.mcq?v.createElement(cs,{onClick:()=>{this.setState({showResetTemplateOverlay:!0})},key:"reset_template"}):null;return{editorButtons:[v.createElement(ds,{handleEditorEval:this.props.handleEditorEval,key:"run"}),Is(this.props.closeDate)||this.props.assessment.questions[e].type===$t.mcq?null:v.createElement(us,{hasUnsavedChanges:this.props.hasUnsavedChanges,onClickSave:()=>this.props.handleSave(this.props.assessment.questions[e].id,this.props.editorValue),key:"save"}),h,v.createElement(es,{handleChapterSelect:()=>{},sourceChapter:this.props.assessment.questions[e].library.chapter,sourceVariant:ze.defaultSourceVariant,disabled:!0,key:"chapter"})],flowButtons:[d,u,c],replButtons:[l,o]}},this.state={showOverlay:!1,showResetTemplateOverlay:!1},this.props.handleEditorValueChange("")}componentDidMount(){if(this.props.handleAssessmentFetch(this.props.assessmentId),0===this.props.questionId&&this.props.notAttempted&&this.setState({showOverlay:!0}),!this.props.assessment)return;let e=this.props.questionId;this.props.questionId>=this.props.assessment.questions.length&&(e=this.props.assessment.questions.length-1);const t=this.props.assessment.questions[e];let s="";t.type===$t.programming&&(s=t.answer?t.answer:t.solutionTemplate),this.props.handleEditorValueChange(s)}componentDidUpdate(){this.checkWorkspaceReset(this.props)}render(){if(void 0===this.props.assessment||0===this.props.assessment.questions.length)return v.createElement(Bt.NonIdealState,{className:qt()("WorkspaceParent",Bt.Classes.DARK),description:"Getting mission ready...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})});const e=v.createElement(Bt.Dialog,{className:"assessment-briefing",isOpen:this.state.showOverlay},v.createElement(Bt.Card,null,v.createElement(ps,{content:this.props.assessment.longSummary}),v.createElement(Bt.Button,{className:"assessment-briefing-button",onClick:()=>this.setState({showOverlay:!1}),text:"Continue"}))),t=()=>this.setState({showResetTemplateOverlay:!1}),s=v.createElement(Bt.Dialog,{className:"assessment-reset",icon:Gt.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showResetTemplateOverlay,onClose:t,title:"Confirmation: Reset editor?"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement(ps,{content:"Are you sure you want to reset the template?"}),v.createElement(ps,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement(Bt.ButtonGroup,null,ss("Cancel",null,t,{minimal:!1}),ss("Confirm",null,()=>{t(),this.props.handleEditorValueChange(this.props.assessment.questions[a].solutionTemplate),this.props.handleUpdateHasUnsavedChanges(!0)},{minimal:!1,intent:Bt.Intent.DANGER})))),a=this.props.questionId>=this.props.assessment.questions.length?this.props.assessment.questions.length-1:this.props.questionId,n=this.props.assessment.questions[a],i={controlBarProps:this.controlBarProps(a),editorProps:n.type===$t.programming?{editorSessionId:"",editorValue:this.props.editorValue,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,handleUpdateHasUnsavedChanges:this.props.handleUpdateHasUnsavedChanges,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,hasUnsavedChanges:this.props.hasUnsavedChanges,mcqProps:{mcq:n,handleMCQSubmit:e=>this.props.handleSave(this.props.assessment.questions[a].id,e)},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,a),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:qt()("WorkspaceParent",Bt.Classes.DARK)},e,s,v.createElement(fa,i))}checkWorkspaceReset(e){if(void 0===this.props.assessment)return;const t=this.props.assessmentId,s=this.props.questionId;if(this.props.storedAssessmentId===t&&this.props.storedQuestionId===s)return;const a=this.props.assessment.questions[s];let n=[],i="",r="",o="",l=[];if(a.type===$t.programming){const e=a;n=e.autogradingResults,r=e.prepend,o=e.postpend,l=e.testcases,i=e.answer,i||(i=e.solutionTemplate)}this.props.handleEditorUpdateBreakpoints([]),this.props.handleUpdateCurrentAssessmentId(t,s),this.props.handleResetWorkspace({autogradingResults:n,editorPrepend:r,editorValue:i,editorPostpend:o,editorTestcases:l}),this.props.handleClearContext(a.library),this.props.handleUpdateHasUnsavedChanges(!1),i&&this.props.handleEditorValueChange(i)}}var wa=Oa;var Ta=Object(C.c)((e,t)=>({assessment:e.session.assessments.get(t.assessmentId),autogradingResults:e.workspaces.assessment.autogradingResults,editorPrepend:e.workspaces.assessment.editorPrepend,editorValue:e.workspaces.assessment.editorValue,editorPostpend:e.workspaces.assessment.editorPostpend,editorTestcases:e.workspaces.assessment.editorTestcases,editorHeight:e.workspaces.assessment.editorHeight,editorWidth:e.workspaces.assessment.editorWidth,breakpoints:e.workspaces.assessment.breakpoints,highlightedLines:e.workspaces.assessment.highlightedLines,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,newCursorPosition:e.workspaces.assessment.newCursorPosition,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion}),e=>Object(O.b)({handleActiveTabChange:e=>j(e,"assessment"),handleAssessmentFetch:ge,handleBrowseHistoryDown:()=>I("assessment"),handleBrowseHistoryUp:()=>k("assessment"),handleChapterSelect:(e,t)=>_(e,"default","assessment"),handleClearContext:e=>B(e,"assessment"),handleDeclarationNavigate:e=>Z("assessment",e),handleEditorEval:()=>q("assessment"),handleEditorValueChange:e=>z(e,"assessment"),handleEditorHeightChange:e=>x(e,"assessment"),handleEditorWidthChange:e=>N(e.toString(),"assessment"),handleEditorUpdateBreakpoints:e=>Y(e,"assessment"),handleInterruptEval:()=>at("assessment"),handleReplEval:()=>X("assessment"),handleReplOutputClear:()=>U("assessment"),handleReplValueChange:e=>K(e,"assessment"),handleResetWorkspace:e=>te("assessment",e),handleSave:we,handleSideContentHeightChange:e=>M(e,"assessment"),handleTestcaseEval:e=>W("assessment",e),handleUpdateHasUnsavedChanges:e=>re("assessment",e),handleUpdateCurrentAssessmentId:ne,handleDebuggerPause:()=>it("assessment"),handleDebuggerResume:()=>ot("assessment"),handleDebuggerReset:()=>lt("assessment"),handlePromptAutocomplete:(e,t,s)=>de("assessment",e,t,s)},e))(wa);class Ia extends v.Component{componentDidMount(){this.props.loadContentDispatch()}render(){return v.createElement("div",{className:"ContentDisplay row center-xs"},v.createElement("div",{className:(this.props.fullWidth?"col-xs-12":"col-xs-10")+" contentdisplay-content-parent"},v.createElement(Bt.Card,{className:"contentdisplay-content",elevation:Bt.Elevation.THREE},this.props.display)))}}var ka=Ia;function Pa(e){return t=>t.filter(t=>!t.submission_id&&t.assessment_id===e)}function xa(e){return t=>t.filter(t=>t.submission_id===e)}function Na(e){return t=>t.filter(t=>"Grading"===e?void 0!==t.submission_id:!t.submission_id&&e===t.assessment_type)}let Ra;!function(e){e.new="new",e.deadline="deadline",e.autograded="autograded",e.graded="graded",e.submitted="submitted",e.unsubmitted="unsubmitted",e.new_message="new_message"}(Ra||(Ra={}));const Ma=e=>{switch(e){case Ra.new:return"This assessment is new.";case Ra.deadline:return"This assessment is closing soon.";case Ra.autograded:return"This assessment has been autograded.";case Ra.submitted:return"This submission is new.";case Ra.unsubmitted:return"This assessment has been unsubmitted.";case Ra.graded:return"This assessment has been manually graded.";case Ra.new_message:return"There are new messages.";default:return"Unknown notification"}};var _a=e=>{const t=e.notificationFilter?e.notificationFilter(e.notifications):e.notifications;if(!t.length)return null;const s=v.createElement(Bt.Tag,{intent:Bt.Intent.DANGER,round:!0,large:e.large},t.length);if(!e.disableHover){const a=t=>v.createElement(Bt.Tag,{className:"row badge-tag",key:""+t.id,minimal:!0,multiline:!0,onRemove:()=>{return e.handleAcknowledgeNotifications((s=t.id,e=>e.filter(e=>e.id===s)));var s}},Ma(t.type)),n=v.createElement("div",{className:"col"},t.map(a));return v.createElement(Bt.Popover,{className:e.className,content:n,interactionKind:Bt.PopoverInteractionKind.HOVER,position:Bt.Position.RIGHT,hoverOpenDelay:50,hoverCloseDelay:50,lazy:!0},s)}return s};var Da=Object(C.c)(e=>({notifications:e.session.notifications}),e=>Object(O.b)({handleAcknowledgeNotifications:Le},e))(_a);class La extends v.Component{constructor(e){super(e),this.toggleClosedAssessments=()=>this.setState({...this.state,showClosedAssessments:!this.state.showClosedAssessments}),this.toggleOpenAssessments=()=>this.setState({...this.state,showOpenedAssessments:!this.state.showOpenedAssessments}),this.toggleUpcomingAssessments=()=>this.setState({...this.state,showUpcomingAssessments:!this.state.showUpcomingAssessments}),this.setBetchaAssessment=e=>this.setState({...this.state,betchaAssessment:e}),this.setBetchaAssessmentNull=()=>this.setBetchaAssessment(null),this.submitAssessment=()=>{this.state.betchaAssessment&&(this.props.handleSubmitAssessment(this.state.betchaAssessment.id),this.setBetchaAssessmentNull())},this.sortAssessments=e=>Object(Qe.sortBy)(e,[e=>-e.id]),this.makeSubmissionButton=(e,t)=>v.createElement(Bt.Button,{disabled:e.status!==Xt.attempted,icon:Gt.a.CONFIRM,intent:e.status===Xt.attempted?Bt.Intent.DANGER:Bt.Intent.NONE,minimal:!0,onClick:()=>this.setBetchaAssessment(e)},v.createElement("span",{className:"custom-hidden-xxxs"},"Finalize"),v.createElement("span",{className:"custom-hidden-xxs"}," Submission")),this.makeAssessmentInteractButton=e=>{let t,s,a="";switch(e.status){case Xt.not_attempted:t=Gt.a.PLAY,s="Attempt";break;case Xt.attempting:t=Gt.a.PLAY,s="Continue",a=" Attempt";break;case Xt.attempted:t=Gt.a.EDIT,s="Review",a=" Attempt";break;case Xt.submitted:t=Gt.a.EYE_OPEN,s="Review",a=" Submission";break;default:t=Gt.a.PLAY,s="Review"}return v.createElement(Ut.a,{to:`/academy/${Ls(e.category)}/${e.id.toString()}/${ze.defaultQuestionId}`},v.createElement(Bt.Button,{icon:t,minimal:!0,onClick:()=>this.props.handleAcknowledgeNotifications(Pa(e.id))},v.createElement("span",{className:"custom-hidden-xxxs"},s),v.createElement("span",{className:"custom-hidden-xxs"},a)))},this.makeOverviewCard=(e,t,s,a)=>v.createElement("div",{key:t},v.createElement(Bt.Card,{className:"row listing",elevation:Bt.Elevation.ONE},v.createElement("div",{className:"col-xs-3 listing-picture"},v.createElement(Da,{className:"badge",notificationFilter:Pa(e.id),large:!0}),v.createElement("img",{alt:"Assessment",className:"cover-image-"+e.status,src:e.coverImage?e.coverImage:Vt.a})),v.createElement("div",{className:"col-xs-9 listing-text"},this.makeOverviewCardTitle(e,t,a),v.createElement("div",{className:"listing-grade"},v.createElement(Bt.H6,null,Is(e.openAt)?`Grade: ${e.grade} / ${e.maxGrade}`:"Max Grade: "+e.maxGrade)),v.createElement("div",{className:"listing-xp"},v.createElement(Bt.H6,null,Is(e.openAt)?`XP: ${e.xp} / ${e.maxXp}`:"Max XP: "+e.maxXp)),v.createElement("div",{className:"listing-description"},v.createElement(ps,{content:e.shortSummary})),v.createElement("div",{className:"listing-footer"},v.createElement(Bt.Text,{className:"listing-due-date"},v.createElement(Bt.Icon,{className:"listing-due-icon",iconSize:12,icon:Gt.a.TIME}),Is(e.openAt)?"Due: "+ks(e.closeAt):"Opens at: "+ks(e.openAt)),v.createElement("div",{className:"listing-button"},s?this.makeAssessmentInteractButton(e):null))))),this.makeOverviewCardTitle=(e,t,s)=>v.createElement("div",{className:"listing-header"},v.createElement(Bt.Text,{ellipsize:!0},v.createElement(Bt.H4,{className:"listing-title"},e.title,e.private?v.createElement(Bt.Tooltip,{className:"listing-title-tooltip",content:"This assessment is password-protected."},v.createElement(Bt.Icon,{icon:"lock"})):null,s?ja(e.gradingStatus):null)),v.createElement("div",{className:"listing-button"},this.makeSubmissionButton(e,t))),this.state={betchaAssessment:null,showClosedAssessments:!1,showOpenedAssessments:!0,showUpcomingAssessments:!0}}render(){const{assessmentOverviews:e,isStudent:t}=this.props,s=js(this.props.match.params.assessmentId),a=js(this.props.match.params.questionId)||ze.defaultQuestionId;if(null!==s&&void 0!==e){const t=e.filter(e=>e.id===s)[0],n={assessmentId:s,questionId:a,notAttempted:t.status===Xt.not_attempted,closeDate:t.closeAt};return v.createElement(Ta,n)}let n;if(void 0===e)n=v.createElement(Bt.NonIdealState,{description:"Fetching assessment...",icon:v.createElement(Bt.Spinner,null)});else if(0===e.length)n=v.createElement(Bt.NonIdealState,{title:"There are no assessments.",icon:Gt.a.FLAME});else{const s=e=>!Is(e.closeAt)&&!Is(e.openAt),a=this.sortAssessments(e.filter(s)).map((e,s)=>this.makeOverviewCard(e,s,!t,!1)),i=e=>!Is(e.closeAt)&&Is(e.openAt)&&e.status!==Xt.submitted,r=this.sortAssessments(e.filter(e=>i(e))).map((e,t)=>this.makeOverviewCard(e,t,!0,!1)),o=this.sortAssessments(e.filter(e=>!i(e)&&!s(e))).map((e,t)=>this.makeOverviewCard(e,t,!0,!0)),l=v.createElement(v.Fragment,null,Ba("Upcoming",this.state.showUpcomingAssessments,this.toggleUpcomingAssessments),v.createElement(Bt.Collapse,{isOpen:this.state.showUpcomingAssessments},a)),c=v.createElement(v.Fragment,null,Ba("Open",this.state.showOpenedAssessments,this.toggleOpenAssessments),v.createElement(Bt.Collapse,{isOpen:this.state.showOpenedAssessments},r)),d=v.createElement(v.Fragment,null,Ba("Closed",this.state.showClosedAssessments,this.toggleClosedAssessments),v.createElement(Bt.Collapse,{isOpen:this.state.showClosedAssessments},o));n=v.createElement(v.Fragment,null,a.length>0?l:null,r.length>0?c:null,o.length>0?d:null)}const i=this.state.betchaAssessment?v.createElement("p",null,"You are about to finalise your submission for the"," ",this.state.betchaAssessment.category.toLowerCase()," ",v.createElement("i",null,'"',this.state.betchaAssessment.title,'"'),"."):v.createElement("p",null,"You are about to finalise your submission."),r=v.createElement(v.Fragment,null,i,v.createElement("p",null,"Early submissions grant you additional XP, but"," ",v.createElement("span",{className:"warning"},"this action is irreversible."))),o=v.createElement(Bt.Dialog,{className:"betcha-dialog",icon:Gt.a.ERROR,isCloseButtonShown:!0,isOpen:null!==this.state.betchaAssessment,onClose:this.setBetchaAssessmentNull,title:"Betcha: Early Submission"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement(Bt.Text,null,r)),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement(Bt.ButtonGroup,null,ss("Cancel",null,this.setBetchaAssessmentNull,{minimal:!1}),ss("Finalise Submission",null,this.submitAssessment,{minimal:!1,intent:Bt.Intent.DANGER}))));return v.createElement("div",{className:"Assessment"},v.createElement(ka,{display:n,loadContentDispatch:this.props.handleAssessmentOverviewFetch}),o)}}const ja=e=>{let t,s,a;switch(e){case Wt.graded:t=Gt.a.TICK,s=Bt.Intent.SUCCESS,a="Fully graded";break;case Wt.grading:t=Gt.a.TIME,s=Bt.Intent.WARNING,a="Grading in progress";break;case Wt.none:t=Gt.a.CROSS,s=Bt.Intent.DANGER,a="Not graded yet";break;default:t=Gt.a.DISABLE,s=Bt.Intent.PRIMARY,a="Not applicable"}return v.createElement(Bt.Tooltip,{className:"listing-title-tooltip",content:a,position:Bt.Position.RIGHT},v.createElement(Bt.Icon,{icon:t,intent:s}))},Ba=(e,t,s)=>ss(e,t?Gt.a.CARET_DOWN:Gt.a.CARET_RIGHT,s,{minimal:!0,className:"collapse-button"});var Ga=La;var Ua=Object(A.h)(Object(C.c)((e,t)=>({assessmentOverviews:e.session.assessmentOverviews?e.session.assessmentOverviews.filter(e=>e.category===t.assessmentCategory):void 0,isStudent:!e.session.role||e.session.role===Ot.Student}),e=>Object(O.b)({handleAcknowledgeNotifications:Le,handleAssessmentOverviewFetch:ye,handleSubmitAssessment:Te},e))(Ga));const Ha=":assessmentId(\\d+)?/:questionId(\\d+)?",Va=()=>Object(w.action)("FETCH_GROUP_GRADING_SUMMARY"),Fa=e=>Object(w.action)("UPDATE_GROUP_GRADING_SUMMARY",e);s(240),s(332);var qa=s(143);class Xa extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFetchGradingSummary=()=>{this.props.handleFetchGradingSummary()},this.onGridReady=e=>{this.gridApi=e.api},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.columnDefs=[{headerName:"Group",field:"groupName",width:80,sort:"asc"},{headerName:"Avenger",field:"leaderName"},{headerName:"Ungraded Missions",field:"ungradedMissions"},{headerName:"Submitted Missions",field:"submittedMissions"},{headerName:"Ungraded Quests",field:"ungradedSidequests"},{headerName:"Submitted Quests",field:"submittedSidequests"}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidUpdate(e){this.gridApi&&this.props.gradingSummary.length!==e.gradingSummary.length&&this.gridApi.setRowData(this.props.gradingSummary)}render(){const e=v.createElement("div",{className:"GradingContainer"},v.createElement("div",{className:"Grading ag-grid-parent ag-theme-balham"},v.createElement(qa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onFirstDataRendered:this.resizeGrid,onGridSizeChanged:this.resizeGrid,rowData:this.props.gradingSummary,rowHeight:30,suppressMovableColumns:!0})));return v.createElement("div",null,v.createElement(ka,{display:e,loadContentDispatch:this.handleFetchGradingSummary}))}}var Wa=Xa;var za=Object(C.c)(e=>({gradingSummary:e.dashboard.gradingSummary}),e=>Object(O.b)({handleFetchGradingSummary:Va},e))(Wa),Ya=s(127),$a=s.n(Ya);var Ka={zektonFont:{key:"zekton",pngPath:"../assets/zekton.png",fntPath:"../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../assets/alien_and_cows.png",fntPath:"../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../assets/alien_league.png",fntPath:"../assets/alien_league.fnt"}};const Qa={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},Ja=Qe.mapValues(Qa,e=>parseInt(e.slice(1),16));function Za({numOfItems:e,maxXSpace:t=sn.x,maxYSpace:s=sn.y,numItemLimit:a=0,redistributeLast:n=!0}){const i=new Array,r=a?Math.ceil(e/a):1,o=a||e,l=t/o,c=s/r,d=n?t/(e%o||o):l;for(let u=0;u<e;u++){const e=u%o,a=Math.floor(u/o)%r,n=e===r-1?(sn.x-t+d)/2+e*d:(sn.x-t+l)/2+e*l,h=(sn.y-s+c)/2+a*c;i.push([n,h])}return i}function en({numOfItems:e,xSpacing:t=30,ySpacing:s=30}){const a=new Array;for(let n=0;n<e;n++)a.push([n*t,n*s]);return a}const tn={repoAssetsFolder:"../assets",assetsFolder:"https://s3-ap-southeast-1.amazonaws.com/source-academy-assets",fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popupDuration:1e3,defaultAssetPath:"/UI/wristDeviceButton.png",defaultFontStyle:{key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER}},sn={x:1920,y:1080},an={x:sn.x/2,y:sn.y/2};function nn(e){return new Promise(t=>setTimeout(t,e))}function rn(e,t){const s=new Map;return e.forEach((e,a)=>{const n=t(e,a);s.set(a,n)}),s}function on(e,t,s){return Math.min(Math.max(e,t),s)}function ln(e){return tn.assetsFolder+e}function cn(e){if(!e)throw new Error("Object not found");return e}var dn={shortButton:{key:"short-button",path:"/ui/shortButton.png"},mediumButton:{key:"med-button",path:"/ui/mediumButton.png"},longButton:{key:"long-button",path:"/ui/longButton.png"},topButton:{key:"top-button",path:"/ui/topButton.png"},speechBox:{key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{key:"medium-box",path:"/ui/mediumBox.png"},diamond:{key:"diamond",path:"/ui/zircon.png"},arrow:{key:"arrow",path:"/ui/arrow.png"},cookies:{key:"cookies",path:"/images/cookies.png"},escapeMenuBackground:{key:"escape-bg",path:"/ui/escapeMenu.png"},collectiblesMenu:{key:"collect-bg",path:"/ui/collectiblesBg.png"},collectiblesBanner:{key:"collect-banner",path:"/ui/collectiblesBanner.png"},collectiblesPageChosen:{key:"collect-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},collectiblesPage:{key:"collect-pg-opt",path:"/ui/collectiblesPageOpt.png"},chapterSelectBackground:{key:"chapter-select-bg",path:"/locations/yourRoom-dim/normal.png"},chapterRepeatButton:{key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{key:"chapter-continue",path:"/ui/chapterContinue.png"},chapterSelectFrame:{key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuBackground:{key:"main-menu-bg",path:"/locations/yourRoom-dim/normal.png"},mainMenuOptBanner:{key:"menu-option",path:"/ui/menuOption.png"},settingBackground:{key:"setting-bg",path:"/locations/yourRoom-dim/normal.png"},settingBanner:{key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{key:"settings-opt",path:"/ui/settingsOption.png"}};const un={volume:0,ease:"Power2"};let hn;!function(e){e[e.SFX=0]="SFX",e[e.BGM=1]="BGM"}(hn||(hn={}));var pn={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.5},soundType:hn.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.5},soundType:hn.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.5,loop:!0},soundType:hn.BGM}};const mn=(e,t,s,a,n)=>new Phaser.GameObjects.BitmapText(e,s,a,n.key,t,n.size,n.align).setTintFill(n.fill);function gn(e,{assetKey:t,message:s="",textConfig:a={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:n=tn.defaultFontStyle,onDown:i=tn.nullFunction,onUp:r=tn.nullFunction,onHover:o=tn.nullFunction,onOut:l=tn.nullFunction,onHoverEffect:c=!0,onClickSound:d=pn.buttonClick.key,onHoverSound:u=pn.buttonHover.key},h){const p=new Phaser.GameObjects.Container(e,0,0),{x:m,y:g,oriX:y,oriY:E}=a,b=new Phaser.GameObjects.Sprite(e,0,0,t);b.setInteractive({pixelPerfect:!0,useHandCursor:!0}),b.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{h&&h.playSound(d),r()}),b.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,()=>{h&&h.playSound(u),c&&p.setAlpha(1),o()}),b.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,()=>{c&&p.setAlpha(.9),l()}),b.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{i()});const v=mn(e,s,m,g,n);return v.setOrigin(y,E),p.add([b,v]),c&&p.setAlpha(.9),p}const yn=.975*-an.y,En={key:Ka.zektonFont.key,size:25,fill:Ja.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class bn extends Phaser.GameObjects.Container{constructor(e,t,s,a,n){super(e,s,a),this.renderBackButton(t,n)}renderBackButton(e,t){const s=gn(this.scene,{assetKey:dn.topButton.key,message:"Back",textConfig:{x:0,y:yn,oriX:.5,oriY:.25},bitMapTextStyle:En,onUp:e},t).setPosition(an.x,an.y);this.add(s)}}var vn=bn;const Sn=an.x-160,fn=an.y,Cn=Sn+10,An=fn+10;function On(e){let t,s;e.load.on("start",()=>{t=e.add.graphics(),s=e.add.graphics(),s.fillStyle(2236962,.8),s.fillRect(Sn,fn,320,50)}),e.load.on("progress",e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(Cn,An,300*e,30)}),e.load.on("complete",(function(){t.destroy(),s.destroy()}))}let wn;!function(e){e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.DialogueLabel=6]="DialogueLabel",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Collectibles=12]="Collectibles"}(wn||(wn={}));const Tn=[wn.Background,wn.Selector,wn.Collectibles,wn.Objects,wn.BBox,wn.Character,wn.Speaker,wn.PopUp,wn.Dialogue,wn.DialogueLabel,wn.UI,wn.Effects,wn.Escape],In={promptSize:{x:30,y:60},promptPadding:{x:30,y:10},rect:{x:10,y:760,width:sn.x-20,height:320},textPadding:{x:100,y:70},speakerRect:{x:320,y:745}},kn={fontFamily:"Verdana",fontSize:"30px",fill:Qa.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:In.rect.width-2*In.textPadding.x-20}},Pn={key:Ka.zektonFont.key,size:36,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var xn=In;const Nn=(e,t=tn.fadeDuration)=>({alpha:0,targets:e,duration:t,ease:"Power2"}),Rn=(e,t=tn.fadeDuration)=>({alpha:1,targets:e,duration:t,ease:"Power2"});function Mn(e,t,{fadeDuration:s}={}){t&&(e.add.tween(Nn([t],s||tn.fadeDuration)),setTimeout(()=>t.destroy(),s||tn.fadeDuration))}function _n(e){return new Phaser.GameObjects.Rectangle(e,an.x,an.y,sn.x,sn.y,0)}function Dn(e,t){let s=0;const a=setInterval(()=>{s%2!==0?(t.setAlpha(0),e.tweens.add(Rn([t],250))):(t.setAlpha(1),e.tweens.add(Nn([t],250))),s++},500);return function(){s=0,clearInterval(a)}}var Ln=function(e,{x:t=0,y:s=0,textStyle:a={},typeWriterInterval:n=1}){const i=new Phaser.GameObjects.Text(e,t,s,"",a);let r,o="",l=0;return{container:i,changeLine:e=>{e&&(o=e,i.text="",l=0,r&&clearInterval(r),r=setInterval(()=>{i.text+=o[l++],l===o.length&&clearInterval(r)},n))}}};var jn=class{constructor(e){this.typewriter=void 0,this.dialogueBox=void 0,this.blinkingDiamond=void 0;const t=Vn.getInstance().getGameManager();var s;this.dialogueBox=(s=t,new Phaser.GameObjects.Image(s,an.x,an.y,dn.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return Ln(e,{x:xn.rect.x+xn.textPadding.x,y:xn.rect.y+xn.textPadding.y,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=Vn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,sn.x-xn.promptSize.x-xn.promptPadding.x,sn.y-xn.promptSize.y-xn.promptPadding.y,dn.diamond.key).setDisplaySize(xn.promptSize.x,xn.promptSize.y);return{container:t,clearBlink:Dn(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=Vn.getInstance().getGameManager();this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),Mn(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}};const Bn={key:Ka.alienLeagueFont.key,size:100,fill:Ja.paleYellow,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Gn=xn.rect.y+2*Bn.size;let Un;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.CollectibleMenu="CollectibleMenu"}(Un||(Un={}));class Hn{constructor(){this.gameManager=void 0,this.getGameManager=()=>cn(this.gameManager),this.gameManager=void 0}static getInstance(){return Hn.instance||(Hn.instance=new Hn),Hn.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getCurrentCheckpoint().map.getLocationAtId(e)}isStorySimulator(){return this.getGameManager().isStorySimulator}getAccountInfo(){return this.getGameManager().getAccountInfo()}getModesByLocId(e){return this.getGameManager().stateManager.getLocationMode(e)}addLocationMode(e,t){this.getGameManager().stateManager.addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().stateManager.removeLocationMode(e,t)}hasLocationUpdate(e,t){return this.getGameManager().stateManager.hasLocationUpdate(e,t)}changeLocationTo(e){this.getGameManager().changeLocationTo(e)}hasTriggeredInteraction(e){return this.getGameManager().stateManager.hasTriggeredInteraction(e)}triggerInteraction(e){this.getGameManager().stateManager.triggerInteraction(e)}getLocationAttr(e,t){return this.getGameManager().stateManager.getLocationAttr(e,t)}addLocationAttr(e,t,s){this.getGameManager().stateManager.addLocationAttr(e,t,s)}removeLocationAttr(e,t,s){return this.getGameManager().stateManager.removeLocationAttr(e,t,s)}subscribeState(e){this.getGameManager().stateManager.subscribe(e)}unsubscribeState(e){this.getGameManager().stateManager.unsubscribe(e)}makeObjectGlow(e){this.getGameManager().objectManager.makeObjectGlow(e)}makeObjectBlink(e){this.getGameManager().objectManager.makeObjectBlink(e)}getObjPropertyMap(){return this.getGameManager().stateManager.getObjPropertyMap()}setObjProperty(e,t){this.getGameManager().stateManager.setObjProperty(e,t)}enableObjectAction(e){this.getGameManager().objectManager.enableObjectAction(e)}disableObjectAction(){this.getGameManager().objectManager.disableObjectAction()}getBBoxPropertyMap(){return this.getGameManager().stateManager.getBBoxPropertyMap()}setBBoxProperty(e,t){this.getGameManager().stateManager.setBBoxProperty(e,t)}enableBBoxAction(e){this.getGameManager().boundingBoxManager.enableBBoxAction(e)}disableBBoxAction(){this.getGameManager().boundingBoxManager.disableBBoxAction()}isAllComplete(){return this.getGameManager().stateManager.isAllComplete()}isObjectiveComplete(e){return this.getGameManager().stateManager.isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().stateManager.areObjectivesComplete(e)}completeObjective(e){this.getGameManager().stateManager.completeObjective(e)}addToUserStateList(e,t){this.getGameManager().userStateManager.addToList(e,t)}async existsInUserStateList(e,t){return await this.getGameManager().userStateManager.doesIdExistInList(e,t)}clearSeveralLayers(e,t=!1){this.getGameManager().layerManager.clearSeveralLayers(e,t)}addContainerToLayer(e,t){this.getGameManager().layerManager.addToLayer(e,t)}fadeInLayer(e,t){this.getGameManager().layerManager.fadeInLayer(e,t)}fadeOutLayer(e,t){this.getGameManager().layerManager.fadeOutLayer(e,t)}async bringUpUpdateNotif(e){this.getGameManager(),await async function(e){const t=Vn.getInstance().getGameManager(),s=new jn({}),a=s.getDialogueContainer();Vn.getInstance().addContainerToLayer(wn.Effects,a),Vn.getInstance().fadeInLayer(wn.Effects);const n=mn(t,e,an.x,Gn,Bn).setOrigin(.5,.9).setAlpha(0);a.add(n),t.add.tween(Rn([n],2*tn.fadeDuration)),await nn(2*tn.fadeDuration);const i=new Promise(e=>{s.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,()=>{Mn(t,n,{fadeDuration:tn.fadeDuration/4}),s.destroy(),e()})});await i}(e)}async processGameActions(e){await this.getGameManager().phaseManager.pushPhase(Un.Sequence),await this.getGameManager().actionManager.processGameActions(e),await this.getGameManager().phaseManager.popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().actionManager.processGameActions(e)}async showDialogue(e){await this.getGameManager().phaseManager.pushPhase(Un.Sequence),await this.getGameManager().dialogueManager.showDialogue(e),await this.getGameManager().phaseManager.popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().dialogueManager.showDialogue(e)}getDialogue(e){return this.getGameManager().getCurrentCheckpoint().map.getDialogues().get(e)}async obtainCollectible(e){this.getGameManager().userStateManager.addToList("collectibles",e)}displayPopUp(e,t,s){this.getGameManager().popUpManager.displayPopUp(e,t,s)}destroyAllPopUps(){this.getGameManager().popUpManager.destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().popUpManager.destroyPopUp(e)}async saveGame(){await this.getGameManager().saveManager.saveGame()}async saveSettings(e){await this.getGameManager().saveManager.saveSettings(e)}getLoadedUserState(){return this.getGameManager().saveManager.getLoadedUserState()}playSound(e){this.getGameManager().soundManager.playSound(e)}playBgMusic(e){this.getGameManager().soundManager.playSound(e)}async stopCurrBgMusic(e){this.getGameManager().soundManager.stopCurrBgMusic(e)}async stopAllSound(){this.getGameManager().soundManager.stopAllSound()}pauseCurrBgMusic(){this.getGameManager().soundManager.pauseCurrBgMusic()}continueCurrBgMusic(){this.getGameManager().soundManager.continueCurrBgMusic()}applySoundSettings(e){this.getGameManager().soundManager.applyUserSettings(e)}enableKeyboardInput(e){this.getGameManager().inputManager.enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().inputManager.enableMouseInput(e)}async popPhase(){await this.getGameManager().phaseManager.popPhase()}async pushPhase(e){await this.getGameManager().phaseManager.pushPhase(e)}async swapPhase(e){await this.getGameManager().phaseManager.swapPhase(e)}isCurrentPhase(e){return this.getGameManager().phaseManager.isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().backgroundManager.renderBackgroundLayerContainer(e)}hideCharacterFromMap(e){this.getGameManager().characterManager.hideCharacterFromMap(e)}showCharacterOnMap(e){this.getGameManager().characterManager.showCharacterOnMap(e)}createCharacterSprite(e,t,s){return this.getGameManager().characterManager.createCharacterSprite(e,t,s)}getCharacterById(e){return this.getGameManager().characterManager.getCharacterById(e)}}Hn.instance=void 0;var Vn=Hn;var Fn=class{constructor(){this.mainLayer=void 0,this.layers=void 0,this.mainLayer=void 0,this.layers=new Map}initialise(e){this.mainLayer=new Phaser.GameObjects.Container(e,0,0),e.add.existing(this.mainLayer);for(const t of Tn){const s=new Phaser.GameObjects.Container(e,0,0);this.layers.set(t,s),this.mainLayer.add(s)}}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e,t=tn.fadeDuration){const s=Vn.getInstance().getGameManager(),a=this.layers.get(e);a.setAlpha(0),s.tweens.add(Rn([a],t)),nn(t)}async fadeOutLayer(e,t=tn.fadeDuration){const s=Vn.getInstance().getGameManager(),a=this.layers.get(e);a.setAlpha(1),s.tweens.add(Nn([a],t)),nn(t)}addToLayer(e,t){const s=this.layers.get(e);s&&s.add(t)}clearSeveralLayers(e,t=!1){e.forEach(e=>this.clearLayerContents(e))}clearAllLayers(){this.layers.forEach((e,t)=>this.clearLayerContents(t))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}};var qn=class{constructor(){this.baseSoundManager=void 0,this.scene=void 0,this.parentGame=void 0,this.getBaseSoundManager=()=>cn(this.baseSoundManager),this.getParentGame=()=>cn(this.parentGame)}initialise(e,t){this.scene=e,this.parentGame=t,this.baseSoundManager=this.parentGame.sound,this.baseSoundManager.pauseOnBlur=!0}applyUserSettings(e){this.setGlobalVolume(e.settings.volume)}renderBackgroundMusic(e){this.stopCurrBgMusic(),this.playBgMusic(e)}clearSoundAssets(){this.getParentGame().clearSoundAssetMap()}loadSounds(e){e.forEach(e=>{this.getParentGame().addSoundAsset(e),this.loadSound(e.key,ln(e.path))})}loadSoundAssetMap(e){Object.entries(e).forEach(e=>{this.getParentGame().addSoundAsset(e[1]),this.loadSound(e[1].key,ln(e[1].path))})}loadSound(e,t){this.scene&&this.scene.load.audio(e,t)}playSound(e){if(this.scene){const t=this.getParentGame().getSoundAsset(e);t&&this.getBaseSoundManager().play(t.key,t.config)}}playBgMusic(e,t=1.5){const s=this.getParentGame().getCurrBgMusicKey();if(s&&s===e)return;const a=this.getParentGame().getSoundAsset(e);a&&(this.getBaseSoundManager().play(a.key,{...a.config,volume:t}),this.getParentGame().setCurrBgMusicKey(a.key))}async stopCurrBgMusic(e=1e3){const t=this.getParentGame().getCurrBgMusicKey();if(this.getParentGame().setCurrBgMusicKey(void 0),this.scene&&t){const s=this.getBaseSoundManager().get(t);this.scene.tweens.add({targets:s,...un,duration:e}),await nn(e),this.getBaseSoundManager().stopByKey(t)}}async stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){const e=this.getParentGame().getCurrBgMusicKey();if(this.scene&&e){const t=this.getBaseSoundManager().get(e);t.isPlaying&&t.pause()}}continueCurrBgMusic(){const e=this.getParentGame().getCurrBgMusicKey();if(this.scene&&e){const t=this.getBaseSoundManager().get(e);t.isPaused&&t.play()}}setGlobalVolume(e){this.getBaseSoundManager().volume=e}};const Xn={key:Ka.zektonFont.key,size:25,fill:Ja.offWhite,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Wn={key:Ka.zektonFont.key,size:35,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},zn={key:Ka.zektonFont.key,size:20,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};var Yn={defaultScrollSpeed:20,buttonsYOffset:200,buttonsXOffset:100,altTextXOffset:40,altTextYOffset:-40,frameXOffset:15,frameYOffset:-10,indexYOffset:-160,titleYOffset:-100,arrowXOffset:875,maskRect:{x:0-an.x,y:100-an.y,width:sn.x-0,height:sn.y-200},imageRect:{width:500,height:700},imageDist:650};class $n extends Phaser.GameObjects.Container{constructor(e,t,s,a,n=tn.defaultFontStyle){super(e,t,s),this.renderTextHover(a,n)}renderTextHover(e,t){const s=new Phaser.GameObjects.Rectangle(this.scene,0,0,e.length*t.size*.7,2*t.size,Ja.darkBlue).setOrigin(0,.5).setAlpha(.8),a=mn(this.scene,e,10,0,t).setOrigin(0,.5);this.add([s,a]),this.setVisible(!1)}}var Kn=$n;const Qn=(e,t,s)=>new Promise(a=>{"__MISSING"!==e.textures.get(t).key?a(t):(e.load.image(t,s),e.load.once("filecomplete",a),e.load.start())}),Jn=(e,t,s)=>new Promise(a=>{e.cache.text.exists(t)?a(t):(e.load.text(t,s),e.load.once("filecomplete",a),e.load.start())});var Zn={defaultCheckpoint:{key:"default-chap",path:"../assets/defaultCheckpoint.txt"}};var ei=class{constructor(){this.soundAssets=void 0,this.mapAssets=void 0,this.locations=void 0,this.talkTopics=void 0,this.objects=void 0,this.boundingBoxes=void 0,this.characters=void 0,this.actions=void 0,this.collectibles=void 0,this.startActions=void 0,this.endActions=void 0,this.getLocationAtId=e=>cn(this.locations.get(e)),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.talkTopics=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.collectibles=new Map,this.startActions=[],this.endActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setStartActions(e){this.startActions=e}setEndActions(e){this.endActions=e}getStartActions(){return this.startActions}getEndActions(){return this.endActions}getLocations(){return this.locations}getObjects(){return this.objects}getBBoxes(){return this.boundingBoxes}getDialogues(){return this.talkTopics}getCharacters(){return this.characters}getActions(){return this.actions}getSoundAssets(){return this.soundAssets}getCollectibles(){return this.collectibles}addItemToMap(e,t,s){this[e].set(t,s)}setItemAt(e,t,s){this.getLocationAtId(e)[t].add(s)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}};var ti=class{constructor(){this.objective=void 0,this.totalNumOfObjectives=void 0,this.numOfCompletedObjectives=void 0,this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const s=this.objective.get(e);this.objective.set(e,t),void 0!==s&&s!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach(e=>this.addObjective(e))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){return this.objective.get(e)}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};class si{static splitToParagraph(e){const t=[];return e.forEach(e=>{if(e.startsWith("\t")||e.startsWith("    ")){const s=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(s)}else t.push([e.trim(),[]])}),t}static mapByHeader(e,t){const s=new Map;if(!t(e[0]))return s.set("0",e),s;let a="";return e.forEach(e=>{if(t(e))return a=e,void s.set(e,[]);s.get(a).push(e)}),s}static splitByChar(e,t,s){return s?e.split(new RegExp((t+"(.+)").repeat(s))).map(e=>e.trim()):e.split(t).map(e=>e.trim())}static splitToLines(e){return e.split("\n").map(e=>e.trimRight()).filter(e=>""!==e)}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(si.capitalize).join(" ")}}let ai,ni,ii,ri,oi;!function(e){e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.LocationChange="LocationChange",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.BringUpDialogue="BringUpDialogue",e.ChangeBackground="ChangeBackground",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow"}(ai||(ai={})),function(e){e.navigation="navigation",e.talkTopics="talkTopics",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles"}(ni||(ni={})),function(e){e.UserState="UserState",e.ChecklistState="ChecklistState"}(ii||(ii={})),function(e){e.Left="Left",e.Middle="Middle",e.Right="Right"}(ri||(ri={})),function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu"}(oi||(oi={}));const li={Move:Un.Move,Explore:Un.Explore,Talk:Un.Talk,Menu:Un.Menu},ci={left:ri.Left,middle:ri.Middle,right:ri.Right},di={talk:oi.Talk,explore:oi.Explore,move:oi.Move,menu:oi.Menu},ui={navigation:ni.navigation,talkTopics:ni.talkTopics,objects:ni.objects,boundingBoxes:ni.boundingBoxes,characters:ni.characters,actions:ni.actions,bgmKey:ni.bgmKey,collectibles:ni.collectibles},hi={move_character:ai.MoveCharacter,update_character:ai.UpdateCharacter,obtain_collectible:ai.ObtainCollectible,complete_objective:ai.CompleteObjective,change_location:ai.LocationChange,add_item:ai.AddItem,remove_item:ai.RemoveItem,change_background:ai.ChangeBackground,show_dialogue:ai.BringUpDialogue,add_mode:ai.AddLocationMode,remove_mode:ai.RemoveLocationMode,add_popup:ai.AddPopup,make_object_glow:ai.MakeObjectGlow,make_object_blink:ai.MakeObjectBlink},pi={checklist:ii.ChecklistState,userstate:ii.UserState};class mi{static stringToPosition(e){return ci[e]||ri.Middle}static stringToGameMode(e){const t=di[e];if(!t)throw new Error("Invalid location mode, "+e);return t}static stringToActionType(e){const t=hi[e];if(!t)throw new Error("Invalid action type, "+e);return t}static stringToGameStateStorage(e){const t=pi[e];if(!t)throw new Error("Invalid condition type, "+e);return t}static stringToLocAttr(e){const t=ui[e];if(!t)throw new Error("Invalid entity type, "+e);return t}}let gi;!function(e){e.locations="locations",e.objectives="objectives"}(gi||(gi={}));class yi{constructor(){this.locAttrAssertions=void 0,this.attrAssertions=void 0,this.locAttrAssertions=new Map,this.attrAssertions=new Map}assertLocAttr(e,t,s){return this.locAttrAssertions.get(e)||this.locAttrAssertions.set(e,[]),this.locAttrAssertions.get(e).push({itemId:t,actionType:s}),t}assertAttr(e,t,s){return this.attrAssertions.get(e)||this.attrAssertions.set(e,[]),this.attrAssertions.get(e).push({itemId:t,actionType:s}),t}assertLocAttrs(e,t,s){t.forEach(t=>this.assertLocAttr(e,t,s))}verifyAssertions(){this.verifyLocAttrAssertions(),this.verifyAttrAssertions()}verifyLocAttrAssertions(){this.locAttrAssertions.forEach((e,t)=>{e.forEach(e=>{const{itemId:s,actionType:a}=e;if(!Ti.checkpoint.map[t].has(s))throw a&&this.actionAssertionError(s,t,a),new Error(`Cannot find id "${s}" under ${t} entity type`)})})}verifyAttrAssertions(){this.attrAssertions.forEach((e,t)=>{e.forEach(e=>{const{itemId:s,actionType:a}=e;switch(t){case gi.locations:Ti.checkpoint.map.getLocationAtId(s);break;case gi.objectives:if(void 0===Ti.checkpoint.objectives.getObjectives().get(s))throw a&&this.actionAssertionError(s,t,a),new Error(`Cannot find objective id "${s}"`)}})})}actionAssertionError(e,t,s){throw new Error(`Expected type of "${t}" as argument for "${s}", obtained "${e}" which is either undefined or the wrong id.`)}}class Ei{static parseActions(e){return e.map(e=>this.parseAction(e))}static parseAction(e){const[t,s]=si.splitByChar(e,"if"),a=this.parseActionContent(t);return s&&(a.actionConditions=si.splitByChar(s,"AND").map(e=>class{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[s,...a]=si.splitByChar(e,".");switch(mi.stringToGameStateStorage(s)){case ii.ChecklistState:return{state:ii.ChecklistState,conditionParams:{id:Ti.validator.assertAttr(gi.objectives,a[0])},boolean:!t};case ii.UserState:return{state:ii.UserState,conditionParams:{listName:a[0],id:a[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}.parse(e))),Ti.checkpoint.map.addItemToMap(ni.actions,a.interactionId,a),a.interactionId}static parseActionContent(e){const[t,s]=si.splitByChar(e,"(");let a=!1,n=t;"*"===t[t.length-1]&&(a=!0,n=n.slice(0,-1));const i=mi.stringToActionType(n),r=si.splitByChar(s.slice(0,-1),","),o={};switch(i){case ai.ObtainCollectible:o.id=Ti.validator.assertLocAttr(ni.collectibles,r[0],n);break;case ai.CompleteObjective:o.id=Ti.validator.assertAttr(gi.objectives,r[0],n);break;case ai.LocationChange:case ai.ChangeBackground:o.id=Ti.validator.assertAttr(gi.locations,r[0],n);break;case ai.BringUpDialogue:o.id=Ti.validator.assertLocAttr(ni.talkTopics,r[0],n);break;case ai.AddItem:case ai.RemoveItem:const e=mi.stringToLocAttr(r[0]);o.attr=e,o.locationId=Ti.validator.assertAttr(gi.locations,r[1],n),o.id=Ti.validator.assertLocAttr(e,r[2],n);break;case ai.AddLocationMode:case ai.RemoveLocationMode:o.locationId=Ti.validator.assertAttr(gi.locations,r[0],n),o.mode=mi.stringToGameMode(r[1]);break;case ai.AddPopup:o.id=Ti.validator.assertLocAttr(ni.objects,r[0],n),o.position=mi.stringToPosition(r[1]);break;case ai.MakeObjectBlink:case ai.MakeObjectGlow:o.id=Ti.validator.assertLocAttr(ni.objects,r[0],n)}return{actionType:i,actionParams:o,actionConditions:[],interactionId:Ti.generateActionId(),isInteractive:!1,isRepeatable:a}}}class bi{static parse(e,t){t.forEach(t=>this.parseCharacterDetails(e,t))}static characterAssetKey(e,t){return e+t}static characterAssetValue(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r]=si.splitByChar(t,","),o=new Map,l={id:a,name:n,expressions:o,defaultExpression:i,defaultPosition:mi.stringToPosition(r)};o.set(i,this.characterAssetKey(a,i)),Ti.checkpoint.map.addMapAsset(this.characterAssetKey(a,i),this.characterAssetValue(a,i)),Ti.checkpoint.map.addItemToMap(ni.characters,a,l),s&&Ti.checkpoint.map.setItemAt(e,ni.characters,a)}}class vi{static parse(e){const[t,s,a]=si.splitByChar(e.slice(1),","),n=mi.stringToPosition(a);return this.addCharacterExprToMap(t,s),{speakerId:t,expression:s,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const s=Ti.checkpoint.map.getCharacters().get(e);if(!s)throw new Error(`Character "${e}" not in map`);const a=t||s.defaultExpression;s.expressions.set(t,bi.characterAssetKey(e,t||a)),Ti.checkpoint.map.addMapAsset(bi.characterAssetKey(e,a),bi.characterAssetValue(e,a))}}const Si=e=>new RegExp(/^[0-9]+$/).test(e),fi=e=>new RegExp(/^goto [0-9]+$/).test(e),Ci=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),Ai=e=>e&&"@"===e[0];class Oi{static parse(e,t,s){t.forEach((t,a)=>{const[n,i,r]=si.splitByChar(t,",");Ti.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseInt(r),loop:s===hn.BGM},soundType:s}),s===hn.BGM&&0===a&&Ti.checkpoint.map.setBGMusicAt(e,n)})}}class wi{static generateActionId(){return wi.actionIdNum++,"action#"+wi.actionIdNum}static init(){wi.actionIdNum=0,wi.checkpoint={configuration:"",map:new ei,startingLoc:"",objectives:new ti},wi.validator=new yi}static parse(e,t=!1){t||wi.init();const s=si.splitToLines(e);return si.splitToParagraph(s).forEach(([e,t])=>{0===t.length&&e.includes(":")?wi.parseCheckpointConfig(e):wi.parseCheckpointParagraphs(e,t)||class{static parse(e,t){const s=Ti.checkpoint.map.getLocationAtId(e);si.splitToParagraph(t).forEach(([e,t])=>{0===t.length?this.parseLocationConfig(s,e):this.parseLocationParagraphs(s,e,t)})}static parseLocationConfig(e,t){const[s,a]=si.splitByChar(t,":"),n=si.splitByChar(a,",");switch(s){case"modes":n.forEach(t=>{const s=mi.stringToGameMode(t);e.modes.add(s)});break;case"nav":n.forEach(t=>{Ti.validator.assertAttr(gi.locations,t),e.navigation.add(t)});break;case"talkTopics":const t=n;Ti.validator.assertLocAttrs(ni.talkTopics,t),e.talkTopics=new Set(t);break;default:throw new Error(`Invalid config key "${s}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,s){switch(t){case"objects":(class{static parse(e,t){si.splitToParagraph(t).forEach(([t,s])=>{const a=this.parseObjectConfig(e,t);s.length&&(a.isInteractive=!0,a.actionIds=Ei.parseActions(s))})}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r,o,l]=si.splitByChar(t,","),c={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(l)||void 0,isInteractive:!1,interactionId:a};return Ti.checkpoint.map.addMapAsset(this.objectAssetKey(n),this.objectPath(n)),Ti.checkpoint.map.addItemToMap(ni.objects,a,c),s&&Ti.checkpoint.map.setItemAt(e,ni.objects,a),c}}).parse(e.id,s);break;case"boundingBoxes":(class{static parse(e,t){si.splitToParagraph(t).forEach(([t,s])=>{const a=this.parseBBoxConfig(e,t);s.length&&(a.isInteractive=!0,a.actionIds=Ei.parseActions(s))})}static parseBBoxConfig(e,t){const s="+"===t[0];s&&(t=t.slice(1));const[a,n,i,r,o]=si.splitByChar(t,","),l={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:a};return Ti.checkpoint.map.addItemToMap(ni.boundingBoxes,a,l),s&&Ti.checkpoint.map.setItemAt(e,ni.boundingBoxes,a),l}}).parse(e.id,s);break;case"characters":bi.parse(e.id,s);break;case"bgm":Oi.parse(e.id,s,hn.BGM);break;case"sfx":Oi.parse(e.id,s,hn.SFX);break;case"actions":e.actionIds=Ei.parseActions(s);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}.parse(e,t)}),wi.validator.verifyAssertions(),this.checkpoint}static parseCheckpointConfig(e){const[t,s]=si.splitByChar(e,":");switch(t){case"startingLoc":wi.validator.assertAttr(gi.locations,s),wi.checkpoint.startingLoc=s;break;default:throw new Error(`Invalid checkpoint config key, "${e}"`)}}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":wi.checkpoint.objectives.addObjectives(t);break;case"locations":(class{static parse(e){e.forEach(e=>{const[t,s,a]=si.splitByChar(e,",",2);Ti.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:a,assetKey:this.locationAssetKey(s)}),Ti.checkpoint.map.addMapAsset(this.locationAssetKey(s),this.locationPath(s))})}static locationAssetKey(e){return e}static locationPath(e){return e}}).parse(t);break;case"startActions":wi.checkpoint.map.setStartActions(Ei.parseActions(t));break;case"endActions":wi.checkpoint.map.setEndActions(Ei.parseActions(t));break;case"dialogues":(class{static parse(e){si.splitToParagraph(e).forEach(([e,t])=>{0!==t.length?this.parseDialogue(e,t):console.error("No dialogue found for dialogueId")})}static parseDialogue(e,t){const[s,a]=si.splitByChar(e,",",1),n={title:a,content:this.parseDialogueContent(t)};Ti.checkpoint.map.addItemToMap(ni.talkTopics,s,n)}static parseDialogueContent(e){return rn(si.mapByHeader(e,Si),this.createDialogueLines)}static createDialogueLines(e){const t=[];let s=0;for(;s!==e.length;){const a=e[s];switch(!0){case fi(a):t[t.length-1].goto=a.split(" ")[1];break;case Ci(a):const n=t[t.length-1];!n.actionIds&&(n.actionIds=[]),n.actionIds.push(Ei.parseAction(a));break;case Ai(a):s++;const i=e[s];if(!i)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:i}),t[t.length-1].speakerDetail=vi.parse(a);break;default:t.push({line:a})}s++}return t}}).parse(t);break;default:return!1}return!0}}wi.checkpoint=void 0,wi.actionIdNum=void 0,wi.validator=void 0;var Ti=wi;async function Ii(e,t,s,a,n){const i=t[a].checkpointsFilenames[n];if(!i)return;const r="#"+i;await Jn(e,r,i),await Jn(e,Zn.defaultCheckpoint.key,Zn.defaultCheckpoint.path);const o=e.cache.text.get(r),l=e.cache.text.get(Zn.defaultCheckpoint.key),c=td().getAccountInfo();if(!c)return;const d=await ad(c);Ti.parse(l),Ti.parse(o,!0);const u=Ti.checkpoint;e.scene.start("GameManager",{isStorySimulator:!1,fullSaveState:d,gameCheckpoint:u,continueGame:s,chapterNum:a,checkpointNum:n})}function ki(e,{title:t},s,a){const[n,i]=[an.x+Yn.imageDist*s,an.y];const r=new Phaser.GameObjects.Container(e,n,i),o=new Phaser.GameObjects.Image(e,0,0,"chapterImage"+s).setDisplaySize(Yn.imageRect.width,Yn.imageRect.height),l=new Phaser.GameObjects.Sprite(e,Yn.frameXOffset,Yn.frameYOffset,dn.chapterSelectFrame.key),c=new Kn(e,Yn.buttonsXOffset+Yn.altTextXOffset,Yn.buttonsYOffset+Yn.altTextYOffset,"Reset progress",zn),d=new Kn(e,-Yn.buttonsXOffset+Yn.altTextXOffset,Yn.buttonsYOffset+Yn.altTextYOffset,"Play/Continue",zn),u=gn(e,{assetKey:dn.chapterRepeatButton.key,onUp:()=>Ii(e,e.chapterDetails,!1,s,0),onHover:()=>c.setVisible(!0),onOut:()=>c.setVisible(!1)},e.soundManager).setPosition(Yn.buttonsXOffset,Yn.buttonsYOffset),h=gn(e,{assetKey:dn.chapterContinueButton.key,onUp:()=>Ii(e,e.chapterDetails,!0,s,a),onHover:()=>d.setVisible(!0),onOut:()=>d.setVisible(!1)},e.soundManager).setPosition(-Yn.buttonsXOffset,Yn.buttonsYOffset),p=mn(e,"Chapter "+s,0,Yn.indexYOffset,Xn).setOrigin(.5,.5),m=mn(e,t,0,Yn.titleYOffset,Wn).setOrigin(.5,.5),g=s<=e.getLoadedGameState().userState.lastCompletedChapter+1,y=new Phaser.GameObjects.Rectangle(e,0,0,Yn.imageRect.width,Yn.imageRect.height,0).setOrigin(.5).setAlpha(g?0:.8).setInteractive();return r.add([o,l,u,h,c,d,p,m,y]),r}const Pi=[{title:"Spaceship Emergency",previewBgPath:"/locations/planet-y-orbit/crashing.png",checkpointsFilenames:["../assets/chapter0.txt","../assets/chapter0.1.txt"]},{title:"Alien Attack",previewBgPath:"/locations/telebay/emergency.png",checkpointsFilenames:["../assets/chapter1.txt"]},{title:"Jedi Master",previewBgPath:"/locations/classroom/normal.png",checkpointsFilenames:["../assets/chapter2.txt"]}];class xi extends Phaser.Scene{constructor(){super("ChapterSelect"),this.layerManager=void 0,this.soundManager=void 0,this.chapterDetails=void 0,this.chapterContainer=void 0,this.backButtonContainer=void 0,this.loadedGameState=void 0,this.autoScrolling=void 0,this.isScrollLeft=void 0,this.isScrollRight=void 0,this.getLoadedGameState=()=>cn(this.loadedGameState),this.chapterContainer=void 0,this.backButtonContainer=void 0,this.chapterDetails=[],this.layerManager=new Fn,this.soundManager=new qn,this.autoScrolling=!0,this.isScrollLeft=!1,this.isScrollRight=!1}preload(){this.chapterDetails=Pi,On(this),this.preloadAssets(),this.layerManager.initialise(this),this.soundManager.initialise(this,td())}async create(){const e=td().getAccountInfo();this.loadedGameState=await ad(e),this.renderBackground(),this.renderChapters(),this.autoScroll()}update(){if(!this.chapterContainer||this.autoScrolling)return;let e=this.chapterContainer.x;this.isScrollRight?e-=Yn.defaultScrollSpeed:this.isScrollLeft&&(e+=Yn.defaultScrollSpeed),this.chapterContainer.x=on(e,-Yn.imageDist*(this.chapterDetails.length-1),0)}cleanUp(){this.soundManager.stopCurrBgMusic(),this.layerManager.clearAllLayers()}preloadAssets(){this.chapterDetails.forEach((e,t)=>{this.load.image("chapterImage"+t,ln(e.previewBgPath))})}renderBackground(){const e=new Phaser.GameObjects.Image(this,an.x,an.y,dn.chapterSelectBackground.key),t=new Phaser.GameObjects.Rectangle(this,an.x,an.y,sn.x,sn.y,0).setAlpha(.3);this.layerManager.addToLayer(wn.Background,e),this.layerManager.addToLayer(wn.Background,t)}renderChapters(){const e=this.createMask();this.backButtonContainer=new vn(this,()=>{this.cleanUp(),this.scene.start("MainMenu")},0,0,this.soundManager),this.chapterContainer=this.createChapterContainer(),this.chapterContainer.mask=new Phaser.Display.Masks.GeometryMask(this,e);const t=new Phaser.GameObjects.Image(this,an.x,an.y,dn.chapterSelectBorder.key),s=gn(this,{assetKey:dn.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1},this.soundManager).setPosition(an.x-Yn.arrowXOffset,an.y),a=gn(this,{assetKey:dn.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1},this.soundManager).setPosition(an.x+Yn.arrowXOffset,an.y).setScale(-1,1);this.layerManager.addToLayer(wn.UI,this.chapterContainer),this.layerManager.addToLayer(wn.UI,this.backButtonContainer),this.layerManager.addToLayer(wn.UI,t),this.layerManager.addToLayer(wn.UI,s),this.layerManager.addToLayer(wn.UI,a)}createMask(){const e=this.add.graphics().fillRect(Yn.maskRect.x,Yn.maskRect.y,Yn.maskRect.width,Yn.maskRect.height).setPosition(an.x,an.y);return e.alpha=0,e}createChapterContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.chapterDetails.map((e,t)=>{let s=0;return this.loadedGameState&&this.loadedGameState.gameSaveStates[t]&&(s=this.loadedGameState.gameSaveStates[t].lastCheckpointPlayed),ki(this,e,t,s)})),e}async autoScroll(){const e=Math.min(this.getLoadedGameState().userState.lastCompletedChapter+1,Pi.length-1);await this.scrollToIndex(e),this.autoScrolling=!1}async scrollToIndex(e){if(!this.chapterContainer)return;const t=-e*Yn.imageDist;this.tweens.add({targets:this.chapterContainer,x:t,ease:"Power2",duration:800}),await nn(800)}}var Ni=xi;const Ri={key:Ka.alienCowsFont.key,size:80,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Mi={chapterText:"Chapter completed.",checkpointText:"Checkpoint reached.",tweenDuration:1500,entryTween:{alpha:1,duration:1500,ease:"Power2"},exitTween:{alpha:0,duration:1500,ease:"Power2"}};class _i extends Phaser.Scene{constructor(){super("CheckpointTransition"),this.soundManager=void 0,this.soundManager=new qn}preload(){this.soundManager.initialise(this,td())}async create(){this.soundManager.stopCurrBgMusic();const e=td().getAccountInfo(),t=await ad(e),s=Pi,[a,n]=t.userState.lastPlayedCheckpoint;return this.isLastCheckpoint(s,a,n)?(await this.saveChapterComplete(t,e,a),a>=s.length-1?void this.scene.start("MainMenu"):(await this.showTransitionText(Mi.chapterText),void await Ii(this,s,!0,a+1,0))):(await this.showTransitionText(Mi.checkpointText),void await Ii(this,s,!1,a,n+1))}async showTransitionText(e){const t=mn(this,e,an.x,an.y,Ri).setOrigin(.5,.5).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...Mi.entryTween}),await nn(2*Mi.tweenDuration),this.tweens.add({targets:t,...Mi.exitTween}),await nn(Mi.tweenDuration)}async saveChapterComplete(e,t,s){e.userState.lastCompletedChapter=Math.max(e.userState.lastCompletedChapter,s),await sd(t,e)}isLastCheckpoint(e,t,s){return s>=e[t].checkpointsFilenames.length-1}}var Di=_i;class Li{constructor(){this.actionMap=void 0,this.getActionFromId=e=>cn(this.actionMap.get(e)),this.actionMap=new Map}initialise(e){this.actionMap=e.getCurrentCheckpoint().map.getActions()}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await Vn.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:s,actionConditions:a,isRepeatable:n,interactionId:i}=this.getActionFromId(e);await this.checkCanPlayAction(n,i,a)&&(await class{static async executeGameAction(e,t){const s=Vn.getInstance();switch(e){case ai.LocationChange:return void s.changeLocationTo(t.id);case ai.ChangeBackground:return void s.renderBackgroundLayerContainer(t.id);case ai.ObtainCollectible:return void s.obtainCollectible(t.id);case ai.CompleteObjective:return void s.completeObjective(t.id);case ai.AddItem:return void s.addLocationAttr(t.attr,t.locationId,t.id);case ai.RemoveItem:return void s.removeLocationAttr(t.attr,t.locationId,t.id);case ai.AddLocationMode:return void s.addLocationMode(t.locationId,t.mode);case ai.RemoveLocationMode:return void s.removeLocationMode(t.locationId,t.mode);case ai.BringUpDialogue:return void await s.showDialogueInSamePhase(t.id);case ai.AddPopup:return void await s.displayPopUp(t.id,t.position,t.duration);case ai.MakeObjectBlink:return void await s.makeObjectBlink(t.id);case ai.MakeObjectGlow:return void await s.makeObjectGlow(t.id);default:return}}}.executeGameAction(t,s),Vn.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,s){return(e||!Vn.getInstance().hasTriggeredInteraction(t))&&await class{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map(async e=>await this.checkConditionSatisfied(e)))).every(e=>!0===e)}static async checkConditionSatisfied(e){const{state:t,conditionParams:s,boolean:a}=e;switch(t){case ii.UserState:return await Vn.getInstance().existsInUserStateList(s.listName,s.id)===a;case ii.ChecklistState:return Vn.getInstance().isObjectiveComplete(s.id)===a;default:return!0}}}.checkAllConditionsSatisfied(s)}}var ji=class{constructor(){this.observerId=void 0,this.bboxes=void 0,this.observerId="GameBoundingBoxManager",this.bboxes=[]}initialise(){Vn.getInstance().subscribeState(this)}notify(e){const t=Vn.getInstance().hasLocationUpdate(e,oi.Explore),s=Vn.getInstance().getCurrLocId();t&&e===s&&this.renderBBoxLayerContainer(e)}renderBBoxLayerContainer(e){Vn.getInstance().clearSeveralLayers([wn.BBox]);const t=Vn.getInstance().getLocationAttr(ni.boundingBoxes,e),s=this.createBBoxLayerContainer(t);Vn.getInstance().addContainerToLayer(wn.BBox,s)}createBBoxLayerContainer(e){const t=Vn.getInstance().getGameManager(),s=Vn.getInstance().getBBoxPropertyMap(),a=new Phaser.GameObjects.Container(t,0,0);return this.bboxes=e.map(e=>s.get(e)).filter(e=>void 0!==e).map(e=>{const s=this.createBBox(t,e);return a.add(s.sprite),s}),a}enableBBoxAction(e){this.bboxes.forEach(t=>t.activate(e))}disableBBoxAction(){this.bboxes.forEach(e=>e.deactivate())}createBBox(e,t){const{x:s,y:a,width:n,height:i,actionIds:r,interactionId:o}=t,l=new Phaser.GameObjects.Rectangle(e,s,a,n,i,0,0);return t.isInteractive&&l.setInteractive(),{sprite:l,activate:r?function({onClick:e=(e=>{}),onPointerout:t=(e=>{}),onHover:s=(e=>{})}){l.on("pointerup",async()=>{e(o),await Vn.getInstance().processGameActions(r)}),l.on("pointerover",()=>{s(o)}),l.on("pointerout",()=>{t(o)})}:tn.nullFunction,deactivate:function(){l.off("pointerup"),l.off("pointerover"),l.off("pointerout")}}}};function Bi(e,t,s){const a=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=s||t*a):(e.displayWidth=s/a,e.displayHeight=s)}function Gi(e,t,s){e.displayWidth>e.displayHeight?Bi(e,t):Bi(e,0,s)}var Ui={charWidth:700,charRect:{x:{Left:350,Middle:an.x,Right:sn.x-350},y:800,height:.4*sn.y}};class Hi{constructor(){this.characterMap=void 0,this.characterSpriteMap=void 0,this.getCharacterById=e=>cn(this.characterMap.get(e)),this.characterMap=new Map,this.characterSpriteMap=new Map}initialise(e){this.characterMap=e.getCurrentCheckpoint().map.getCharacters()}renderCharacterLayerContainer(e){const t=Vn.getInstance().getLocationAttr(ni.characters,e),s=this.getCharacterContainer(t);Vn.getInstance().addContainerToLayer(wn.Character,s)}getCharacterContainer(e){const t=new Phaser.GameObjects.Container(Vn.getInstance().getGameManager(),0,0);return e.forEach(e=>{const s=this.createCharacterSprite(e);t.add(s),this.characterSpriteMap.set(e,s)}),t}createCharacterSprite(e,t,s){const a=this.getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r}=a,o=Ui.charRect.x[s||n],l=r.get(t||i),c=new Phaser.GameObjects.Image(Vn.getInstance().getGameManager(),o,sn.y,l).setOrigin(.5,1);return Bi(c,Ui.charWidth),c}showCharacterOnMap(e){const t=this.characterSpriteMap.get(e);t&&Vn.getInstance().getGameManager().add.tween(Rn([t]))}hideCharacterFromMap(e){const t=this.characterSpriteMap.get(e);t&&Vn.getInstance().getGameManager().add.tween(Nn([t]))}}class Vi{constructor(e){this.currPart=void 0,this.currLineNum=void 0,this.dialogueContent=void 0,this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){if(!this.dialogueContent.get(e.goto))return{line:""};this.currPart=e.goto,this.currLineNum=0}else this.currLineNum++;return e}}class Fi{constructor(e){this.currentSpeakerId=void 0,this.username=void 0,this.username=e}changeSpeakerTo(e){void 0!==e&&(this.hidePreviousSpeaker(this.currentSpeakerId),this.showNewSpeaker(e))}hidePreviousSpeaker(e){e&&(Vn.getInstance().clearSeveralLayers([wn.Speaker,wn.DialogueLabel]),Vn.getInstance().showCharacterOnMap(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){const t="you"===e?this.createSpeakerBox(this.username,ri.Right):this.createSpeakerBox(Vn.getInstance().getCharacterById(e).name,ri.Left);Vn.getInstance().addContainerToLayer(wn.DialogueLabel,t)}drawSpeakerSprite({speakerId:e,speakerPosition:t,expression:s}){if("you"===e||"narrator"===e)return;Vn.getInstance().hideCharacterFromMap(e);const a=Vn.getInstance().createCharacterSprite(e,s,t);Vn.getInstance().addContainerToLayer(wn.Speaker,a),this.currentSpeakerId=e}createSpeakerBox(e,t){const s=Vn.getInstance().getGameManager(),a=new Phaser.GameObjects.Container(s,0,0),n=new Phaser.GameObjects.Image(s,an.x,an.y,dn.speakerBox.key).setAlpha(.8),i=mn(s,"",xn.speakerRect.x,xn.speakerRect.y,Pn).setOrigin(.5,.5);return t===ri.Right&&(n.displayWidth*=-1,i.x=sn.x-i.x),a.add([n,i]),i.text=si.capitalize(e),a}}class qi{constructor(){this.dialogueMap=void 0,this.username=void 0,this.speakerRenderer=void 0,this.dialogueRenderer=void 0,this.dialogueGenerator=void 0,this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.dialogueMap=new Map,this.username=""}initialise(e){this.username=Vn.getInstance().getAccountInfo().name,this.dialogueMap=e.getCurrentCheckpoint().map.getDialogues()}async showDialogue(e){const t=this.dialogueMap.get(e);t&&(this.dialogueRenderer=new jn(kn),this.dialogueGenerator=new Vi(t.content),this.speakerRenderer=new Fi(this.username),Vn.getInstance().addContainerToLayer(wn.Dialogue,this.dialogueRenderer.getDialogueContainer()),Vn.getInstance().fadeInLayer(wn.Dialogue),await new Promise(e=>this.playWholeDialogue(e)))}async playWholeDialogue(e){await this.showNextLine(e),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,async()=>await this.showNextLine(e))}async showNextLine(e){const{line:t,speakerDetail:s,actionIds:a}=this.getDialogueGenerator().generateNextLine(),n=t.replace("{name}",this.username);this.getDialogueRenderer().changeText(n),this.getSpeakerRenderer().changeSpeakerTo(s),await Vn.getInstance().processGameActionsInSamePhase(a),t||(e(),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null))}}class Xi{constructor(e,t,s,a,n,i){this.scene=void 0,this.container=void 0,this.imageGlow=void 0,this.clickArea=void 0,this.glowClearer=void 0,this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,s);const r=new Phaser.GameObjects.Image(e,0,0,a);this.imageGlow=new Phaser.GameObjects.Image(e,0,0,a).setAlpha(0).setTint(Ja.yellow),this.clickArea=new Phaser.GameObjects.Image(e,0,0,a).setAlpha(.01).setInteractive({pixelPerfect:!0}),n&&(Bi(r,n,i),Bi(this.imageGlow,n,i),Bi(this.clickArea,n,i)),this.container.add([r,this.imageGlow,this.clickArea])}startGlow(){this.imageGlow.setAlpha(1),this.glowClearer&&this.glowClearer(),this.glowClearer=Dn(this.scene,this.imageGlow)}clearGlow(){this.imageGlow.setAlpha(0),this.glowClearer&&this.glowClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}var Wi=class{constructor(){this.observerId=void 0,this.objects=void 0,this.observerId="GameObjectManager",this.objects=new Map}initialise(){Vn.getInstance().subscribeState(this)}notify(e){const t=Vn.getInstance().hasLocationUpdate(e,oi.Explore),s=Vn.getInstance().getCurrLocId();t&&e===s&&this.renderObjectsLayerContainer(e)}createObjectsLayerContainer(e){const t=Vn.getInstance().getGameManager(),s=Vn.getInstance().getObjPropertyMap(),a=new Phaser.GameObjects.Container(t,0,0);return e.map(e=>s.get(e)).filter(e=>void 0!==e).forEach(e=>{const s=this.createObject(t,e);return a.add(s.sprite.getContainer()),this.objects.set(e.interactionId,s),s}),a}renderObjectsLayerContainer(e){Vn.getInstance().clearSeveralLayers([wn.Objects]);const t=Vn.getInstance().getLocationAttr(ni.objects,e),s=this.createObjectsLayerContainer(t);Vn.getInstance().addContainerToLayer(wn.Objects,s)}enableObjectAction(e){this.objects.forEach(t=>t.activate(e))}disableObjectAction(){this.objects.forEach(e=>e.deactivate())}makeObjectGlow(e){const t=this.objects.get(e);t&&t.sprite.startGlow()}makeObjectBlink(e){const t=this.objects.get(e);t&&Dn(Vn.getInstance().getGameManager(),t.sprite.getContainer())}createObject(e,t){const{assetKey:s,x:a,y:n,width:i,height:r,actionIds:o,interactionId:l}=t,c=new Xi(e,a,n,s,i,r);return{sprite:c,activate:o?function({onClick:e=(e=>{}),onPointerout:t=(e=>{}),onHover:s=(e=>{})}){c.getClickArea().on("pointerup",async()=>{e(l),await Vn.getInstance().processGameActions(o)}),c.getClickArea().on("pointerover",()=>{s(l)}),c.getClickArea().on("pointerout",()=>{t(l)})}:tn.nullFunction,deactivate:function(){c.getClickArea().off("pointerup"),c.getClickArea().off("pointerover"),c.getClickArea().off("pointerout")}}}};const zi=an.y/2;var Yi={imgXOffset:20,imgYOffset:20,rect:{x:{Left:350,Middle:an.x,Right:sn.x-350},y:zi,width:280,height:280}};var $i=class{constructor(){this.currPopUp=void 0,this.popUpFrame=void 0,this.currPopUp=new Map,this.popUpFrame={assetKey:dn.popUpFrame.key,assetXPos:Yi.rect.x[ri.Middle],assetYPos:Yi.rect.y}}displayPopUp(e,t,s=tn.popupDuration){this.destroyPopUp(t);const a=Vn.getInstance().getGameManager(),n=new Phaser.GameObjects.Container(a,0,0),i=new Phaser.GameObjects.Image(a,Yi.rect.x[t],this.popUpFrame.assetYPos,this.popUpFrame.assetKey),r=this.getAssetKey(e);if(!r)return;const o=new Phaser.GameObjects.Image(a,Yi.rect.x[t]+Yi.imgXOffset,this.popUpFrame.assetYPos+Yi.imgYOffset,r);Gi(o,Yi.rect.width,Yi.rect.height),n.add([i,o]),this.currPopUp.set(t,n),Vn.getInstance().addContainerToLayer(wn.PopUp,n),n.setActive(!0),n.setVisible(!0),setTimeout(()=>this.destroyPopUp(t),s)}destroyAllPopUps(){this.currPopUp.forEach((e,t,s)=>{this.destroyPopUp(t)})}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(await nn(200),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e))}getAssetKey(e){const t=Vn.getInstance().getGameManager().getCurrentCheckpoint().map.getObjects().get(e);if(t)return t.assetKey}};const Ki=new Set([]);function Qi(e){const t={};return e.forEach((e,s)=>{t[s]=e}),t}function Ji(e){const t={};return e.forEach((e,s)=>{const a=Qe.mapValues(e,e=>e instanceof Set?Array.from(e):e);t[s]=a}),t}function Zi(e){const t=new Map;return Object.keys(e).length&&Object.keys(e).forEach(s=>{t.set(s,e[s])}),t}var er=class{constructor(){this.subscribers=void 0,this.checkpoint=void 0,this.checkpointObjective=void 0,this.locationHasUpdate=void 0,this.locationStates=void 0,this.objectPropertyMap=void 0,this.bboxPropertyMap=void 0,this.triggeredInteractions=void 0,this.getLocationById=e=>cn(this.locationStates.get(e)),this.subscribers=new Array,this.checkpoint={},this.checkpointObjective=new ti,this.locationHasUpdate=new Map,this.locationStates=new Map,this.objectPropertyMap=new Map,this.bboxPropertyMap=new Map,this.triggeredInteractions=new Map}update(e){this.subscribers.forEach(t=>t.notify(e))}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t.observerId!==e.observerId)}updateLocationStateMode(e,t){const s=Vn.getInstance().getCurrLocId();this.locationHasUpdate.get(e).set(t,!0),s!==e&&this.triggeredInteractions.set(e,!1),this.update(e)}updateLocationStateAttr(e,t){switch(t){case ni.navigation:return this.updateLocationStateMode(e,oi.Move);case ni.talkTopics:return this.updateLocationStateMode(e,oi.Talk);case ni.boundingBoxes:case ni.objects:return this.updateLocationStateMode(e,oi.Explore);default:return}}checkLocationsExist(e){e.forEach(e=>cn(this.locationStates.get(e)))}initialise(e){this.checkpoint=e.getCurrentCheckpoint();const t=e.saveManager.getLoadedGameStoryState();this.checkpointObjective=this.checkpoint.objectives,t?this.loadFromGameStoryState(t):this.loadNewGameStoryState(),this.locationStates.forEach((e,t,s)=>{this.locationHasUpdate.set(t,new Map),e.modes&&e.modes.forEach(e=>this.locationHasUpdate.get(t).set(e,!0))})}loadFromGameStoryState(e){this.checkpointObjective.setObjectives(Zi(e.chapterObjective)),this.locationStates=function(e){const t=new Map;return Object.keys(e).length&&Object.keys(e).forEach(s=>{const a=Qe.mapValues(e[s],e=>e instanceof Array?new Set(e):e);t.set(s,a)}),t}(e.locationStates),this.objectPropertyMap=Zi(e.objectPropertyMap),this.bboxPropertyMap=Zi(e.bboxPropertyMap),this.triggeredInteractions=Zi(e.triggeredInteractions)}loadNewGameStoryState(){this.checkpointObjective=this.checkpoint.objectives,this.locationStates=this.checkpoint.map.getLocations(),this.objectPropertyMap=this.checkpoint.map.getObjects(),this.bboxPropertyMap=this.checkpoint.map.getBBoxes(),this.triggeredInteractions.clear()}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}hasLocationUpdate(e,t){if(this.checkLocationsExist([e]),t)return this.locationHasUpdate.get(e).get(t);let s=!1;return this.locationHasUpdate.get(e).forEach((e,t,a)=>s=s||e),s}getLocationMode(e){return Array.from(this.checkpoint.map.getLocationAtId(e).modes||Ki)}addLocationMode(e,t){this.getLocationById(e).modes.add(t),this.locationStates.get(e).modes.add(t),this.updateLocationStateMode(e,oi.Menu)}removeLocationMode(e,t){const s=this.getLocationById(e);s.modes&&(s.modes.delete(t),this.updateLocationStateMode(e,oi.Menu))}getLocationAttr(e,t){const s=this.getLocationById(t);return Array.from(s[e])||[]}addLocationAttr(e,t,s){const a=this.getLocationById(t);!a[e]&&(a[e]=[]),a[e].push(s),this.updateLocationStateAttr(t,e)}removeLocationAttr(e,t,s){const a=this.getLocationById(t);a[e]&&(a[e]=a[e].filter(e=>e!==s),this.updateLocationStateAttr(t,e))}isAllComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){const t=this.checkpointObjective.getObjectiveState(e);return!(void 0!==t&&!t)}areObjectivesComplete(e){let t=!0;return e.forEach(e=>t=t&&this.isObjectiveComplete(e)),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}getObjPropertyMap(){return this.objectPropertyMap}setObjProperty(e,t){this.objectPropertyMap.set(e,t),this.locationStates.forEach((t,s)=>{t.objects&&t.objects.has(e)&&this.updateLocationStateAttr(s,ni.objects)})}getBBoxPropertyMap(){return this.bboxPropertyMap}setBBoxProperty(e,t){this.bboxPropertyMap.set(e,t),this.locationStates.forEach((t,s)=>{t.boundingBoxes&&t.boundingBoxes.delete(e)&&this.updateLocationStateAttr(s,ni.boundingBoxes)})}getLocationStates(){return this.locationStates}getCheckpointObjectives(){return this.checkpointObjective}getTriggeredInteractions(){return this.triggeredInteractions}},tr=s(2),sr=s(828),ar=s(859);const nr=(e=kt,t)=>{switch(t.type){case"LOG_OUT":return kt;case"SAVE_CANVAS":return{...e,gameCanvas:t.payload};default:return e}},ir=(e=xt,t)=>{switch(t.type){case"UPDATE_GROUP_GRADING_SUMMARY":return{...e,gradingSummary:t.payload};default:return e}},rr=(e=Nt,t)=>{switch(t.type){case"CHANGE_QUERY_STRING":return{...e,queryString:t.payload};case"TOGGLE_USING_SUBST":return{...e,usingSubst:t.payload};case"UPDATE_SHORT_URL":return{...e,shortURL:t.payload};case"PLAYGROUND_UPDATE_PERSISTENCE_FILE":return{...e,persistenceFile:t.payload};default:return e}},or=(e=Mt,t)=>{const s=t.payload?t.payload.workspaceLocation:"assessment";let a,n;switch(s){case"sourcecast":const s=((e,t)=>{switch(t.type){case"SAVE_SOURCECAST_DATA":return{...e,title:t.payload.title,description:t.payload.description,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case"SET_CURRENT_PLAYER_TIME":return{...e,currentPlayerTime:t.payload.playerTime};case"SET_CODE_DELTAS_TO_APPLY":return{...e,codeDeltasToApply:t.payload.deltas};case"SET_INPUT_TO_APPLY":return{...e,inputToApply:t.payload.inputToApply};case"SET_SOURCECAST_DATA":return{...e,title:t.payload.title,description:t.payload.description,audioUrl:t.payload.audioUrl,playbackData:t.payload.playbackData};case"SET_SOURCECAST_PLAYBACK_DURATION":return{...e,playbackDuration:t.payload.duration};case"SET_SOURCECAST_PLAYBACK_STATUS":return{...e,playbackStatus:t.payload.playbackStatus};case"UPDATE_SOURCECAST_INDEX":return{...e,sourcecastIndex:t.payload.index};default:return e}})(e.sourcecast,t);if(s===e.sourcecast)break;return{...e,sourcecast:s};case"sourcereel":const a=((e,t)=>{switch(t.type){case"RECORD_INIT":return{...e,playbackData:{init:t.payload.initData,inputs:[]}};case"RECORD_INPUT":return{...e,playbackData:{...e.playbackData,inputs:[...e.playbackData.inputs,t.payload.input]}};case"RESET_INPUTS":return{...e,playbackData:{...e.playbackData,inputs:t.payload.inputs}};case"TIMER_PAUSE":return{...e,recordingStatus:Ue.paused,timeElapsedBeforePause:e.timeElapsedBeforePause+t.payload.timeNow-e.timeResumed};case"TIMER_RESET":return{...e,recordingStatus:Ue.notStarted,timeElapsedBeforePause:0,timeResumed:0};case"TIMER_RESUME":return{...e,recordingStatus:Ue.recording,timeElapsedBeforePause:t.payload.timeBefore>=0?t.payload.timeBefore:e.timeElapsedBeforePause,timeResumed:t.payload.timeNow};case"TIMER_START":return{...e,recordingStatus:Ue.recording,timeElapsedBeforePause:0,timeResumed:t.payload.timeNow};case"TIMER_STOP":return{...e,recordingStatus:Ue.finished,timeElapsedBeforePause:0,timeResumed:0};default:return e}})(e.sourcereel,t);if(a===e.sourcereel)break;return{...e,sourcereel:a}}switch(t.type){case"BROWSE_REPL_HISTORY_DOWN":if(null===e[s].replHistory.browseIndex)return e;if(0!==e[s].replHistory.browseIndex){const t=e[s].replHistory.browseIndex-1,a=e[s].replHistory.records[t];return{...e,[s]:{...e[s],replValue:a,replHistory:{...e[s].replHistory,browseIndex:t}}}}{const t=null,a=e[s].replHistory.originalValue,n=e[s].replHistory.records.slice();return{...e,[s]:{...e[s],replValue:a,replHistory:{browseIndex:t,records:n,originalValue:""}}}}case"BROWSE_REPL_HISTORY_UP":const i=e[s].replHistory.records,r=e[s].replHistory.browseIndex;if(0===i.length||null!==r&&void 0===i[r+1])return e;if(null===r){const t=0,a=i.slice(),n=e[s].replValue,r=a[t];return{...e,[s]:{...e[s],replValue:r,replHistory:{...e[s].replHistory,browseIndex:t,records:a,originalValue:n}}}}{const t=r+1,a=i[t];return{...e,[s]:{...e[s],replValue:a,replHistory:{...e[s].replHistory,browseIndex:t}}}}case"CHANGE_EDITOR_HEIGHT":return{...e,[s]:{...e[s],editorHeight:t.payload.height}};case"CHANGE_EDITOR_WIDTH":return{...e,[s]:{...e[s],editorWidth:(parseFloat(e[s].editorWidth.slice(0,-1))+parseFloat(t.payload.widthChange)).toString()+"%"}};case"CHANGE_EXEC_TIME":return{...e,[s]:{...e[s],execTime:t.payload.execTime}};case"CHANGE_SIDE_CONTENT_HEIGHT":return{...e,[s]:{...e[s],sideContentHeight:t.payload.height}};case"CLEAR_REPL_INPUT":return{...e,[s]:{...e[s],replValue:""}};case"CLEAR_REPL_OUTPUT_LAST":return{...e,[s]:{...e[s],output:e[s].output.slice(0,-1)}};case"CLEAR_REPL_OUTPUT":return{...e,[s]:{...e[s],output:[]}};case"END_CLEAR_CONTEXT":return{...e,[s]:{...e[s],context:ht(t.payload.library.chapter,t.payload.library.external.symbols,s,t.payload.library.variant,t.payload.library.moduleParams),globals:t.payload.library.globals}};case"SEND_REPL_INPUT_TO_OUTPUT":let o;return a=e[s].output.concat(t.payload),o=""!==t.payload.value?[t.payload.value].concat(e[s].replHistory.records):e[s].replHistory.records,o.length>ze.maxBrowseIndex&&o.pop(),{...e,[s]:{...e[s],output:a,replHistory:{...e[s].replHistory,records:o}}};case"CHANGE_EXTERNAL_LIBRARY":return{...e,[s]:{...e[s],externalLibrary:t.payload.newExternal}};case"HANDLE_CONSOLE_LOG":if(n=e[s].output.slice(-1)[0],void 0===n||"running"!==n.type)a=e[s].output.concat({type:"running",consoleLogs:[t.payload.logString]});else{const i={type:n.type,consoleLogs:n.consoleLogs.concat(t.payload.logString)};a=e[s].output.slice(0,-1).concat(i)}return{...e,[s]:{...e[s],output:a}};case"LOG_OUT":const l=e.playground;return{...Mt,playground:l};case"EVAL_EDITOR":return{...e,[s]:{...e[s],isRunning:!0,isDebugging:!1}};case"EVAL_REPL":return{...e,[s]:{...e[s],isRunning:!0}};case"EVAL_INTERPRETER_SUCCESS":return n=e[s].output.slice(-1)[0],a=void 0!==n&&"running"===n.type?e[s].output.slice(0,-1).concat({type:t.payload.type,value:t.payload.value,consoleLogs:n.consoleLogs}):e[s].output.concat({type:t.payload.type,value:t.payload.value,consoleLogs:[]}),{...e,[s]:{...e[s],output:a,isRunning:!1,breakpoints:[],highlightedLines:[]}};case"EVAL_TESTCASE_SUCCESS":return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map((e,s)=>s===t.payload.index?{...e,result:t.payload.value,errors:void 0}:e),isRunning:!1}};case"EVAL_TESTCASE_FAILURE":return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map((e,s)=>s===t.payload.index?{...e,result:void 0,errors:t.payload.value}:e)}};case"EVAL_INTERPRETER_ERROR":return n=e[s].output.slice(-1)[0],a=void 0!==n&&"running"===n.type?e[s].output.slice(0,-1).concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:n.consoleLogs}):e[s].output.concat({type:t.payload.type,errors:t.payload.errors,consoleLogs:[]}),{...e,[s]:{...e[s],output:a,isRunning:!1,isDebugging:!1}};case"END_INTERRUPT_EXECUTION":return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!1}};case"END_DEBUG_PAUSE":return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!0}};case"DEBUG_RESUME":return{...e,[s]:{...e[s],isRunning:!0,isDebugging:!1}};case"DEBUG_RESET":return{...e,[s]:{...e[s],isRunning:!1,isDebugging:!1}};case"RESET_TESTCASE":return{...e,[s]:{...e[s],editorTestcases:e[s].editorTestcases.map((e,s)=>s===t.payload.index?{...e,result:void 0,errors:void 0}:e)}};case"RESET_WORKSPACE":return{...e,[s]:{...e[s],...Rt(s),...t.payload.workspaceOptions}};case"INIT_INVITE":return{...e,[s]:{...e[s],sharedbAceInitValue:t.payload.editorValue,sharedbAceIsInviting:!0}};case"FINISH_INVITE":return{...e,[s]:{...e[s],sharedbAceIsInviting:!1}};case"UPDATE_WORKSPACE":return{...e,[s]:{...e[s],...t.payload.workspaceOptions}};case"SET_EDITOR_SESSION_ID":return{...e,[s]:{...e[s],editorSessionId:t.payload.editorSessionId}};case"SET_EDITOR_READONLY":return{...e,[s]:{...e[s],editorReadonly:t.payload.editorReadonly}};case"SET_WEBSOCKET_STATUS":return{...e,[s]:{...e[s],websocketStatus:t.payload.websocketStatus}};case"TOGGLE_EDITOR_AUTORUN":return{...e,[s]:{...e[s],isEditorAutorun:!e[s].isEditorAutorun}};case"UPDATE_ACTIVE_TAB":return{...e,[s]:{...e[s],sideContentActiveTab:t.payload.activeTab}};case"UPDATE_CURRENT_ASSESSMENT_ID":return{...e,assessment:{...e.assessment,currentAssessment:t.payload.assessmentId,currentQuestion:t.payload.questionId}};case"UPDATE_CURRENT_SUBMISSION_ID":return{...e,grading:{...e.grading,currentSubmission:t.payload.submissionId,currentQuestion:t.payload.questionId}};case"UPDATE_EDITOR_VALUE":return{...e,[s]:{...e[s],editorValue:t.payload.newEditorValue}};case"HIGHLIGHT_LINE":return{...e,[s]:{...e[s],highlightedLines:t.payload.highlightedLines}};case"MOVE_CURSOR":return{...e,[s]:{...e[s],newCursorPosition:t.payload.cursorPosition}};case"UPDATE_REPL_VALUE":return{...e,[s]:{...e[s],replValue:t.payload.newReplValue}};case"UPDATE_HAS_UNSAVED_CHANGES":return{...e,[s]:{...e[s],hasUnsavedChanges:t.payload.hasUnsavedChanges}};case"UPDATE_CHAPTER":return{...e,playground:{...e.playground,context:{...e.playground.context,chapter:t.payload.chapter,variant:t.payload.variant}}};case"NOTIFY_PROGRAM_EVALUATED":return{...e,[s]:{...e[s],debuggerContext:{...e[s].debuggerContext,result:t.payload.result,lastDebuggerResult:t.payload.lastDebuggerResult,code:t.payload.code,context:t.payload.context,workspaceLocation:t.payload.workspaceLocation}}};default:return e}},lr=(e=Pt,t)=>e;var cr=e=>Object(O.c)({router:Object(E.b)(e),academy:nr,application:lr,dashboard:ir,playground:rr,session:Lt,workspaces:or});const dr=e=>Object(w.action)("FINISH_INVITE",{workspaceLocation:e}),ur=(e,t)=>Object(w.action)("INIT_INVITE",{editorValue:e,workspaceLocation:t}),hr=()=>Object(w.action)("INVALID_EDITOR_SESSION_ID"),pr=(e,t)=>Object(w.action)("SET_EDITOR_SESSION_ID",{workspaceLocation:e,editorSessionId:t}),mr=(e,t)=>Object(w.action)("SET_WEBSOCKET_STATUS",{workspaceLocation:e,websocketStatus:t}),gr=e=>Object(w.action)("SAVE_CANVAS",e),yr=(e,t,s)=>Object(w.action)("CHANGE_DATE_ASSESSMENT",{id:e,openAt:t,closeAt:s}),Er=e=>Object(w.action)("DELETE_ASSESSMENT",e),br=(e,t)=>Object(w.action)("PUBLISH_ASSESSMENT",{id:t,togglePublishTo:e}),vr=(e,t)=>Object(w.action)("UPLOAD_ASSESSMENT",{file:e,forceUpdate:t}),Sr=()=>Object(w.action)("PERSISTENCE_OPEN_PICKER"),fr=e=>Object(w.action)("PERSISTENCE_SAVE_FILE",e),Cr=()=>Object(w.action)("PERSISTENCE_SAVE_FILE_AS"),Ar=()=>Object(w.action)("PERSISTENCE_INITIALISE"),Or=()=>Object(w.action)("GENERATE_LZ_STRING"),wr=e=>Object(w.action)("SHORTEN_URL",e),Tr=e=>Object(w.action)("UPDATE_SHORT_URL",e),Ir=e=>Object(w.action)("TOGGLE_USING_SUBST",e),kr=e=>Object(w.action)("CHANGE_QUERY_STRING",e),Pr=e=>Object(w.action)("PLAYGROUND_UPDATE_PERSISTENCE_FILE",e),xr=e=>Object(w.action)("FETCH_SOURCECAST_INDEX",{workspaceLocation:e}),Nr=(e,t)=>Object(w.action)("UPDATE_SOURCECAST_INDEX",{index:e,workspaceLocation:t}),Rr=(e,t,s,a,n)=>Object(w.action)("SAVE_SOURCECAST_DATA",{title:e,description:t,audio:s,audioUrl:window.URL.createObjectURL(s),playbackData:a,workspaceLocation:n}),Mr=(e,t)=>Object(w.action)("SET_CURRENT_PLAYER_TIME",{playerTime:e,workspaceLocation:t}),_r=(e,t)=>Object(w.action)("SET_CODE_DELTAS_TO_APPLY",{deltas:e,workspaceLocation:t}),Dr=(e,t)=>Object(w.action)("SET_INPUT_TO_APPLY",{inputToApply:e,workspaceLocation:t}),Lr=(e,t,s,a,n)=>Object(w.action)("SET_SOURCECAST_DATA",{title:e,description:t,audioUrl:s,playbackData:a,workspaceLocation:n}),jr=(e,t)=>Object(w.action)("SET_SOURCECAST_PLAYBACK_DURATION",{duration:e,workspaceLocation:t}),Br=(e,t)=>Object(w.action)("SET_SOURCECAST_PLAYBACK_STATUS",{playbackStatus:e,workspaceLocation:t}),Gr=(e,t)=>Object(w.action)("DELETE_SOURCECAST_ENTRY",{id:e,workspaceLocation:t}),Ur=(e,t)=>Object(w.action)("RECORD_INIT",{initData:e,workspaceLocation:t}),Hr=(e,t)=>Object(w.action)("RECORD_INPUT",{input:e,workspaceLocation:t}),Vr=(e,t)=>Object(w.action)("RESET_INPUTS",{inputs:e,workspaceLocation:t}),Fr=e=>Object(w.action)("TIMER_PAUSE",{timeNow:Date.now(),workspaceLocation:e}),qr=e=>Object(w.action)("TIMER_RESET",{workspaceLocation:e}),Xr=(e,t)=>Object(w.action)("TIMER_RESUME",{timeBefore:e,timeNow:Date.now(),workspaceLocation:t}),Wr=e=>Object(w.action)("TIMER_START",{timeNow:Date.now(),workspaceLocation:e}),zr=e=>Object(w.action)("TIMER_STOP",{timeNow:Date.now(),workspaceLocation:e}),Yr={...n,...l,...o,...r,...h,...i,...p,...m,...g,...a,...d,...c,...u},$r=[...[{category:zt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",grade:1,id:1,maxGrade:3e3,maxXp:1e3,openAt:"2038-06-18T05:24:26.026Z",title:"An Odessey to Runes (Duplicate)",shortSummary:"This is a test for the UI of the unopened assessment overview. It links to the mock Mission 0",status:Xt.not_attempted,story:"mission-1",xp:0,gradingStatus:Wt.none}],...[{category:zt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/300/",grade:2,id:1,maxGrade:3e3,maxXp:1e3,openAt:"2018-06-18T05:24:26.026Z",title:"An Odessey to Runes",shortSummary:"\n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor\n  incididunt ut labore et dolore magna aliqua.\n  \n  ```\n  const a = 5;\n  ```\n  \n  Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium\n  _doloremque laudantium_, totam rem aperiam, eaque ipsa quae ab illo inventore\n  [veritatis et quasi architecto](google.com) beatae vitae dicta sunt\n  `explicabo`.\n  \n  ",status:Xt.attempted,story:"mission-1",xp:1,gradingStatus:Wt.none},{category:zt.Mission,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=World&font=lobster",grade:3,id:2,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"The Secret to Streams",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Xt.attempting,story:"mission-2",xp:2,gradingStatus:Wt.none},{category:zt.Sidequest,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",grade:4,id:3,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Sidequest",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Xt.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:Wt.none},{category:zt.Path,closeAt:"2069-04-20T01:23:45.111Z",coverImage:"https://fakeimg.pl/700x400/417678,64/?text=%E3%83%91%E3%82%B9&font=noto",grade:0,id:6,maxGrade:0,maxXp:200,openAt:"2018-01-01T00:00:00.000Z",title:"Basic logic gates",shortSummary:"This mock path serves as a demonstration of the support provided for mock programming path functionality.",status:Xt.not_attempted,story:null,xp:0,gradingStatus:Wt.excluded},{category:zt.Practical,closeAt:"2048-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/?text=Hello",grade:4,id:5,maxGrade:3e3,maxXp:1e3,openAt:"2018-07-18T05:24:26.026Z",title:"A sample Practical",shortSummary:"Once upon a time, Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin nec vulputate sapien. Fusce vel lacus fermentum, efficitur ipsum.",status:Xt.not_attempted,story:"sidequest-2.1",xp:3,gradingStatus:Wt.none,private:!0}],...[{category:zt.Mission,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",grade:2700,id:4,maxGrade:3e3,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"A closed Mission",shortSummary:"This is a test for the grading status tooltip when the assessment is partially graded (undergoing manual grading). It should render as an orange clock.",status:Xt.submitted,story:"mission-3",xp:800,gradingStatus:Wt.grading},{category:zt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",grade:1950,id:5,maxGrade:3e3,maxXp:1e3,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (not graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is not graded. It should render as a red cross.",status:Xt.submitted,story:null,xp:500,gradingStatus:Wt.none},{category:zt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000,128/000,255",grade:300,id:5,maxGrade:700,maxXp:500,openAt:"2007-07-18T05:24:26.026Z",title:"Closed (fully graded) Sidequest",shortSummary:"This is a test for the grading status tooltip when the assessment is fully graded. It should render as a green tick. This sidequest links to the mock Sidequest 4.",status:Xt.submitted,story:null,xp:150,gradingStatus:Wt.graded},{category:zt.Sidequest,closeAt:"2008-06-18T05:24:26.026Z",coverImage:"https://fakeimg.pl/350x200/ff0000/000",grade:0,id:5,maxGrade:0,maxXp:0,openAt:"2007-07-18T05:24:26.026Z",title:"Ungraded assessment",shortSummary:"This is a test for the grading status tooltip when the assessment does not require manual grading (e.g. paths and contests). It should render as a blue disable sign. This sidequest links to the mock Sidequest 4.",status:Xt.submitted,story:null,xp:100,gradingStatus:Wt.excluded}]],Kr=[["testNumber",3.141592653589793],["testString","who dat boi"],["testBooleanTrue",!0],["testBooleanFalse",!1],["testBooleanUndefined",void 0],["testBooleanNull",null],["testObject",{a:1,b:2}],["testArray",[1,2,"a","b"]]],Qr={chapter:4,external:{name:gt.SOUNDS,symbols:Ct.get(gt.SOUNDS)},globals:Kr},Jr={chapter:1,external:{name:gt.RUNES,symbols:Ct.get(gt.RUNES)},globals:Kr},Zr={chapter:4,external:{name:gt.CURVES,symbols:Ct.get(gt.CURVES)},globals:Kr},eo={chapter:4,external:{name:gt.SOUNDS,symbols:["get_matrix"]},globals:Kr},to=[{autogradingResults:[],answer:null,content:"\n  This question has an id of `0`.\n  \n  ```\n  What's your favourite dinner food?\n  ```\n  ",roomId:null,id:0,library:Qr,prepend:'const pizza = "pizza";\n  const sushi = "sushi";\n  const chickenrice = "chicken rice";',postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:Yt.public,program:"answer();",score:1,answer:'"pizza"'},{type:Yt.public,program:"answer();",score:1,answer:'"sushi"'},{type:Yt.public,program:"answer();",score:1,answer:'"chicken rice"'}],solutionTemplate:"function answer() {\n      // Write something here!\n  }\n  ",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2},{autogradingResults:[],answer:"function areaOfCircle(x) {\n      return square(x) * pi;\n  }\n  \n  function volumeOfSphere(x) {\n      return 4 / 3 * cube(x) * pi;\n  }",roomId:"19422043",content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:Jr,prepend:"const square = x => x * x;\n  const cube = x => x * x * x;\n  const pi = 3.1415928;",postpend:"",testcases:[{type:Yt.public,program:"areaOfCircle(5);",score:1,answer:"78.53982"},{type:Yt.public,program:"volumeOfSphere(5);",score:1,answer:"523.5988"}],solutionTemplate:"function areaOfCircle(x) {\n      // return area of circle\n  }\n  \n  function volumeOfSphere(x) {\n      // return volume of sphere\n  }",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2},{answer:3,roomId:"19422046",content:"This is the 3rd question. Oddly enough, it is an ungraded MCQ question that uses the curves library! Option C has a null hint!",choices:[{content:"**Option** `A`",hint:"_hint_ A is `here`"},{content:"### B",hint:"hint B"},{content:"C",hint:null},{content:"D",hint:"hint D"}],id:2,library:Zr,type:"mcq",solution:0,xp:0,grade:0,maxGrade:2,maxXp:2},{answer:3,roomId:null,content:"This is the 4rth question. Oddly enough, it is a graded MCQ question that uses the curves library!",choices:[{content:"A",hint:null},{content:"B",hint:null},{content:"C",hint:null},{content:"D",hint:null}],id:3,library:Zr,type:"mcq",solution:null,xp:0,grade:0,maxGrade:2,maxXp:2},{autogradingResults:[],answer:null,roomId:"19422032",content:"You have reached the last question! Have some fun with the tone matrix...",id:4,library:eo,prepend:"",postpend:"",testcases:[],solutionTemplate:"5th question mock solution template",type:"programming",xp:0,grade:0,maxGrade:2,maxXp:2}],so=[{answer:"function fibonacci(n) {\n      if (n <= 2) {\n          return 1;\n      } else {\n          return fibonacci(n-1) + fibonacci(n-2);\n      }\n  }",roomId:"19422032",content:"You can see autograding results!!!",id:0,library:Zr,prepend:"",postpend:"// This is a mock Postpend! You shouldn't be able to see me!",testcases:[{type:Yt.public,program:"fibonacci(3);",score:1,answer:"2"},{type:Yt.public,program:"fibonacci(4);",score:1,answer:"3"},{type:Yt.public,program:"fibonacci(5);",score:1,answer:"5"}],solutionTemplate:"function fibonacci(n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,grade:0,maxGrade:2,maxXp:2,comments:"Good job. You are awarded the full marks!\n  \n  ----\n  ## markdown test\n  \n  # header\n  \n  **bold**\n  \n  _italics_\n  \n  * list\n  \n  1. numbered list\n  \n  - [] checkboxes\n  \n  > quote\n  \n      code\n  \n  [link to Source Academy](https://sourceacademy.nus.edu.sg)  \n  \n  ![](image-url-goes-here)",autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},{answer:"function recurse(rune, n) {\n      return n <= 1 ? rune : make_cross(recurse(rune, n - 1));\n  }",roomId:"19422033",content:"This is a runes question - there are no testcases nor autograding results.",id:1,library:Jr,prepend:"",postpend:"",testcases:[],solutionTemplate:"function recurse(rune, n) {\n      // Your answer here\n  }",type:"programming",grader:{name:"some avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:0,grade:0,maxGrade:2,maxXp:2,comments:"You open the Report Card, not knowing what to expect...\n  \n      ## WOW!\n      Amazing grasp of runes. We can now move on to the next assignment.\n      \n      <br/>\n      \n      Robot Dog: `woof`\n      \n      You look at the display of the robot dog.\n      \n          FEED ME\n      1. Bread\n      2. Water\n      \n      <br/>\n      \n      * I am hungry.\n      * I am thirsty.\n      \n      <br/>\n      <br/>\n          \n      New message from **Avenger**!\n      \n      > _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n      \n      > _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n      \n      > Best regards, Avocado A. Avenger\n      \n      #### Upcoming Tasks\n      - [] Meet Avenger Avenger at Level X-05\n      - [] Open the Pod Bay Doors",autogradingResults:[]}],ao=[{answer:null,roomId:null,content:"As a recap: which of the following is not a valid logic gate?",choices:[{content:"XOR gate",hint:"This is the exclusive-OR gate!"},{content:"IF gate",hint:"Correct!"},{content:"AND gate",hint:"This logic gate exists!"},{content:"OR gate",hint:"This logic gate exists!"}],id:0,library:Jr,type:"mcq",solution:1,xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"An AND gate is a digital logic gate that implements logical conjunction on its inputs. It returns a single output that is HIGH (active) iff all the inputs to the AND gate are HIGH (active).\n  \n  In this question, let us model an AND gate as a function, and treat HIGH (active) inputs as the boolean value `true` and LOW (inactive) inputs as the boolean value `false`.\n  \n  As an AND gate is not restricted to exactly two inputs, our function shall be the same. Implement the function `AND(inputs)` which takes in the list `inputs` (a list of boolean values), and returns the output of the AND gate as a boolean. You may assume the list `inputs` is of minimum length 2.\n  \n  This question makes use of the sentinel function method to throw custom errors for each testcase.",id:1,library:Jr,prepend:"const OR = (x, y) => x || y;",postpend:"\n  const __AND = (xs) => {\n    if (AND(list(true, true)) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = AND(xs);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (equal(xs, list(true, false)) && result) {\n      error('Check the truth table for an AND gate again!');\n    } else if (equal(xs, list(true, true, false)) && result) {\n      error('Are you using all inputs in the list?');\n    } else if (equal(xs, list(true, true, true)) && !result) {\n      error('Are you sure your base case is correct?');\n    } else if (AND(list(true, true)) === AND(list(false, false))) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:Yt.public,program:"__AND(list(true, false));",score:0,answer:"false"},{type:Yt.public,program:"__AND(list(true, true, false));",score:0,answer:"false"},{type:Yt.public,program:"__AND(list(true, OR(true, false), OR(true, true)));",score:0,answer:"true"},{type:Yt.hidden,program:"__AND(list(true, OR(false, true), AND(list(true, false)), false));",score:0,answer:"false"},{type:Yt.hidden,program:"__AND(list(true, OR(true, false), OR(true, AND(list(false, true))), true));",score:0,answer:"true"}],solutionTemplate:"function AND(inputs) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"The XOR (exclusive-OR) gate is a digital logic gate that accepts two inputs and returns a single output that is HIGH (active) iff one of the inputs are HIGH (active), but not both.\n  \n  In this question, let us model the XOR gate as a function. Implement the function `XOR(x, y)` which takes two boolean inputs `x` and `y` and which returns the output of the XOR gate as a boolean.\n  \n  This question makes use of the wrapping container method to throw custom errors for each testcase.",id:2,library:Jr,prepend:"",postpend:"\n  const __XOR = (x, y) => {\n    if (XOR(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    const result = XOR(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (((x && !y) || (y && !x)) && !result) {\n      error('Check your truth tables!');\n    } else if (XOR(false, false) === XOR(false, true)) {\n      error('Oi! Do not hardcode values!');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:Yt.public,program:"__XOR(true, false);",score:0,answer:"true"},{type:Yt.public,program:"__XOR(false, true);",score:0,answer:"true"},{type:Yt.hidden,program:"__XOR(true, XOR(true, false));",score:0,answer:"false"}],solutionTemplate:"function XOR(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0},{autogradingResults:[],answer:null,roomId:null,content:"The NOR logic gate is special in that it is an _universal logic gate_, that is to say, they can be composed to form any other logic gate.\n  \n  Implement the AND logic gate **using ONLY the NOR logic gate**, as the `NOR_AND(x, y)` function that takes in two booleans as input.\n  \n  The `NOR` function modeled after a NOR gate is provided for you - it accepts two boolean values and returns `true` iff both inputs are `false`.",id:3,library:Jr,prepend:"\n  let counter = 0;\n  const NOR = (x, y) => {\n    counter = counter + 1;\n    return !(x || y);\n  };",postpend:"\n  const __NOR_AND = (x, y) => {\n    if (NOR_AND(false, false) === undefined) {\n      error('Your function is empty!');\n    } else {}\n    \n    counter = 0;\n    const result = NOR_AND(x, y);\n  \n    if (!is_boolean(result)) {\n      error('Your function does not return a boolean!');\n    } else {}\n    \n    if (!x && y && result) {\n      error('Check your truth tables!');\n    } else if (x && y && !result && counter > 0) {\n      error('Nope! Try again :)');\n    } else if (x && y && !result) {\n      error('...You did not use NOR and still got it wrong!');\n    } else if (x && y && result && counter !== 3) {\n      error('Did you use NOR in your solution? >:(');\n    } else if (x && !y && counter !== 6) {\n      error('Incorrect number of calls.');\n    } else {\n      return result;\n    }\n  };",testcases:[{type:Yt.public,program:"__NOR_AND(false, true);",score:0,answer:"false"},{type:Yt.public,program:"__NOR_AND(true, true);",score:0,answer:"true"},{type:Yt.hidden,program:"__NOR_AND(true, NOR_AND(false, true));",score:0,answer:"false"}],solutionTemplate:"function NOR_AND(x, y) {\n      // Your answer here!\n  }",type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],no=[{category:"Mission",id:1,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:to,title:"An Odessey to Runes"},{category:"Mission",id:2,longSummary:"This is the mission briefing. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:to,title:"The Secret to Streams"},{category:zt.Sidequest,id:3,longSummary:"###This is the sidequest briefing.\n  \n  *Lorem ipsum* dolor sit amet, consectetur adipiscing elit.\n  \n  > Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin\n  enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis\n  vestibulum.\n  \n  - Etiam in egestas dolor.\n  - Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum,\n    vel ornare metus turpis sed justo.\n  - Vivamus at tellus sed ex convallis commodo at in lectus.\n  \n  ```\n  Pellentesque\n  pharetra\n  pulvinar\n  sapien\n  ```",missionPDF:"www.google.com",questions:to,title:"A sample Sidequest"},{category:zt.Mission,id:4,longSummary:"This is the closed mission briefing. The save button should not be there. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas viverra, sem scelerisque ultricies ullamcorper, sem nibh sollicitudin enim, at ultricies sem orci eget odio. Pellentesque varius et mauris quis vestibulum. Etiam in egestas dolor. Nunc consectetur, sapien sodales accumsan convallis, lectus mi tempus ipsum, vel ornare metus turpis sed justo. Vivamus at tellus sed ex convallis commodo at in lectus. Pellentesque pharetra pulvinar sapien pellentesque facilisis. Curabitur efficitur malesuada urna sed aliquam. Quisque massa metus, aliquam in sagittis non, cursus in sem. Morbi vel nunc at nunc pharetra lobortis. Aliquam feugiat ultricies ipsum vel sollicitudin. Vivamus nulla massa, hendrerit sit amet nibh quis, porttitor convallis nisi. ",missionPDF:"www.google.com",questions:so,title:"A Closed Mission"},{category:zt.Sidequest,id:5,longSummary:"This is the closed sidequest briefing. The save button should not exist. This is a placeholder sidequest for testing rendering of grading statuses.",missionPDF:"www.google.com",questions:so,title:"A Closed Sidequest"},{category:zt.Path,id:6,longSummary:"### Basic logic gates\n  \n  This path is intended to demonstrate concepts from the lecture **Logic Circuits**. You are strongly encouraged to attempt this path to check your understanding, prior to the next Studio session. For this, you will be granted a small amount of XP!\n  \n  The path comprises 4 questions and is fully autograded and guided, and there are **no private test cases** - there will be no manual review by default. Please consult your Avenger if you require assistance!</TEXT>",missionPDF:"www.google.com",questions:ao,title:"A sample guided path"}];let io;!function(e){e.student="student",e.trainer="trainer",e.admin="admin"}(io||(io={}));const ro=(e,t=io.trainer)=>t,oo=[{id:1,type:Ra.deadline,assessment_id:3,assessment_type:zt.Sidequest,assessment_title:"The Secret to Streams"},{id:2,type:Ra.autograded,assessment_id:4,assessment_type:zt.Mission,assessment_title:"A Closed Mission"},{id:3,type:Ra.graded,assessment_id:4,assessment_type:zt.Mission,assessment_title:"A Closed Mission"},{id:4,type:Ra.new,assessment_id:6,assessment_type:zt.Path,assessment_title:"Basic Logic"},{id:5,type:Ra.new,assessment_id:7,assessment_type:zt.Mission,assessment_title:"Symphony of the Winds"},{id:6,type:Ra.submitted,submission_id:1,assessment_type:zt.Mission,assessment_title:"Mission 0"},{id:7,type:Ra.submitted,submission_id:2,assessment_type:zt.Mission,assessment_title:"Mission 1"},{id:8,type:Ra.submitted,submission_id:3,assessment_type:zt.Mission,assessment_title:"Mission 0"}],lo=[{gradeAdjustment:0,xpAdjustment:0,assessmentCategory:"Mission",assessmentId:0,assessmentName:"Mission 0 ",currentGrade:69,currentXp:69,xpBonus:10,initialGrade:69,initialXp:69,maxGrade:100,maxXp:100,studentId:0,studentName:"Al Gorithm",submissionId:1,submissionStatus:"submitted",groupName:"1D",gradingStatus:"graded",questionCount:6,gradedCount:6},{gradeAdjustment:-2,xpAdjustment:-2,assessmentCategory:"Mission",assessmentId:1,assessmentName:"Mission 1",currentGrade:-2,currentXp:-2,xpBonus:12,initialGrade:0,initialXp:0,maxGrade:400,maxXp:400,studentId:0,studentName:"Dee Sign",submissionId:2,submissionStatus:"submitted",groupName:"1F",gradingStatus:"grading",questionCount:6,gradedCount:2},{gradeAdjustment:4,xpAdjustment:4,assessmentCategory:"Mission",assessmentId:0,assessmentName:"Mission 0",currentGrade:1e3,currentXp:1e3,xpBonus:12,initialGrade:996,initialXp:996,maxGrade:1e3,maxXp:1e3,studentId:1,studentName:"May Trix",submissionId:3,submissionStatus:"submitted",groupName:"1F",gradingStatus:"none",questionCount:6,gradedCount:0}],co=[{question:{answer:"function remainder(n, d) {\n  return (n - d) < 0 ? n : remainder(n - d, d);\n}",content:"\nHello and welcome to this assessment! This is the *0th question*.\n\n```\n>>> import this\n```\n",prepend:"// THIS IS A PREPEND",postpend:"// THIS IS A POSTPEND",testcases:[{type:Yt.public,program:"remainder(12, 7);",score:1,answer:"5"},{type:Yt.public,program:"remainder(6, 1);",score:2,answer:"0"},{type:Yt.private,program:"remainder(-15, 6);",score:2,answer:"-3"},{type:Yt.private,program:"remainder(17, 23) === 17;",score:2,answer:"true"}],roomId:null,id:0,library:Jr,solutionTemplate:"0th question mock solution template",solution:"This is how the 0th question is solved. [7 points]\n\nfunction remainder(n, d) {\n  return n % d;\n}",type:"programming",maxGrade:1e3,maxXp:1e3,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:0,xp:0,roomId:"19422040",comments:"Good job. You are awarded the full marks!\n\n----\n## markdown test\n\n# header\n\n**bold**\n\n_italics_\n\n* list\n\n1. numbered list\n\n- [] checkboxes\n\n> quote\n\n    code\n\n[link to Source Academy](https://sourceacademy.nus.edu.sg)\n\n![](image-url-goes-here)\n      ",grader:{name:"HARTIN MENZ",id:100},gradedAt:"2019-08-16T13:26:32+00:00"},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:"This student's answer to the 1st question",roomId:null,content:"Hello and welcome to this assessment! This is the 1st question.",id:1,library:Jr,solutionTemplate:"1st question mock solution template",solution:null,type:"programming",maxGrade:200,maxXp:200,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:100,xp:100,roomId:"19422040",comments:"You open the Report Card, not knowing what to expect...\n\n## WOW!\nAmazing grasp of runes. We can now move on to the next assignment.\n\n<br/>\n\nRobot Dog: `woof`\n\nYou look at the display of the robot dog.\n\n    FEED ME\n1. Bread\n2. Water\n\n<br/>\n\n* I am hungry.\n* I am thirsty.\n\n<br/>\n<br/>\n\nNew message from **Avenger**!\n\n> _Cadet, please meet me at Level X-05, outside the pod bay doors. There is an important mission awaiting us._\n\n> _May the [Source](https://sourceacademy.nus.edu.sg) be with you._\n\n> Best regards, Avocado A. Avenger\n\n#### Upcoming Tasks\n- [] Meet Avenger Avenger at Level X-05\n- [] Open the Pod Bay Doors\n      "},student:{name:"Al Gorithm",id:0}},{question:{prepend:"",postpend:"",testcases:[],answer:3,roomId:null,solution:2,content:"Hello and welcome to this assessment! This is the 2nd question. Oddly enough, it is an MCQ question!",choices:[{content:"A",hint:"hint A"},{content:"B",hint:"hint B"},{content:"C",hint:"hint C"},{content:"D",hint:"hint D"}],id:2,library:Jr,type:"mcq",maxGrade:100,maxXp:100,grader:{name:"avenger",id:1},gradedAt:"2038-06-18T05:24:26.026Z",xp:1,grade:1,autogradingResults:[{resultType:"pass"},{resultType:"fail",expected:"8",actual:"5"},{resultType:"error",errors:[{errorType:"timeout"},{errorType:"syntax",line:1,location:"student",errorLine:"function fibonacci(n) {",errorExplanation:"Just kidding!"}]}]},grade:{gradeAdjustment:0,xpAdjustment:0,grade:50,xp:50,roomId:"19422030"},student:{name:"Al Gorithm",id:0}}],uo=[{leaderName:"John",groupName:"Mock Group 1",ungradedMissions:123,submittedMissions:200,ungradedSidequests:100,submittedSidequests:117},{leaderName:"Molly",groupName:"Mock Group 2",ungradedMissions:1232,submittedMissions:205430,ungradedSidequests:345,submittedSidequests:11547},{leaderName:"Lenny",groupName:"Mock Group 3",ungradedMissions:1532,submittedMissions:22200,ungradedSidequests:134500,submittedSidequests:6777}];function*ho(){yield Object(tr.h)("FETCH_AUTH",(function*(e){al.dispatch(Yr.setTokens({accessToken:"accessToken",refreshToken:"refreshToken"})),al.dispatch(Yr.setUser({name:"DevStaff",role:"staff",group:"1F",story:{story:"mission-1",playStory:!0},grade:0,gameState:{}})),yield xs.push("/academy")})),yield Object(tr.h)("FETCH_ASSESSMENT_OVERVIEWS",(function*(){yield Object(tr.d)(Yr.updateAssessmentOverviews([...$r]))})),yield Object(tr.h)("FETCH_ASSESSMENT",(function*(e){const t=e.payload,s=no[t-1];yield Object(tr.d)(Yr.updateAssessment({...s}))})),yield Object(tr.h)("FETCH_GRADING_OVERVIEWS",(function*(e){yield Object(tr.f)(e=>e.session.accessToken);const t=e.payload,s=yield Object(tr.a)(()=>((e,t)=>{const s=[io.admin,io.trainer],a=ro();return null!==a&&s.includes(a)?t?[lo[0]]:lo.sort((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId):null})(0,t));null!==s&&(yield Object(tr.d)(Yr.updateGradingOverviews([...s])))})),yield Object(tr.h)("FETCH_GRADING",(function*(e){const t=e.payload,s=(yield Object(tr.f)(e=>e.session.accessToken),yield Object(tr.a)(()=>((e,t)=>{const s=[io.admin,io.trainer],a=ro();return null!==a&&s.includes(a)?co:null})()));null!==s&&(yield Object(tr.d)(Yr.updateGrading(t,[...s])))})),yield Object(tr.h)("SUBMIT_ANSWER",(function*(e){const t=e.payload.id,s=e.payload.answer,a=yield Object(tr.f)(e=>e.workspaces.assessment.currentAssessment),n=yield Object(tr.f)(e=>e.session.assessments.get(a)),i=n.questions.slice().map(e=>(e.id===t&&(e.answer=s),e)),r={...n,questions:i};return yield Object(tr.d)(Yr.updateAssessment(r)),yield Object(tr.a)(Rs,"Saved!",1e3),yield Object(tr.d)(Yr.updateHasUnsavedChanges("assessment",!1))})),yield Object(tr.h)("UNSUBMIT_SUBMISSION",(function*(e){const{submissionId:t}=e.payload,s=yield Object(tr.f)(e=>e.session.gradingOverviews||[]);if(-1===s.findIndex(e=>e.submissionId===t&&"submitted"===e.submissionStatus))return void(yield Object(tr.a)(Ms,"400: Bad Request"));const a=s.map(e=>e.submissionId===t?{...e,submissionStatus:"attempted"}:e);yield Object(tr.a)(Rs,"Unsubmitted!",1e3),yield Object(tr.d)(Yr.updateGradingOverviews(a))}));const e=function*(e){const{submissionId:t,questionId:s,gradeAdjustment:a,xpAdjustment:n,comments:i}=e.payload,r=(yield Object(tr.f)(e=>e.session.gradings.get(t))).slice().map(e=>(e.question.id===s&&(e.grade={gradeAdjustment:a,xpAdjustment:n,roomId:e.grade.roomId,grade:e.grade.grade,xp:e.grade.xp,comments:i}),e));yield Object(tr.d)(Yr.updateGrading(t,r)),yield Object(tr.a)(Rs,"Submitted!",1e3)};yield Object(tr.h)("SUBMIT_GRADING",e),yield Object(tr.h)("SUBMIT_GRADING_AND_CONTINUE",(function*(t){const{submissionId:s}=t.payload;yield*e(t);const a=yield Object(tr.f)(e=>e.workspaces.grading.currentQuestion);yield xs.push(`/academy/grading/${s}/${(a||0)+1}`)})),yield Object(tr.h)("ACKNOWLEDGE_NOTIFICATIONS",(function*(e){const t=e.payload.withFilter,s=yield Object(tr.f)(e=>e.session.notifications);let a=s;if(t&&(a=t(s)),0===a.length)return;const n=a.map(e=>e.id),i=s.filter(e=>!n.includes(e.id));yield Object(tr.d)(Yr.updateNotifications(i))})),yield Object(tr.h)("FETCH_NOTIFICATIONS",(function*(e){yield Object(tr.d)(Yr.updateNotifications(oo))})),yield Object(tr.h)("FETCH_GROUP_GRADING_SUMMARY",(function*(){yield Object(tr.d)(Yr.updateGroupGradingSummary([...uo]))}))}function po(e){const t=ze.authProviders.get(e);if(!t)return;const s=""===window.location.port?"":":"+window.location.port;return`${window.location.protocol}//${window.location.hostname}${s}/login${t.isDefault?"":"?provider="+encodeURIComponent(e)}`}var mo=function*(){yield Object(tr.h)("FETCH_AUTH",(function*(e){const{code:t,providerId:s}=e.payload,a=s||([...ze.authProviders.entries()].find(([e,{isDefault:t}])=>t)||[null])[0];if(!a)return yield Object(tr.a)(Ms,"Could not log in; invalid provider or no providers configured."),yield xs.push("/");const n=function(e){const t=ze.authProviders.get(e);if(t)try{return new URL(t.endpoint).searchParams.get("client_id")||void 0}catch(s){return t.endpoint||void 0}}(a),i=po(a),r=yield Object(tr.a)(nl,t,a,n,i);if(!r)return yield xs.push("/");const o=yield Object(tr.a)(il,r);if(!o)return yield xs.push("/");yield Object(tr.d)(Yr.setTokens(r)),yield Object(tr.d)(Yr.setUser(o)),yield xs.push("/academy")})),yield Object(tr.h)("FETCH_ASSESSMENT_OVERVIEWS",(function*(){const e=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),t=yield Object(tr.a)(rl,e);t&&(yield Object(tr.d)(Yr.updateAssessmentOverviews(t)))})),yield Object(tr.h)("FETCH_ASSESSMENT",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield Object(tr.a)(ol,s,t);a&&(yield Object(tr.d)(Yr.updateAssessment(a)))})),yield Object(tr.h)("SUBMIT_ANSWER",(function*(e){if((yield Object(tr.f)(e=>e.session.role))!==Ot.Student)return yield Object(tr.a)(Ms,"Answer rejected - only students can submit answers.");const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload.id,a=e.payload.answer,n=yield Object(tr.a)(ll,s,a,t),i=new Map([[400,"Answer rejected - can't save an empty answer."],[403,"Answer rejected - assessment not open or already finalised."]]);if(!n||!n.ok)return void(yield fl(n,i));yield Object(tr.a)(Rs,"Saved!",1e3);const r=yield Object(tr.f)(e=>e.workspaces.assessment.currentAssessment),o=yield Object(tr.f)(e=>e.session.assessments.get(r)),l=o.questions.slice().map(e=>e.id===s?{...e,answer:a}:e),c={...o,questions:l};return yield Object(tr.d)(Yr.updateAssessment(c)),yield Object(tr.d)(Yr.updateHasUnsavedChanges("assessment",!1))})),yield Object(tr.h)("SUBMIT_ASSESSMENT",(function*(e){if((yield Object(tr.f)(e=>e.session.role))!==Ot.Student)return yield Object(tr.a)(Ms,"Submission rejected - only students can submit assessments.");const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield Object(tr.a)(cl,s,t),n=new Map([[400,"Not allowed to finalise - some questions are unattempted."],[403,"Not allowed to finalise - assessment not open or already finalised."]]);if(!a||!a.ok)return void(yield fl(a,n));yield Object(tr.a)(Rs,"Submitted!",2e3);const i=(yield Object(tr.f)(e=>e.session.assessmentOverviews)).map(e=>e.id===s?{...e,status:Xt.submitted}:e);return yield Object(tr.d)(Yr.updateAssessmentOverviews(i))})),yield Object(tr.h)("FETCH_GRADING_OVERVIEWS",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield Object(tr.a)(dl,t,s);a&&(yield Object(tr.d)(Yr.updateGradingOverviews(a)))})),yield Object(tr.h)("FETCH_GRADING",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield Object(tr.a)(ul,s,t);a&&(yield Object(tr.d)(Yr.updateGrading(s,a)))})),yield Object(tr.h)("UNSUBMIT_SUBMISSION",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),{submissionId:s}=e.payload,a=yield async function(e,t){return await Sl(`grading/${e}/unsubmit`,"POST",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(s,t),n=new Map([[400,"Not allowed to unsubmit - submission incomplete or not submitted."],[403,"Not allowed to unsubmit - not this student's Avenger or an Admin."]]);if(!a||!a.ok)return void(yield fl(a,n));const i=(yield Object(tr.f)(e=>e.session.gradingOverviews||[])).map(e=>e.submissionId===s?{...e,submissionStatus:"attempted"}:e);yield Object(tr.a)(Rs,"Unsubmit successful",1e3),yield Object(tr.d)(Yr.updateGradingOverviews(i))}));const e=function*(e){if((yield Object(tr.f)(e=>e.session.role))===Ot.Student)return yield Object(tr.a)(Ms,"Only staff can submit answers.");const{submissionId:t,questionId:s,gradeAdjustment:a,xpAdjustment:n,comments:i}=e.payload,r=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),o=yield hl(t,s,a,n,r,i),l=new Map([[400,"Grading rejected - missing permissions or invalid grade parameters."],[405,"Not allowed to grade - submission incomplete or not submitted."]]);if(!o||!o.ok)return void(yield fl(o,l));yield Object(tr.a)(Rs,"Submitted!",1e3);const c=(yield Object(tr.f)(e=>e.session.gradings.get(t))).slice().map(e=>(e.question.id===s&&(e.grade={gradeAdjustment:a,xpAdjustment:n,roomId:e.grade.roomId,grade:e.grade.grade,xp:e.grade.xp,comments:i}),e));yield Object(tr.d)(Yr.updateGrading(t,c))};yield Object(tr.h)("SUBMIT_GRADING",e),yield Object(tr.h)("SUBMIT_GRADING_AND_CONTINUE",(function*(t){const{submissionId:s}=t.payload;yield*e(t);const a=yield Object(tr.f)(e=>e.workspaces.grading.currentQuestion);yield xs.push(`/academy/grading/${s}/${(a||0)+1}`)})),yield Object(tr.h)("FETCH_NOTIFICATIONS",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=yield Object(tr.a)(pl,t);yield Object(tr.d)(Yr.updateNotifications(s))})),yield Object(tr.h)("ACKNOWLEDGE_NOTIFICATIONS",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload.withFilter,a=yield Object(tr.f)(e=>e.session.notifications);let n=a;if(s&&(n=s(a)),0===n.length)return;const i=n.map(e=>e.id),r=a.filter(e=>!i.includes(e.id));yield Object(tr.d)(Yr.updateNotifications(r));const o=yield Object(tr.a)(ml,t,i);o&&o.ok||(yield fl(o))})),yield Object(tr.h)("DELETE_SOURCECAST_ENTRY",(function*(e){if((yield Object(tr.f)(e=>e.session.role))===Ot.Student)return yield Object(tr.a)(Ms,"Only staff can delete sourcecasts.");const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),{id:s}=e.payload,a=yield async function(e,t){return await Sl("sourcecast/"+e,"DELETE",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(s,t);if(!a||!a.ok)return void(yield fl(a));const n=yield Object(tr.a)(gl,t);n&&(yield Object(tr.d)(Yr.updateSourcecastIndex(n,e.payload.workspaceLocation))),yield Object(tr.a)(Rs,"Deleted successfully!",1e3)})),yield Object(tr.h)("FETCH_SOURCECAST_INDEX",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=yield Object(tr.a)(gl,t);s&&(yield Object(tr.d)(Yr.updateSourcecastIndex(s,e.payload.workspaceLocation)))})),yield Object(tr.h)("SAVE_SOURCECAST_DATA",(function*(e){if((yield Object(tr.f)(e=>e.session.role))===Ot.Student)return yield Object(tr.a)(Ms,"Only staff can save sourcecast.");const{title:t,description:s,audio:a,playbackData:n}=e.payload,i=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),r=yield yl(t,s,a,n,i);r&&r.ok?(yield Object(tr.a)(Rs,"Saved successfully!",1e3),yield xs.push("/sourcecast")):yield fl(r,new Map)})),yield Object(tr.h)("CHANGE_CHAPTER",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield Object(tr.a)(vl,s.chapter,s.variant,t);a&&a.ok?(yield Object(tr.d)(Yr.updateChapter(s.chapter,s.variant)),yield Object(tr.a)(Rs,"Updated successfully!",1e3)):yield fl(a)})),yield Object(tr.h)("FETCH_GROUP_GRADING_SUMMARY",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=yield Object(tr.a)(bl,t);s&&(yield Object(tr.d)(Yr.updateGroupGradingSummary(s)))})),yield Object(tr.h)("CHANGE_DATE_ASSESSMENT",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload.id,a=e.payload.closeAt,n=e.payload.openAt,i=yield async function(e,t,s,a){const n=await Sl("assessments/update/"+e,"POST",{accessToken:a.accessToken,body:{closeAt:t,openAt:s},noHeaderAccept:!0,refreshToken:a.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});return n?await n.text():null}(s,a,n,t);null!=i?"OK"===i?(yield Object(tr.d)(Yr.fetchAssessmentOverviews()),yield Object(tr.a)(Rs,"Updated successfully!",1e3)):yield Object(tr.a)(Ms,i,5e3):yield fl(i)})),yield Object(tr.h)("DELETE_ASSESSMENT",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload,a=yield async function(e,t){return await Sl("assessments/"+e,"DELETE",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(s,t);a&&a.ok?(yield Object(tr.d)(Yr.fetchAssessmentOverviews()),yield Object(tr.a)(Rs,"Deleted successfully!",1e3)):yield fl(a)})),yield Object(tr.h)("PUBLISH_ASSESSMENT",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload.id,a=e.payload.togglePublishTo,n=yield async function(e,t,s){return await Sl("assessments/publish/"+e,"POST",{accessToken:s.accessToken,body:{togglePublishTo:t},noHeaderAccept:!0,refreshToken:s.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}(s,a,t);n&&n.ok?(yield Object(tr.d)(Yr.fetchAssessmentOverviews()),a?yield Object(tr.a)(Rs,"Published successfully!",1e3):yield Object(tr.a)(Rs,"Unpublished successfully!",1e3)):yield fl(n)})),yield Object(tr.h)("UPLOAD_ASSESSMENT",(function*(e){const t=yield Object(tr.f)(e=>({accessToken:e.session.accessToken,refreshToken:e.session.refreshToken})),s=e.payload.file,a=e.payload.forceUpdate,n=yield El(s,t,a);if(n)if("OK"===n)yield Object(tr.a)(Rs,"Uploaded successfully!",2e3);else{if("Force Update OK"!==n)return void(yield Object(tr.a)(Ms,n,1e4));yield Object(tr.a)(Rs,"Assessment force updated successfully!",2e3)}else yield fl(n);yield Object(tr.d)(Yr.fetchAssessmentOverviews())}))};function*go(){yield Object(tr.h)("LOGIN",yo)}function*yo({payload:e}){const t=function(e){const t=ze.authProviders.get(e);if(t)try{const s=new URL(t.endpoint);return s.searchParams.set("redirect_uri",po(e)),s.toString()}catch(s){return t.endpoint||""}}(e);t?window.location.href=t:yield Object(tr.a)(Ms,"Could not log in; invalid provider name provided.")}function Eo(e){const t=e.choices.map((t,s)=>v.createElement(Bt.Button,Object.assign({key:s,onClick:()=>e.onResponse&&e.onResponse(t.key),intent:t.intent,fill:e.largeButtons,className:qt()(e.largeButtons&&"large-button")},t.props),t.label)),{escapeResponse:s}=e,a="undefined"===typeof s?void 0:()=>e.onResponse&&e.onResponse(s);return v.createElement(Bt.Dialog,Object.assign({className:qt()(Bt.Classes.DARK,"ConfirmDialog"),title:e.title,isCloseButtonShown:"undefined"===typeof e.title&&void 0,canEscapeKeyClose:!!a,onClose:a,isOpen:e.isOpen},e.props),v.createElement("div",{className:Bt.Classes.DIALOG_BODY},e.contents),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},e.largeButtons&&t,!e.largeButtons&&v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER_ACTIONS},t)))}function bo(e){const{enterResponse:t,validationFunction:s}=e,a=v.useRef(null),[n,i]=v.useState(!s||s(e.defaultValue||""));v.useEffect(()=>{a.current&&i(!s||s(a.current.value))},[s]);const r=t=>{var n;t!==e.escapeResponse&&s&&!s(a.current.value)||e.onResponse(t,(null===(n=a.current)||void 0===n?void 0:n.value)||"")},o=e.choices.map(e=>({...e,props:{...e.props,disabled:e.disableOnInvalid&&!n}})),l=t?e=>{13===e.keyCode&&r(t)}:void 0,c=s?e=>{s(e.target.value)!==n&&i(!n)}:void 0;return v.createElement(Eo,Object.assign({},e,{onResponse:r,choices:o,contents:v.createElement(v.Fragment,null,e.contents,v.createElement(Bt.InputGroup,{autoFocus:!0,defaultValue:e.defaultValue,inputRef:a,onKeyDown:l,onChange:c,intent:n?Bt.Intent.NONE:Bt.Intent.DANGER}))}))}class vo extends v.PureComponent{constructor(...e){super(...e),this.state={dialog:null,dialogOnClose:null}}static create(){const e=document.createElement("div");document.body.appendChild(e);const t=f.render(v.createElement(vo,null),e);if(null==t)throw new Error("Could not create DialogHelper - are you in a React lifecycle method?");return t}show(e,t){this.setState(()=>({dialog:e,dialogOnClose:t||null}))}close(){this.state.dialogOnClose&&this.state.dialogOnClose(),this.setState(()=>({dialog:null,dialogOnClose:null}))}render(){return this.state.dialog}}const So=vo.create();function fo(){So.close()}function Co(e,t){return new Promise((s,a)=>{var n,i;n=v.createElement(e,t(s)),i=a,So.show(n,i)}).finally(fo)}function Ao(e){return function(e){return Co(Eo,t=>({...e,onResponse:t,isOpen:!0}))}({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"No"},{key:!0,label:e.positiveLabel||"Yes",intent:Bt.Intent.SUCCESS,props:{type:"submit"}}],escapeResponse:!1,...e.props})}function Oo(e){return Co(bo,t=>({title:e.title,contents:e.contents,choices:[{key:!1,label:e.negativeLabel||"Cancel"},{key:!0,label:e.positiveLabel||"Accept",intent:Bt.Intent.SUCCESS,disableOnInvalid:!0}],escapeResponse:!1,enterResponse:!0,onResponse:(e,s)=>t({buttonResponse:e,value:s}),isOpen:!0,...e.props}))}const wo=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],To="https://www.googleapis.com/upload/drive/v3/files";let Io;const ko=new Promise(e=>{Io=e}).then((async function(){await new Promise((e,t)=>gapi.load("client:auth2",{callback:e,onerror:t})),await gapi.client.init({apiKey:ze.googleApiKey,clientId:ze.googleClientId,discoveryDocs:wo,scope:"profile https://www.googleapis.com/auth/drive.file"}),gapi.auth2.getAuthInstance().currentUser.listen(Po),Po(gapi.auth2.getAuthInstance().currentUser.get())}));function Po(e){al.dispatch(Yr.setGoogleUser(e.isSignedIn()?e.getBasicProfile().getEmail():void 0))}function*xo(){Io(),yield ko}function*No(){yield Object(tr.a)(xo),gapi.auth2.getAuthInstance().isSignedIn.get()||(yield gapi.auth2.getAuthInstance().signIn())}function Ro(e,t){const s="undefined"!==typeof(null===t||void 0===t?void 0:t.pickFolders)&&(null===t||void 0===t?void 0:t.pickFolders),a="undefined"===typeof(null===t||void 0===t?void 0:t.showFolders)||(null===t||void 0===t?void 0:t.showFolders),n="undefined"===typeof(null===t||void 0===t?void 0:t.showFiles)||(null===t||void 0===t?void 0:t.showFiles);return new Promise(i=>{gapi.load("picker",()=>{const r=new google.picker.DocsView(n?google.picker.ViewId.DOCS:google.picker.ViewId.FOLDERS);(null===t||void 0===t?void 0:t.rootFolder)&&r.setParent(t.rootFolder),r.setOwnedByMe(!0),r.setIncludeFolders(a),r.setSelectFolderEnabled(s),r.setMode(google.picker.DocsViewMode.LIST);(new google.picker.PickerBuilder).setTitle(e).enableFeature(google.picker.Feature.NAV_HIDDEN).addView(r).setOAuthToken(gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token).setAppId(ze.googleAppId).setDeveloperKey(ze.googleApiKey).setCallback(e=>{switch(e[google.picker.Response.ACTION]){case google.picker.Action.PICKED:{const{id:t,name:s,mimeType:a,parentId:n}=e.docs[0];i({id:t,name:s,mimeType:a,parentId:n,picked:!0});break}case google.picker.Action.CANCEL:i({picked:!1})}}).build().setVisible(!0)})})}function Mo(e,t,s,a="",n){const i={name:e,mimeType:s,parents:[t],appProperties:{source:!0,...n}},{body:r,headers:o}=Do(i,a,s);return gapi.client.request({path:To,method:"POST",params:{uploadType:"multipart"},headers:o,body:r}).then(({result:e})=>({id:e.id,name:e.name}))}function _o(e,t,s,a="",n){const i={name:t,mimeType:s,appProperties:{source:!0,...n}},{body:r,headers:o}=Do(i,a,s);return gapi.client.request({path:To+"/"+e,method:"PATCH",params:{uploadType:"multipart"},headers:o,body:r})}function Do(e,t,s){const a=JSON.stringify(e);let n;do{n=Lo()}while(a.includes(n)||t.includes(n));return{body:`--${n}\nContent-Type: application/json; charset=utf-8\n\n${JSON.stringify(e)}\n--${n}\nContent-Type: ${s}\n\n${t}\n--${n}--\n`,boundary:n,headers:{"Content-Type":"multipart/related; boundary="+n}}}function Lo(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(10*Math.random()).toString(16);return e}var jo=function*(){yield Object(tr.i)("LOGOUT_GOOGLE",(function*(){yield Object(tr.d)(Pr(void 0)),yield Object(tr.a)(xo),yield Object(tr.a)([gapi.auth2.getAuthInstance(),"signOut"])})),yield Object(tr.i)("PERSISTENCE_OPEN_PICKER",(function*(){let e;try{yield Object(tr.a)(No);const{id:t,name:s,picked:a}=yield Object(tr.a)(Ro,"Pick a file to open");if(!a)return;if(!(yield Object(tr.a)(Ao,{title:"Opening from Google Drive",contents:v.createElement("p",null,"Opening ",v.createElement("strong",null,s)," will overwrite the current contents of your workspace. Are you sure?"),positiveLabel:"Open",negativeLabel:"Cancel"})))return;e=yield Object(tr.a)(_s,{message:"Opening file...",timeout:0,intent:Bt.Intent.PRIMARY});const{result:n}=yield Object(tr.a)([gapi.client.drive.files,"get"],{fileId:t,fields:"appProperties"}),i=yield Object(tr.a)([gapi.client.drive.files,"get"],{fileId:t,alt:"media"});yield Object(tr.d)(Yr.updateEditorValue(i.body,"playground")),yield Object(tr.d)(Yr.playgroundUpdatePersistenceFile({id:t,name:s,lastSaved:new Date})),n&&n.appProperties&&(yield Object(tr.d)(Yr.chapterSelect(parseInt(n.appProperties.chapter||"4",10),n.appProperties.variant||"default","playground")),yield Object(tr.d)(Yr.externalLibrarySelect(Object.values(gt).find(e=>e===n.appProperties.external)||gt.NONE,"playground"))),yield Object(tr.a)(Rs,`Loaded ${s}.`,1e3)}catch(t){console.error(t),yield Object(tr.a)(Ms,"Error while opening file.",1e3)}finally{e&&Ds(e)}})),yield Object(tr.i)("PERSISTENCE_SAVE_FILE_AS",(function*(){let e;try{yield Object(tr.a)(No);const[t,s,a,n]=yield Object(tr.f)(e=>[e.workspaces.playground.editorValue,e.workspaces.playground.context.chapter,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary]),i=yield Object(tr.a)(Ro,"Pick a folder, or cancel to pick the root folder",{pickFolders:!0,showFolders:!0,showFiles:!1}),r=i.picked?i:{id:"root",name:"My Drive"},o=yield Object(tr.a)(Ro,`Saving to ${r.name}; pick a file to overwrite, or cancel to save as a new file`,{pickFolders:!1,showFolders:!1,showFiles:!0,rootFolder:r.id});if(o.picked){if(!(yield Object(tr.a)(Ao,{title:"Saving to Google Drive",contents:v.createElement("span",null,"Really overwrite ",v.createElement("strong",null,o.name),"?")})))return;yield Object(tr.d)(Yr.playgroundUpdatePersistenceFile(o)),yield Object(tr.d)(Yr.persistenceSaveFile(o))}else{const i=yield Object(tr.a)(Oo,{title:"Saving to Google Drive",contents:v.createElement(v.Fragment,null,v.createElement("p",null,"Saving to folder ",v.createElement("strong",null,r.name),"."),v.createElement("p",null,"Save as name?")),positiveLabel:"Save as new file",negativeLabel:"Cancel",props:{validationFunction:e=>!!e}});if(!i.buttonResponse)return;const o={chapter:s,variant:a,external:n};e=yield Object(tr.a)(_s,{message:`Saving as ${i.value}...`,timeout:0,intent:Bt.Intent.PRIMARY});const l=yield Object(tr.a)(Mo,i.value,r.id,"text/plain",t,o);yield Object(tr.d)(Yr.playgroundUpdatePersistenceFile({...l,lastSaved:new Date})),yield Object(tr.a)(Rs,i.value+" successfully saved to Google Drive.",1e3)}}catch(t){console.error(t),yield Object(tr.a)(Ms,"Error while saving file.",1e3)}finally{e&&Ds(e)}})),yield Object(tr.h)("PERSISTENCE_SAVE_FILE",(function*({payload:{id:e,name:t}}){let s;try{s=yield Object(tr.a)(_s,{message:`Saving as ${t}...`,timeout:0,intent:Bt.Intent.PRIMARY}),yield Object(tr.a)(No);const[a,n,i,r]=yield Object(tr.f)(e=>[e.workspaces.playground.editorValue,e.workspaces.playground.context.chapter,e.workspaces.playground.context.variant,e.workspaces.playground.externalLibrary]),o={chapter:n,variant:i,external:r};yield Object(tr.a)(_o,e,t,"text/plain",a,o),yield Object(tr.d)(Yr.playgroundUpdatePersistenceFile({id:e,name:t,lastSaved:new Date})),yield Object(tr.a)(Rs,t+" successfully saved to Google Drive.",1e3)}catch(a){console.error(a),yield Object(tr.a)(Ms,"Error while saving file.",1e3)}finally{s&&Ds(s)}})),yield Object(tr.h)("PERSISTENCE_INITIALISE",xo)},Bo=s(313);function*Go(){yield Object(tr.h)("GENERATE_LZ_STRING",Uo),yield Object(tr.h)("SHORTEN_URL",(function*(e){const t=yield Object(tr.f)(e=>e.playground.queryString),s=e.payload;let a,n;try{const{result:e,hasTimedOut:i}=yield Object(tr.e)({result:Object(tr.a)(Ho,t,s),hasTimedOut:Object(tr.b)(1e4)});a=e,n=i}catch(i){}return!a||n?(yield Object(tr.d)(Tr("ERROR")),yield Object(tr.a)(Ms,"Something went wrong trying to create the link.")):"success"===a.status||a.shorturl?("success"!==a.status&&(yield Object(tr.a)(Rs,a.message)),void(yield Object(tr.d)(Tr(a.shorturl)))):(yield Object(tr.d)(Tr("ERROR")),yield Object(tr.a)(Ms,a.message))}))}function*Uo(){const e=yield Object(tr.f)(e=>e.workspaces.playground.editorValue);if(!e||"// Type your program in here!"===e)return void(yield Object(tr.d)(kr("")));const t=e,s=yield Object(tr.f)(e=>e.workspaces.playground.context.chapter),a=yield Object(tr.f)(e=>e.workspaces.playground.context.variant),n=yield Object(tr.f)(e=>e.workspaces.playground.externalLibrary),i=yield Object(tr.f)(e=>e.workspaces.playground.execTime),r=Bo.stringify({prgrm:Object(pe.compressToEncodedURIComponent)(t),chap:s,variant:a,ext:n,exec:i});yield Object(tr.d)(kr(r))}async function Ho(e,t){let s=`${window.location.protocol}//${window.location.hostname}/playground#${e}`;""!==window.location.port&&(s=`${window.location.protocol}//${window.location.hostname}:${window.location.port}/playground#${e}`);const a={signature:ze.urlShortenerSignature,action:"shorturl",format:"json",keyword:t,url:s},n={method:"POST",body:Object.entries(a).reduce((e,[t,s])=>(e.append(t,s),e),new FormData)},i=await fetch(ze.urlShortener,n);if(!i||!i.ok)return null;return await i.json()}var Vo=s(80),Fo=s(81),qo=s(159),Xo=s(225),Wo=s(290),zo=s(458),Yo=s(467);let $o,Ko,Qo=[];function*Jo(){let e;function*t(){const{loadedScripts:e,timeout:t}=yield Object(tr.e)({loadedScripts:Object(tr.a)((function*(){for(;void 0===window.getReadyWebGLForCanvas;)yield Object(tr.b)(250);return!0})),timeout:Object(tr.b)(4e3)});return void 0===t||void 0!==e||(yield Object(tr.a)(Ms,"Error loading libraries",750),!1)}yield Object(tr.h)("EVAL_EDITOR",(function*(t){const s=t.payload.workspaceLocation,a=yield Object(tr.f)(e=>[e.workspaces[s].editorPrepend,e.workspaces[s].editorValue]),[n,i]=a,r=i.split("\n");for(const e in Qo)if("string"===typeof e){const t=+e;r[t]="debugger;"+r[t]}const o=r.join("\n"),l=yield Object(tr.f)(e=>e.workspaces[s].context.chapter),c=yield Object(tr.f)(e=>e.workspaces[s].execTime),d=yield Object(tr.f)(e=>e.workspaces[s].context.externalSymbols),u=yield Object(tr.f)(e=>e.workspaces[s].globals),h={chapter:l,variant:yield Object(tr.f)(e=>e.workspaces[s].context.variant),external:{name:gt.NONE,symbols:d},globals:u};if(yield Object(tr.d)(Yr.beginInterruptExecution(s)),yield Object(tr.d)(Yr.beginClearContext(h,s)),yield Object(tr.d)(Yr.clearReplOutput(s)),e=yield Object(tr.f)(e=>e.workspaces[s].context),n.length){const t=pt(e);yield Object(tr.a)(tl,n,t,c,s,"EVAL_SILENT"),yield*el(t,e,c,s)}yield Object(tr.a)(tl,o,e,c,s,"EVAL_EDITOR")})),yield Object(tr.h)("PROMPT_AUTOCOMPLETE",(function*(t){const s=t.payload.workspaceLocation;e=yield Object(tr.f)(e=>e.workspaces[s].context);const a=yield Object(tr.f)(e=>[e.workspaces[s].editorPrepend,e.workspaces[s].editorValue]),[n,i]=a;let r,o=0;n?(o=n.split("\n").length,r=n+"\n"+i):r=i;const[l,c]=yield Object(tr.a)(ms.getNames,r,t.payload.row+o,t.payload.column,e);if(!c)return void(yield Object(tr.a)(t.payload.callback));const d=l.map(e=>({caption:e.name,value:e.name,meta:e.meta,score:e.score?e.score+1e3:1e3}));let u=e.chapter.toString();"default"!==e.variant&&(u+="_"+e.variant);const h=Zs.builtins[u]||[],p=yield Object(tr.f)(e=>e.workspaces[s].externalLibrary),m=Zs.externalLibraries[p]||[];yield Object(tr.a)(t.payload.callback,null,d.concat(h,m))})),yield Object(tr.h)("TOGGLE_EDITOR_AUTORUN",(function*(e){const t=e.payload.workspaceLocation,s=yield Object(tr.f)(e=>e.workspaces[t].isEditorAutorun);yield Object(tr.a)(Ms,"Autorun "+(s?"Started":"Stopped"),750)})),yield Object(tr.h)("INVALID_EDITOR_SESSION_ID",(function*(e){yield Object(tr.a)(Ms,"Invalid ID Input",1e3)})),yield Object(tr.h)("EVAL_REPL",(function*(t){const s=t.payload.workspaceLocation,a=yield Object(tr.f)(e=>e.workspaces[s].replValue),n=yield Object(tr.f)(e=>e.workspaces[s].execTime);yield Object(tr.d)(Yr.beginInterruptExecution(s)),yield Object(tr.d)(Yr.clearReplInput(s)),yield Object(tr.d)(Yr.sendReplInputToOutput(a,s)),e=yield Object(tr.f)(e=>e.workspaces[s].context),yield Object(tr.a)(tl,a,e,n,s,"EVAL_REPL")})),yield Object(tr.h)("DEBUG_RESUME",(function*(t){const s=t.payload.workspaceLocation,a=yield Object(tr.f)(e=>e.workspaces[s].editorValue),n=yield Object(tr.f)(e=>e.workspaces[s].execTime);yield Object(tr.d)(Yr.beginInterruptExecution(s)),yield Object(tr.d)(Yr.clearReplOutput(s)),e=yield Object(tr.f)(e=>e.workspaces[s].context),yield Object(tr.d)(Yr.highlightEditorLine([],s)),yield Object(tr.a)(tl,a,e,n,s,"DEBUG_RESUME")})),yield Object(tr.h)("DEBUG_RESET",(function*(t){const s=t.payload.workspaceLocation;e=yield Object(tr.f)(e=>e.workspaces[s].context),yield Object(tr.d)(Yr.clearReplOutput(s)),dt(void 0),ct(void 0),yield Object(tr.d)(Yr.clearReplOutput(s)),e.runtime.break=!1,$o=void 0})),yield Object(tr.h)("HIGHLIGHT_LINE",(function*(e){ct(e.payload.highlightedLines[0]),yield})),yield Object(tr.h)("UPDATE_EDITOR_BREAKPOINTS",(function*(e){Qo=e.payload.breakpoints,yield})),yield Object(tr.h)("EVAL_TESTCASE",(function*(t){const s=t.payload.workspaceLocation,a=t.payload.testcaseId,n=yield Object(tr.f)(e=>[e.workspaces[s].editorPrepend,e.workspaces[s].editorValue,e.workspaces[s].editorPostpend,e.workspaces[s].editorTestcases[a].program]),[i,r,o,l]=n,c=yield Object(tr.f)(e=>e.workspaces[s].editorTestcases[a].type),d=yield Object(tr.f)(e=>e.workspaces[s].execTime);e=yield Object(tr.f)(e=>e.workspaces[s].context);const u=pt(e);yield Object(tr.a)(tl,i,u,d,s,"EVAL_SILENT");const h=String(Object(Qe.random)(1048576,68719476736));yield*el(u,e,d,s,h),yield Object(tr.a)(tl,r,e,d,s,"EVAL_SILENT"),e.errors.length||(o&&(yield*function*(e,t,s,a,n){const i=function(e,t){const s="_____"+t;return e.map((e,t)=>"makeUndefinedErrorFunction"===e?"":`const ${e} = ${s}[${t}];`).join("\n")}(mt(e,t),n);yield Object(tr.a)(tl,i,e,s,a,"EVAL_SILENT")}(u,e,d,s,h),yield Object(tr.a)(tl,o,u,d,s,"EVAL_SILENT"),yield*el(u,e,d,s,h)),yield*function*(e,t,s,a,n,i){yield Object(tr.d)(Yr.resetTestcase(a,n));const{result:r,interrupted:o}=yield Object(tr.e)({result:Object(tr.a)(ms.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:s}),interrupted:Object(tr.g)("BEGIN_INTERRUPT_EXECUTION")});if(o)return Object(ms.interrupt)(t),t.errors.push(new Fo.InterruptedError(t.runtime.nodes[0])),yield Object(tr.d)(Yr.endInterruptExecution(a)),void(yield Object(tr.a)(Ms,`Execution of testcase ${n} aborted`,750));"error"===r.status?(yield Object(tr.d)(Yr.evalInterpreterError(t.errors,a)),yield Object(tr.d)(Yr.evalTestcaseFailure(t.errors,a,n))):"finished"===r.status&&(yield Object(tr.d)(Yr.evalInterpreterSuccess(r.value,a)),yield Object(tr.d)(Yr.evalTestcaseSuccess(r.value,a,n)));i===Yt.hidden&&(yield Object(tr.d)(Yr.clearReplOutputLast(a)))}(l,u,d,s,a,c))})),yield Object(tr.h)("CHAPTER_SELECT",(function*(e){const t=e.payload.workspaceLocation,s=e.payload.chapter,a=yield Object(tr.f)(e=>e.workspaces[t].context.variant),n=e.payload.variant,i=yield Object(tr.f)(e=>e.workspaces[t].context.chapter),r=yield Object(tr.f)(e=>e.workspaces[t].context.externalSymbols),o=yield Object(tr.f)(e=>e.workspaces[t].globals);if(s!==i||n!==a){const e={chapter:s,variant:n,external:{name:gt.NONE,symbols:r},globals:o};yield Object(tr.d)(Yr.beginClearContext(e,t)),yield Object(tr.d)(Yr.clearReplOutput(t)),yield Object(tr.d)(Yr.debuggerReset(t)),yield Object(tr.a)(Rs,"Switched to "+It(s,n),1e3)}})),yield Object(tr.h)("PLAYGROUND_EXTERNAL_SELECT ",(function*(e){const t=e.payload.workspaceLocation,s=yield Object(tr.f)(e=>e.workspaces[t].context.chapter),a=yield Object(tr.f)(e=>e.workspaces[t].globals),n=e.payload.externalLibraryName,i=yield Object(tr.f)(e=>e.workspaces[t].externalLibrary),r={chapter:s,external:{name:n,symbols:Ct.get(n)},globals:a};n!==i&&(yield Object(tr.d)(Yr.changeExternalLibrary(n,t)),yield Object(tr.d)(Yr.beginClearContext(r,t)),yield Object(tr.d)(Yr.clearReplOutput(t)),yield Object(tr.a)(Rs,`Switched to ${n} library`,1e3))})),yield Object(tr.h)("ENSURE_LIBRARIES_LOADED",(function*(e){yield*t()})),yield Object(tr.h)("BEGIN_CLEAR_CONTEXT",(function*(e){yield*t();switch(e.payload.library.external.name){case gt.RUNES:window.loadLib("RUNES"),window.getReadyWebGLForCanvas("3d");break;case gt.CURVES:window.loadLib("CURVES"),window.getReadyWebGLForCanvas("curve");break;case gt.MACHINELEARNING:window.loadLib("MACHINELEARNING")}const s=e.payload.library.globals;for(const[t,a]of s)window[t]=a;e.payload.library.moduleParams={runes:{},phaser:$a.a},yield Object(tr.d)(Yr.endClearContext(e.payload.library,e.payload.workspaceLocation)),yield})),yield Object(tr.h)("NAV_DECLARATION",(function*(t){const s=t.payload.workspaceLocation,a=yield Object(tr.f)(e=>e.workspaces[s].editorValue);e=yield Object(tr.f)(e=>e.workspaces[s].context);const n=Object(ms.findDeclaration)(a,e,{line:t.payload.cursorPosition.row+1,column:t.payload.cursorPosition.column});n&&(yield Object(tr.d)(Yr.moveCursor(t.payload.workspaceLocation,{row:n.start.line-1,column:n.start.column})))}))}function*Zo(e){try{const t=$o.context.runtime.nodes[0].loc.start.line-1,s=$o.context.runtime.nodes[0].loc.end.line-1;yield Object(tr.d)(Yr.highlightEditorLine([t,s],e)),dt($o),function(e){if(!window.EnvVisualizer)throw new Error("Env visualizer is not enabled");window.EnvVisualizer.draw_env({context:e})}($o)}catch(t){yield Object(tr.d)(Yr.highlightEditorLine([],e))}}function*el(e,t,s,a,n){const i=mt(e,t);if(n){const t=function(e,t){return`const _____${t} = [${e.join(", ")}];`}(i,n);yield Object(tr.a)(tl,t,e,s,a,"EVAL_SILENT")}const r=i.map(e=>"makeUndefinedErrorFunction"===e?"":`const ${e} = makeUndefinedErrorFunction('${e}');`).join("\n");yield Object(tr.a)(tl,r,e,s,a,"EVAL_SILENT")}function*tl(e,t,s,a,n){t.runtime.debuggerOn=("EVAL_EDITOR"===n||"DEBUG_RESUME"===n)&&t.chapter>2,!t.runtime.debuggerOn&&t.chapter>2&&"EVAL_SILENT"!==n&&dt(void 0);const i=yield Object(tr.f)(e=>e.playground.usingSubst),r=t.chapter<=2&&"playground"===a&&i;if(r){t.executionMethod="interpreter";const e=document.getElementById(T.substVisualizer+"-icon");e&&e.classList.add("side-content-tab-alert")}async function o(e,s){return Yo.compile(e,s).then(e=>Yo.run(e,s)).then(e=>({status:"finished",context:t,value:e}),e=>({status:"error"}))}const l="non-det"===t.variant,c="lazy"===t.variant,d="wasm"===t.variant,{result:u,interrupted:h,paused:p}=yield Object(tr.e)({result:"DEBUG_RESUME"===n?Object(tr.a)(ms.resume,$o):l||c||d?function(a){if("non-det"===a)return e.trim()===Vo.TRY_AGAIN?Object(tr.a)(ms.resume,Ko):Object(tr.a)(ms.runInContext,e,t,{executionMethod:"interpreter",originalMaxExecTime:s,useSubst:r});if("lazy"===a)return Object(tr.a)(ms.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:s,useSubst:r});if("wasm"===a)return Object(tr.a)(o,e,t);throw new Error("Unknown variant: "+a)}(t.variant):Object(tr.a)(ms.runInContext,e,t,{scheduler:"preemptive",originalMaxExecTime:s,useSubst:r}),interrupted:Object(tr.g)("BEGIN_INTERRUPT_EXECUTION"),paused:Object(tr.g)("BEGIN_DEBUG_PAUSE")});if(h)return Object(ms.interrupt)(t),t.errors.push(new Fo.InterruptedError(t.runtime.nodes[0])),yield Object(tr.d)(Yr.debuggerReset(a)),yield Object(tr.d)(Yr.endInterruptExecution(a)),void(yield Object(tr.a)(Ms,"Execution aborted",750));if(p)return yield Object(tr.d)(Yr.endDebuggerPause(a)),$o=Object(Xo.manualToggleDebugger)(t),yield Object(tr.a)(Zo,a),void(yield Object(tr.a)(Ms,"Execution paused",750));if("EVAL_EDITOR"===n&&($o=u),yield Object(tr.a)(Zo,a),"suspended"!==u.status&&"finished"!==u.status&&"suspended-non-det"!==u.status){yield Object(tr.d)(Yr.evalInterpreterError(t.errors,a));const s=t.errors;t.errors=[];const n=Object(qo.parse)(e,t),i=n&&Object(Wo.typeCheck)(Object(zo.validateAndAnnotate)(n,t),t)[1];return t.errors=s,void(i&&i.length>0&&(yield Object(tr.d)(Yr.sendReplInputToOutput("Hints:\n"+Object(ms.parseError)(i),a))))}if("suspended"===u.status)return yield Object(tr.d)(Yr.endDebuggerPause(a)),void(yield Object(tr.d)(Yr.evalInterpreterSuccess("Breakpoint hit!",a)));if(l&&("cut"===u.value&&(u.value=void 0),Ko=u),"EVAL_SILENT"!==n&&(yield Object(tr.d)(Yr.evalInterpreterSuccess(u.value,a))),"EVAL_EDITOR"!==n&&"EVAL_REPL"!==n||(yield Object(tr.d)(ue(u,$o,e,t,a))),"EVAL_EDITOR"===n){if((yield Object(tr.f)(e=>e.workspaces[a].sideContentActiveTab))===T.autograder&&("assessment"===a||"grading"===a)){const e=yield Object(tr.f)(e=>e.workspaces[a].editorTestcases);if(e.length>0){yield Object(tr.a)(Rs,"Running all testcases!",750);for(const t of e.keys()){yield Object(tr.d)(Yr.evalTestcase(a,t));const{success:e,error:s}=yield Object(tr.e)({success:Object(tr.g)("EVAL_TESTCASE_SUCCESS"),error:Object(tr.g)("EVAL_TESTCASE_FAILURE")});if(s||!e)return}}}}}function*sl(){yield Object(tr.c)(ze.useBackend?mo:ho),yield Object(tr.c)(Jo),yield Object(tr.c)(go),yield Object(tr.c)(Go),yield Object(tr.c)(jo)}const al=function(e){const t=Object(ar.a)(),s=[t,Object(sr.a)(e)],a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({serialize:!0,maxAge:300})||O.d,n=function(e){if(!e)return;return{...Dt,session:{...Dt.session,...e.session?e.session:{}},workspaces:{...Dt.workspaces,playground:{...Dt.workspaces.playground,editorValue:e.playgroundEditorValue?e.playgroundEditorValue:Dt.workspaces.playground.editorValue,isEditorAutorun:e.playgroundIsEditorAutorun?e.playgroundIsEditorAutorun:Dt.workspaces.playground.isEditorAutorun,externalLibrary:e.playgroundExternalLibrary?e.playgroundExternalLibrary:Dt.workspaces.playground.externalLibrary,context:{...Dt.workspaces.playground.context,chapter:e.playgroundSourceChapter?e.playgroundSourceChapter:Dt.workspaces.playground.context.chapter,variant:e.playgroundSourceVariant?e.playgroundSourceVariant:Dt.workspaces.playground.context.variant}}}}}((()=>{try{const e=localStorage.getItem("storedState");if(!e)return;const t=Object(pe.decompressFromUTF16)(e);if(!t)return;return JSON.parse(t)}catch(e){return void Ms("Error loading from local storage")}})())||Dt,i=a(Object(O.a)(...s)),r=Object(O.e)(cr(e),n,i);return t.run(sl),r.subscribe(Object(Qe.throttle)(()=>{(e=>{try{const t={session:{accessToken:e.session.accessToken,refreshToken:e.session.refreshToken,role:e.session.role,name:e.session.name},playgroundEditorValue:e.workspaces.playground.editorValue,playgroundIsEditorAutorun:e.workspaces.playground.isEditorAutorun,playgroundSourceChapter:e.workspaces.playground.context.chapter,playgroundSourceVariant:e.workspaces.playground.context.variant,playgroundExternalLibrary:e.workspaces.playground.externalLibrary},s=Object(pe.compressToUTF16)(JSON.stringify(t));localStorage.setItem("storedState",s)}catch(t){Ms("Error saving to local storage")}})(r.getState())},1e3)),r}(xs);async function nl(e,t,s,a){const n=await Sl("auth","POST",{body:{code:e,provider:t,...s?{client_id:s}:{},...a?{redirect_uri:a}:{}},errorMessage:"Could not login. Please contact the module administrator."});if(!n)return null;const i=await n.json();return{accessToken:i.access_token,refreshToken:i.refresh_token}}async function il(e){const t=await Sl("user","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});return t&&t.ok?await t.json():null}async function rl(e){const t=await Sl("assessments","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});if(!t||!t.ok)return null;return(await t.json()).map(e=>(e.category=Cl(e.type),delete e.type,e.gradingStatus=Al(e.category,e.status,e.gradedCount,e.questionCount),delete e.gradedCount,delete e.questionCount,e))}async function ol(e,t){let s=await Sl("assessments/"+e,"POST",{accessToken:t.accessToken,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});for(;s&&403===s.status;){const a=window.prompt("Please enter password.","");if(!a)return s=null,window.history.back(),null;s=await Sl("assessments/"+e,"POST",{accessToken:t.accessToken,refreshToken:t.refreshToken,body:{password:a},shouldAutoLogout:!1,shouldRefresh:!0})}if(!s||!s.ok)return null;const a=await s.json();return a.category=Cl(a.type),delete a.type,a.questions=a.questions.map(e=>{if(e.type===$t.programming){const t=e;t.autogradingResults=t.autogradingResults||[],t.prepend=t.prepend||"",t.postpend=t.postpend||"",t.testcases=t.testcases||[],e=t}return null===e.grader&&(delete e.grader,delete e.gradedAt),e.library.external.name=e.library.external.name.toUpperCase(),e.library.globals=Object.entries(e.library.globals).map(e=>{try{e[1]=window.eval(e[1])}catch(t){}return e}),e}),a}async function ll(e,t,s){return await Sl(`assessments/question/${e}/submit`,"POST",{accessToken:s.accessToken,body:{answer:""+t},noHeaderAccept:!0,refreshToken:s.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function cl(e,t){return await Sl(`assessments/${e}/submit`,"POST",{accessToken:t.accessToken,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function dl(e,t){const s=await Sl("grading?group="+t,"GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});if(!s)return null;return(await s.json()).map(e=>{const t={assessmentId:e.assessment.id,assessmentName:e.assessment.title,assessmentCategory:Cl(e.assessment.type),studentId:e.student.id,studentName:e.student.name,submissionId:e.id,submissionStatus:e.status,groupName:e.student.groupName,initialGrade:e.grade,gradeAdjustment:e.adjustment,currentGrade:e.grade+e.adjustment,maxGrade:e.assessment.maxGrade,gradingStatus:"none",questionCount:e.assessment.questionCount,gradedCount:e.gradedCount,initialXp:e.xp,xpAdjustment:e.xpAdjustment,currentXp:e.xp+e.xpAdjustment,maxXp:e.assessment.maxXp,xpBonus:e.xpBonus};return t.gradingStatus=Al(t.assessmentCategory,t.submissionStatus,t.gradedCount,t.questionCount),t}).sort((e,t)=>e.assessmentId!==t.assessmentId?t.assessmentId-e.assessmentId:t.submissionId-e.submissionId)}async function ul(e,t){const s=await Sl("grading/"+e,"GET",{accessToken:t.accessToken,refreshToken:t.refreshToken,shouldRefresh:!0});if(!s)return null;return(await s.json()).map(e=>{const{student:t,question:s,grade:a}=e,n={question:{answer:s.answer,autogradingResults:s.autogradingResults||[],choices:s.choices,content:s.content,roomId:null,id:s.id,library:(i=s.library,{chapter:i.chapter,external:{name:i.external.name.toUpperCase(),symbols:i.external.symbols},globals:Object.entries(i.globals).map(e=>{try{e[1]=window.eval(e[1])}catch(t){}return e})}),solution:e.solution||s.solution||null,solutionTemplate:s.solutionTemplate,prepend:s.prepend||"",postpend:s.postpend||"",testcases:s.testcases||[],type:s.type,maxGrade:s.maxGrade,maxXp:s.maxXp},student:t,grade:{grade:a.grade,xp:a.xp,roomId:a.roomId||"",gradeAdjustment:a.adjustment,xpAdjustment:a.xpAdjustment,comments:a.comments}};var i;return null!==e.grade.grader&&(n.grade.grader=e.grade.grader,n.grade.gradedAt=e.grade.gradedAt),n})}const hl=async(e,t,s,a,n,i)=>await Sl(`grading/${e}/${t}`,"POST",{accessToken:n.accessToken,body:{grading:{adjustment:s,xpAdjustment:a,comments:i}},noHeaderAccept:!0,refreshToken:n.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});async function pl(e){const t=await Sl("notification","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldAutoLogout:!1});let s=[];if(!t||!t.ok)return s;return s=(await t.json()).map(e=>({id:e.id,type:e.type,assessment_id:e.assessment_id||void 0,assessment_type:e.assessment?Cl(e.assessment.type):void 0,assessment_title:e.assessment?e.assessment.title:void 0,submission_id:e.submission_id||void 0})),s}async function ml(e,t){return await Sl("notification/acknowledge","POST",{accessToken:e.accessToken,refreshToken:e.refreshToken,body:{notificationIds:t},shouldAutoLogout:!1})}async function gl(e){const t=await Sl("sourcecast","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});if(!t||!t.ok)return null;return await t.json()}const yl=async(e,t,s,a,n)=>{const i=new FormData,r=Date.now().toString()+".wav";i.append("sourcecast[title]",e),i.append("sourcecast[description]",t),i.append("sourcecast[audio]",s,r),i.append("sourcecast[playbackData]",JSON.stringify(a));return await Sl("sourcecast","POST",{accessToken:n.accessToken,body:i,noContentType:!0,noHeaderAccept:!0,refreshToken:n.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})};const El=async(e,t,s)=>{const a=new FormData;a.append("assessment[file]",e),a.append("forceUpdate",String(s));const n=await Sl("assessments","POST",{accessToken:t.accessToken,body:a,noContentType:!0,noHeaderAccept:!0,refreshToken:t.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0});return n?await n.text():null};async function bl(e){const t=await Sl("grading/summary","GET",{accessToken:e.accessToken,refreshToken:e.refreshToken,shouldRefresh:!0});return t&&t.ok?await t.json():null}async function vl(e,t,s){return await Sl("chapter/update/1","POST",{accessToken:s.accessToken,body:{chapterno:e,variant:t},noHeaderAccept:!0,refreshToken:s.refreshToken,shouldAutoLogout:!1,shouldRefresh:!0})}async function Sl(e,t,s){const a=new Headers;s.noHeaderAccept||a.append("Accept","application/json"),s.accessToken&&a.append("Authorization","Bearer "+s.accessToken);const n={method:t,headers:a};s.body&&(s.noContentType?n.body=s.body:(a.append("Content-Type","application/json"),n.body=JSON.stringify(s.body)));try{const a=await fetch(`${ze.backendUrl}/v1/${e}`,n);if(s.shouldRefresh&&a&&401===a.status){const a=await async function(e){const t=await Sl("auth/refresh","POST",{body:{refresh_token:e}});if(!t)return null;const s=await t.json();return{accessToken:s.access_token,refreshToken:s.refresh_token}}(s.refreshToken);al.dispatch(Yr.setTokens(a));return Sl(e,t,{...s,accessToken:a.accessToken,shouldRefresh:!1})}if(a&&!a.ok&&!1===s.shouldAutoLogout)return a;if(!a||!a.ok)throw new Error("API call failed or got non-OK response");return a}catch(i){return al.dispatch(Yr.logOut()),Ms(s.errorMessage?s.errorMessage:"Please login again."),null}}function*fl(e,t){if(!e)return void(yield Object(tr.a)(Ms,"Couldn't reach our servers. Are you online?"));let s;if(e.status)if(t&&t.has(e.status))s=t.get(e.status);else switch(e.status){case 401:s="Session expired. Please login again.";break;default:s=`Something went wrong (got ${e.status} response)`}else s="Something went wrong (received response with no status code)";yield Object(tr.a)(Ms,s)}const Cl=e=>e.charAt(0).toUpperCase()+e.slice(1),Al=(e,t,s,a)=>["Mission","Sidequest","Practical"].includes(e)&&"submitted"===t?0===s?"none":s===a?"graded":"grading":"excluded",Ol={collectibles:[],assessments:[]},wl={key:Ka.zektonFont.key,size:35,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Tl{constructor(){this.userState=void 0,this.userState=Ol}initialise(e){this.userState=e.saveManager.getLoadedUserState()||Ol}addToList(e,t){this.userState[e].push(t)}getList(e){return this.userState[e]}async doesIdExistInList(e,t){return"assessments"===e&&Vn.getInstance().isStorySimulator()?this.askAssessmentComplete(t):this.userState[e].includes(t)}async askAssessmentComplete(e){const t=Vn.getInstance().getGameManager(),s=new Phaser.GameObjects.Container(t,0,0);Vn.getInstance().addContainerToLayer(wn.UI,s);const a=new Promise(a=>{s.add(gn(t,{assetKey:dn.longButton.key,message:`Assessment#${e} completed?`,textConfig:{x:0,y:0,oriX:.5,oriY:.4},bitMapTextStyle:wl}).setPosition(an.x,100)),s.add(["Yes","No"].map((e,n)=>gn(t,{assetKey:dn.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.4},bitMapTextStyle:wl,onUp:()=>{s.destroy(),a("Yes"===e)}}).setPosition(an.x,200*n+400)))});return await a}async loadAssessments(){if(Vn.getInstance().isStorySimulator())return;const e=await rl(td().getAccountInfo());this.userState.assessments=null===e||void 0===e?void 0:e.filter(e=>"submitted"===e.status).map(e=>e.id.toString())}}var Il={storySimBg:{key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},mainMenuOptBanner:{key:"menu-option",path:"/ui/menuOption.png"},shortButton:{key:"short-button",path:"/ui/shortButton.png"},invertedButton:{key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{key:"top-button",path:"/ui/topButton.png"},colorIcon:{key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{key:"icon-bg",path:"/ui/modeIconBg.png"},longButton:{key:"long-button",path:"/ui/longButton.png"}};let kl;!function(e){e.Default="Default",e.ObjectPlacement="ObjectPlacement",e.AssetUploader="AssetUploader",e.CheckpointSim="CheckpointSim",e.ChapterSequence="ChapterSequence"}(kl||(kl={}));const Pl={key:Ka.zektonFont.key,size:35,fill:Ja.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var xl={maxOptButtonsRow:2,optButtonsXSpace:.9*sn.x,optButtonsYSpace:.5*sn.y,gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}};class Nl extends Phaser.Scene{constructor(){super("StorySimulatorMenu"),this.soundManager=void 0,this.layerManager=void 0,this.layerManager=new Fn,this.soundManager=new qn}init(){Jl().setStorySimProps({mainMenuRef:this}),this.layerManager.initialise(this),this.soundManager.initialise(this,Jl())}async preload(){On(this),Object.values(dn).forEach(e=>this.load.image(e.key,ln(e.path))),Object.values(Il).forEach(e=>this.load.image(e.key,ln(e.path))),Object.values(Ka).forEach(e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath)),this.soundManager.loadSoundAssetMap(pn)}async create(){this.renderBackground(),this.renderOptionButtons()}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),s=Za({numOfItems:t.length,maxXSpace:xl.optButtonsXSpace,maxYSpace:xl.optButtonsYSpace,numItemLimit:xl.maxOptButtonsRow,redistributeLast:!0});e.add(t.map((e,t)=>this.createOptButton(e.text,s[t][0],s[t][1],e.callback))),this.layerManager.addToLayer(wn.UI,e)}getOptionButtons(){return[{text:"Object Placement",callback:()=>{Jl().setStorySimState(kl.ObjectPlacement),this.layerManager.clearAllLayers(),this.scene.start("ObjectPlacement")}},{text:"Simulate Checkpoint",callback:()=>{Jl().setStorySimState(kl.CheckpointSim)}},{text:"Asset Uploader",callback:()=>{Jl().setStorySimState(kl.AssetUploader)}},{text:"Chapter Sequencer",callback:()=>{Jl().setStorySimState(kl.ChapterSequence)}}]}createOptButton(e,t,s,a){return gn(this,{assetKey:Il.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:Pl,onUp:a},this.soundManager).setPosition(t,s)}callGameManager(){const e=sessionStorage.getItem(xl.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem(xl.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.layerManager.clearAllLayers(),Ti.parse(e),t&&Ti.parse(t,!0);const s=Ti.checkpoint;this.scene.start("GameManager",{isStorySimulator:!0,fullSaveState:void 0,gameCheckpoint:s,continueGame:!1,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,an.x,an.y,Il.storySimBg.key);e.setDisplaySize(sn.x,sn.y);const t=new Phaser.GameObjects.Image(this,an.x,an.y,Il.blueUnderlay.key).setAlpha(.5);this.layerManager.addToLayer(wn.Background,e),this.layerManager.addToLayer(wn.Background,t)}}var Rl=Nl;var Ml=class{constructor(){this.scene=void 0,this.keyboardListeners=void 0,this.eventListeners=void 0,this.getScene=()=>cn(this.scene),this.keyboardListeners=[],this.eventListeners=[]}initialise(e){this.scene=e}enableMouseInput(e){this.getScene().input.mouse.enabled=e}enableKeyboardInput(e){this.getScene().input.keyboard.enabled=e}registerKeyboardListener(e,t,s){const a=this.getScene().input.keyboard.addKey(e).addListener(t,s);this.keyboardListeners.push(a)}registerEventListener(e,t){const s=this.getScene().input.addListener(e,t);this.eventListeners.concat(s)}clearListeners(){this.keyboardListeners.forEach(e=>e.removeAllListeners()),this.eventListeners.forEach(e=>e.removeAllListeners())}};class _l{constructor(){this.backgroundAssetPath=void 0,this.objectPlacement=void 0,this.x=void 0,this.y=void 0,this.getObjectPlacement=()=>cn(this.objectPlacement),this.x=an.x,this.y=an.y}initialise(e){this.objectPlacement=e}async loadBackground(){const e=sessionStorage.getItem("selectedAsset");if(!e||!e.startsWith("/locations/"))return;this.backgroundAssetPath=e;const t="!"+e;this.getObjectPlacement().addAsset(t,e);const s=await Qn(this.getObjectPlacement(),t,tn.assetsFolder+e);this.renderBackground(s)}renderBackground(e){if("!"!==e[0])return;this.getObjectPlacement().layerManager.clearLayerContents(wn.Background);const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),an.x,an.y,e).setInteractive();this.getObjectPlacement().layerManager.addToLayer(wn.Background,t)}getBackgroundAssetPath(){return this.backgroundAssetPath}screenLog(){return this.backgroundAssetPath+"\n"}}let Dl;function Ll(e){return Math.floor(e).toString()}!function(e){e[e.DrawBBox=0]="DrawBBox",e[e.DragResizeObj=1]="DragResizeObj"}(Dl||(Dl={}));class jl{constructor(){this.checkpointTitle="boundingBoxes",this.objectPlacement=void 0,this.bboxBeingDrawn=void 0,this.startingCoordinates=void 0,this.bboxDetailMap=void 0,this.getObjectPlacement=()=>cn(this.objectPlacement),this.bboxDetailMap=new Map}initialise(e){this.objectPlacement=e,this.addBBoxListeners(e)}addBBoxListeners(e){this.getObjectPlacement().inputManager.registerEventListener("pointerdown",()=>{this.getObjectPlacement().isCursorMode(Dl.DrawBBox)&&(this.bboxBeingDrawn=this.createNewBBox())}),this.getObjectPlacement().inputManager.registerEventListener("pointerup",()=>{if(this.getObjectPlacement().isCursorMode(Dl.DrawBBox)&&this.bboxBeingDrawn){if(this.bboxBeingDrawn.displayWidth<=2||this.bboxBeingDrawn.displayHeight<=2)return void this.bboxBeingDrawn.destroy();this.bboxBeingDrawn.x+=this.bboxBeingDrawn.displayWidth/2,this.bboxBeingDrawn.y+=this.bboxBeingDrawn.displayHeight/2,this.bboxBeingDrawn.setOrigin(.5),this.registerBBox(this.bboxBeingDrawn),e.input.setDraggable(this.bboxBeingDrawn),this.getObjectPlacement().setActiveSelection(this.bboxBeingDrawn),this.startingCoordinates=void 0,this.bboxBeingDrawn=void 0}})}createNewBBox(){const[e,t]=this.getObjectPlacement().getCoordinates(),s=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e,t,1,1,Ja.white).setOrigin(0).setAlpha(.1).setInteractive().setDataEnabled();return this.startingCoordinates=[e,t],this.getObjectPlacement().layerManager.addToLayer(wn.BBox,s),s}registerBBox(e){const t="bbox"+this.getObjectPlacement().generateItemIdNumber(),s={id:t,x:e.x,y:e.y,width:e.displayWidth,height:e.displayHeight};this.bboxDetailMap.set(t,s),e.data.set("itemId",t),e.data.set("type","bbox")}getLoggables(){return[...this.bboxDetailMap.values()]}getItemById(e){return this.bboxDetailMap.get(e)}resizeWhileBeingDrawn(e){if(!this.getObjectPlacement().isCursorMode(Dl.DrawBBox)||!this.startingCoordinates||!this.bboxBeingDrawn)return;const[t,s]=this.startingCoordinates,a=e.input.x,n=e.input.y;Bi(this.bboxBeingDrawn,a-t,n-s)}checkpointTxtLog(){const e=[];return this.bboxDetailMap.forEach(t=>{const s=["+"+t.id,Ll(t.x),Ll(t.y),Ll(t.width),Ll(t.height)];e.push(s.join(", ")),e.push("    show_dialogue*(click)")}),e}setAttribute(e,t,s){const a=e.data.get("itemId"),n=this.bboxDetailMap.get(a);n&&(n[t]=s)}deleteAll(){this.bboxDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.bboxDetailMap.delete(t)}}const Bl={key:Ka.zektonFont.key,size:20,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};var Gl={iconBgSize:55,iconSize:40,iconSpacing:15,inactiveAlpha:.7,onHoverAlpha:1,activeAlpha:.9,altTextXPos:44,altTextYPos:-22,altTextMargin:10};class Ul extends Phaser.GameObjects.Container{constructor(e,t,s,a,n=Dl.DragResizeObj){super(e,t,s),this.isModes=void 0,this.currCursorMode=void 0,this.cursorModes=void 0,this.currActiveModeIdx=void 0,this.soundManager=void 0,this.currCursorMode=n,this.isModes=new Array,this.cursorModes=new Array,this.currActiveModeIdx=tn.nullSequenceNumber,this.soundManager=a}getCurrCursorMode(){return this.currCursorMode}setCursorMode(e){this.currCursorMode=e}addCursorMode(e,t,s=!0,a="",n=tn.nullFunction,i=tn.nullFunction,r=tn.nullFunction){const o=new Phaser.GameObjects.Container(e,0,0);this.isModes.push(s),this.cursorModes.push(o);const l=this.cursorModes.length-1,c=new Kn(e,Gl.altTextXPos,Gl.altTextYPos,a,Bl),d=gn(e,{assetKey:Il.iconBg.key,onUp:()=>{this.isModes[l]&&(this.currActiveModeIdx=l),n(),this.renderCursorModesContainer()},onHover:()=>{""!==a&&c.setVisible(!0),o.setAlpha(Gl.onHoverAlpha),i()},onOut:()=>{c.setVisible(!1);const e=l===this.currActiveModeIdx&&this.isModes[l];o.setAlpha(e?Gl.activeAlpha:Gl.inactiveAlpha),r()},onHoverEffect:!1},this.soundManager),u=new Phaser.GameObjects.Sprite(e,0,0,t).setDisplaySize(Gl.iconSize,Gl.iconSize);d.add(u),o.add([d,c])}renderCursorModesContainer(){this.removeAll(!1);let e=0;this.cursorModes.forEach((t,s)=>{t.setPosition(0,e);const a=s===this.currActiveModeIdx&&this.isModes[s];t.setAlpha(a?Gl.activeAlpha:Gl.inactiveAlpha),this.add(t),e+=Gl.iconBgSize+Gl.iconSpacing})}}const Hl={key:Ka.zektonFont.key,size:27,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};function Vl(e){return e.split("/").pop().split(".")[0]}const Fl=e=>"    "+e;class ql{constructor(){this.detailMapContainer=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>cn(this.objectPlacement)}initialise(e){this.objectPlacement=e}printCheckpoint(e="/locations/yourRoom-dim/normal.png",t){const s=""===e?"default":Vl(e),a=t.map(e=>{const t=e.checkpointTxtLog();if(!t)return"";return`${e.checkpointTitle}\n${t.map(Fl).map(Fl).join("\n")}`}),n=`\nstartingLoc: ${s}\n\nobjectives\n    talk\n\nlocations\n    ${s}, ${e}, ${si.toCapitalizedWords(e)}\n\n${s}\n    modes: explore\n    actions\n        show_dialogue(welcome)\n${a.map(Fl).join("\n")}\n\ndialogues\n    welcome\n        Congrats on creating your scene\n    click\n        Invisible bounding box is right here\n`;alert("Chapter ready!"),console.log(n)}showDetailMap(e){this.detailMapContainer=new Phaser.GameObjects.Container(this.getObjectPlacement(),0,0),e.forEach(e=>{const t=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e.x,e.y,400,210,Ja.darkBlue).setOrigin(0,.5).setAlpha(.9),s=mn(this.getObjectPlacement(),this.formatObjectDetails(e),e.x+20,e.y+10,Hl).setLetterSpacing(3).setOrigin(0,.6);this.detailMapContainer.add([t,s])}),this.getObjectPlacement().add.existing(this.detailMapContainer)}formatObjectDetails(e){return Object.entries(e).map(([e,t])=>`${e}: ${"number"===typeof t?Ll(t):t.toString()}`).join("\n")}hideDetailMap(){this.detailMapContainer&&this.detailMapContainer.destroy()}}class Xl{constructor(){this.checkpointTitle="objects",this.objectPlacement=void 0,this.objectDetailMap=void 0,this.getObjectPlacement=()=>cn(this.objectPlacement),this.objectDetailMap=new Map}initialise(e){this.objectPlacement=e,this.objectDetailMap=new Map}async loadObject(){const e=sessionStorage.getItem("selectedAsset");if(!e)return;const t="#"+e;this.getObjectPlacement().addAsset(t,e);const s=await Qn(this.getObjectPlacement(),t,tn.assetsFolder+e);this.renderObject(s)}renderObject(e){if("#"!==e[0])return;const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),an.x,an.y,e).setInteractive().setDataEnabled();this.getObjectPlacement().input.setDraggable(t),this.getObjectPlacement().layerManager.addToLayer(wn.Objects,t),this.registerObject(e,t)}registerObject(e,t){const s=this.generateItemId(e,this.getObjectPlacement().generateItemIdNumber()),a={id:s,assetKey:e,assetPath:cn(this.getObjectPlacement().getAssetPath(e)),x:an.x,y:an.y};this.objectDetailMap.set(s,a),t.data.set("itemId",s),t.data.set("type","object"),this.getObjectPlacement().setActiveSelection(t)}generateItemId(e,t){return`${Vl(e)}${t}`}getLoggables(){return[...this.objectDetailMap.values()]}checkpointTxtLog(){return Array.from(rn(this.objectDetailMap,e=>{const t=["+"+e.id,e.assetPath,Ll(e.x),Ll(e.y)];return e.width&&(t.push(Ll(e.width)),t.push(Ll(e.height))),t.join(", ")}).values())}setAttribute(e,t,s){const a=e.data.get("itemId"),n=this.objectDetailMap.get(a);n&&(n[t]=s)}deleteAll(){this.objectDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.objectDetailMap.delete(t)}}var Wl={activeSelectMargin:30,scaleFactor:1.02};class zl{constructor(){this.activeSelection=void 0,this.activeSelectRect=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>cn(this.objectPlacement)}initialise(e){this.objectPlacement=e,this.trackDraggables(e),this.drawActiveSelectRect(),this.bindDeleteKey()}drawActiveSelectRect(){this.activeSelectRect=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),0,0,1,1,0).setAlpha(.3),this.getObjectPlacement().layerManager.addToLayer(wn.Selector,this.activeSelectRect)}trackDraggables(e){e.inputManager.registerEventListener("drag",(t,s,a,n)=>{e.isCursorMode(Dl.DrawBBox)||(e.getCursorManager().setCursorMode(Dl.DragResizeObj),s.x=a,s.y=n),"object"===s.data.get("type")&&(e.setObjAttribute(s,"x",a),e.setObjAttribute(s,"y",n),this.setActiveSelection(s)),"bbox"===s.data.get("type")&&(e.setBBoxAttribute(s,"x",a),e.setBBoxAttribute(s,"y",n),this.setActiveSelection(s))})}resizeActive(e){const t=this.getObjectPlacement();if(!this.activeSelection||!this.activeSelectRect)return;const s=e?Wl.scaleFactor:1/Wl.scaleFactor;!function(e,t){e.displayWidth*=t,e.displayHeight*=t}(this.activeSelection,s),this.activeSelectRect.displayHeight=this.activeSelection.displayHeight+Wl.activeSelectMargin,this.activeSelectRect.displayWidth=this.activeSelection.displayWidth+Wl.activeSelectMargin,"object"===this.activeSelection.data.get("type")&&(t.setObjAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setObjAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight))),"bbox"===this.activeSelection.data.get("type")&&(t.setBBoxAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setBBoxAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight)))}setActiveSelection(e){this.activeSelectRect&&(this.activeSelectRect.setAlpha(.3),this.activeSelection=e,this.activeSelectRect.x=e.x,this.activeSelectRect.y=e.y,this.activeSelectRect.displayHeight=e.displayHeight+Wl.activeSelectMargin,this.activeSelectRect.displayWidth=e.displayWidth+Wl.activeSelectMargin)}deselect(){this.activeSelectRect.setAlpha(0),this.activeSelection=void 0}bindDeleteKey(){[Phaser.Input.Keyboard.KeyCodes.BACKSPACE,Phaser.Input.Keyboard.KeyCodes.DELETE].forEach(e=>this.getObjectPlacement().inputManager.registerKeyboardListener(e,"up",()=>{this.deleteActiveSelection(),this.deselect()}))}deleteActiveSelection(){if(this.activeSelection){switch(this.getType(this.activeSelection)){case"object":this.getObjectPlacement().deleteObj(this.activeSelection);break;case"bbox":this.getObjectPlacement().deleteBBox(this.activeSelection)}this.activeSelection.destroy()}}getType(e){var t;return null===(t=this.activeSelection)||void 0===t?void 0:t.data.get("type")}}var Yl={cursorModeXPos:100,cursorModeYPos:100};class $l extends Phaser.Scene{constructor(){super("ObjectPlacement"),this.layerManager=void 0,this.soundManager=void 0,this.inputManager=void 0,this.transformManager=void 0,this.cursorModes=void 0,this.bboxManager=void 0,this.objectManager=void 0,this.backgroundManager=void 0,this.logManager=void 0,this.assetMap=void 0,this.itemIdNumber=void 0,this.openBracket=void 0,this.closedBracket=void 0,this.getCursorManager=()=>cn(this.cursorModes),this.layerManager=new Fn,this.soundManager=new qn,this.inputManager=new Ml,this.objectManager=new Xl,this.bboxManager=new jl,this.backgroundManager=new _l,this.logManager=new ql,this.transformManager=new zl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}init(){this.layerManager=new Fn,this.soundManager=new qn,this.inputManager=new Ml,this.objectManager=new Xl,this.bboxManager=new jl,this.backgroundManager=new _l,this.logManager=new ql,this.transformManager=new zl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}create(){this.layerManager.initialise(this),this.soundManager.initialise(this,Jl()),this.inputManager.initialise(this),this.renderBackground(),this.createUIButtons(),this.backgroundManager.initialise(this),this.objectManager.initialise(this),this.bboxManager.initialise(this),this.transformManager.initialise(this),this.logManager.initialise(this),this.openBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET),this.closedBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET)}update(){this.openBracket&&this.openBracket.isDown&&this.transformManager.resizeActive(!1),this.closedBracket&&this.closedBracket.isDown&&this.transformManager.resizeActive(!0),this.bboxManager.resizeWhileBeingDrawn(this)}createUIButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=new vn(this,()=>{this.cleanUp(),Jl().setStorySimState(kl.Default),this.scene.start("StorySimulatorMenu")},0,0,this.soundManager);this.cursorModes=new Ul(this,Yl.cursorModeXPos,Yl.cursorModeYPos,this.soundManager),this.populateCursorModes(),e.add(this.cursorModes),e.add(t),this.layerManager.addToLayer(wn.UI,e)}renderBackground(){const e=new Phaser.GameObjects.Image(this,an.x,an.y,Il.storySimBg.key);e.setDisplaySize(sn.x,sn.y),this.layerManager.addToLayer(wn.Background,e)}populateCursorModes(){this.cursorModes&&(this.cursorModes.addCursorMode(this,Il.colorIcon.key,!1,"Set background",async()=>await this.backgroundManager.loadBackground()),this.cursorModes.addCursorMode(this,Il.imageIcon.key,!1,"Add selected object",async()=>await this.objectManager.loadObject()),this.cursorModes.addCursorMode(this,Il.bboxIcon.key,!0,"Draw bounding boxes",()=>this.cursorModes.setCursorMode(Dl.DrawBBox)),this.cursorModes.addCursorMode(this,Il.handIcon.key,!0,"Drag or resize",()=>this.cursorModes.setCursorMode(Dl.DragResizeObj)),this.cursorModes.addCursorMode(this,Il.listIcon.key,!1,"Print coordinates",()=>this.logManager.printCheckpoint(this.backgroundManager.getBackgroundAssetPath(),[this.objectManager,this.bboxManager]),()=>this.logManager.showDetailMap([...this.objectManager.getLoggables(),...this.bboxManager.getLoggables()]),()=>this.logManager.hideDetailMap()),this.cursorModes.addCursorMode(this,Il.eraseIcon.key,!1,"Erase all",()=>{this.layerManager.clearSeveralLayers([wn.Background,wn.BBox,wn.Objects]),this.objectManager.deleteAll(),this.bboxManager.deleteAll(),this.transformManager.deselect(),this.renderBackground()}),this.cursorModes.renderCursorModesContainer())}getCoordinates(){return[this.input.x,this.input.y]}isCursorMode(e){return this.getCursorManager().getCurrCursorMode()===e}cleanUp(){this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}addAsset(e,t){this.assetMap.set(e,t)}getAssetPath(e){return this.assetMap.get(e)}generateItemIdNumber(){return this.itemIdNumber++}setActiveSelection(e){this.transformManager.setActiveSelection(e)}setObjAttribute(e,t,s){this.objectManager.setAttribute(e,t,s)}deleteObj(e){this.objectManager.delete(e)}setBBoxAttribute(e,t,s){this.bboxManager.setAttribute(e,t,s)}deleteBBox(e){this.bboxManager.delete(e)}}const Kl={debug:!0,type:Ya.WEBGL,width:sn.x,height:sn.y,physics:{default:"arcade"},scale:{mode:Ya.Scale.FIT,parent:"game-display"}};let Ql;const Jl=()=>Ql;class Zl{constructor(){this.observerId=void 0,this.observerId="GameBackgroundManager"}renderBackgroundLayerContainer(e){const t=Vn.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){Vn.getInstance().clearSeveralLayers([wn.Background]);const t=Vn.getInstance().getGameManager(),s=new Phaser.GameObjects.Image(t,an.x,an.y,e).setDisplaySize(sn.x,sn.y).setAlpha(0);t.add.tween(Rn([s],tn.fadeDuration)),Vn.getInstance().addContainerToLayer(wn.Background,s)}}const ec={y:0,duration:300,ease:"Power2"},tc={y:-sn.y,duration:250,ease:"Power2"},sc={key:Ka.alienLeagueFont.key,size:35,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},ac={key:Ka.zektonFont.key,size:25,fill:Ja.darkBlue,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},nc={key:Ka.alienLeagueFont.key,size:50,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ic={fontFamily:"Verdana",fontSize:"25px",fill:Qa.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},rc={assetKey:dn.cookies.key,x:0,y:0};var oc={backButtonYPos:.3*sn.y,pageYStartPos:.3*-sn.y,pageYSpacing:150,pageTextXPos:.3*sn.x,listYStartPos:.31*-sn.y,listYSpacing:100,listTextXPos:.09*-sn.x,previewXPos:.3*-sn.x,previewYPos:.05*-sn.y,previewDim:430,titleYOffset:-275,descYOffset:275,arrowDownYPos:.34*sn.y,arrowXMidPos:.08*sn.x,arrowXOffset:80,arrowXScale:.4,arrowYScale:.3,itemsPerPage:7};let lc;!function(e){e.Collectibles="Collectibles",e.Achievements="Achievements"}(lc||(lc={}));var cc=class{constructor(){this.scene=void 0,this.layerManager=void 0,this.soundManager=void 0,this.phaseManager=void 0,this.uiContainer=void 0,this.previewContainer=void 0,this.itemsContainer=void 0,this.pageChosenContainer=void 0,this.currActivePage=void 0,this.activePageNumber=void 0,this.getScene=()=>cn(this.scene),this.getLayerManager=()=>cn(this.layerManager),this.getPhaseManager=()=>cn(this.phaseManager),this.activePageNumber=new Map,this.currActivePage=lc.Collectibles}initialise(e,t){this.scene=e,this.layerManager=e.layerManager,this.soundManager=e.soundManager,this.phaseManager=t,Object.keys(lc).forEach((e,t)=>{const s=e;this.activePageNumber.set(s,0)})}setPage(e){if(this.uiContainer){this.itemsContainer&&this.itemsContainer.destroy(),this.pageChosenContainer&&this.pageChosenContainer.destroy(),this.currActivePage=e,this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer);const t=this.getPageOptPositions(),s=Object.keys(lc).findIndex(t=>t===e),a=new Phaser.GameObjects.Sprite(this.getScene(),t[s][0],t[s][1]+oc.pageYStartPos,dn.collectiblesPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.getScene(),0,0,[a]),this.uiContainer.add(this.pageChosenContainer),this.setPreview("",rc,"")}}async activateUI(){this.uiContainer=this.createUIContainer(),this.getLayerManager().addToLayer(wn.UI,this.uiContainer),this.setPage(this.currActivePage),this.uiContainer.setPosition(an.x,-sn.y),this.getScene().tweens.add({targets:this.uiContainer,...ec,y:an.y})}async deactivateUI(){this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getScene().tweens.add({targets:this.uiContainer,...tc}),await nn(tc.duration),Mn(this.getScene(),this.uiContainer,{fadeDuration:50}))}createUIContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=new Phaser.GameObjects.Rectangle(this.getScene(),0,0,sn.x,4*sn.y,0).setAlpha(.7).setInteractive(),s=new Phaser.GameObjects.Image(this.getScene(),0,0,dn.collectiblesMenu.key);e.add([t,s]);const a=Object.keys(lc).map((e,t)=>({text:e,callback:()=>this.setPage(e)})),n=this.getPageOptPositions();e.add(a.map((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+oc.pageYStartPos,e.callback)));const i=this.createPageOpt("Back",0,oc.backButtonYPos,async()=>{this.getPhaseManager().isCurrentPhase(Un.CollectibleMenu)&&await this.getPhaseManager().popPhase()});e.add(i);const r=gn(this.getScene(),{assetKey:dn.arrow.key,onUp:()=>this.nextPage(!1)},this.soundManager).setScale(oc.arrowXScale,oc.arrowYScale).setRotation(-90*Math.PI/180).setPosition(oc.arrowXMidPos-oc.arrowXOffset,oc.arrowDownYPos),o=gn(this.getScene(),{assetKey:dn.arrow.key,onUp:()=>this.nextPage(!0)},this.soundManager).setScale(oc.arrowXScale,oc.arrowYScale).setRotation(90*Math.PI/180).setPosition(oc.arrowXMidPos+oc.arrowXOffset,oc.arrowDownYPos);e.add([r,o]);const l=new Phaser.GameObjects.Sprite(this.getScene(),oc.previewXPos,oc.previewYPos,dn.popUpFrame.key).setScale(1.2);return e.add(l),e}getPageOptPositions(){return en({numOfItems:Object.keys(lc).length,xSpacing:0,ySpacing:oc.pageYSpacing})}setPreview(e,t,s=""){if(this.uiContainer){this.previewContainer&&this.previewContainer.destroy(),this.previewContainer=new Phaser.GameObjects.Container(this.getScene(),0,0);const a=new Phaser.GameObjects.Sprite(this.getScene(),0,0,t.assetKey);Gi(a,oc.previewDim,oc.previewDim),a.setPosition(oc.previewXPos,oc.previewYPos).setOrigin(.428,.468);const n=mn(this.getScene(),e,oc.previewXPos,oc.previewYPos+oc.titleYOffset,nc).setOrigin(.35,.5),i=new Phaser.GameObjects.Text(this.getScene(),oc.previewXPos,oc.previewYPos+oc.descYOffset,s,ic).setOrigin(.45,0);this.previewContainer.add([a,n,i]),this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber.get(this.currActivePage),s=on(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(s).length>0&&(this.activePageNumber.set(this.currActivePage,s),this.setPage(this.currActivePage))}createPageOpt(e,t,s,a){return gn(this.getScene(),{assetKey:dn.collectiblesPage.key,message:e,textConfig:{x:oc.pageTextXPos,y:0,oriX:.1,oriY:.5},bitMapTextStyle:sc,onUp:a},this.soundManager).setPosition(t,s)}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=this.getItems(this.activePageNumber.get(this.currActivePage)),s=en({numOfItems:t.length,xSpacing:0,ySpacing:oc.listYSpacing});return e.add(t.map((e,t)=>this.createItemButton(e,s[t][0],s[t][1]+oc.listYStartPos,()=>this.setPreview(e,rc)))),e}createItemButton(e,t,s,a){return gn(this.getScene(),{assetKey:dn.collectiblesBanner.key,message:e,textConfig:{x:oc.listTextXPos,y:0,oriX:0,oriY:.55},bitMapTextStyle:ac,onUp:a},this.soundManager).setPosition(t,s)}getItems(e){let t;switch(this.currActivePage){case lc.Achievements:t=["achievement1","achievement2","achievement3","achievement4","achievement5","achievement6","achievement7","achievement8","achievement9","achievement10","achievement11","achievement12"];break;case lc.Collectibles:t=["collect1","collect2"];break;default:t=[]}const s=e*oc.itemsPerPage;return t.slice(s,s+oc.itemsPerPage)}};class dc extends Phaser.GameObjects.Container{constructor(e,{choices:t,defaultChoiceIdx:s=0,maxXSpace:a=sn.x,radioChoiceConfig:n={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:i={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:r=tn.defaultFontStyle},o,l){super(e,o,l),this.activeChoice=void 0,this.activeChoiceIdx=void 0,this.choices=void 0,this.buttonPositions=void 0,this.radioChoiceConfig=void 0,this.choiceTextConfig=void 0,this.bitmapTextStyle=void 0,this.activeChoiceIdx=s,this.choices=t,this.choiceTextConfig=i,this.bitmapTextStyle=r,this.radioChoiceConfig=n;const c=this.getRadioButtons(t);this.buttonPositions=Za({numOfItems:c.length,maxXSpace:a}),this.renderRadioButtons(c,this.buttonPositions,this.radioChoiceConfig),this.activate(s)}getRadioButtons(e){return e.map((e,t)=>({text:e,callback:()=>this.activate(t)}))}renderRadioButtons(e,t,s){this.add(e.map((e,a)=>this.createRadioButton(t[a][0],t[a][1],e.callback,s)))}createRadioButton(e,t,s,a){return new Phaser.GameObjects.Ellipse(this.scene,e,t,a.circleDim,a.circleDim,Ja.lightBlue).setStrokeStyle(a.outlineThickness,Ja.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,s)}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=mn(this.scene,this.choices[e],this.choiceTextConfig.x,this.choiceTextConfig.y,this.bitmapTextStyle).setOrigin(this.choiceTextConfig.oriX,this.choiceTextConfig.oriY),s=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,Ja.darkBlue);this.activeChoice.add([t,s]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:tn.nullInteractionId}}var uc=dc;const hc={key:Ka.zektonFont.key,size:25,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},pc={key:Ka.zektonFont.key,size:35,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},mc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var gc={optXSpace:.4*sn.x,optXPos:140,volUnderlineYPos:.25*sn.y,volTextXpos:.25*sn.x,volTextYPos:.23*sn.y,volOptYPos:.26*-sn.y,volContainerOpts:["0","0.5","1.0","1.5","2.0"]};const yc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ec={key:Ka.zektonFont.key,size:20,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},bc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var vc={textOriX:.33,textOriY:.85,buttonYPos:.15*sn.y,optTextXPos:.38*sn.x,optTextYPos:.38*sn.y,radioButtonsXSpace:.2*sn.x,volOptXPos:.05*sn.x,volOptYPos:.1*-sn.y};var Sc=class{constructor(){this.volumeOptions=void 0,this.scene=void 0,this.layerManager=void 0,this.phaseManager=void 0,this.soundManager=void 0,this.inputManager=void 0,this.saveManager=void 0,this.isStorySimulator=void 0,this.getScene=()=>cn(this.scene),this.getLayerManager=()=>cn(this.layerManager),this.getSoundManager=()=>cn(this.soundManager),this.getSaveManager=()=>cn(this.saveManager),this.getPhaseManager=()=>cn(this.phaseManager),this.getInputManager=()=>cn(this.inputManager),this.isStorySimulator=!1}initialise(e,t,s,a){this.scene=e,this.layerManager=e.layerManager,this.soundManager=e.soundManager,this.inputManager=e.inputManager,this.phaseManager=t,this.saveManager=s,this.isStorySimulator=a}createUIContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=new Phaser.GameObjects.Image(this.getScene(),an.x,an.y,dn.escapeMenuBackground.key).setDisplaySize(sn.x,sn.y).setInteractive({pixelPerfect:!0}),s=this.createVolOptContainer();e.add([t,s]);const a=this.getOptButtons(),n=Za({numOfItems:a.length});return e.add(a.map((e,t)=>this.createEscapeOptButton(e.text,n[t][0],n[t][1]+vc.buttonYPos,e.callback))),e}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),this.isStorySimulator?this.getScene().scene.start("StorySimulatorMenu"):this.getScene().scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.getPhaseManager().isCurrentPhase(Un.EscapeMenu)&&await this.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}activateUI(){const e=this.createUIContainer();this.getLayerManager().addToLayer(wn.Escape,e)}deactivateUI(){this.getLayerManager().clearSeveralLayers([wn.Escape])}createVolOptContainer(){const e=new Phaser.GameObjects.Container(this.getScene(),0,0),t=this.getSaveManager().getLoadedUserState().settings.volume,s=gc.volContainerOpts.findIndex(e=>parseFloat(e)===t),a=mn(this.getScene(),"Volume",vc.optTextXPos,vc.optTextYPos,bc);return this.volumeOptions=new uc(this.getScene(),{choices:gc.volContainerOpts,defaultChoiceIdx:s,maxXSpace:vc.radioButtonsXSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},bitmapTextStyle:Ec},vc.volOptXPos,vc.volOptYPos),e.add([a,this.volumeOptions]),e}createEscapeOptButton(e,t,s,a){return gn(this.getScene(),{assetKey:dn.mediumButton.key,message:e,textConfig:{x:0,y:0,oriX:.37,oriY:.75},bitMapTextStyle:yc,onUp:a},this.soundManager).setPosition(t,s)}async applySettings(){if(this.volumeOptions){const e=parseFloat(this.volumeOptions.getChosenChoice());await this.getSaveManager().saveSettings({volume:e});const t=this.getSaveManager().getLoadedUserState();this.getSoundManager().applyUserSettings(t)}}cleanUp(){this.getSoundManager().stopCurrBgMusic(),this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}};class fc{constructor(){this.phaseMap=void 0,this.phaseStack=void 0,this.inputManager=void 0,this.phaseTransitionCallback=void 0,this.getInputManager=()=>cn(this.inputManager),this.phaseStack=[Un.None],this.phaseMap=new Map,this.phaseTransitionCallback=tn.nullFunction}initialise(e,t){this.phaseMap=e,this.inputManager=t}setCallback(e){this.phaseTransitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e===t||this.isCurrentPhase(Un.EscapeMenu)||(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e===t||this.isCurrentPhase(Un.EscapeMenu)||(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){await this.phaseTransitionCallback(t),this.getInputManager().enableKeyboardInput(!1),this.getInputManager().enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),await this.phaseMap.get(t).activateUI(),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[Un.None]),this.phaseStack[this.phaseStack.length-1]}}let Cc;!function(e){e.Game="Game",e.Settings="Settings",e.Simulator="Simulator",e.None="None"}(Cc||(Cc={}));class Ac{constructor(){this.accountInfo=void 0,this.fullSaveState=void 0,this.chapterNum=void 0,this.checkpointNum=void 0,this.continueGame=void 0,this.version=void 0,this.getAccountInfo=()=>cn(this.accountInfo),this.fullSaveState={gameSaveStates:{},userState:{collectibles:[],achievements:[],settings:{volume:1},lastPlayedCheckpoint:[-1,-1],lastCompletedChapter:-1}},this.chapterNum=tn.nullSequenceNumber,this.checkpointNum=tn.nullSequenceNumber,this.continueGame=!1,this.version=Cc.None}async initialiseForGame(e,t,s,a,n){if("student"!==e.role)throw Error("This initalisation method is for students playing games");if(this.accountInfo=e,this.chapterNum=s,this.checkpointNum=a,!t)throw Error("No loaded state");this.fullSaveState=t,this.continueGame=n,this.version=Cc.Game}async initialiseForSettings(e,t){if(this.accountInfo=e,!t)throw Error("No loaded state");this.fullSaveState=t,this.continueGame=!1,this.version=Cc.Settings}async initialiseForStaff(e){if("staff"!==e.role)throw Error("This initalisation method is for staff testing simulator");this.accountInfo=e,this.version=Cc.Simulator}async saveGame(){if(this.version!==Cc.Game){if(this.version===Cc.Simulator)return;throw new Error("Only used during gameplay")}this.fullSaveState=function(e,t,s){const a=Vn.getInstance().getGameManager(),n=a.stateManager,i=a.userStateManager,r=a.phaseManager,o={currentLocation:a.currentLocationId,currentPhase:r.getCurrentPhase(),chapterObjective:Qi(n.getCheckpointObjectives().getObjectives()),locationStates:Ji(n.getLocationStates()),objectPropertyMap:Qi(n.getObjPropertyMap()),bboxPropertyMap:Qi(n.getBBoxPropertyMap()),triggeredInteractions:Qi(n.getTriggeredInteractions()),lastCheckpointPlayed:s},l={settings:{...e.userState.settings},lastPlayedCheckpoint:[t,s],collectibles:i.getList("collectibles"),achievements:i.getList("achievements"),lastCompletedChapter:void 0===e.userState.lastCompletedChapter?-1:e.userState.lastCompletedChapter};return{gameSaveStates:{...e.gameSaveStates,[t]:o},userState:l}}(this.fullSaveState,this.chapterNum,this.checkpointNum),await sd(this.getAccountInfo(),this.fullSaveState)}async saveSettings(e){this.fullSaveState=function(e,t){return{gameSaveStates:e.gameSaveStates,userState:{...e.userState,settings:t}}}(this.fullSaveState,e),await sd(this.getAccountInfo(),this.fullSaveState)}getLoadedUserState(){return this.fullSaveState.userState}getLoadedGameStoryState(){return this.continueGame?this.fullSaveState.gameSaveStates[this.chapterNum]:void 0}getLoadedLocation(){return this.continueGame&&this.fullSaveState.gameSaveStates[this.chapterNum]?this.fullSaveState.gameSaveStates[this.chapterNum].currentLocation:void 0}getLoadedPhase(){return this.fullSaveState.gameSaveStates[this.chapterNum].currentPhase}}const Oc=`url(${tn.assetsFolder}/ui/magnifying.png), pointer`,wc=`url(${tn.assetsFolder}/ui/magnifying_trigg.png), pointer`,Tc=`url(${tn.assetsFolder}/ui/magnifying_check.png), pointer`;var Ic=class{constructor(){this.uiContainer=void 0}createUIContainer(){const e=Vn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new vn(e,()=>{Vn.getInstance().popPhase(),Vn.getInstance().fadeInLayer(wn.Character,300)},0,0,e.soundManager);return t.add(s),t}async activateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Vn.getInstance().addContainerToLayer(wn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-sn.y),e.tweens.add({targets:this.uiContainer,...ec}),Vn.getInstance().enableObjectAction({onClick:this.explorePointerUp,onHover:this.explorePointerOver,onPointerout:this.explorePointerOut}),Vn.getInstance().enableBBoxAction({onClick:this.explorePointerUp,onHover:this.explorePointerOver,onPointerout:this.explorePointerOut}),e.input.setDefaultCursor(Oc)}async deactivateUI(){const e=Vn.getInstance().getGameManager();e.input.setDefaultCursor(""),Vn.getInstance().disableBBoxAction(),Vn.getInstance().disableObjectAction(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...tc}),await nn(500),Mn(e,this.uiContainer))}explorePointerOver(e){const t=Vn.getInstance().getGameManager();Vn.getInstance().hasTriggeredInteraction(e)?t.input.setDefaultCursor(Tc):t.input.setDefaultCursor(wc)}explorePointerOut(){Vn.getInstance().getGameManager().input.setDefaultCursor(Oc)}explorePointerUp(e){const t=Vn.getInstance().getGameManager();t.input.setDefaultCursor(""),Vn.getInstance().triggerInteraction(e),t.input.setDefaultCursor(Oc)}};const kc={key:Ka.zektonFont.key,size:45,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Pc={assetKey:dn.modeMenuBanner.key,assetXPos:an.x,assetYPos:an.y,isInteractive:!1};var xc={buttonYPosOffset:.3*sn.y,entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*sn.y,duration:300,ease:"Power2"}};var Nc=class{constructor(){this.uiContainer=void 0}getLatestLocationModes(){const e=Vn.getInstance().getCurrLocId();let t=Vn.getInstance().getModesByLocId(e);return 0===Vn.getInstance().getLocationAttr(ni.talkTopics,e).length&&(t=t.filter(e=>e!==oi.Talk)),t}createUIContainer(){const e=Vn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Image(e,Pc.assetXPos,Pc.assetYPos,Pc.assetKey);t.add(s);const a=this.getLatestLocationModes(),n=this.getModeButtons(a),i=Za({numOfItems:n.length});return t.add(n.map((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+xc.buttonYPosOffset,e.callback))),t}getModeButtons(e){return e.sort().map(e=>({text:e,callback:()=>{Vn.getInstance().pushPhase(li[e]),e!==oi.Talk&&Vn.getInstance().fadeOutLayer(wn.Character,300)}}))}createModeButton(e,t,s,a){const n=Vn.getInstance().getGameManager();return gn(n,{assetKey:dn.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:kc,onUp:a},n.soundManager).setPosition(t,s)}async activateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Vn.getInstance().addContainerToLayer(wn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,sn.y),e.tweens.add({targets:this.uiContainer,...xc.entryTweenProps})}async deactivateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...xc.exitTweenProps}),await nn(500),Mn(e,this.uiContainer))}};const Rc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Mc={buttonYSpace:.8*sn.y,buttonXPosOffset:.25*sn.x,previewFrameXPos:.3*sn.x,previewWidth:.473*sn.x,previewHeight:.56*sn.y,previewXPos:.3125*sn.x,previewYPos:.515*sn.y};var _c=class{constructor(){this.uiContainer=void 0}setPreview(e,t){e.setTexture(t).setDisplaySize(Mc.previewWidth,Mc.previewHeight).setPosition(Mc.previewXPos,Mc.previewYPos)}getLatestNavigations(){return Vn.getInstance().getLocationAttr(ni.navigation,Vn.getInstance().getCurrLocId())}createUIContainer(){const e=Vn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,Mc.previewFrameXPos,an.y,dn.locationPreviewFrame.key),a=new Phaser.GameObjects.Sprite(e,an.x,an.y,dn.locationPreviewFill.key);t.add([s,a]);const n=this.getLatestNavigations(),i=this.getMoveButtons(n,a),r=Za({numOfItems:i.length,numItemLimit:1,maxYSpace:Mc.buttonYSpace});t.add(i.map((e,t)=>this.createMoveButton(e.text,r[t][0]+Mc.buttonXPosOffset,r[t][1],e.callback,e.onHover,e.onOut)));const o=new vn(e,()=>{Vn.getInstance().popPhase(),Vn.getInstance().fadeInLayer(wn.Character,300)},0,0,e.soundManager);return t.add(o),this.setPreview(a,dn.defaultLocationImg.key),t}getMoveButtons(e,t){const s=e=>this.setPreview(t,e),a=()=>this.setPreview(t,dn.defaultLocationImg.key);return e.map(e=>{const t=Vn.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await Vn.getInstance().popPhase(),await Vn.getInstance().changeLocationTo(e)},onHover:()=>s(t.assetKey),onOut:()=>a()}})}createMoveButton(e,t,s,a,n,i){const r=Vn.getInstance().getGameManager();return gn(r,{assetKey:dn.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:Rc,onUp:a,onHover:n,onOut:i},r.soundManager).setPosition(t,s)}async activateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Vn.getInstance().addContainerToLayer(wn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-sn.y),e.tweens.add({targets:this.uiContainer,...ec})}async deactivateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...tc}),await nn(500),Mn(e,this.uiContainer))}};var Dc=class{activateUI(){}deactivateUI(){}};const Lc=.7*sn.y,jc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};var Bc=class{constructor(){this.uiContainer=void 0}getLatestTalkTopics(){return Vn.getInstance().getLocationAttr(ni.talkTopics,Vn.getInstance().getCurrLocId())}createUIContainer(){const e=Vn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),s=this.getLatestTalkTopics(),a=this.getTalkTopicButtons(s),n=Za({numOfItems:a.length,maxYSpace:Lc});t.add(a.map((e,t)=>this.createTalkTopicButton(e.text,n[t][0],n[t][1],e.callback))),a.forEach((s,a)=>{const i=new Phaser.GameObjects.Sprite(e,n[a][0],n[a][1],dn.talkOptCheck.key);!!s.interactionId&&Vn.getInstance().hasTriggeredInteraction(s.interactionId)&&t.add(i)});const i=new vn(e,()=>Vn.getInstance().popPhase(),0,0,e.soundManager);return t.add(i),t}getTalkTopicButtons(e){return e.map(e=>({text:cn(Vn.getInstance().getDialogue(e)).title,callback:async()=>{Vn.getInstance().triggerInteraction(e),await Vn.getInstance().showDialogue(e)},interactionId:e}))}createTalkTopicButton(e,t,s,a){const n=Vn.getInstance().getGameManager();return gn(n,{assetKey:dn.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:jc,onUp:a,onHoverEffect:!1},n.soundManager).setPosition(t,s)}async activateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),Vn.getInstance().addContainerToLayer(wn.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-sn.y),e.tweens.add({targets:this.uiContainer,...ec})}async deactivateUI(){const e=Vn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...tc}),await nn(500),Mn(e,this.uiContainer))}};class Gc extends Phaser.Scene{constructor(){super("GameManager"),this.currentLocationId=void 0,this.parentGame=void 0,this.isStorySimulator=void 0,this.currentCheckpoint=void 0,this.accountInfo=void 0,this.fullSaveState=void 0,this.continueGame=void 0,this.chapterNum=void 0,this.checkpointNum=void 0,this.layerManager=void 0,this.stateManager=void 0,this.objectManager=void 0,this.characterManager=void 0,this.dialogueManager=void 0,this.actionManager=void 0,this.userStateManager=void 0,this.boundingBoxManager=void 0,this.popUpManager=void 0,this.saveManager=void 0,this.soundManager=void 0,this.escapeManager=void 0,this.phaseManager=void 0,this.backgroundManager=void 0,this.inputManager=void 0,this.collectibleManager=void 0,this.getCurrentCheckpoint=()=>cn(this.currentCheckpoint),this.getAccountInfo=()=>cn(this.accountInfo),this.getParentGame=()=>cn(this.parentGame),this.currentCheckpoint=void 0,this.fullSaveState=void 0,this.continueGame=!1,this.chapterNum=tn.nullSequenceNumber,this.checkpointNum=tn.nullSequenceNumber,this.currentLocationId=tn.nullInteractionId,this.isStorySimulator=!1,this.layerManager=new Fn,this.stateManager=new er,this.characterManager=new Hi,this.objectManager=new Wi,this.dialogueManager=new qi,this.actionManager=new Li,this.userStateManager=new Tl,this.boundingBoxManager=new ji,this.popUpManager=new $i,this.saveManager=new Ac,this.soundManager=new qn,this.escapeManager=new Sc,this.phaseManager=new fc,this.backgroundManager=new Zl,this.inputManager=new Ml,this.collectibleManager=new cc}init({gameCheckpoint:e,fullSaveState:t,continueGame:s,chapterNum:a,checkpointNum:n,isStorySimulator:i}){this.isStorySimulator=i,this.parentGame=i?Jl():td(),this.currentCheckpoint=e,this.fullSaveState=t,this.continueGame=s,this.chapterNum=a,this.checkpointNum=n,this.initialiseManagers()}initialiseManagers(){this.layerManager=new Fn,this.stateManager=new er,this.characterManager=new Hi,this.objectManager=new Wi,this.dialogueManager=new qi,this.actionManager=new Li,this.userStateManager=new Tl,this.boundingBoxManager=new ji,this.popUpManager=new $i,this.saveManager=new Ac,this.soundManager=new qn,this.escapeManager=new Sc,this.phaseManager=new fc,this.backgroundManager=new Zl,this.inputManager=new Ml,this.collectibleManager=new cc}preload(){var e,t;Vn.getInstance().setGameManager(this),On(this),this.loadGameState(),this.currentLocationId=this.saveManager.getLoadedLocation()||this.getCurrentCheckpoint().startingLoc,this.stateManager.initialise(this),this.userStateManager.initialise(this),this.soundManager.initialise(this,this.parentGame||td()),this.dialogueManager.initialise(this),this.characterManager.initialise(this),this.actionManager.initialise(this),this.inputManager.initialise(this),this.boundingBoxManager.initialise(),this.objectManager.initialise(),this.layerManager.initialise(this),this.collectibleManager.initialise(this,this.phaseManager),this.phaseManager.initialise((e=this.escapeManager,t=this.collectibleManager,new Map([[Un.Menu,new Nc],[Un.Move,new _c],[Un.Explore,new Ic],[Un.Talk,new Bc],[Un.Sequence,new Dc],[Un.None,new Dc],[Un.EscapeMenu,e],[Un.CollectibleMenu,t]])),this.inputManager),this.escapeManager.initialise(this,this.phaseManager,this.saveManager,this.isStorySimulator),this.soundManager.loadSounds(this.getCurrentCheckpoint().map.getSoundAssets()),this.phaseManager.setCallback(async e=>await this.checkpointTransition(e)),this.preloadLocationsAssets(this.getCurrentCheckpoint()),this.bindKeyboardTriggers()}loadGameState(){if(this.accountInfo=this.getParentGame().getAccountInfo(),this.isStorySimulator&&"staff"===this.accountInfo.role)this.saveManager.initialiseForStaff(this.accountInfo);else{if(this.isStorySimulator||"student"!==this.accountInfo.role)throw new Error("Mismatch of roles");this.saveManager.initialiseForGame(this.accountInfo,this.fullSaveState,this.chapterNum,this.checkpointNum,this.continueGame)}}preloadLocationsAssets(e){e.map.getMapAssets().forEach((e,t)=>{this.load.image(t,ln(e))})}async create(){await this.userStateManager.loadAssessments(),this.changeLocationTo(this.currentLocationId,!0),await Vn.getInstance().saveGame()}async renderLocation(e,t){const s=Vn.getInstance().getLocationAtId(e);await this.soundManager.renderBackgroundMusic(s.bgmKey),this.backgroundManager.renderBackgroundLayerContainer(e),this.objectManager.renderObjectsLayerContainer(e),this.boundingBoxManager.renderBBoxLayerContainer(e),this.characterManager.renderCharacterLayerContainer(e),this.layerManager.showLayer(wn.Character),await this.phaseManager.swapPhase(Un.Sequence),t&&await this.actionManager.processGameActions(this.getCurrentCheckpoint().map.getStartActions()),this.stateManager.hasTriggeredInteraction(e)||await Vn.getInstance().bringUpUpdateNotif(s.name),await this.actionManager.processGameActions(s.actionIds),await this.phaseManager.swapPhase(Un.Menu)}async changeLocationTo(e,t=!1){this.currentLocationId=e,await(async(e,t,s,a)=>{const n=_n(e);e.layerManager.addToLayer(wn.Effects,n),n.setAlpha(0),e.tweens.add(Rn([n],t)),await nn(t),await a(),await nn(s),n.setAlpha(1),e.tweens.add(Nn([n],t)),await nn(t),n.destroy()})(this,300,500,async()=>{await this.layerManager.clearAllLayers(),await this.renderLocation(e,t)}),this.stateManager.triggerInteraction(e)}bindKeyboardTriggers(){this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",async()=>{this.phaseManager.isCurrentPhase(Un.EscapeMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(Un.EscapeMenu)}),this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.I,"up",async()=>{this.phaseManager.isCurrentPhase(Un.CollectibleMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(Un.CollectibleMenu)})}cleanUp(){this.soundManager.stopCurrBgMusic(),this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}async checkpointTransition(e){e===Un.Menu&&Vn.getInstance().isAllComplete()&&(await this.actionManager.processGameActions(this.getCurrentCheckpoint().map.getEndActions()),this.cleanUp(),Vn.getInstance().isStorySimulator()?this.scene.start("StorySimulatorMenu"):this.scene.start("CheckpointTransition"))}}var Uc=Gc;const Hc='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n';async function Vc(e){return function(e){if(e){const t=e.questions[0],s=t.answer;return s||t.solutionTemplate}return Hc}(await ol(405,{accessToken:e.accessToken,refreshToken:e.refreshToken}))}const Fc={key:Ka.zektonFont.key,size:30,fill:Ja.lightBlue,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT};var qc={optionsText:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",collectible:"Achievements",settings:"Settings"},buttonYSpace:.5*sn.y,optXOffset:80,textXOffset:600,bannerHide:300,bannerShow:200,onFocusOptTween:{x:an.x+200,duration:200,ease:"Power2"},outFocusOptTween:{x:an.x+300,duration:200,ease:"Power2"}};class Xc extends Phaser.Scene{constructor(){super("MainMenu"),this.layerManager=void 0,this.soundManager=void 0,this.roomCode=void 0,this.layerManager=new Fn,this.soundManager=new qn,this.roomCode=tn.nullInteractionId}preload(){this.preloadAssets(),this.layerManager.initialise(this),this.soundManager.initialise(this,td()),this.soundManager.loadSoundAssetMap(pn),On(this)}async create(){const e=td().getAccountInfo();if("staff"===e.role)return void console.log("Staff do not have accounts");this.renderBackground(),this.renderOptionButtons(),this.roomCode=await Vc(e);const t=await ad(e),s=t.userState?t.userState.settings.volume:1;this.soundManager.playBgMusic(pn.galacticHarmony.key,s)}preloadAssets(){Object.values(dn).forEach(e=>this.load.image(e.key,ln(e.path))),Object.values(Ka).forEach(e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))}renderBackground(){const e=new Phaser.GameObjects.Image(this,an.x,an.y,dn.mainMenuBackground.key);e.setDisplaySize(sn.x,sn.y),this.layerManager.addToLayer(wn.Background,e)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),s=Za({numOfItems:t.length,maxYSpace:qc.buttonYSpace,numItemLimit:1});e.add(t.map((e,t)=>this.createOptionButton(e.text,s[t][0]+qc.bannerHide,s[t][1],e.callback))),this.layerManager.addToLayer(wn.UI,e)}createOptionButton(e,t,s,a){const n=e=>{this.tweens.add({targets:e,...qc.onFocusOptTween})},i=e=>{this.tweens.add({targets:e,...qc.outFocusOptTween})},r=gn(this,{assetKey:dn.mainMenuOptBanner.key,message:e,textConfig:{x:qc.textXOffset,y:0,oriX:1,oriY:.1},bitMapTextStyle:Fc,onUp:a,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1},this.soundManager).setPosition(t,s);return r}getOptionButtons(){return[{text:qc.optionsText.chapterSelect,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("ChapterSelect")}},{text:qc.optionsText.collectible,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("MyRoom")}},{text:qc.optionsText.studentRoom,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("RoomPreview",{studentCode:this.roomCode})}},{text:qc.optionsText.settings,callback:()=>{this.layerManager.clearAllLayers(),this.scene.start("Settings")}}]}}var Wc=Xc;class zc extends Phaser.Scene{constructor(){super("MyRoom"),this.layerManager=void 0,this.layerManager=new Fn}preload(){On(this),this.layerManager.initialise(this)}create(){this.renderMyRoom()}renderMyRoom(){const e=new vn(this,()=>{this.layerManager.clearAllLayers(),this.scene.start("MainMenu")},0,0);this.layerManager.addToLayer(wn.UI,e)}}var Yc=zc;class $c extends Phaser.Scene{constructor(){super("RoomPreview"),this.layerManager=void 0,this.soundManager=void 0,this.inputManager=void 0,this.phaseManager=void 0,this.saveManager=void 0,this.escapeManager=void 0,this.collectibleManager=void 0,this.studentCode=void 0,this.preloadImageMap=void 0,this.preloadSoundMap=void 0,this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.layerManager=new Fn,this.phaseManager=new fc,this.saveManager=new Ac,this.soundManager=new qn,this.inputManager=new Ml,this.escapeManager=new Sc,this.collectibleManager=new cc,this.studentCode=Hc}init({studentCode:e}){this.studentCode=e,this.layerManager=new Fn,this.phaseManager=new fc,this.saveManager=new Ac,this.soundManager=new qn,this.inputManager=new Ml,this.escapeManager=new Sc,this.collectibleManager=new cc}preload(){var e,t;On(this),this.soundManager.initialise(this,td()),this.layerManager.initialise(this),this.inputManager.initialise(this),this.collectibleManager.initialise(this,this.phaseManager),this.phaseManager.initialise((e=this.escapeManager,t=this.collectibleManager,new Map([[Un.None,new Dc],[Un.EscapeMenu,e],[Un.CollectibleMenu,t]])),this.inputManager),this.escapeManager.initialise(this,this.phaseManager,this.saveManager,!1),this.bindKeyboardTriggers()}async create(){const e=td().getAccountInfo(),t=await ad(e);this.saveManager.initialiseForSettings(e,t),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map(async([e,t])=>{await Qn(this,e,t)})),await Promise.all(Array.from(this.preloadSoundMap).map(async([e,t])=>{var s,a,n;await(s=this,a=e,n=t,new Promise(e=>{null!==s.sound.get(a)?e(a):(s.load.audio(a,n),s.load.once("filecomplete",e),s.load.start())}))})),await this.eval("create();"),this.soundManager.stopCurrBgMusic()}update(){this.eval("\nupdate();")}async eval(e){const t=ht(4,[],{},"gpu",{scene:this,phaser:Phaser,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,layerManager:this.layerManager,layerTypes:wn,remotePath:tn.assetsFolder,screenSize:sn});t.externalContext="playground",await Object(ms.runInContext)(this.studentCode+e,t)}bindKeyboardTriggers(){this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",async()=>{this.phaseManager.isCurrentPhase(Un.EscapeMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(Un.EscapeMenu)}),this.inputManager.registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.I,"up",async()=>{this.phaseManager.isCurrentPhase(Un.CollectibleMenu)?await this.phaseManager.popPhase():await this.phaseManager.pushPhase(Un.CollectibleMenu)})}cleanUp(){this.soundManager.stopCurrBgMusic(),this.inputManager.clearListeners(),this.layerManager.clearAllLayers()}}class Kc extends Phaser.Scene{constructor(){super("Settings"),this.volumeRadioButtons=void 0,this.layerManager=void 0,this.settingsSaveManager=void 0,this.soundManager=void 0,this.layerManager=new Fn,this.volumeRadioButtons=void 0,this.settingsSaveManager=new Ac,this.soundManager=new qn}preload(){this.layerManager.initialise(this),this.soundManager.initialise(this,td())}async create(){this.renderBackground();const e=td().getAccountInfo(),t=await ad(e);this.settingsSaveManager.initialiseForSettings(e,t),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,an.x,an.y,dn.settingBackground.key),t=new Phaser.GameObjects.Image(this,an.x,an.y,dn.settingBanner.key);this.layerManager.addToLayer(wn.Background,e),this.layerManager.addToLayer(wn.Background,t)}renderOptions(){this.renderVolumeOptions();const e=gn(this,{assetKey:dn.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:mc,onUp:()=>this.applySettings(this.volumeRadioButtons)},this.soundManager).setPosition(an.x,.925*sn.y),t=new vn(this,()=>{this.layerManager.clearAllLayers(),this.scene.start("MainMenu")},0,0,this.soundManager);this.layerManager.addToLayer(wn.UI,e),this.layerManager.addToLayer(wn.UI,t)}renderVolumeOptions(){const e=new Phaser.GameObjects.Image(this,an.x,gc.volUnderlineYPos,dn.settingOption.key),t=mn(this,"Volume",gc.volTextXpos,gc.volTextYPos,pc).setOrigin(.5,.25),s=this.settingsSaveManager.getLoadedUserState().settings.volume,a=gc.volContainerOpts.findIndex(e=>parseFloat(e)===s);this.volumeRadioButtons=new uc(this,{choices:gc.volContainerOpts,defaultChoiceIdx:a,maxXSpace:gc.optXSpace,choiceTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},bitmapTextStyle:hc},gc.optXPos,gc.volOptYPos),this.layerManager.addToLayer(wn.UI,e),this.layerManager.addToLayer(wn.UI,t),this.layerManager.addToLayer(wn.UI,this.volumeRadioButtons)}async applySettings(e){if(e){const t=parseFloat(e.getChosenChoice());await this.settingsSaveManager.saveSettings({volume:t});const s=this.settingsSaveManager.getLoadedUserState();this.soundManager.applyUserSettings(s)}}}var Qc=Kc;class Jc extends Ya.Game{constructor(e){super(e),this.global=void 0,this.global={currBgMusicKey:void 0,soundAssetMap:new Map,accountInfo:void 0}}stopAllSounds(){this.sound.stopAll()}setCurrBgMusicKey(e){this.global.currBgMusicKey=e}getCurrBgMusicKey(){return this.global.currBgMusicKey}addSoundAsset(e){this.global.soundAssetMap.set(e.key,e)}clearSoundAssetMap(){this.global.soundAssetMap.clear()}getSoundAsset(e){return this.global.soundAssetMap.get(e)}setAccountInfo(e){this.global.accountInfo=e}getAccountInfo(){return cn(this.global.accountInfo)}setStorySimProps(e){this.global.storySimulatorProps={...this.global.storySimulatorProps,...e}}setStorySimState(e){this.getStorySimProps().setStorySimState(e)}getStorySimProps(){return cn(this.global.storySimulatorProps)}}const Zc={debug:!0,type:Ya.WEBGL,width:sn.x,height:sn.y,physics:{default:"arcade"},scale:{mode:Ya.Scale.FIT,parent:"game-display"},scene:[Wc,Qc,Ni,Uc,Di,Yc,$c]};let ed;const td=()=>ed;async function sd(e,t){const s={method:"PUT",headers:nd(e.accessToken),body:JSON.stringify({gameStates:{collectibles:t,completed_quests:[]}})},a=await fetch(ze.backendUrl+"/v1/user/game_states/save",s);if(a&&a.ok)return a}async function ad(e){const t={method:"GET",headers:nd(e.accessToken)},s=await fetch(ze.backendUrl+"/v1/user/",t),a=await s.text();return JSON.parse(a).gameStates.collectibles}function nd(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization","Bearer "+e),t.append("Content-Type","application/json"),t}var id=function(){const e=Object(C.e)(e=>e.session),[t,s]=v.useState(!1),[a,n]=v.useState(!1);return v.useEffect(()=>(ed=new Jc(Zc),()=>{td().stopAllSounds()}),[]),v.useEffect(()=>{!a&&e&&(td().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,name:e.name,role:e.role}),"Test Student"===e.name&&s(!0),n(!0))},[a,e]),v.createElement(v.Fragment,null,v.createElement("div",{id:"game-display"}),t&&v.createElement("button",{onClick:async()=>{await async function(){const e=await sd(td().getAccountInfo(),{gameSaveStates:{},userState:{collectibles:[],achievements:[],settings:{volume:1},lastPlayedCheckpoint:[-1,-1],lastCompletedChapter:-1}});e&&e.ok&&alert("Game data reset!")}()}},"Reset"))};class rd extends v.Component{render(){return v.createElement(Ut.a,{to:"/academy/grading/"+this.props.data.submissionId,activeClassName:Bt.Classes.ACTIVE},ss("",Gt.a.ANNOTATION,()=>this.props.handleAcknowledgeNotifications(xa(this.props.data.submissionId)),{fullWidth:!0}))}}var od=rd;class ld extends v.Component{render(){if(this.props.data.maxGrade){const e=`Initial Grade: ${this.props.data.initialGrade}\n        (${this.props.data.gradeAdjustment>=0?"+":""}${this.props.data.gradeAdjustment} adj.)`;return v.createElement("div",null,v.createElement(Bt.Tooltip,{content:e,position:Bt.Position.LEFT,hoverOpenDelay:10,lazy:!0},`${this.props.data.currentGrade} / ${this.props.data.maxGrade}`))}return v.createElement("div",null,"N/A")}}var cd=ld;class dd extends v.Component{render(){let e,t,s;switch(this.props.data.gradingStatus){case Wt.graded:e=Gt.a.TICK,t=`Fully graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,s=Bt.Intent.SUCCESS;break;case Wt.grading:e=Gt.a.TIME,t=`Partially graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,s=Bt.Intent.WARNING;break;case Wt.none:e=Gt.a.CROSS,t=`Not graded: ${this.props.data.gradedCount} of\n          ${this.props.data.questionCount}`,s=Bt.Intent.DANGER;break;default:e=Gt.a.DISABLE,t="Not applicable",s=Bt.Intent.PRIMARY}return v.createElement("div",null,v.createElement(Bt.Tooltip,{content:t,position:Bt.Position.LEFT,hoverOpenDelay:10,lazy:!0},v.createElement(Bt.Icon,{icon:e,intent:s})))}}var ud=dd;class hd extends v.Component{constructor(e){super(e),this.handleConfirmUnsubmit=()=>{this.props.handleUnsubmitSubmission(this.props.data.submissionId),this.setState({isAlertOpen:!1})},this.handleUnsubmitAlertClose=()=>this.setState({isAlertOpen:!1}),this.state={isAlertOpen:!1}}render(){return"submitted"!==this.props.data.submissionStatus||this.props.group!==this.props.data.groupName&&this.props.role!==Ot.Admin?null:v.createElement("div",null,v.createElement(Bt.Alert,{canEscapeKeyCancel:!0,canOutsideClickCancel:!0,cancelButtonText:"Cancel",className:"unsubmit-alert alert",intent:Bt.Intent.DANGER,onConfirm:this.handleConfirmUnsubmit,isOpen:this.state.isAlertOpen,onCancel:this.handleUnsubmitAlertClose},"Are you sure you want to unsubmit?"),ss("",Gt.a.ARROW_LEFT,()=>this.setState({isAlertOpen:!0}),{fullWidth:!0}))}}var pd=hd,md=s(459),gd=s.n(md);class yd extends v.Component{constructor(e){super(e),this.validateGradesBeforeSave=e=>()=>{const t=js(this.state.gradeAdjustmentInput||void 0)||void 0,s=this.props.initialGrade+(t||0),a=js(this.state.xpAdjustmentInput||void 0)||void 0,n=this.props.initialXp+(a||0);s<0||s>this.props.maxGrade?Ms(`Grade ${s.toString()} is out of bounds. Maximum grade is ${this.props.maxGrade.toString()}.`):n<0||n>this.props.maxXp?Ms(`XP ${n.toString()} is out of bounds. Maximum xp is ${this.props.maxXp.toString()}.`):e(this.props.submissionId,this.props.questionId,t,a,this.state.editorValue)},this.onClickSaveAndContinue=(e,t,s,a,n)=>{this.setState({...this.state,currentlySaving:!0},()=>{this.props.handleGradingSaveAndContinue(e,t,s,a,n)})},this.discardChanges=()=>{this.hasUnsavedChanges()&&!window.confirm("This will reset the editor. Are you sure?")||this.setState({...this.state,gradeAdjustmentInput:this.props.gradeAdjustment.toString(),xpAdjustmentInput:this.props.xpAdjustment.toString(),editorValue:this.props.comments||""},()=>{Rs("Discarded!",1e3)})},this.onGradeAdjustmentInputChange=(e,t)=>{this.setState({...this.state,gradeAdjustmentInput:t,xpAdjustmentInput:String(Math.round(e/this.props.maxGrade*this.props.maxXp)||0)})},this.onXpAdjustmentInputChange=(e,t)=>{this.setState({...this.state,xpAdjustmentInput:t})},this.handleEditorValueChange=e=>{this.setState({...this.state,editorValue:e})},this.hasUnsavedChanges=()=>{const e=js(this.state.gradeAdjustmentInput||void 0),t=js(this.state.xpAdjustmentInput||void 0);return this.props.gradeAdjustment!==e||this.props.xpAdjustment!==t||this.props.comments!==this.state.editorValue},this.generateMarkdownPreview=e=>Promise.resolve(v.createElement(ps,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),this.state={gradeAdjustmentInput:e.gradeAdjustment.toString(),xpAdjustmentInput:e.xpAdjustment.toString(),editorValue:e.comments,selectedTab:"write",currentlySaving:!1}}render(){const e=this.hasUnsavedChanges(),t={intent:e?Bt.Intent.WARNING:Bt.Intent.NONE,minimal:!e,className:"grading-editor-button"},s={intent:e?Bt.Intent.DANGER:Bt.Intent.NONE,minimal:!e,className:"grading-editor-button"},a={intent:e?Bt.Intent.SUCCESS:Bt.Intent.NONE,minimal:!e,className:"grading-editor-button"},n=this.props.initialGrade+(js(this.state.gradeAdjustmentInput||void 0)||0),i=this.props.initialXp+(js(this.state.xpAdjustmentInput||void 0)||0),r=`${this.props.initialGrade>0?"-":""}${this.props.initialGrade} to ${this.props.maxGrade-this.props.initialGrade}`,o=`${this.props.initialXp>0?"-":""}${this.props.initialXp} to ${this.props.maxXp-this.props.initialXp}`;return v.createElement("div",{className:"GradingEditor"},!this.state.currentlySaving&&e?v.createElement(A.a,{message:"You have unsaved changes. Are you sure you want to leave?"}):null,v.createElement("div",{className:"grading-editor-header"},v.createElement(Bt.H3,null,"Currently Grading: ",this.props.studentName)),null!==this.props.solution?v.createElement("div",{className:"grading-editor-marking-scheme"},v.createElement(Bt.Pre,null,this.props.solution.toString()," ")):null,v.createElement("div",{className:"grading-editor-container"},v.createElement("div",{className:"grading-editor-grades"},v.createElement("div",{className:"autograder-grade"},v.createElement("div",null,"Autograder grade:"),v.createElement("div",null,`${this.props.initialGrade} / ${this.props.maxGrade}`)),v.createElement("div",{className:"grade-adjustment"},v.createElement("div",null,"Grade adjustment:"),v.createElement("div",null,v.createElement(Bt.NumericInput,{className:"adjustment-input",onValueChange:this.onGradeAdjustmentInputChange,value:this.state.gradeAdjustmentInput||"",buttonPosition:Bt.Position.RIGHT,fill:!0,placeholder:r,intent:n<0||n>this.props.maxGrade?Bt.Intent.DANGER:Bt.Intent.NONE,min:0-this.props.initialGrade,max:this.props.maxGrade>this.props.initialGrade?this.props.maxGrade-this.props.initialGrade:void 0}))),v.createElement("div",{className:"final-grade"},v.createElement("div",null,"Final grade:"),v.createElement("div",null,`${n} / ${this.props.maxGrade}`))),v.createElement("div",{className:"grading-editor-xp"},v.createElement("div",{className:"autograder-grade"},v.createElement("div",null,"Autograder XP:"),v.createElement("div",null,`${this.props.initialXp} / ${this.props.maxXp}`)),v.createElement("div",{className:"grade-adjustment"},v.createElement("div",null,"XP adjustment:"),v.createElement("div",null,v.createElement(Bt.NumericInput,{className:"adjustment-input",onValueChange:this.onXpAdjustmentInputChange,value:this.state.xpAdjustmentInput||"",buttonPosition:Bt.Position.RIGHT,fill:!0,placeholder:o,intent:i<0||i>this.props.maxXp?Bt.Intent.DANGER:Bt.Intent.NONE,min:0-this.props.initialXp,max:this.props.maxXp>this.props.initialXp?this.props.maxXp-this.props.initialXp:void 0}))),v.createElement("div",{className:"final-grade"},v.createElement("div",null,"Final XP:"),v.createElement("div",null,`${i} / ${this.props.maxXp}`)))),v.createElement("div",{className:"react-mde-parent"},v.createElement(gd.a,{value:this.state.editorValue||"",onChange:this.handleEditorValueChange,selectedTab:this.state.selectedTab,onTabChange:e=>this.setState({...this.state,selectedTab:e}),generateMarkdownPreview:this.generateMarkdownPreview,minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:this.blueprintIconProvider})),"write"===this.state.selectedTab&&v.createElement("div",{className:"grading-editor-draft-buttons"},v.createElement("div",{className:"grading-editor-save-button"},ss("Save Changes",Gt.a.FLOPPY_DISK,this.validateGradesBeforeSave(this.props.handleGradingSave),t)),v.createElement("div",{className:"grading-editor-discard-button"},ss("Discard Changes",Gt.a.TRASH,this.discardChanges,s))),v.createElement("div",{className:"grading-editor-save-continue-button"},ss("Save and Continue",Gt.a.UPDATED,this.validateGradesBeforeSave(this.onClickSaveAndContinue),a)),this.props.graderName&&this.props.gradedAt&&v.createElement(v.Fragment,null,v.createElement(Bt.Divider,null),v.createElement("div",{className:"grading-editor-last-graded-details"},"Last edited by ",v.createElement("b",null,this.props.graderName)," on ",ks(this.props.gradedAt))))}blueprintIconProvider(e){const t=Ed(e);return v.createElement(Bt.Icon,{icon:t.iconName,htmlTitle:t.title})}}const Ed=e=>{switch(e){case"header":return{iconName:Gt.a.HEADER,title:"Header Styles"};case"bold":return{iconName:Gt.a.BOLD,title:"Bold"};case"italic":return{iconName:Gt.a.ITALIC,title:"Italic"};case"strikethrough":return{iconName:Gt.a.STRIKETHROUGH,title:"Strikethrough"};case"link":return{iconName:Gt.a.LINK,title:"Link"};case"quote":return{iconName:Gt.a.CITATION,title:"Quote"};case"code":return{iconName:Gt.a.CODE,title:"Monospaced"};case"image":return{iconName:Gt.a.MEDIA,title:"Image"};case"unordered-list":return{iconName:Gt.a.UNGROUP_OBJECTS,title:"Bullets"};case"ordered-list":return{iconName:Gt.a.NUMBERED_LIST,title:"Numbering"};case"checked-list":return{iconName:Gt.a.SQUARE,title:"Checkboxes"};default:return{iconName:Gt.a.HELP}}};var bd=yd;var vd=Object(C.c)(null,e=>Object(O.b)({handleGradingSave:Ie,handleGradingSaveAndContinue:ke},e))(bd);class Sd extends v.Component{constructor(...e){super(...e),this.sideContentProps=(e,t)=>{const s=[{label:"Grading: Question "+(t+1),iconName:Gt.a.TICK,body:v.createElement(vd,{solution:e.grading[t].question.solution,questionId:e.grading[t].question.id,submissionId:e.submissionId,initialGrade:e.grading[t].grade.grade,gradeAdjustment:e.grading[t].grade.gradeAdjustment,maxGrade:e.grading[t].question.maxGrade,initialXp:e.grading[t].grade.xp,xpAdjustment:e.grading[t].grade.xpAdjustment,maxXp:e.grading[t].question.maxXp,studentName:e.grading[t].student.name,comments:e.grading[t].grade.comments,graderName:e.grading[t].grade.grader?e.grading[t].grade.grader.name:void 0,gradedAt:e.grading[t].grade.grader?e.grading[t].grade.gradedAt:void 0}),id:T.grading,toSpawn:()=>!0},{label:"Task "+(t+1),iconName:Gt.a.NINJA,body:v.createElement(ps,{content:e.grading[t].question.content}),id:T.questionOverview,toSpawn:()=>!0},{label:"Autograder",iconName:Gt.a.AIRPLANE,body:v.createElement(Cs,{testcases:e.editorTestcases,autogradingResults:e.autogradingResults,handleTestcaseEval:this.props.handleTestcaseEval}),id:T.autograder,toSpawn:()=>!0}];e.grading[t].question.library.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:Gt.a.GRID_VIEW,body:v.createElement(Os,null),id:T.toneMatrix,toSpawn:()=>!0});return{handleActiveTabChange:e.handleActiveTabChange,tabs:s,workspaceLocation:"grading"}},this.controlBarProps=e=>{const t="/academy/grading/"+this.props.submissionId,s=[e+1,this.props.grading.length],a=v.createElement(as,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),n=v.createElement(ns,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),i=v.createElement(rs,{onClickNext:()=>xs.push(t+"/"+(e+1).toString()),onClickReturn:()=>xs.push("/academy/grading"),questionProgress:s,key:"next_question"}),r=v.createElement(os,{onClick:()=>xs.push(t+"/"+(e-1).toString()),questionProgress:s,key:"previous_question"}),o=v.createElement(ls,{questionProgress:s,key:"question_view"});return{editorButtons:[v.createElement(ds,{handleEditorEval:this.props.handleEditorEval,key:"run"})],flowButtons:[r,o,i],replButtons:[n,a]}}}componentDidMount(){if(this.props.handleGradingFetch(this.props.submissionId),!this.props.grading)return;let e=this.props.questionId;this.props.questionId>=this.props.grading.length&&(e=this.props.grading.length-1);const t=this.props.grading[e].question;let s="";t.type===$t.programming&&(s=t.answer?t.answer:t.solutionTemplate||""),this.props.handleEditorValueChange(s)}componentDidUpdate(){if(void 0===this.props.grading)return;const e=this.props.questionId;void 0===this.props.grading[e]?xs.push("/academy/grading"):this.checkWorkspaceReset(this.props)}render(){if(void 0===this.props.grading)return v.createElement(Bt.NonIdealState,{className:qt()("WorkspaceParent",Bt.Classes.DARK),description:"Getting assessment ready...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})});const e=this.props.questionId>=this.props.grading.length?this.props.grading.length-1:this.props.questionId,t=this.props.grading[e].question,s={controlBarProps:this.controlBarProps(e),editorProps:t.type===$t.programming?{editorSessionId:"",editorValue:this.props.editorValue,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,mcqProps:{mcq:t,handleMCQSubmit:e=>{}},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,e),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:qt()("WorkspaceParent",Bt.Classes.DARK)},v.createElement(fa,s))}checkWorkspaceReset(e){const t=e.submissionId,s=e.questionId;if(e.storedSubmissionId===t&&e.storedQuestionId===s)return;const a=e.grading[s].question;let n=[],i="",r="",o="",l=[];if(a.type===$t.programming){const e=a;n=e.autogradingResults,r=e.prepend,o=e.postpend,l=e.testcases,i=e.answer,i||(i=e.solutionTemplate)}e.handleEditorUpdateBreakpoints([]),e.handleUpdateCurrentSubmissionId(t,s),e.handleResetWorkspace({autogradingResults:n,editorPrepend:r,editorValue:i,editorPostpend:o,editorTestcases:l}),e.handleClearContext(a.library),e.handleUpdateHasUnsavedChanges(!1),i&&e.handleEditorValueChange(i)}}var fd=Sd;var Cd=Object(C.c)((e,t)=>({autogradingResults:e.workspaces.grading.autogradingResults,editorPrepend:e.workspaces.grading.editorPrepend,editorValue:e.workspaces.grading.editorValue,editorPostpend:e.workspaces.grading.editorPostpend,editorTestcases:e.workspaces.grading.editorTestcases,editorHeight:e.workspaces.grading.editorHeight,editorWidth:e.workspaces.grading.editorWidth,breakpoints:e.workspaces.grading.breakpoints,highlightedLines:e.workspaces.grading.highlightedLines,grading:e.session.gradings.get(t.submissionId),hasUnsavedChanges:e.workspaces.grading.hasUnsavedChanges,isRunning:e.workspaces.grading.isRunning,isDebugging:e.workspaces.grading.isDebugging,enableDebugging:e.workspaces.grading.enableDebugging,newCursorPosition:e.workspaces.grading.newCursorPosition,output:e.workspaces.grading.output,replValue:e.workspaces.grading.replValue,sideContentHeight:e.workspaces.grading.sideContentHeight,storedSubmissionId:e.workspaces.grading.currentSubmission,storedQuestionId:e.workspaces.grading.currentQuestion}),e=>Object(O.b)({handleActiveTabChange:e=>j(e,"grading"),handleBrowseHistoryDown:()=>I("grading"),handleBrowseHistoryUp:()=>k("grading"),handleChapterSelect:(e,t)=>_(e,"default","grading"),handleClearContext:e=>B(e,"grading"),handleDeclarationNavigate:e=>Z("grading",e),handleEditorEval:()=>q("grading"),handleEditorValueChange:e=>z(e,"grading"),handleEditorHeightChange:e=>x(e,"grading"),handleEditorWidthChange:e=>N(e.toString(),"grading"),handleEditorUpdateBreakpoints:e=>Y(e,"grading"),handleGradingFetch:Ee,handleInterruptEval:()=>at("grading"),handleReplEval:()=>X("grading"),handleReplOutputClear:()=>U("grading"),handleReplValueChange:e=>K(e,"grading"),handleResetWorkspace:e=>te("grading",e),handleSideContentHeightChange:e=>M(e,"grading"),handleTestcaseEval:e=>W("grading",e),handleUpdateCurrentSubmissionId:ie,handleUpdateHasUnsavedChanges:e=>re("grading",e),handleDebuggerPause:()=>it("grading"),handleDebuggerResume:()=>ot("grading"),handleDebuggerReset:()=>lt("grading"),handlePromptAutocomplete:(e,t,s)=>de("grading",e,t,s)},e))(fd);class Ad extends v.Component{render(){if(this.props.data.maxXp||this.props.data.xpBonus){const e=`Initial XP: ${this.props.data.initialXp}\n        (${this.props.data.xpBonus>0?`+${this.props.data.xpBonus} bonus `:""}\n        ${this.props.data.xpAdjustment>=0?"+":""}${this.props.data.xpAdjustment} adj.)`;return v.createElement("div",null,v.createElement(Bt.Tooltip,{content:e,position:Bt.Position.LEFT,hoverOpenDelay:10,lazy:!0},`${this.props.data.currentXp+this.props.data.xpBonus} / ${this.props.data.maxXp}`))}return v.createElement("div",null,"No Exp")}}var Od=Ad;class wd extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.GradingStatus=e=>v.createElement(ud,{data:e.data}),this.GradingMarks=e=>v.createElement(cd,{data:e.data}),this.NotificationBadgeCell=e=>v.createElement(Da,{notificationFilter:xa(e.data.submissionId)}),this.GradingExp=e=>v.createElement(Od,{data:e.data}),this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.updatePaginationState=()=>{if(this.gridApi){const e=this.gridApi.paginationGetTotalPages(),t=0===e?0:this.gridApi.paginationGetCurrentPage()+1;this.setState({currPage:t,maxPages:e,rowCountString:this.formatRowCountString(25,t,e,this.gridApi.paginationGetRowCount()),isBackDisabled:0===e||1===t,isForwardDisabled:0===e||t===e})}},this.formatRowCountString=(e,t,s,a)=>0===s?"(none)":t!==s?`(#${e*t-24} - #${e*t})`:`(#${e*t-24} - #${a})`,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t})},this.handleFilterKeypress=e=>{"Enter"===e.key&&this.handleApplyFilter()},this.handleApplyFilter=()=>{this.gridApi&&this.gridApi.setQuickFilter(this.state.filterValue)},this.handleGroupsFilter=()=>{this.gridApi&&(this.setState({groupFilterEnabled:!this.state.groupFilterEnabled}),this.props.handleFetchGradingOverviews(this.state.groupFilterEnabled))},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),this.updatePaginationState()},this.exportCSV=()=>{this.gridApi&&this.gridApi.exportDataAsCsv({fileName:`SA submissions (${(new Date).toISOString()}).csv`,columnKeys:["assessmentName","assessmentCategory","studentName","groupName","submissionStatus","gradingStatus","questionCount","gradedCount","initialGrade","gradeAdjustment","currentGrade","maxGrade","initialXp","xpAdjustment","currentXp","maxXp","xpBonus"]})},this.changePaginationView=e=>()=>{if(this.gridApi)switch(e){case"first":return this.gridApi.paginationGoToFirstPage();case"prev":return this.gridApi.paginationGoToPreviousPage();case"next":return this.gridApi.paginationGoToNextPage();case"last":return this.gridApi.paginationGoToLastPage()}},this.sortSubmissionsByNotifications=()=>this.props.gradingOverviews?this.props.gradingOverviews.map(e=>({...e,notifications:xa(e.submissionId)(this.props.notifications)})).sort((e,t)=>t.notifications.length-e.notifications.length):[],this.columnDefs=[{headerName:"",field:"notifications",cellRendererFramework:this.NotificationBadgeCell,width:30,suppressMovable:!0,suppressMenu:!0,suppressSizeToFit:!0,resizable:!1},{headerName:"Assessment Name",field:"assessmentName"},{headerName:"Category",field:"assessmentCategory",maxWidth:100},{headerName:"Student Name",field:"studentName"},{headerName:"Group",field:"groupName",maxWidth:100},{headerName:"Status",field:"submissionStatus",maxWidth:100,valueFormatter:e=>{const t=e.value;return t.charAt(0).toUpperCase()+t.slice(1)},cellStyle:e=>"submitted"===e.data.submissionStatus?{backgroundColor:Bt.Colors.GREEN5}:{backgroundColor:Bt.Colors.RED5}},{headerName:"Grading",field:"gradingStatus",cellRendererFramework:this.GradingStatus,maxWidth:110},{headerName:"Grade",field:"",cellRendererFramework:this.GradingMarks,maxWidth:100,cellStyle:e=>e.data.currentGrade<e.data.maxGrade?{backgroundColor:Bt.Colors.RED5}:{},comparator:(e,t,s,a,n)=>s&&a?s.data.currentGrade-a.data.currentGrade:e-t},{headerName:"XP",field:"",cellRendererFramework:this.GradingExp,maxWidth:100,comparator:(e,t,s,a,n)=>s&&a?s.data.currentXp-a.data.currentXp:e-t},{headerName:"Edit",cellRendererFramework:od,cellRendererParams:{handleAcknowledgeNotifications:this.props.handleAcknowledgeNotifications},width:65,filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0,cellStyle:{padding:0}},{headerName:"Unsubmit",colId:"Unsubmit",width:100,field:"",cellRendererFramework:pd,cellRendererParams:{group:this.props.group,handleUnsubmitSubmission:this.props.handleUnsubmitSubmission,role:this.props.role},filter:!1,resizable:!1,sortable:!1,suppressSizeToFit:!0,cellStyle:{padding:0}},{headerName:"Question Count",field:"questionCount",hide:!0},{headerName:"Questions Graded",field:"gradedCount",hide:!0},{headerName:"Initial Grade",field:"initialGrade",hide:!0},{headerName:"Grade Adjustment",field:"gradeAdjustment",hide:!0},{headerName:"Initial XP",field:"initialXp",hide:!0},{headerName:"XP Adjustment",field:"xpAdjustment",hide:!0},{headerName:"Current Grade",field:"currentGrade",hide:!0},{headerName:"Max Grade",field:"maxGrade",hide:!0},{headerName:"Current XP (excl. bonus)",field:"currentXp",hide:!0},{headerName:"Max XP",field:"maxXp",hide:!0},{headerName:"Bonus XP",field:"xpBonus",hide:!0}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0},this.state={filterValue:"",groupFilterEnabled:!1,currPage:1,maxPages:1,rowCountString:"(none)",isBackDisabled:!0,isForwardDisabled:!0}}render(){const e=js(this.props.match.params.submissionId),t=js(this.props.match.params.questionId)||0;if(null!==e){const s={submissionId:e,questionId:t};return v.createElement(Cd,s)}const s=v.createElement(Bt.NonIdealState,{className:"Grading",description:"Fetching submissions...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})}),a=this.sortSubmissionsByNotifications(),n=v.createElement("div",{className:"GradingContainer"},v.createElement("div",null,v.createElement(Bt.FormGroup,{label:"Filter:",labelFor:"text-input",inline:!0},v.createElement(Bt.InputGroup,{id:"filterBar",large:!1,leftIcon:"filter",placeholder:"Enter any text (e.g. mission)",value:this.state.filterValue,onChange:this.handleFilterChange,onKeyPress:this.handleFilterKeypress,onBlur:this.handleApplyFilter})),v.createElement("div",{className:"ag-grid-controls"},v.createElement("div",{className:"left-controls"},v.createElement(Bt.Button,{active:this.state.groupFilterEnabled,icon:Gt.a.GIT_REPO,intent:this.state.groupFilterEnabled?Bt.Intent.PRIMARY:Bt.Intent.NONE,onClick:this.handleGroupsFilter},v.createElement("div",{className:"ag-grid-button-text hidden-xs"},"Show all groups"))),v.createElement("div",{className:"centre-controls"},v.createElement(Bt.Button,{icon:Gt.a.CHEVRON_BACKWARD,onClick:this.changePaginationView("first"),minimal:!0,disabled:this.state.isBackDisabled}),v.createElement(Bt.Button,{icon:Gt.a.CHEVRON_LEFT,onClick:this.changePaginationView("prev"),minimal:!0,disabled:this.state.isBackDisabled}),v.createElement(Bt.Button,{className:"pagination-details hidden-xs",disabled:!0,minimal:!0},v.createElement("div",null,`Page ${this.state.currPage} of ${this.state.maxPages}`),v.createElement("div",null,this.state.rowCountString)),v.createElement(Bt.Button,{icon:Gt.a.CHEVRON_RIGHT,onClick:this.changePaginationView("next"),minimal:!0,disabled:this.state.isForwardDisabled}),v.createElement(Bt.Button,{icon:Gt.a.CHEVRON_FORWARD,onClick:this.changePaginationView("last"),minimal:!0,disabled:this.state.isForwardDisabled})),v.createElement("div",{className:"right-controls"},v.createElement(Bt.Button,{icon:Gt.a.EXPORT,onClick:this.exportCSV},v.createElement("div",{className:"ag-grid-button-text hidden-xs"},"Export to CSV"))))),v.createElement(Bt.Divider,null),v.createElement("div",{className:"Grading"},v.createElement("div",{className:"ag-grid-parent ag-theme-balham"},v.createElement(qa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,onPaginationChanged:this.updatePaginationState,rowData:a,rowHeight:30,pagination:!0,paginationPageSize:25,suppressMovableColumns:!0,suppressPaginationPanel:!0}))));return v.createElement("div",null,v.createElement(ka,{loadContentDispatch:this.props.handleFetchGradingOverviews,display:void 0===this.props.gradingOverviews?s:n,fullWidth:!1}))}componentDidUpdate(e,t){this.gridApi&&this.props.notifications.length!==e.notifications.length&&this.gridApi.setRowData(this.sortSubmissionsByNotifications())}}var Td=wd;var Id=Object(C.c)(e=>({gradingOverviews:e.session.gradingOverviews,group:e.session.group,notifications:e.session.notifications,role:e.session.role}),e=>Object(O.b)({handleAcknowledgeNotifications:Le,handleFetchGradingOverviews:be,handleUnsubmitSubmission:_e},e))(Td);class kd extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handleDeleteAssessment(e.id),this.handleCloseDialog()},this.state={dialogOpen:!1}}render(){return v.createElement("div",null,ss("",Gt.a.TRASH,this.handleOpenDialog),v.createElement(Bt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Delete Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure that you want to delete this Assessment?"),v.createElement("p",null,"Students' answers and submissions will be deleted as well.")),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER_ACTIONS},ss("Confirm Delete",Gt.a.TRASH,this.handleDelete),ss("Cancel",Gt.a.CROSS,this.handleCloseDialog)))))}}var Pd=kd,xd=s(858);const Nd={flex:1,display:"flex",height:"30vh",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",borderWidth:2,borderRadius:2,borderColor:"#eeeeee",borderStyle:"dashed",backgroundColor:"#fafafa",color:"#bdbdbd",outline:"none",transition:"border .24s ease-in-out"},Rd={borderColor:"#2196f3"},Md={borderColor:"#00e676"},_d={borderColor:"#ff1744"};var Dd=e=>{const[t,s]=v.useState(),[a,n]=v.useState(),{getRootProps:i,getInputProps:r,isDragActive:o,isDragAccept:l,isDragReject:c,isFocused:d}=Object(xd.a)({onDrop:e=>{s(e[0]),n(e[0].name)}}),u=v.useMemo(()=>({...Nd,...o?Rd:{},...l?Md:{},...c?_d:{},...d?Rd:{}}),[o,l,c,d]),h=()=>{e.forceUpdate||e.toggleDisplayConfirmation(),e.toggleForceUpdate()},p=()=>{e.toggleDisplayConfirmation()},m=()=>{e.toggleDisplayConfirmation(),e.toggleForceUpdate()};return v.createElement(v.Fragment,null,v.createElement(Bt.Card,{className:"contentdisplay-content",elevation:Bt.Elevation.THREE},v.createElement("div",i({style:u}),v.createElement("input",r()),v.createElement("p",null,"Drag 'n' drop some files here, or click to select files"))),t&&v.createElement(Bt.Card,null,v.createElement("div",null,a),v.createElement("br",null),!e.displayConfirmation&&ss("Confirm Upload",Gt.a.UPLOAD,()=>{e.handleUploadAssessment(t),s(void 0)}),!e.displayConfirmation&&ss("Cancel Upload",Gt.a.DELETE,()=>s(void 0)),v.createElement("br",null),v.createElement("br",null),!e.displayConfirmation&&v.createElement("p",null,"Force update opened assessment"),e.displayConfirmation&&v.createElement("div",null,v.createElement("p",null,"Are you sure that you want to force update the assessment?"),ss("Yes",Gt.a.CONFIRM,p),ss("No",Gt.a.CROSS,m)),!e.displayConfirmation&&v.createElement("div",{className:"toggle-button-wrapper"},v.createElement(Bt.Switch,{checked:e.forceUpdate,onChange:h}))))},Ld=s(2431);class jd extends v.Component{constructor(e){super(e),this.maxDate=new Date(new Date(Date.now()).setFullYear(2100)),this.dateInput=()=>v.createElement(Ld.a,{formatDate:this.formatDate,onChange:this.handleDateChange,parseDate:this.parseDate,value:this.props.forOpenDate?this.state.openAt:this.state.closeAt,timePrecision:"minute",fill:!0,maxDate:this.maxDate,closeOnSelection:!1}),this.parseDate=e=>new Date(e),this.formatDate=e=>e.toLocaleString(),this.handleDateChange=e=>{this.props.forOpenDate?this.setState({openAt:e}):this.setState({closeAt:e})},this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleUpdate=()=>{const{data:e}=this.props;this.props.handleAssessmentChangeDate(e.id,this.state.openAt.toISOString(),this.state.closeAt.toISOString()),this.handleCloseDialog()},this.state={dialogOpen:!1,openAt:new Date(Date.parse(this.props.data.openAt)),closeAt:new Date(Date.parse(this.props.data.closeAt))}}render(){const e=this.props.forOpenDate?"Opening":"Closing";return v.createElement("div",null,this.props.forOpenDate?this.props.data.prettyOpenAt:this.props.data.prettyCloseAt,ss("",Gt.a.EDIT,this.handleOpenDialog),v.createElement(Bt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Update Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},e," Date: ",this.dateInput()),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER_ACTIONS},ss("Confirm Update",Gt.a.TICK,this.handleUpdate),ss("Cancel",Gt.a.CROSS,this.handleCloseDialog)))))}}var Bd=jd;class Gd extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handlePublishAssessment(!e.isPublished,e.id),this.handleCloseDialog()},this.state={dialogOpen:!1,isPublished:void 0!==this.props.data.isPublished&&this.props.data.isPublished}}render(){const e=this.props.data.isPublished?"Unpublish":"Publish",t=e.toLowerCase();return v.createElement("div",null,(()=>v.createElement("div",{className:"toggle-button-wrapper"},v.createElement(Bt.Switch,{checked:this.state.isPublished,onChange:this.handleOpenDialog})))(),v.createElement(Bt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:e+" Assessment",canOutsideClickClose:!0},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure that you want to ",t," this Assessment?")),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER_ACTIONS},ss("Confirm "+e,Gt.a.CONFIRM,this.handleDelete),ss("Cancel",Gt.a.CROSS,this.handleCloseDialog)))))}}var Ud=Gd;class Hd extends v.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.sortByCategoryAndDate=()=>{if(!this.props.assessmentOverviews)return[];const e=this.props.assessmentOverviews.slice().map(e=>{const t=JSON.parse(JSON.stringify(e));return t.prettyCloseAt=ks(t.closeAt),t.prettyOpenAt=ks(t.openAt),t.formattedOpenAt=new Date(Date.parse(t.openAt)),t.formattedCloseAt=new Date(Date.parse(t.closeAt)),t});return Object(Qe.sortBy)(e,["category","formattedOpenAt","formattedCloseAt"])},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit()},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.handleUploadAssessment=e=>{this.props.handleUploadAssessment(e,this.state.forceUpdate),this.setState({forceUpdate:!1})},this.toggleForceUpdate=()=>{this.setState({forceUpdate:!this.state.forceUpdate})},this.toggleDisplayConfirmation=()=>{this.setState({displayConfirmation:!this.state.displayConfirmation})},this.state={forceUpdate:!1,displayConfirmation:!1},this.columnDefs=[{headerName:"Title",field:"title"},{headerName:"Category",field:"category",width:100},{headerName:"Open Date",field:"",cellRendererFramework:Bd,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!0},width:150,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0}},{headerName:"Close Date",field:"",cellRendererFramework:Bd,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!1},width:150,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0}},{headerName:"Publish",field:"",cellRendererFramework:Ud,cellRendererParams:{handlePublishAssessment:this.props.handlePublishAssessment},width:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0},hide:!this.props.handlePublishAssessment},{headerName:"Delete",field:"",cellRendererFramework:Pd,cellRendererParams:{handleDeleteAssessment:this.props.handleDeleteAssessment},width:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{padding:0},hide:!this.props.handleDeleteAssessment}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidUpdate(e){this.gridApi&&this.props.assessmentOverviews.length!==e.assessmentOverviews.length&&this.gridApi.setRowData(this.sortByCategoryAndDate())}render(){const e=this.sortByCategoryAndDate(),t=()=>v.createElement("div",{className:"GradingContainer"},v.createElement("div",{className:"Grading ag-grid-parent ag-theme-balham"},v.createElement(qa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,rowData:e,rowHeight:30,pagination:!0,paginationPageSize:25,suppressMovableColumns:!0,suppressPaginationPanel:!0}))),s=v.createElement("div",{className:"GroundControl"},v.createElement(Dd,{handleUploadAssessment:this.handleUploadAssessment,toggleForceUpdate:this.toggleForceUpdate,toggleDisplayConfirmation:this.toggleDisplayConfirmation,forceUpdate:this.state.forceUpdate,displayConfirmation:this.state.displayConfirmation}),v.createElement(t,null));return v.createElement("div",null,v.createElement(ka,{display:s,loadContentDispatch:this.props.handleAssessmentOverviewFetch}))}}var Vd=Hd;var Fd=Object(C.c)(e=>({assessmentOverviews:e.session.assessmentOverviews?e.session.assessmentOverviews:[]}),e=>Object(O.b)({handleAssessmentChangeDate:yr,handleAssessmentOverviewFetch:ye,handleDeleteAssessment:Er,handleUploadAssessment:vr,handlePublishAssessment:br},e))(Vd);function qd(e){const t=v.createElement("div",{className:"Switch"},v.createElement(Bt.Switch,{label:"",checked:e.isEditorAutorun,onChange:e.handleToggleEditorAutorun})),s=ss("Auto",Gt.a.AUTOMATIC_UPDATES),a=ss("Stop",Gt.a.STOP,e.handleInterruptEval),n=ss("Stop Debugger",Gt.a.STOP,e.handleDebuggerReset),i=ss("Pause",Gt.a.STOP,e.handleDebuggerPause),r=ss("Resume",Gt.a.CHEVRON_RIGHT,e.handleDebuggerResume);return v.createElement(v.Fragment,null,t,e.isEditorAutorun?s:e.isRunning?a:e.isDebugging?null:v.createElement(ds,{handleEditorEval:e.handleEditorEval,key:"run"}),e.isRunning&&!e.isDebugging?i:!e.isRunning&&e.isDebugging?r:null,e.isDebugging?n:null)}function Xd(e){const t=Array.from(Ct.entries()).map((e,t)=>({name:e[0],key:t,symbols:e[1]})),s=Zt.a.ofType(),a=(e,{handleClick:t,modifiers:s,query:a})=>v.createElement(Bt.MenuItem,{active:!1,key:e.key,onClick:t,text:e.name});return n=e.externalLibraryName,i=e.handleExternalSelect,v.createElement(s,{className:Bt.Classes.MINIMAL,items:t,onItemSelect:i,itemRenderer:a,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:n,rightIcon:Gt.a.DOUBLE_CARET_VERTICAL}));var n,i}class Wd extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.EnvVisualizer;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:qt()("sa-env-visualizer",Bt.Classes.DARK)},v.createElement("p",{id:"env-visualizer-default-text",className:Bt.Classes.RUNNING_TEXT},"The environmental visualizer generates the environmental model diagram based on breakpoints set in the editor.",v.createElement("br",null),v.createElement("br",null),"It is activated by clicking on the gutter of the editor (where all the line numbers are, on the left) to set a breakpoint, and then running the program.",v.createElement("br",null),v.createElement("br",null),"The environment model diagram follows a notation introduced in"," ",v.createElement("a",{href:We.sourceDocsChapter3_2,rel:"noopener noreferrer",target:"_blank"},v.createElement("i",null,"Structure and Interpretation of Computer Programs, JavaScript Adaptation, Chapter 3, Section 2")),"."),this.state.loading&&v.createElement(Bt.NonIdealState,{description:"Loading Env Visualizer...",icon:v.createElement(Bt.Spinner,null)}))}}var zd=Wd;class Yd extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.Inspector;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:"sa-inspector"},v.createElement("p",{id:"inspector-default-text",className:Bt.Classes.RUNNING_TEXT},"The inspector generates a list of variable bindings based on breakpoints set in the editor.",v.createElement("br",null),v.createElement("br",null),"It is activated by clicking on the gutter of the editor (where all the line numbers are, on the left) to set a breakpoint, and then running the program. Only the first line of a statement can have a breakpoint. The program halts just before the statement is evaluated."),this.state.loading&&v.createElement(Bt.NonIdealState,{description:"Loading Inspector...",icon:v.createElement(Bt.Spinner,null)}))}}var $d=Yd;class Kd extends v.Component{constructor(e){super(e),this.$parent=null,this.tryToLoad=()=>{const e=window.ListVisualizer;this.$parent&&e?(e.init(this.$parent),this.setState((e,t)=>({loading:!1}))):window.setTimeout(this.tryToLoad,1e3)},this.state={loading:!0}}componentDidMount(){this.tryToLoad()}render(){return v.createElement("div",{ref:e=>this.$parent=e,className:qt()("sa-list-visualizer",Bt.Classes.DARK)},v.createElement("p",{id:"data-visualizer-default-text",className:Bt.Classes.RUNNING_TEXT},"The data visualizer visualises data structures.",v.createElement("br",null),v.createElement("br",null),"It is activated by calling the function ",v.createElement("code",null,"draw_data(the_data)"),", where",v.createElement("code",null,"the_data")," would be the data structure that you want to visualise.",v.createElement("br",null),v.createElement("br",null),"The data visualizer uses box-and-pointer diagrams, as introduced in"," ",v.createElement("a",{href:We.sourceDocsChapter2_2,rel:"noopener noreferrer",target:"_blank"},v.createElement("i",null,"Structure and Interpretation of Computer Programs, JavaScript Adaptation, Chapter 2, Section 2")),"."),this.state.loading&&v.createElement(Bt.NonIdealState,{description:"Loading Data Visualizer...",icon:v.createElement(Bt.Spinner,null)}))}}var Qd=Kd;class Jd extends v.PureComponent{constructor(e){super(e),this.audio=void 0,this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},()=>this.applyPlaybackDataFromStart(e))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise(t=>setTimeout(t,e)),s=this.state.currentDeltaRevision;let a=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter(e=>e.time<=a&&"codeDelta"===e.type).map(e=>e.data);this.applyDeltas(n);const i=e.inputs.filter(e=>e.time>a),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===s;)a=1e3*this.audio.current.currentTime,i[o].time<a?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetEditorReadonly(!1),this.props.handleSetSourcecastStatus(Ge.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetEditorReadonly(!0),this.props.handleSetSourcecastStatus(Ge.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handlePlayerStopping=()=>{this.props.handleSetEditorReadonly(!1),this.props.handleSetSourcecastStatus(Ge.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration})},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,s=Math.floor(t/60),a=Math.floor(t-60*s);return(s<10?"0"+s:s)+":"+(a<10?"0"+a:a)}return"00:00"},this.audio=v.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=ss("Play",Gt.a.PLAY,this.handlePlayerPlaying,{},!this.props.duration),t=ss("Pause",Gt.a.PAUSE,this.handlePlayerPausing);return v.createElement("div",{className:"Bar"},v.createElement("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),v.createElement("br",null),v.createElement("div",null,v.createElement("div",{className:"PlayerControl"},v.createElement("div",{className:"PlayerControl"},this.props.playbackStatus===Ge.paused&&e,this.props.playbackStatus===Ge.playing&&t)),v.createElement("div",{className:"Slider"},v.createElement(Bt.Slider,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel}))),v.createElement("br",null))}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}var Zd=Jd;s(1988);class eu extends v.PureComponent{constructor(e){super(e),this.ShareAce=void 0,this.AceEditor=void 0,this.onChangeMethod=void 0,this.onCursorChange=void 0,this.onSelectionChange=void 0,this.getMarkers=()=>{const e=[];for(const t of this.props.highlightedLines)e.push({startRow:t[0],startCol:0,endRow:t[1],endCol:1,className:"myMarker",type:"fullLine"});return e},this.handleGutterClick=e=>{const t=e.domEvent.target;if(-1===t.className.indexOf("ace_gutter-cell")||!e.editor.isFocused()||e.clientX>35+t.getBoundingClientRect().left)return;const s=e.getDocumentPosition().row,a=e.editor.session.getLine(s);void 0!==e.editor.session.getBreakpoints(s,0)[s]||0===a.length||a.includes("//")||a.includes("debugger;")?e.editor.session.clearBreakpoint(s):e.editor.session.setBreakpoint(s),e.stop(),this.props.handleEditorUpdateBreakpoints(e.editor.session.$breakpoints)},this.handleAnnotationChange=e=>()=>{const t=e.getAnnotations();let s=0;for(const e of t)"info"===e.type&&(e.type="error",e.className="ace_error",s++);0!==s&&e.setAnnotations(t)},this.handleEvaluate=()=>{this.props.handleEditorEval(),this.props.isRecording&&this.props.handleRecordInput({type:"keyboardCommand",time:this.props.getTimerDuration(),data:Be.run})},this.moveCursor=e=>{this.AceEditor.current.editor.selection.clearSelection(),this.AceEditor.current.editor.moveCursorToPosition(e),this.AceEditor.current.editor.renderer.showCursor(),this.AceEditor.current.editor.renderer.scrollCursorIntoView(e,.5)},this.handleDeclarationNavigate=()=>{this.props.handleDeclarationNavigate(this.AceEditor.current.editor.getCursorPosition())},this.AceEditor=v.createRef(),this.ShareAce=null,this.onChangeMethod=(e,t)=>{this.props.handleUpdateHasUnsavedChanges&&this.props.handleUpdateHasUnsavedChanges(!0),this.props.handleEditorValueChange(e),this.props.isRecording&&this.props.handleRecordInput({type:"codeDelta",time:this.props.getTimerDuration(),data:t});const s=this.AceEditor.current.editor.getSession().getAnnotations();this.props.isEditorAutorun&&0===s.length&&this.props.handleEditorEval()},this.onCursorChange=e=>{if(!this.props.isRecording)return;const t=e.getCursor();this.props.handleRecordInput({type:"cursorPositionChange",time:this.props.getTimerDuration(),data:t})},this.onSelectionChange=e=>{if(!this.props.isRecording)return;const t=e.getRange(),s=e.isBackwards();Object(Qe.isEqual)(t.start,t.end)||this.props.handleRecordInput({type:"selectionRangeData",time:this.props.getTimerDuration(),data:{range:t,isBackwards:s}})}}componentDidUpdate(e){const{codeDeltasToApply:t,inputToApply:s,newCursorPosition:a}=this.props;if(t&&t!==e.codeDeltasToApply&&(this.AceEditor.current.editor.session.getDocument().applyDeltas(t),this.AceEditor.current.editor.selection.clearSelection()),a&&a!==e.newCursorPosition&&this.moveCursor(a),s&&s!==e.inputToApply)switch(s.type){case"codeDelta":this.AceEditor.current.editor.session.getDocument().applyDelta(s.data),this.AceEditor.current.editor.selection.clearSelection();break;case"cursorPositionChange":this.moveCursor(s.data);break;case"selectionRangeData":const{range:e,isBackwards:t}=s.data;this.AceEditor.current.editor.selection.setRange(e,t);break;case"keyboardCommand":switch(s.data){case"run":this.props.handleEditorEval()}}}getBreakpoints(){return this.AceEditor.current.editor.session.getBreakpoints().filter(e=>null!=e)}componentDidMount(){if(!this.AceEditor||!this.AceEditor.current||!this.AceEditor.current.editor)return;const e=this.AceEditor.current.editor,t=e.getSession();e.on("gutterclick",this.handleGutterClick),t.on("changeAnnotation",this.handleAnnotationChange(t))}componentWillUnmount(){null!==this.ShareAce&&this.ShareAce.WS.close(),this.ShareAce=null}render(){return v.createElement(qs.HotKeys,{className:"Editor",handlers:tu},v.createElement("div",{className:"row editor-react-ace"},v.createElement(Fs.a,{className:"react-ace",commands:[{name:"evaluate",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:this.handleEvaluate},{name:"navigate",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:this.handleDeclarationNavigate}],editorProps:{$blockScrolling:1/0},ref:this.AceEditor,markers:this.getMarkers(),fontSize:17,height:"100%",highlightActiveLine:!1,mode:"javascript",onChange:this.onChangeMethod,onCursorChange:this.onCursorChange,onSelectionChange:this.onSelectionChange,readOnly:!!this.props.editorReadonly&&this.props.editorReadonly,theme:"source",value:this.props.editorValue,width:"100%",setOptions:{fontFamily:"'Inconsolata', monospace"}})))}}const tu={goGreen:()=>{}};var su=eu;class au extends v.Component{constructor(e){super(e),this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.handleDelete=()=>{const{data:e}=this.props;this.props.handleDeleteSourcecastEntry(e.id)},this.state={dialogOpen:!1}}render(){return v.createElement("div",null,ss("",Gt.a.TRASH,this.handleOpenDialog),v.createElement(Bt.Dialog,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Delete Sourcecast",canOutsideClickClose:!0},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement("p",null,"Are you sure to delete this sourcecast entry?")),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER_ACTIONS},ss("Confirm Delete",Gt.a.TRASH,this.handleDelete),ss("Cancel",Gt.a.CROSS,this.handleCloseDialog)))))}}var nu=au;class iu extends v.Component{constructor(e){super(e),this.handleSelect=()=>{const{data:e}=this.props,t=e.url,s=JSON.parse(e.playbackData);this.props.handleSetSourcecastData(e.title,e.description,t,s)}}render(){return v.createElement("div",null,ss(""+this.props.data.title,Gt.a.PLAY,this.handleSelect))}}var ru=iu;class ou extends v.Component{constructor(e){super(e),this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRendererFramework:ru,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},width:400,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",width:200,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",width:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>{return t=e.data.inserted_at,Ts()(t).format("MMMM Do YYYY");var t},maxWidth:200,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRendererFramework:nu,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},width:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}componentDidMount(){this.props.handleFetchSourcecastIndex()}render(){const e=v.createElement(Bt.NonIdealState,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})}),t=Object(Qe.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),s=v.createElement("div",{className:"SourcecastContainer"},v.createElement("br",null),v.createElement("div",null,v.createElement(Bt.FormGroup,{label:"",labelFor:"text-input"},v.createElement(Bt.InputGroup,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange}))),v.createElement(Bt.Divider,null),v.createElement("div",{className:"SourcecastTable"},v.createElement("div",{className:"ag-grid-parent"},v.createElement(qa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50}))),v.createElement("br",null));return v.createElement("div",null,void 0===this.props.sourcecastIndex?e:s)}}var lu=ou,cu=s(468),du=s.n(cu);class uu extends v.PureComponent{constructor(e){super(e),this.recorder=void 0,this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter(e=>e.time<=1e3*this.props.currentPlayerTime);this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:s}=this.props;clearInterval(this.state.updater),e(!0),s(),this.recorder.pause();t("","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new du.a;const{handleRecordInit:e,handleSetEditorReadonly:t,handleTimerStart:s}=this.props;this.recorder.start().then(()=>{e(),t(!1),s();const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a})},e=>{alert("Microphone not found: "+e)})},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetEditorReadonly:t,handleTimerResume:s}=this.props;this.handleTruncatePlaybackData(),t(!1),s(1e3*e);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),s=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(s<10?"0"+s:s)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.state={duration:0,updater:void 0,saveTitle:"Title",saveDescription:"Description"}}async componentDidMount(){du.a.getPermission().then(()=>{},e=>{alert("Microphone not found: "+e)})}render(){const e=ss("Pause",Gt.a.PAUSE,this.handleRecorderPausing),t=ss("Resume",Gt.a.PLAY,this.handleRecorderResuming),s=ss("Resume Here",Gt.a.PLAY,this.handleRecorderResumingFromCurrent),a=ss("Record",Gt.a.PLAY,this.handleRecorderStarting),n=ss("Stop",Gt.a.STOP,this.handleRecorderStopping),i=ss("Reset",Gt.a.REFRESH,this.handleRecorderResetting),r=v.createElement(Bt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},ss("Save",Gt.a.FLOPPY_DISK),v.createElement("ul",{className:"Sourcereel-save-form"},v.createElement("li",{className:"form-row"},v.createElement("label",{htmlFor:"title"},"Title: "),v.createElement("input",{id:"title",value:this.state.saveTitle,onChange:this.handleSaveTitleInputChange})),v.createElement("li",{className:"form-row"},v.createElement("label",{htmlFor:"description"},"Description: "),v.createElement("input",{id:"description",value:this.state.saveDescription,onChange:this.handleSaveDescriptionInputChange})),v.createElement("li",null,ss("Submit",Gt.a.TICK,this.handleRecorderSaving))));return v.createElement("div",null,v.createElement("br",null),v.createElement("div",{className:"Timer"},v.createElement(Bt.Card,{elevation:2,style:{background:"#24323F"}},v.createElement(Bt.H1,null,this.renderLabel(this.props.recordingStatus!==Ue.paused?this.state.duration/1e3:this.props.currentPlayerTime)))),v.createElement("br",null),v.createElement("div",{className:"RecorderControl"},this.props.recordingStatus===Ue.notStarted&&a,this.props.recordingStatus===Ue.paused&&t,this.props.recordingStatus===Ue.paused&&s,this.props.recordingStatus===Ue.recording&&e,this.props.recordingStatus===Ue.paused&&n,this.props.recordingStatus===Ue.finished&&r,this.props.recordingStatus!==Ue.notStarted&&i),v.createElement("br",null))}}var hu=uu;class pu extends v.Component{constructor(...e){super(...e),this.getTimerDuration=()=>this.props.timeElapsedBeforePause+Date.now()-this.props.timeResumed,this.handleRecordInit=()=>this.props.handleRecordInit({chapter:this.props.sourceChapter,externalLibrary:this.props.externalLibraryName,editorValue:this.props.editorValue})}componentDidUpdate(e){const{inputToApply:t}=this.props;if(t&&t!==e.inputToApply)switch(t.type){case"activeTabChange":this.props.handleActiveTabChange(t.data);break;case"chapterSelect":this.props.handleChapterSelect(t.data);break;case"externalLibrarySelect":this.props.handleExternalSelect(t.data)}}render(){const e=v.createElement(qd,{handleDebuggerPause:this.props.handleDebuggerPause,handleDebuggerReset:this.props.handleDebuggerReset,handleDebuggerResume:this.props.handleDebuggerResume,handleEditorEval:()=>{this.props.handleEditorEval(),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"keyboardCommand",data:Be.run})},handleInterruptEval:this.props.handleInterruptEval,handleToggleEditorAutorun:this.props.handleToggleEditorAutorun,isDebugging:this.props.isDebugging,isEditorAutorun:this.props.isEditorAutorun,isRunning:this.props.isRunning,key:"autorun"}),t=v.createElement(es,{handleChapterSelect:({chapter:e},t)=>{this.props.handleChapterSelect(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"chapterSelect",data:e})},sourceChapter:this.props.sourceChapter,sourceVariant:this.props.sourceVariant,key:"chapter"}),s=v.createElement(as,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),a=v.createElement(ns,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),n=v.createElement(Xd,{externalLibraryName:this.props.externalLibraryName,handleExternalSelect:({name:e},t)=>{this.props.handleExternalSelect(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"externalLibrarySelect",data:e})},key:"external_library"}),i={codeDeltasToApply:this.props.codeDeltasToApply,editorReadonly:this.props.editorReadonly,editorValue:this.props.editorValue,editorSessionId:"",getTimerDuration:this.getTimerDuration,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,isEditorAutorun:this.props.isEditorAutorun,inputToApply:this.props.inputToApply,isPlaying:this.props.playbackStatus===Ge.playing,isRecording:this.props.recordingStatus===Ue.recording,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handleRecordInput:this.props.handleRecordInput},r={controlBarProps:{editorButtons:[e,t,n],replButtons:[a,s]},customEditor:v.createElement(su,i),editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,replProps:{output:this.props.output,replValue:this.props.replValue,handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange},sideContentHeight:this.props.sideContentHeight,sideContentProps:{handleActiveTabChange:e=>{this.props.handleActiveTabChange(e),this.props.recordingStatus===Ue.recording&&this.props.handleRecordInput({time:this.getTimerDuration(),type:"activeTabChange",data:e})},selectedTabId:this.props.sideContentActiveTab,tabs:[{label:"Recording Panel",iconName:Gt.a.COMPASS,body:v.createElement("div",null,v.createElement("span",{className:"Multi-line"},v.createElement(Bt.Pre,null," ",mu," ")),v.createElement(hu,{currentPlayerTime:this.props.currentPlayerTime,editorValue:this.props.editorValue,getTimerDuration:this.getTimerDuration,playbackData:this.props.playbackData,handleRecordInit:this.handleRecordInit,handleResetInputs:this.props.handleResetInputs,handleSaveSourcecastData:this.props.handleSaveSourcecastData,handleSetSourcecastData:this.props.handleSetSourcecastData,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleTimerPause:this.props.handleTimerPause,handleTimerReset:this.props.handleTimerReset,handleTimerResume:this.props.handleTimerResume,handleTimerStart:this.props.handleTimerStart,handleTimerStop:this.props.handleTimerStop,recordingStatus:this.props.recordingStatus})),id:T.sourcereel,toSpawn:()=>!0},{label:"Sourcecast Table",iconName:Gt.a.EDIT,body:v.createElement("div",null,v.createElement(lu,{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry,handleFetchSourcecastIndex:this.props.handleFetchSourcecastIndex,sourcecastIndex:this.props.sourcecastIndex})),id:T.introduction,toSpawn:()=>!0},gu,yu,Eu],workspaceLocation:"sourcereel"}},o={handleEditorValueChange:this.props.handleEditorValueChange,handlePromptAutocomplete:this.props.handlePromptAutocomplete,handleSetCurrentPlayerTime:this.props.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:this.props.handleSetCodeDeltasToApply,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleSetInputToApply:this.props.handleSetInputToApply,handleSetSourcecastDuration:this.props.handleSetSourcecastDuration,handleSetSourcecastStatus:this.props.handleSetSourcecastStatus,audioUrl:this.props.audioUrl,currentPlayerTime:this.props.currentPlayerTime,duration:this.props.playbackDuration,playbackData:this.props.playbackData,playbackStatus:this.props.playbackStatus,handleChapterSelect:this.props.handleChapterSelect,handleExternalSelect:this.props.handleExternalSelect};return v.createElement("div",{className:qt()("Sourcereel",Bt.Classes.DARK)},this.props.recordingStatus===Ue.paused?v.createElement(Zd,o):void 0,v.createElement(fa,r))}}const mu="Welcome to Sourcereel!",gu={label:"Data Visualizer",iconName:Gt.a.EYE_OPEN,body:v.createElement(Qd,null),id:T.dataVisualiser,toSpawn:()=>!0},yu={label:"Inspector",iconName:Gt.a.SEARCH,body:v.createElement($d,null),id:T.inspector,toSpawn:()=>!0},Eu={label:"Env Visualizer",iconName:Gt.a.GLOBE,body:v.createElement(zd,null),id:T.envVisualiser,toSpawn:()=>!0};var bu=pu;var vu=Object(C.c)(e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,breakpoints:e.workspaces.sourcereel.breakpoints,editorReadonly:e.workspaces.sourcereel.editorReadonly,editorValue:e.workspaces.sourcereel.editorValue,editorWidth:e.workspaces.sourcereel.editorWidth,enableDebugging:e.workspaces.sourcereel.enableDebugging,externalLibraryName:e.workspaces.sourcereel.externalLibrary,highlightedLines:e.workspaces.sourcereel.highlightedLines,inputToApply:e.workspaces.sourcecast.inputToApply,isDebugging:e.workspaces.sourcereel.isDebugging,isEditorAutorun:e.workspaces.sourcereel.isEditorAutorun,isRunning:e.workspaces.sourcereel.isRunning,newCursorPosition:e.workspaces.sourcereel.newCursorPosition,output:e.workspaces.sourcereel.output,playbackData:e.workspaces.sourcereel.playbackData,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackStatus:e.workspaces.sourcecast.playbackStatus,recordingStatus:e.workspaces.sourcereel.recordingStatus,replValue:e.workspaces.sourcereel.replValue,sideContentHeight:e.workspaces.sourcereel.sideContentHeight,sideContentActiveTab:e.workspaces.sourcereel.sideContentActiveTab,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:e.workspaces.sourcereel.context.chapter,sourceVariant:e.workspaces.sourcereel.context.variant,timeElapsedBeforePause:e.workspaces.sourcereel.timeElapsedBeforePause,timeResumed:e.workspaces.sourcereel.timeResumed}),e=>Object(O.b)({handleActiveTabChange:e=>j(e,"sourcereel"),handleBrowseHistoryDown:()=>I("sourcereel"),handleBrowseHistoryUp:()=>k("sourcereel"),handleChapterSelect:e=>_(e,"default","sourcereel"),handleDeclarationNavigate:e=>Z("sourcereel",e),handleDeleteSourcecastEntry:e=>Gr(e,"sourcecast"),handleEditorEval:()=>q("sourcereel"),handleEditorValueChange:e=>z(e,"sourcereel"),handleEditorHeightChange:e=>x(e,"sourcereel"),handleEditorWidthChange:e=>N(e.toString(),"sourcereel"),handleEditorUpdateBreakpoints:e=>Y(e,"sourcereel"),handleExternalSelect:e=>D(e,"sourcereel"),handleFetchSourcecastIndex:()=>xr("sourcecast"),handleInterruptEval:()=>at("sourcereel"),handleRecordInput:e=>Hr(e,"sourcereel"),handleReplEval:()=>X("sourcereel"),handleReplOutputClear:()=>U("sourcereel"),handleReplValueChange:e=>K(e,"sourcereel"),handleSaveSourcecastData:(e,t,s,a)=>Rr(e,t,s,a,"sourcecast"),handleSetCurrentPlayerTime:e=>Mr(e,"sourcecast"),handleSetCodeDeltasToApply:e=>_r(e,"sourcecast"),handleSetInputToApply:e=>Dr(e,"sourcecast"),handleSetSourcecastData:(e,t,s,a)=>Lr(e,t,s,a,"sourcecast"),handleSetSourcecastDuration:e=>jr(e,"sourcecast"),handleSetSourcecastStatus:e=>Br(e,"sourcecast"),handleSetEditorReadonly:e=>ae("sourcereel",e),handleResetInputs:e=>Vr(e,"sourcereel"),handleRecordInit:e=>Ur(e,"sourcereel"),handleSideContentHeightChange:e=>M(e,"sourcereel"),handleTimerPause:()=>Fr("sourcereel"),handleTimerReset:()=>qr("sourcereel"),handleTimerResume:e=>Xr(e,"sourcereel"),handleTimerStart:()=>Wr("sourcereel"),handleTimerStop:()=>zr("sourcereel"),handleToggleEditorAutorun:()=>L("sourcereel"),handleDebuggerPause:()=>it("sourcereel"),handleDebuggerResume:()=>ot("sourcereel"),handleDebuggerReset:()=>lt("sourcereel"),handlePromptAutocomplete:(e,t,s)=>de("sourcereel",e,t,s)},e))(bu);async function Su(e="",t,s,a={},n={}){try{const i=function(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization","Bearer "+e),t}(e);Object.entries(a).forEach(([e,t])=>{i.append(e,t)});const r={method:s,headers:i,...n};return fetch(ze.backendUrl+"/v1/assets/"+t,r)}finally{}}const fu=["locations","objects","images","avatars","ui","sfx","bgm","stories"];async function Cu(e="",t){return(await Promise.all(t.map(async t=>{const s=await async function(e,t){const s=await Su(e,t,"GET",{"Content-Type":"application/json"});return 200===s.status?s.json():[]}(e,t);return s.length?s:[""+t]}))).reduce((e,t)=>e.concat(t),[])}async function Au(e,t,s,a){return(await Promise.all(Array.from(t).map(async t=>{const n=await async function(e,t,s,a,n){if(n.every(e=>!t.type.startsWith(e)))return"Allowed types are "+n.join(",");const i=new FormData;i.set("upload",t);const r=await Su(e,`${s}/${a}`,"POST",{},{body:i,mode:"cors"});return r?r.text():""}(e,t,s,t.name,a);return t.name+" => "+n}))).join("\n")}var Ou=function({accessToken:e}){const[t,s]=v.useState(),[a,n]=v.useState("locations"),[i,r]=v.useState(!1),[o,l]=v.useState();function c(e){e.target.innerText&&(n(e.target.innerText),r(!1))}return v.createElement("div",{className:"LeftAlign"},v.createElement("h4",null,"Choose Folder"),v.createElement(Bt.Popover,{position:Bt.Position.BOTTOM},v.createElement(Bt.Button,{text:a}),v.createElement(Bt.Menu,null,fu.map(e=>v.createElement(Bt.MenuItem,{onClick:c,id:e,key:e,text:e})),v.createElement(Bt.MenuItem,{onClick:function(e){e.target.innerText&&(n(e.target.innerText),r(!0))},id:"Specify own folder...",key:"Specify own folder...",text:"Specify own folder..."}))),i&&v.createElement(Bt.InputGroup,{placeholder:"Or specify your own, e.g. 'locations/hallway'",onChange:function(e){l(e.target.value)}}),v.createElement("br",null),v.createElement("h4",null,"Choose File"),v.createElement("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const t=e.target.files;s(t)}}),v.createElement(Bt.Button,{onClick:async function(){const s=o||a;if(!e||!t||!s)return;const n=await Au(e,t,s,["image","audio","text"]);alert(n)}},"Upload"))};var wu=function({assetPath:e}){const t=e||tn.defaultAssetPath;return v.createElement(v.Fragment,null,v.createElement("img",{alt:"asset",crossOrigin:"anonymous",src:tn.assetsFolder+t,width:"150px"}))};var Tu=function({assetPaths:e,accessToken:t,folders:s}){const[a,n]=v.useState(""),[i,r]=v.useState({nodes:[]});v.useEffect(()=>{t&&r({nodes:ku(e,t,s)})},[t,e,s]);const o=v.useCallback(e=>{!function e(t,s){t&&t.forEach(t=>{s(t),e(t.childNodes,s)})}(i.nodes,e=>e.isSelected=!1),e.isSelected=!e.isSelected,e.isExpanded=!e.isExpanded;const t=e.id.toString();e.childNodes||(n(t),sessionStorage.setItem("selectedAsset",t)),r({...i})},[i,n]);return v.createElement(v.Fragment,null,v.createElement(wu,{assetPath:a}),v.createElement(Bt.Tree,{contents:i.nodes,onNodeClick:o}))};const Iu=(e,t)=>async()=>{const s=window.confirm(`Are you sure you want to delete ${e}?\nThere is no undoing this action!`);alert(s?await async function(e,t){const s=await Su(e,t,"DELETE");return await s.text()||"Successfully Deleted"}(t,e):"Whew")};function ku(e,t,s){const a={};return e.forEach(e=>Qe.set(a,e.split("/"),"FILE")),s.forEach(e=>{a[e]&&"FILE"!==a[e]||(a[e]=[])}),function e(s,a){return Object.keys(a).map(n=>{const i="/"+s.join("/")+"/"+n;return{id:i,label:n,secondaryLabel:v.createElement(Bt.Tooltip,{content:"Delete"},v.createElement(Bt.Icon,{icon:"trash",onClick:Iu(i,t)})),childNodes:"FILE"===a[n]?void 0:e([...s,n],a[n])}})}([],a)}var Pu=s(856),xu=s.n(Pu),Nu=s(469);const Ru=Object(Nu.b)(({value:e})=>S.a.createElement("div",null,S.a.createElement(Bt.Button,null,e))),Mu=Object(Nu.a)(({items:e})=>S.a.createElement("div",null,e.map((e,t)=>S.a.createElement(Ru,{key:"item-"+e,index:t,value:e}))));function _u(){const[e,t]=S.a.useState(["Item 1","Item 2","Item 3","Item 4","Item 5","Item 6"]);return S.a.createElement(S.a.Fragment,null,S.a.createElement(Mu,{items:e,onSortEnd:({oldIndex:e,newIndex:s})=>{t(t=>xu()(t,e,s))}}),S.a.createElement("br",null),S.a.createElement(Bt.Button,{onClick:function(){console.log(e)}},"Save"))}s(1989);const Du=(e,t)=>{const s=new FileReader;s.readAsText(t),s.onloadend=t=>{s.result&&sessionStorage.setItem(e,s.result.toString())}};var Lu=function({storageName:e,assetPaths:t,useDefaultChapter:s}){const a=t.filter(e=>e.startsWith("stories")&&e.endsWith("txt")).map(e=>e.slice(8)),[n,i]=v.useState(s?"defaultCheckpoint.txt":a[0]);async function r(t){if(!t.target.innerHTML)return;const s=t.target.innerHTML;i("Loading");const a=await fetch(`${tn.assetsFolder}/stories/${s}`),n=await a.text();i(s),sessionStorage.setItem(e,n)}const o=v.createElement(v.Fragment,null,v.createElement("input",{type:"file",onChange:function(t){if(!t.target.files)return;const[s]=t.target.files;Du(e,s)},style:{width:"250px"}})),l=v.createElement(v.Fragment,null,v.createElement(Bt.Popover,{position:Bt.Position.BOTTOM},v.createElement(Bt.Button,{text:n}),v.createElement(Bt.Menu,null,a.map(e=>v.createElement(Bt.MenuItem,{onClick:r,id:e,key:e,text:e})))));return v.createElement("div",{className:"LeftAlign"},v.createElement("hr",null),v.createElement(Bt.Tabs,{id:"Tabs",key:"vertical",renderActiveTabPanelOnly:!0},v.createElement(Bt.Tab,{id:"own",title:"Local",panel:o}),v.createElement(Bt.Tab,{id:"s3",title:"S3",panel:l})),v.createElement("hr",null))};function ju({accessToken:e,assetPaths:t}){return v.createElement(v.Fragment,null,v.createElement("h3",null,"Checkpoint Text Loader"),v.createElement("b",null,"Step 1: Choose default checkpoint"),v.createElement(Lu,{assetPaths:t,useDefaultChapter:!0,storageName:xl.gameTxtStorageName.defaultChapter,accessToken:e}),v.createElement("b",null,"Step 2: Choose checkpoint text"),v.createElement(Lu,{assetPaths:t,useDefaultChapter:!1,storageName:xl.gameTxtStorageName.checkpointTxt,accessToken:e}),v.createElement("br",null),v.createElement(Bt.Button,{onClick:function(){Jl().getStorySimProps().mainMenuRef.callGameManager()},icon:"play"},"Simulate Checkpoint"),v.createElement("br",null),v.createElement("br",null),v.createElement(Bt.Button,{onClick:Bu},"Reset All Files"),v.createElement("br",null))}function Bu(e){sessionStorage.setItem(xl.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem(xl.gameTxtStorageName.defaultChapter,"")}var Gu=function(){const e=Object(C.e)(e=>e.session),[t,s]=v.useState([]),[a,n]=v.useState(kl.Default);return v.useEffect(()=>{(Ql=new Jc(Kl),Ql.scene.add("StorySimulatorMenu",Rl,!0),Ql.scene.add("ObjectPlacement",$l),Ql.scene.add("GameManager",Uc),Ql).setStorySimProps({setStorySimState:n})},[]),v.useEffect(()=>{Jl().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name})},[e]),v.useEffect(()=>{(async()=>{s(await Cu(e.accessToken,fu))})()},[e]),v.createElement(v.Fragment,null,v.createElement("div",{className:"StorySimulatorWrapper"},v.createElement("div",{id:"game-display"}),v.createElement("div",{className:"LeftAlign StorySimulatorPanel"},a===kl.Default&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Welcome to story simulator!")),a===kl.CheckpointSim&&v.createElement(ju,{accessToken:e.accessToken,assetPaths:t}),a===kl.ObjectPlacement&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Asset Selection"),v.createElement(Tu,{folders:fu,assetPaths:t,accessToken:e.accessToken})),a===kl.AssetUploader&&v.createElement(v.Fragment,null,v.createElement("h3",null,"Asset uploader"),v.createElement(Ou,{accessToken:e.accessToken}),v.createElement("h3",null,"Asset Viewer"),v.createElement(Tu,{folders:fu,assetPaths:t,accessToken:e.accessToken})),a===kl.ChapterSequence&&v.createElement(_u,null))))};var Uu=Object(A.h)(Object(C.c)(e=>({sourceChapter:e.workspaces.playground.context.chapter,sourceVariant:e.workspaces.playground.context.variant}),e=>Object(O.b)({handleFetchChapter:()=>oe(),handleUpdateChapter:e=>le(e.chapter,e.variant)},e))((function(e){e.handleFetchChapter();const t=wt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:It(e.chapter,e.variant)})),s=(e,{handleClick:t})=>v.createElement(Bt.MenuItem,{active:!1,key:e.chapter+e.variant,onClick:t,text:e.displayName}),a=Zt.a.ofType();return v.createElement("div",null," ",((e,n,i=(e=>{}))=>v.createElement(a,{className:Bt.Classes.MINIMAL,items:t,onItemSelect:i,itemRenderer:s,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:It(e,n),rightIcon:Gt.a.DOUBLE_CARET_VERTICAL})))(e.sourceChapter,e.sourceVariant,e.handleUpdateChapter)," ")})));var Hu=e=>v.createElement(Bt.Navbar,{className:"NavigationBar secondary-navbar"},v.createElement(Bt.NavbarGroup,{align:Bt.Alignment.LEFT},v.createElement(Ut.a,{to:"/academy/"+Ls(zt.Mission),activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.FLAME}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Missions"),v.createElement(Da,{notificationFilter:Na(zt.Mission),disableHover:!0})),v.createElement(Ut.a,{to:"/academy/"+Ls(zt.Sidequest),activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.LIGHTBULB}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Quests"),v.createElement(Da,{notificationFilter:Na(zt.Sidequest),disableHover:!0})),v.createElement(Ut.a,{to:"/academy/"+Ls(zt.Path),activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.PREDICTIVE_ANALYSIS}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Paths"),v.createElement(Da,{notificationFilter:Na(zt.Path),disableHover:!0})),v.createElement(Ut.a,{to:"/academy/"+Ls(zt.Contest),activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.COMPARISON}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Contests"),v.createElement(Da,{notificationFilter:Na(zt.Contest),disableHover:!0})),v.createElement(Ut.a,{to:"/academy/"+Ls(zt.Practical),activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.MANUAL}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Practical"))),e.role===Ot.Admin||e.role===Ot.Staff?v.createElement(Bt.NavbarGroup,{align:Bt.Alignment.RIGHT},v.createElement(Uu,null),v.createElement(Ut.a,{to:"/academy/groundcontrol",activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:"satellite"}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Ground Control")),v.createElement(Ut.a,{to:"/academy/dashboard",activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:"globe"}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Dashboard")),v.createElement(Ut.a,{to:"/academy/sourcereel",activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.MOBILE_VIDEO}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Sourcereel")),v.createElement(Ut.a,{to:"/academy/grading",activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.ENDORSED}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Grading"),v.createElement(Da,{notificationFilter:Na("Grading"),disableHover:!0})),v.createElement(Ut.a,{to:"/academy/storysimulator",activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL)},v.createElement(Bt.Icon,{icon:Gt.a.CROWN}),v.createElement("div",{className:"navbar-button-text hidden-xs"},"Story Simulator"))):null);class Vu extends v.Component{constructor(...e){super(...e),this.assessmentRenderFactory=e=>t=>v.createElement(Ua,{assessmentCategory:e}),this.dynamicRedirect=e=>{const t=e.historyHelper.lastGeneralLocations[0],s=e.historyHelper.lastAcademyLocations[0];return null!=t&&null==jt.exec(t)&&null!=s?()=>v.createElement(A.b,{to:s}):this.redirectToGame},this.redirectTo404=()=>v.createElement(A.b,{to:"/404"}),this.redirectToGame=()=>v.createElement(A.b,{to:"/academy/game"})}componentDidMount(){this.props.handleFetchNotifications()}render(){return v.createElement("div",{className:"Academy"},v.createElement(Hu,{role:this.props.role}),v.createElement(A.e,null,v.createElement(A.c,{path:`/academy/${Ls(zt.Contest)}/${Ha}`,render:this.assessmentRenderFactory(zt.Contest)}),v.createElement(A.c,{path:"/academy/game",component:id}),v.createElement(A.c,{path:`/academy/${Ls(zt.Mission)}/${Ha}`,render:this.assessmentRenderFactory(zt.Mission)}),v.createElement(A.c,{path:`/academy/${Ls(zt.Path)}/${Ha}`,render:this.assessmentRenderFactory(zt.Path)}),v.createElement(A.c,{path:`/academy/${Ls(zt.Sidequest)}/${Ha}`,render:this.assessmentRenderFactory(zt.Sidequest)}),v.createElement(A.c,{path:`/academy/${Ls(zt.Practical)}/${Ha}`,render:this.assessmentRenderFactory(zt.Practical)}),v.createElement(A.c,{path:"/academy/groundcontrol",component:Fd}),v.createElement(A.c,{path:"/academy/dashboard",component:za}),v.createElement(A.c,{path:"/academy/grading/:submissionId(\\d+)?/:questionId(\\d+)?",component:Id}),v.createElement(A.c,{path:"/academy/sourcereel",component:vu}),v.createElement(A.c,{path:"/academy/storysimulator",component:Gu}),v.createElement(A.c,{exact:!0,path:"/academy",component:this.dynamicRedirect(this.props)}),v.createElement(A.c,{component:this.redirectTo404})))}}var Fu=Vu;var qu=Object(A.h)(Object(C.c)(e=>({historyHelper:e.session.historyHelper}),e=>Object(O.b)({handleFetchNotifications:De},e))(Fu));const Xu=v.createElement("span",{className:"dot"},"\u2022");class Wu extends v.Component{render(){return v.createElement("div",{className:"outsideDetails"},v.createElement(Bt.Card,{className:"contributorsDetails",elevation:Bt.Elevation.ONE},v.createElement(Bt.H3,null,"The people behind Source Academy"),v.createElement("p",null,"The ",v.createElement("i",null,"Source Academy"),' is designed by and for students of the National University of Singapore. Students who completed the CS1101S module come back to coach their juniors as "Avengers" or to further develop and improve the Academy. This page includes all developers who contributed to the Source Academy ',v.createElement("i",null,"Knight")," (2020) and its its precursor, ",v.createElement("i",null,"Cadet")," (2018). Both of these succeeded Source Academy 2 (2017) and ultimately the original Source Academy (2016)."),v.createElement("div",{className:"leadership"},v.createElement(Bt.H5,null,v.createElement("strong",null,v.createElement("u",null,"2020 Leadership"))),v.createElement("p",null,"Tiffany Chong",v.createElement("br",null),v.createElement("strong",null,"(Game)")),Xu,v.createElement("p",null,"Anthony Halim",v.createElement("br",null),v.createElement("strong",null,"(Architecture)")),Xu,v.createElement("p",null,"Kan Yip Keng, Jet",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),Xu,v.createElement("p",null,"Low Jun Kai, Sean",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),Xu,v.createElement("p",null,"Daryl Tan",v.createElement("br",null),v.createElement("strong",null,"(Source)")),Xu,v.createElement("p",{className:"wider"},"Tee Hao Wei",v.createElement("br",null),v.createElement("strong",null,"(Backend & DevOps)")),Xu,v.createElement("p",null,"Martin Henz",v.createElement("br",null),v.createElement("strong",null,"(Coordination)"))),v.createElement("div",{className:"hallOfFame"},v.createElement(Bt.H5,null,v.createElement("strong",null,v.createElement("u",null,"Hall of Fame"))),v.createElement("p",null,v.createElement("strong",null,"Cadet architect")),v.createElement("p",null,"Evan Sebastian"),v.createElement("p",null,v.createElement("strong",null,"Cadet core team")),v.createElement("p",null,"Julius Putra Tanu Setiaji ",Xu," Lee Ning Yuan ",Xu," Vignesh Shankar ",Xu," Thomas Tan"," ",Xu," Chen Shaowei"),v.createElement("p",null,v.createElement("strong",null,"Graphic design")),v.createElement("p",null,"Ng Tse Pei ",Xu," Joey Yeo ",Xu," Tan Yu Wei")),v.createElement("div",{className:"leadership"},v.createElement(Bt.H5,null,v.createElement("strong",null,v.createElement("u",null,"2019 Leadership"))),v.createElement("p",null,"Liow Jia Chen",v.createElement("br",null),v.createElement("strong",null,"(Backend)")),Xu,v.createElement("p",null,"Ge Shuming",v.createElement("br",null),v.createElement("strong",null,"(Frontend)")),Xu,v.createElement("p",null,"Rahul Rajesh",v.createElement("br",null),v.createElement("strong",null,"(DevOps)")),Xu,v.createElement("p",null,"Daryl Tan",v.createElement("br",null),v.createElement("strong",null,"(Source)")),Xu,v.createElement("p",null,"She Jiayu",v.createElement("br",null),v.createElement("strong",null,"(Tools)"))),v.createElement("div",{className:"contributors"},v.createElement(Bt.H5,null,v.createElement("strong",null,v.createElement("u",null,"All Contributors"))),v.createElement("p",null,"Below are all contributors to the"," ",v.createElement("a",{href:We.githubOrg},"GitHub repositories of the Source Academy"),"."))))}}var zu=Wu;const Yu=["assessments","tools","source-academy2"],$u=["dependabot[bot]","dependabot-preview[bot]"];class Ku extends v.Component{constructor(e){super(e),this.state={repos:[],contributors:[]}}componentDidMount(){(async()=>{const e=await fetch("https://api.github.com/orgs/source-academy/repos"),t=await e.json();return await t.filter(e=>!Yu.includes(e.name)).map(e=>({key:e.id,name:e.name,description:e.description,link:e.contributors_url}))})().then(e=>(this.setState({repos:e}),e)).then(e=>{(async e=>{const t=await Promise.all(e.map(e=>fetch(e.link))),s=await Promise.all(t.map(e=>e.json()));return await Promise.all(s.map(e=>e.filter(e=>!$u.includes(e.login)).map(e=>({key:e.id,photo:e.avatar_url,githubPage:e.html_url,githubName:e.login,commits:e.contributions}))))})(e).then(e=>{this.setState({contributors:e})})})}render(){const{contributors:e,repos:t}=this.state,s=e.length?e.map((e,s)=>{const a=t[s],n=e.map(e=>v.createElement("div",{key:e.key},v.createElement("img",{src:e.photo,alt:"Contributor"}),v.createElement("p",null,v.createElement("a",{href:e.githubPage,rel:"noopener noreferrer",target:"_blank"},e.githubName)),v.createElement("p",null,"Commits: ",e.commits)));return v.createElement(Bt.Card,{key:a.key,className:"containerPermalink",elevation:Bt.Elevation.ONE},v.createElement("div",{className:"repoDetailsPermalink"},v.createElement(Bt.H3,null,a.name),v.createElement(Bt.H5,null,a.description)),v.createElement("div",{className:"inPermalink"},n))}):v.createElement(Bt.H2,null,"Loading...");return v.createElement("div",null,s)}}var Qu=Ku;class Ju extends v.Component{render(){return v.createElement("div",{className:"fullpage"},v.createElement(Bt.Card,{className:"fullpage-content",elevation:Bt.Elevation.THREE},v.createElement(zu,null),v.createElement(Qu,null)))}}var Zu=Ju;const eh=({handleClick:e,id:t,name:s})=>v.createElement(Bt.Button,{className:Bt.Classes.LARGE,rightIcon:Gt.a.LOG_IN,onClick:v.useCallback(()=>e(t),[e,t])},"Log in with "+s),th=v.createElement(Ut.a,{to:"/playground"},v.createElement(Bt.Button,{className:Bt.Classes.LARGE,rightIcon:Gt.a.CODE},"Try out the playground"));var sh=e=>{const{code:t,providerId:s,handleFetchAuth:a}=e;return v.useEffect(()=>{t&&a(t,s)},[t,s,a]),t?v.createElement("div",{className:qt()("Login",Bt.Classes.DARK)},v.createElement(Bt.Card,{className:qt()("login-card",Bt.Classes.ELEVATION_4)},v.createElement("div",{className:"login-body"},v.createElement(Bt.NonIdealState,{description:"Logging In...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})})))):v.createElement("div",{className:qt()("Login",Bt.Classes.DARK)},v.createElement(Bt.Card,{className:qt()("login-card",Bt.Classes.ELEVATION_4)},v.createElement("div",{className:"login-header"},v.createElement(Bt.H4,null,v.createElement(Bt.Icon,{icon:Gt.a.LOCK}),"LOGIN")),v.createElement("div",{className:"login-body"},v.createElement(Bt.ButtonGroup,{fill:!0,vertical:!0},e.providers.map(({id:t,name:s})=>v.createElement(eh,{handleClick:e.handleLogin,name:s,id:t,key:t})),th))))};var ah=e=>{const t=Object(C.d)(),s=v.useMemo(()=>Object(O.b)({handleFetchAuth:me,handleLogin:ve},t),[t]);return v.createElement(sh,Object.assign({},s,e))},nh=s(316),ih=s(314);const rh=e=>e.charAt(0).toUpperCase()+e.slice(1),oh=()=>{const e=localStorage.getItem("MissionEditingAssessmentSA");return e?JSON.parse(e):null},lh=()=>{const e=localStorage.getItem("MissionEditingOverviewSA");return e?JSON.parse(e):null},ch=e=>{localStorage.setItem("MissionEditingAssessmentSA",JSON.stringify(e))},dh=e=>{localStorage.setItem("MissionEditingOverviewSA",JSON.stringify(e))},uh=(e,t,s)=>{const a=e.CONTENT.TASK[0],n=a.$;return{category:rh(n.kind),closeAt:n.duedate,coverImage:n.coverimage,grade:1,id:-1,maxGrade:t,maxXp:s,number:n.number||"",openAt:n.startdate,title:n.title,reading:a.READING?a.READING[0]:"",shortSummary:a.WEBSUMMARY?a.WEBSUMMARY[0]:"",status:Xt.attempting,story:n.story,xp:0,gradingStatus:"none"}},hh=e=>{const t=e.CONTENT.TASK[0],s=t.$,a=mh(t);return[{category:rh(s.kind),id:-1,globalDeployment:ph(t.DEPLOYMENT),graderDeployment:ph(t.GRADERDEPLOYMENT),longSummary:t.TEXT[0],missionPDF:"google.com",questions:a[0],title:s.title},a[1],a[2]]},ph=e=>{if(void 0===e)return{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]};{const t=e[0],s=t.IMPORT||t.EXTERNAL,a=s?s[0].$.name:"NONE",n=s&&s[0].SYMBOL||[],i=t.GLOBAL?t.GLOBAL.map(e=>{return[e.IDENTIFIER[0],(t=e.VALUE[0],Function('"use strict";return ('+t+")")()),e.VALUE[0]];var t}):[];return{chapter:parseInt(t.$.interpreter,10),external:{name:a,symbols:n},globals:i}}},mh=e=>{let t=0,s=0;const a=[];return e.PROBLEMS[0].PROBLEM.forEach((e,n)=>{const i=e.$.maxxp?parseInt(e.$.maxxp,10):0,r={answer:null,roomId:null,content:e.TEXT[0],id:n,library:ph(e.DEPLOYMENT),graderLibrary:ph(e.GRADERDEPLOYMENT),type:e.$.type,xp:0,grade:0,maxGrade:parseInt(e.$.maxgrade,10),maxXp:i};t+=parseInt(e.$.maxgrade,10),s+=i,"programming"===r.type&&a.push(yh(e,r)),"mcq"===r.type&&a.push(gh(e,r))}),[a,t,s]},gh=(e,t)=>{const s=[],a=e.SNIPPET?e.SNIPPET[0].SOLUTION:void 0;let n=0;return e.CHOICE.forEach((e,t)=>{s.push({content:e.TEXT[0],hint:null}),n="true"===e.$.correct?t:n}),{...t,type:"mcq",answer:a?parseInt(a[0],10):0,choices:s,solution:n}},yh=(e,t)=>{const s=e.SNIPPET[0].TESTCASES,a=s&&s[0].PUBLIC||[],n=s&&s[0].PRIVATE||[],i=e.SNIPPET[0].PREPEND,r=e.SNIPPET[0].POSTPEND,o=e.SNIPPET[0].SOLUTION,l={...t,autogradingResults:[],prepend:i?i[0].trim():"",solutionTemplate:e.SNIPPET[0].TEMPLATE[0].trim(),postpend:r?r[0].trim():"",testcases:a.map(e=>Eh(e)),testcasesPrivate:n.map(e=>Eh(e)),answer:o?o[0].trim():"",type:"programming"};return e.SNIPPET[0].GRADER&&(l.graderTemplate=e.SNIPPET[0].GRADER[0]),l},Eh=e=>({type:Yt.public,answer:e.$.answer,score:parseInt(e.$.score,10),program:e._}),bh=(e,t)=>{const s=document.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},vh=e=>{const t={$:{interpreter:e.chapter.toString()},EXTERNAL:{$:{name:e.external.name}}};return 0!==e.external.symbols.length&&(t.EXTERNAL.SYMBOL=e.external.symbols),0!==e.globals.length&&(t.GLOBAL=e.globals.map(e=>({IDENTIFIER:e[0],VALUE:e[2]}))),t},Sh=(e,t)=>{const s={},a={coverimage:t.coverImage,duedate:t.closeAt,kind:t.category.toLowerCase(),number:t.number||"",startdate:t.openAt,story:t.story,title:t.title};return s.$=a,t.reading&&""!==t.reading&&(s.READING=t.reading),s.WEBSUMMARY=t.shortSummary,s.TEXT=e.longSummary,s.PROBLEMS={PROBLEM:[]},s.DEPLOYMENT=vh(e.globalDeployment),-1!==e.graderDeployment.chapter&&(s.GRADERDEPLOYMENT=vh(e.graderDeployment)),e.questions.forEach(e=>{const t={$:{type:e.type,maxgrade:e.maxGrade},SNIPPET:{SOLUTION:e.answer},TEXT:e.content,CHOICE:[]};if(-1!==e.library.chapter&&(t.$.DEPLOYMENT=vh(e.library)),-1!==e.graderLibrary.chapter&&(t.$.GRADERDEPLOYMENT=vh(e.graderLibrary)),e.maxXp&&(t.$.maxxp=e.maxXp),"programming"===e.type){e.graderTemplate&&(t.SNIPPET.GRADER=e.graderTemplate);const s={...t.SNIPPET,TEMPLATE:e.solutionTemplate,PREPEND:e.prepend,POSTPEND:e.postpend,TESTCASES:""};if(e.testcases.length||e.testcasesPrivate.length){if(s.TESTCASES={},e.testcases.length){const t=e.testcases.map(e=>({$:{answer:e.answer,score:e.score},_:e.program}));s.TESTCASES.PUBLIC=t}if(e.testcasesPrivate&&e.testcasesPrivate.length){const t=e.testcasesPrivate.map(e=>({$:{answer:e.answer,score:e.score},_:e.program}));s.TESTCASES.PRIVATE=t}}t.SNIPPET=s}"mcq"===e.type&&e.choices.forEach((s,a)=>{t.CHOICE.push({$:{correct:e.solution===a?"true":"false"},TEXT:s.content})}),s.PROBLEMS.PROBLEM.push(t)}),s};class fh extends v.Component{constructor(e){super(e),this.saveEditOverview=e=>t=>{const s={...this.props.overview,[e]:this.state.fieldValue};this.setState({editingOverviewField:"",fieldValue:""}),dh(s),this.props.updateEditingOverview(s)},this.handleEditOverview=()=>e=>{this.setState({fieldValue:e.target.value})},this.toggleEditField=e=>t=>{this.state.editingOverviewField!==e&&this.setState({editingOverviewField:e,fieldValue:this.props.overview[e]})},this.toggleOptionsOverlay=()=>{this.setState({showOptionsOverlay:!this.state.showOptionsOverlay})},this.handleExportXml=e=>{(()=>{const e=localStorage.getItem("MissionEditingAssessmentSA"),t=localStorage.getItem("MissionEditingOverviewSA");if(e&&t){const s=JSON.parse(e),a=JSON.parse(t),n=a.fileName||a.title,i=new ih.Builder,r={CONTENT:{$:{"xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance"},TASK:Sh(s,a)}};let o=i.buildObject(r);o=o.replace(/(&#xD;)+/g,""),bh(n+".xml",o)}})()},this.makeEditingOverviewTextarea=e=>v.createElement(nh.a,{autoFocus:!0,className:"editing-textarea",onChange:this.handleEditOverview(),onBlur:this.saveEditOverview(e),value:this.state.fieldValue}),this.makeEditingOverviewCard=e=>v.createElement("div",null,v.createElement(Bt.Card,{className:"row listing",elevation:Bt.Elevation.ONE},v.createElement("div",{className:"col-xs-3 listing-picture",onClick:this.toggleEditField("coverImage")},"coverImage"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("coverImage"):v.createElement("img",{alt:"Assessment cover",className:"cover-image-"+e.status,src:e.coverImage?e.coverImage:Vt.a})),v.createElement("div",{className:"col-xs-9 listing-text"},this.makeEditingOverviewCardTitle(e,e.title),v.createElement("div",{className:"row listing-grade"},v.createElement(Bt.H6,null," ","Max Grade: "+e.maxGrade," ")),v.createElement("div",{className:"row listing-xp"},v.createElement(Bt.H6,null," ","Max XP: "+e.maxXp," ")),v.createElement("div",{className:"row listing-description",onClick:this.toggleEditField("shortSummary")},"shortSummary"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("shortSummary"):v.createElement(ps,{content:Ch(e.shortSummary)})),v.createElement("div",{className:"listing-controls"},v.createElement(Bt.Text,{className:"listing-due-date"},v.createElement(Bt.Icon,{className:"listing-due-icon",iconSize:12,icon:Gt.a.TIME}),v.createElement("div",{className:"date-container"},"Opens at:\xa0"),v.createElement("div",{className:"date-container",onClick:this.toggleEditField("openAt")},"openAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("openAt"):""+ks(e.openAt)),v.createElement("div",{className:"date-container"},"\xa0\xa0Due:\xa0"),v.createElement("div",{className:"date-container",onClick:this.toggleEditField("closeAt")},"closeAt"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("closeAt"):""+ks(e.closeAt))),this.makeOptionsButton(),Ah(e,this.props.listingPath))))),this.makeEditingOverviewCardTitle=(e,t)=>v.createElement("div",{className:"row listing-title"},v.createElement(Bt.Text,{ellipsize:!0,className:"col-xs-10"},v.createElement(Bt.H4,{onClick:this.toggleEditField("title")},"title"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("title"):Ch(t))),v.createElement("div",{className:"col-xs-2"},this.makeExportButton(e))),this.makeExportButton=e=>v.createElement(Bt.Button,{icon:Gt.a.EXPORT,intent:Bt.Intent.DANGER,minimal:!0,onClick:this.handleExportXml},"Save as XML"),this.makeOptionsButton=()=>v.createElement(Bt.Button,{icon:Gt.a.WRENCH,minimal:!0,onClick:this.toggleOptionsOverlay},"Other Options"),this.saveCategory=(e,t)=>{const s={...this.props.overview,category:e};dh(s),this.props.updateEditingOverview(s)},this.optionsOverlay=()=>v.createElement(Bt.Dialog,{canOutsideClickClose:!1,className:"assessment-reset",icon:Gt.a.WRENCH,isCloseButtonShown:!0,isOpen:this.state.showOptionsOverlay,onClose:this.toggleOptionsOverlay,title:"Other options"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement(Bt.H3,null,"Category"),wh(this.props.overview.category,this.saveCategory),v.createElement(Bt.H3,null,"Number"),v.createElement("div",{onClick:this.toggleEditField("number")},"number"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("number"):Ch(this.props.overview.number||"")),v.createElement(Bt.H3,null,"Story"),v.createElement("div",{onClick:this.toggleEditField("story")},"story"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("story"):Ch(this.props.overview.story||"")),v.createElement("br",null),v.createElement(Bt.H3,null,"Filename"),v.createElement("div",{onClick:this.toggleEditField("fileName")},"fileName"===this.state.editingOverviewField?this.makeEditingOverviewTextarea("fileName"):Ch(this.props.overview.fileName||"")))),this.state={editingOverviewField:"",fieldValue:"",showOptionsOverlay:!1}}render(){return v.createElement("div",null,this.optionsOverlay(),this.makeEditingOverviewCard(this.props.overview))}}const Ch=e=>e.match("^(\n| )*$")?"Enter Value Here (If Applicable)":e,Ah=(e,t)=>(t=t||"/academy/"+Ls(e.category),v.createElement(Ut.a,{to:t+`/${e.id.toString()}/${ze.defaultQuestionId}`},ss("Edit mission",Gt.a.EDIT))),Oh=[zt.Mission,zt.Path,zt.Sidequest,zt.Contest],wh=(e,t=((e,t)=>{}))=>v.createElement(Th,{className:Bt.Classes.MINIMAL,items:Oh,onItemSelect:t,itemRenderer:Ih,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:e,rightIcon:Gt.a.DOUBLE_CARET_VERTICAL})),Th=Zt.a.ofType(),Ih=(e,{handleClick:t,modifiers:s,query:a})=>v.createElement(Bt.MenuItem,{active:!1,key:e,onClick:t,text:e});function kh(e){const t="question"===e.editingMode?"Global":"Question Specific";return v.createElement(Bt.Tooltip,{content:"Switch to "+t+" Editing Mode"},ss(t+" Editing Mode",Gt.a.REFRESH,e.toggleEditMode))}const Ph=(e,t)=>{for(const s of e)t=t[s];return t},xh=(e,t,s)=>{let a=0;for(a=0;a<e.length-1;a++)s=s[e[a]];s[e[a]]=t},Nh=(e=0,t=null)=>s=>{let a;return s="string"===typeof s?parseInt(s,10):s,a=null!==e&&s<e?e:null!==t&&s>t?t:s,a};class Rh extends v.Component{constructor(e){super(e),this.saveEditAssessment=e=>{let t;this.state.isNumber?(t=parseInt(this.state.fieldValue,10),isNaN(t)&&(t=Ph(this.props.path,this.props.assessment))):t=this.state.fieldValue;const s=Ph(this.props.path,this.props.assessment);if(this.props.processResults&&(t=this.props.processResults(t)),t!==s){const e=this.props.assessment;xh(this.props.path,t,e),this.props.updateAssessment(e)}this.setState({isEditing:!1})},this.handleEditAssessment=e=>{this.setState({fieldValue:e.target.value})},this.makeEditingTextarea=()=>v.createElement(nh.a,{autoFocus:!0,className:"editing-textarea",onChange:this.handleEditAssessment,onBlur:this.saveEditAssessment,value:this.state.fieldValue}),this.toggleEditField=()=>e=>{if(!this.state.isEditing){const e=Ph(this.props.path,this.props.assessment)||"";this.setState({isEditing:!0,fieldValue:"string"===typeof e?e:e.toString()})}};const t=this.props.isNumber||!1;this.state={isEditing:!1,isNumber:t,fieldValue:"",useRawValue:this.props.useRawValue||t}}render(){let e;if(this.state.isEditing)e=this.makeEditingTextarea();else{const t="Please enter value (if applicable)";let s=Ph(this.props.path,this.props.assessment);this.props.isNumber||(s=s||"",s=s.match(/^\s*$/)?t:s),e=this.state.useRawValue?s:v.createElement(ps,{content:s})}return v.createElement("div",{onClick:this.toggleEditField()},e)}}var Mh=Rh;class _h extends v.Component{constructor(...e){super(...e),this.addTestcase=e=>()=>{e.push({type:Yt.public,answer:"",score:0,program:""}),this.props.updateAssessment(this.props.assessment)},this.removeTestcase=(e,t)=>{e.splice(t,1),this.props.updateAssessment(this.props.assessment)},this.autograderCard=(e,t)=>{const s=Ph(e,this.props.assessment),a=s[t];return v.createElement("div",null,v.createElement(Bt.Card,{className:"row listing",elevation:Bt.Elevation.ONE},v.createElement("div",{className:"col-xs-9 listing-text"},v.createElement("div",{className:"row listing-program"},v.createElement(Bt.H6,null,"Test Program:",v.createElement(Mh,{assessment:this.props.assessment,path:e.concat([t,"program"]),useRawValue:!0,updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"row listing-expected"},v.createElement(Bt.H6,null,"Score:",v.createElement(Mh,{assessment:this.props.assessment,isNumber:!0,path:e.concat([t,"score"]),updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"row listing-expected"},v.createElement(Bt.H6,null,"Expected Answer:",v.createElement(Mh,{assessment:this.props.assessment,path:e.concat([t,"answer"]),useRawValue:!0,updateAssessment:this.props.updateAssessment}))),v.createElement("div",{className:"listing-controls"},v.createElement("div",null,ss("Test",Gt.a.PLAY,()=>this.props.handleTestcaseEval(a)),ss("Delete",Gt.a.DELETE,()=>this.removeTestcase(s,t)))))))}}render(){const e=this.props.assessment.questions[this.props.questionId],t=["questions",this.props.questionId,"testcases"],s=e.testcases.map((e,s)=>v.createElement("div",{key:s},this.autograderCard(t,s))),a=["questions",this.props.questionId,"testcasesPrivate"],n=e.testcasesPrivate.map((e,t)=>v.createElement("div",{key:t},this.autograderCard(a,t)));return v.createElement("div",null,"Public Testcases",s,ss("New public testcase",Gt.a.PLUS,this.addTestcase(e.testcases)),v.createElement("br",null),v.createElement("br",null),"Private Testcases",n,ss("New private testcase",Gt.a.PLUS,this.addTestcase(e.testcasesPrivate)))}}class Dh extends v.Component{constructor(...e){super(...e),this.deploymentTab=()=>{const e=this.props.pathToLibrary,t=Ph(e,this.props.assessment),s=t.external.symbols.map((t,s)=>v.createElement("tr",{key:s},v.createElement("td",null,this.textareaContent(e.concat(["external","symbols",s]))),v.createElement("td",{style:{width:"100px"}},ss("Delete",Gt.a.MINUS,this.handleSymbolDelete(s))))),a=t.globals.map((t,s)=>v.createElement("tr",{key:s},v.createElement("td",{style:{width:"170px"}},this.textareaContent(e.concat(["globals",s,0]))),v.createElement("td",null,this.globalValueTextareaContent(s)),v.createElement("td",{style:{width:"90px"}},ss("Delete",Gt.a.MINUS,this.handleGlobalDelete(s))))),n=ss("Use this Library",Gt.a.REFRESH,()=>this.props.handleRefreshLibrary(t)),i=v.createElement(v.Fragment,null,"External Library:",v.createElement("br",null),Fh(t.external.name,this.handleExternalSelect),v.createElement(Bt.Divider,null),v.createElement("div",null,"Symbols:"),v.createElement("br",null),v.createElement("table",{style:{width:"100%"}},v.createElement("tbody",null,s)),ss("New Symbol",Gt.a.PLUS,this.handleNewSymbol)),r=v.createElement(v.Fragment,null,v.createElement("div",null,"Globals:"),v.createElement("br",null),v.createElement("table",{style:{width:"100%",borderSpacing:"5px"}},v.createElement("tbody",null,a)),ss("New Global",Gt.a.PLUS,this.handleNewGlobal));return v.createElement("div",null,v.createElement(Bt.Divider,null),n,v.createElement(Bt.Divider,null),"Interpreter:",v.createElement("br",null),Gh(t.chapter,t.variant,this.handleChapterSelect),v.createElement(Bt.Divider,null),i,v.createElement(Bt.Divider,null),r)},this.textareaContent=e=>v.createElement(Mh,{assessment:this.props.assessment,path:e,processResults:Lh,updateAssessment:this.props.updateAssessment,useRawValue:!0}),this.globalValueTextareaContent=e=>{const t=this.props.pathToLibrary.concat(["globals",e,2]);return v.createElement(Mh,{assessment:this.props.assessment,path:t,updateAssessment:this.handleGlobalValueUpdate(e),useRawValue:!0})},this.handleGlobalValueUpdate=e=>t=>{const s=Ph(this.props.pathToLibrary,this.props.assessment).globals[e];try{s[1]=jh(s[2]),this.props.updateAssessment(t)}catch(a){s[2]='"Invalid Expression"'}},this.handleSymbolDelete=e=>()=>{const t=this.props.assessment;Ph(this.props.pathToLibrary,t).external.symbols.splice(e,1),this.props.updateAssessment(t)},this.handleNewSymbol=()=>{const e=this.props.assessment;Ph(this.props.pathToLibrary,e).external.symbols.push("new_symbol"),this.props.updateAssessment(e)},this.handleGlobalDelete=e=>()=>{const t=this.props.assessment;Ph(this.props.pathToLibrary,t).globals.splice(e,1),this.props.updateAssessment(t)},this.handleNewGlobal=()=>{const e=this.props.assessment;Ph(this.props.pathToLibrary,e).globals.push(["new_global",null,"null"]),this.props.updateAssessment(e)},this.handleChapterSelect=(e,t)=>{const s=this.props.assessment;Ph(this.props.pathToLibrary,s).chapter=e.chapter,this.props.updateAssessment(s)},this.handleExternalSelect=(e,t)=>{const s=this.props.assessment,a=Ph(this.props.pathToLibrary,s);a.external.name=e.name,a.external.symbols=JSON.parse(JSON.stringify(Ct.get(e.name))),this.props.updateAssessment(s)},this.handleSwitchDeployment=()=>{const e=this.props.assessment;if(this.isEmptyLibrary()){let t=Ph(this.props.pathToCopy||["globalDeployment"],e);-1===t.chapter&&(t=e.globalDeployment),t=JSON.parse(JSON.stringify(t)),xh(this.props.pathToLibrary,t,e)}else xh(this.props.pathToLibrary,{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},e);this.props.updateAssessment(e)},this.isEmptyLibrary=(e=this.props.pathToLibrary)=>-1===Ph(e.concat(["chapter"]),this.props.assessment)}render(){return this.props.isOptionalDeployment?v.createElement("div",null,v.createElement(Bt.Switch,{checked:!this.isEmptyLibrary(),label:"Enable "+this.props.label+" Deployment",onChange:this.handleSwitchDeployment}),this.isEmptyLibrary()?null:this.deploymentTab()):v.createElement("div",null,this.props.label+" Deployment",v.createElement("br",null),this.deploymentTab())}}const Lh=e=>"string"===typeof e?e.replace(/\s+/g,""):e,jh=e=>Function('"use strict";return ('+e+")")(),Bh=wt.map(e=>({chapter:e.chapter,variant:e.variant,displayName:It(e.chapter,e.variant)})),Gh=(e,t="default",s=((e,t)=>{}))=>v.createElement(Uh,{className:Bt.Classes.MINIMAL,items:Bh,onItemSelect:s,itemRenderer:Hh,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:It(e,t),rightIcon:Gt.a.DOUBLE_CARET_VERTICAL})),Uh=Zt.a.ofType(),Hh=(e,{handleClick:t,modifiers:s,query:a})=>v.createElement(Bt.MenuItem,{active:!1,key:e.chapter,onClick:t,text:e.displayName}),Vh=Array.from(Ct.entries()).map((e,t)=>({name:e[0],key:t,symbols:e[1]})),Fh=(e,t)=>v.createElement(qh,{className:Bt.Classes.MINIMAL,items:Vh,onItemSelect:t,itemRenderer:Xh,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:e,rightIcon:Gt.a.DOUBLE_CARET_VERTICAL})),qh=Zt.a.ofType(),Xh=(e,{handleClick:t,modifiers:s,query:a})=>v.createElement(Bt.MenuItem,{active:!1,key:e.key,onClick:t,text:e.name});class Wh extends v.Component{constructor(e){super(e),this.textareaContent=e=>v.createElement(Mh,{assessment:this.props.assessment,isNumber:!0,path:e,processResults:Nh(0),updateAssessment:this.props.updateAssessment}),this.gradingTab=()=>v.createElement("div",null,"Max Grade:",this.textareaContent(this.props.path.concat(["maxGrade"])),v.createElement("br",null),"Max Xp:",this.textareaContent(this.props.path.concat(["maxXp"])))}render(){return this.gradingTab()}}class zh extends v.Component{constructor(e){super(e),this.manageQuestionTab=e=>v.createElement("div",null,ss("Clone",Gt.a.DOCUMENT,this.confirmSave(this.makeQuestion(()=>Yh(this.props.assessment.questions[e]),e))),ss("Delete",Gt.a.REMOVE,this.confirmSave(this.deleteQuestion(e))),ss("Shift Up",Gt.a.CARET_UP,this.confirmSave(this.shiftQuestion(-1,e)),{},0===e),ss("Shift Down",Gt.a.CARET_DOWN,this.confirmSave(this.shiftQuestion(1,e)),{},e>=this.props.assessment.questions.length-1),v.createElement("br",null),ss("Insert Programming Question",Gt.a.FONT,this.confirmSave(this.makeQuestion(Qt,e))),ss("Insert MCQ Question",Gt.a.CONFIRM,this.confirmSave(this.makeQuestion(Jt,e)))),this.shiftQuestion=(e,t)=>()=>{const s=this.props.assessment,a=t+e;if(a>=0&&a<s.questions.length){const e=s.questions[t],n=s.questions;n[t]=n[a],n[a]=e,s.questions=n,this.props.updateAssessment(s),xs.push("/mission-control/-1/"+a.toString())}},this.makeQuestion=(e,t)=>()=>{const s=this.props.assessment;t+=1;const a=s.questions;a.splice(t,0,e()),s.questions=a,this.props.updateAssessment(s),xs.push("/mission-control/-1/"+t.toString())},this.deleteQuestion=e=>()=>{const t=this.props.assessment;let s=t.questions;s.length>1&&(s=s.slice(0,e).concat(s.slice(e+1))),t.questions=s,this.props.updateAssessment(t)},this.confirmSave=e=>()=>{this.props.hasUnsavedChanges?this.setState({showSaveOverlay:!0,modifyAssessment:e}):e()},this.confirmSaveOverlay=()=>v.createElement(Bt.Dialog,{className:"assessment-reset",icon:Gt.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showSaveOverlay,title:"Confirmation: Save unsaved changes?"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement(ps,{content:"Are you sure you want to save over your unsaved changes?"})),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement(Bt.ButtonGroup,null,ss("Cancel",null,()=>this.setState({showSaveOverlay:!1}),{minimal:!1}),ss("Confirm",null,()=>{this.state.modifyAssessment(),this.setState({showSaveOverlay:!1})},{minimal:!1,intent:Bt.Intent.DANGER})))),this.state={showSaveOverlay:!1,modifyAssessment:()=>{}}}render(){return v.createElement("div",null,this.confirmSaveOverlay(),this.props.assessment.questions.map((e,t)=>v.createElement("div",{key:t},"Question ",t+1,v.createElement("br",null),v.createElement(Bt.Button,{className:"mcq-option col-xs-12",minimal:!0},v.createElement(ps,{content:e.content.length>200?e.content.substring(0,300)+"...":e.content})),this.manageQuestionTab(t),v.createElement("br",null),v.createElement("br",null))))}}const Yh=e=>JSON.parse(JSON.stringify(e));class $h extends v.Component{constructor(e){super(e),this.mcqTab=()=>{const e=this.props.questionId,t=this.props.assessment.questions[e],s=t.choices.map((t,s)=>v.createElement("div",{key:s,className:"mcq-option col-xs-12"},"Option ",s,":",this.textareaContent(["questions",e,"choices",s,"content"]),v.createElement("br",null),"Hint:",this.textareaContent(["questions",e,"choices",s,"hint"]))),a=ss("Delete Option",Gt.a.REMOVE,this.delOption);return v.createElement("div",{className:"MCQChooser row"},v.createElement(Bt.Card,{className:"mcq-content-parent col-xs-12 middle-xs"},v.createElement("div",{className:"row mcq-options-parent between-xs"},s,"Solution:",this.textareaContent(["questions",e,"solution"],!0,[0,t.choices.length]),v.createElement("br",null),ss("Add Option",Gt.a.CONFIRM,this.addOption),t.choices.length>0?a:void 0)))},this.addOption=()=>{const e=this.props.assessment,t=this.props.questionId,s=e.questions[t],a=s.choices.concat([{content:"A",hint:null}]);s.choices=a,e.questions[t]=s,this.props.updateAssessment(e)},this.delOption=()=>{const e=this.props.assessment,t=this.props.questionId,s=e.questions[t],a=s.choices.slice(0,s.choices.length-1);s.choices=a,e.questions[t]=s,this.props.updateAssessment(e)},this.textareaContent=(e,t=!1,s=[0])=>t?v.createElement(Mh,{assessment:this.props.assessment,isNumber:!0,path:e,processResults:Nh(s[0],s[1]),updateAssessment:this.props.updateAssessment}):v.createElement(Mh,{assessment:this.props.assessment,path:e,updateAssessment:this.props.updateAssessment})}render(){return this.mcqTab()}}const Kh=Zt.a.ofType(),Qh=[{label:"Prepend",icon:Gt.a.CHEVRON_UP,id:"prepend"},{label:"Postpend",icon:Gt.a.CHEVRON_DOWN,id:"postpend"},{label:"Solution Template",icon:Gt.a.MANUAL,id:"solutionTemplate"},{label:"Suggested Answer",icon:Gt.a.TICK,id:"answer"}];class Jh extends v.Component{constructor(e){super(e),this.programmingTab=()=>{const e=["questions",this.props.questionId].concat(this.state.activeEditor.id),t=ss("Copy from Editor",Gt.a.IMPORT,this.handleCopyFromEditor(e)),s=ss("Copy to Editor",Gt.a.EXPORT,this.handleCopyToEditor(e)),a=v.createElement("div",null,t,s,v.createElement(Bt.Divider,null),this.editor(e)),n=(e,{handleClick:t})=>v.createElement(Bt.MenuItem,{active:!1,key:e.id,onClick:t,text:e.label,icon:e.icon});return v.createElement("div",{className:"side-content"},v.createElement(Bt.Card,null,(i=this.state.activeEditor,r=this.handleChangeActiveEditor,v.createElement(Kh,{className:Bt.Classes.MINIMAL,items:Qh,itemRenderer:n,onItemSelect:r,filterable:!1},v.createElement(Bt.Button,{className:Bt.Classes.MINIMAL,text:i.label,icon:Gt.a.EDIT,rightIcon:Gt.a.DOUBLE_CARET_VERTICAL}))),v.createElement(Bt.Divider,null),v.createElement("div",{className:"side-content-text"},a)));var i,r},this.editor=e=>{const t=this.state.templateFocused?this.state.templateValue:Ph(e,this.props.assessment);return v.createElement("div",{onClick:this.focusEditor(e),onBlur:this.unFocusEditor(e)},v.createElement(Fs.a,{className:"react-ace",editorProps:{$blockScrolling:1/0},fontSize:14,highlightActiveLine:!1,mode:"javascript",onChange:this.handleTemplateChange,theme:"source",value:t,width:"100%"}))},this.handleChangeActiveEditor=e=>{this.setState({activeEditor:e})},this.handleTemplateChange=e=>{this.setState({templateValue:e})},this.focusEditor=e=>t=>{this.state.templateFocused||this.setState({templateValue:Ph(e,this.props.assessment),templateFocused:!0})},this.unFocusEditor=e=>t=>{if(this.state.templateFocused){if(Ph(e,this.props.assessment)!==this.state.templateValue){const t=this.props.assessment;xh(e,this.state.templateValue,t),this.props.updateAssessment(t)}if("prepend"===this.state.activeEditor.id){const e=this.state.templateValue;this.props.handleUpdateWorkspace({editorPrepend:e})}else if("postpend"===this.state.activeEditor.id){const e=this.state.templateValue;this.props.handleUpdateWorkspace({editorPostpend:e})}this.setState({templateValue:"",templateFocused:!1})}},this.handleCopyFromEditor=e=>()=>{const t=this.props.assessment;xh(e,this.props.editorValue,t),this.props.updateAssessment(t)},this.handleCopyToEditor=e=>()=>{const t=Ph(e,this.props.assessment);this.props.handleEditorValueChange(t)},this.state={activeEditor:Qh[0],templateValue:"",templateFocused:!1}}render(){return this.programmingTab()}}class Zh extends v.Component{constructor(e){super(e),this.formatedQuestionId=()=>{let e=this.props.questionId;return e<0?e=0:e>=this.state.assessment.questions.length&&(e=this.state.assessment.questions.length-1),e},this.resetTemplateOverlay=()=>v.createElement(Bt.Dialog,{className:"assessment-reset",icon:Gt.a.ERROR,isCloseButtonShown:!0,isOpen:this.state.showResetTemplateOverlay,title:"Confirmation: Reset editor?"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement(ps,{content:"Are you sure you want to reset to your last save?"})),v.createElement("div",{className:Bt.Classes.DIALOG_FOOTER},v.createElement(Bt.ButtonGroup,null,ss("Cancel",null,()=>this.setState({showResetTemplateOverlay:!1}),{minimal:!1}),ss("Confirm",null,()=>{const e=oh();this.setState({assessment:e,hasUnsavedChanges:!1,showResetTemplateOverlay:!1,originalMaxGrade:this.getMaxMarks("maxGrade"),originalMaxXp:this.getMaxMarks("maxXp")}),this.handleRefreshLibrary(),this.resetWorkspaceValues()},{minimal:!1,intent:Bt.Intent.DANGER})))),this.handleRefreshLibrary=e=>{const t=this.state.assessment.questions[this.formatedQuestionId()];if(e||(e=-1===t.library.chapter?this.state.assessment.globalDeployment:t.library),e&&e.globals.length>0){const t=e.globals.map(e=>e[0]),s=e.external.symbols.concat(t);e={...e,external:{name:e.external.name,symbols:ep(s)}}}this.props.handleClearContext(e)},this.resetWorkspaceValues=()=>{const e=this.state.assessment.questions[this.formatedQuestionId()];let t,s="",a="";e.type===$t.programming?(t=e.editorValue?e.editorValue:e.solutionTemplate,s=e.prepend,a=e.postpend):t="//If you see this, this is a bug. Please report bug.",this.props.handleResetWorkspace({editorPrepend:s,editorValue:t,editorPostpend:a}),this.props.handleEditorValueChange(t)},this.handleTestcaseEval=e=>{const t=[e];this.props.handleUpdateWorkspace({editorTestcases:t}),this.props.handleTestcaseEval(0)},this.handleSave=()=>{const e=this.state.assessment;e.questions[this.formatedQuestionId()].editorValue=this.props.editorValue,this.setState({assessment:e,hasUnsavedChanges:!1}),ch(e),this.handleSaveGradeAndXp()},this.handleSaveGradeAndXp=()=>{const e=this.getMaxMarks("maxGrade"),t=e-this.state.originalMaxGrade,s=this.getMaxMarks("maxXp"),a=s-this.state.originalMaxXp;if(0!==t||0!==a){const n=this.props.assessmentOverview;0!==t&&(n.maxGrade=e),0!==a&&(n.maxXp=s),this.setState({originalMaxGrade:e,originalMaxXp:s}),this.props.updateAssessmentOverview(n),dh(n)}},this.getMaxMarks=e=>{let t=0;const s=this.state.assessment.questions;for(const a of s)t+=a[e];return t},this.updateEditAssessmentState=e=>{this.setState({assessment:e,hasUnsavedChanges:!0})},this.updateAndSaveAssessment=e=>{this.setState({assessment:e}),this.handleRefreshLibrary(),this.handleSave(),this.resetWorkspaceValues()},this.handleActiveTabChange=e=>{this.setState({activeTab:e})},this.toggleEditingMode=()=>{const e="question"===this.state.editingMode?"global":"question";this.setState({editingMode:e})},this.sideContentProps=(e,t)=>{const s=this.state.assessment;let a;if("question"===this.state.editingMode){const e=this.state.assessment.questions[this.props.questionId].type,n="mcq"===e?v.createElement($h,{assessment:s,questionId:t,updateAssessment:this.updateEditAssessmentState}):v.createElement(Jh,{assessment:s,questionId:t,updateAssessment:this.updateEditAssessmentState,editorValue:this.props.editorValue,handleEditorValueChange:this.props.handleEditorValueChange,handleUpdateWorkspace:this.props.handleUpdateWorkspace});a=[{label:"Task "+(t+1),iconName:Gt.a.NINJA,body:v.createElement(Rh,{assessment:s,path:["questions",t,"content"],updateAssessment:this.updateEditAssessmentState}),id:T.editorQuestionOverview,toSpawn:()=>!0},{label:"Question Template",iconName:Gt.a.DOCUMENT,body:n,id:T.editorQuestionTemplate,toSpawn:()=>!0},{label:"Manage Local Deployment",iconName:Gt.a.HOME,body:v.createElement(Dh,{assessment:s,label:"Question Specific",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["questions",t,"library"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorLocalDeployment,toSpawn:()=>!0},{label:"Manage Local Grader Deployment",iconName:Gt.a.CONFIRM,body:v.createElement(Dh,{assessment:s,label:"Question Specific Grader",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["questions",t,"graderLibrary"],pathToCopy:["questions",t,"library"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorLocalGraderDeployment,toSpawn:()=>!0},{label:"Grading",iconName:Gt.a.TICK,body:v.createElement(Wh,{assessment:s,path:["questions",t],updateAssessment:this.updateEditAssessmentState}),id:T.editorGrading,toSpawn:()=>!0}],"programming"===e&&a.push({label:"Autograder",iconName:Gt.a.AIRPLANE,body:v.createElement(_h,{assessment:s,questionId:t,handleTestcaseEval:this.handleTestcaseEval,updateAssessment:this.updateEditAssessmentState}),id:T.editorAutograder,toSpawn:()=>!0});s.globalDeployment.external.symbols.includes("get_matrix")&&a.push({label:"Tone Matrix",iconName:Gt.a.GRID_VIEW,body:v.createElement(Os,null),id:T.toneMatrix,toSpawn:()=>!0})}else a=[{label:s.category+" Briefing",iconName:Gt.a.BRIEFCASE,body:v.createElement(Rh,{assessment:s,path:["longSummary"],updateAssessment:this.updateEditAssessmentState}),id:T.editorBriefing,toSpawn:()=>!0},{label:"Manage Question",iconName:Gt.a.WRENCH,body:v.createElement(zh,{assessment:s,hasUnsavedChanges:this.state.hasUnsavedChanges,questionId:t,updateAssessment:this.updateAndSaveAssessment}),id:T.editorManageQuestion,toSpawn:()=>!0},{label:"Manage Global Deployment",iconName:Gt.a.GLOBE,body:v.createElement(Dh,{assessment:s,label:"Global",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["globalDeployment"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!1}),id:T.editorGlobalDeployment,toSpawn:()=>!0},{label:"Manage Global Grader Deployment",iconName:Gt.a.CONFIRM,body:v.createElement(Dh,{assessment:s,label:"Global Grader",handleRefreshLibrary:this.handleRefreshLibrary,pathToLibrary:["graderDeployment"],updateAssessment:this.updateEditAssessmentState,isOptionalDeployment:!0}),id:T.editorGlobalGraderDeployment,toSpawn:()=>!0}];return{handleActiveTabChange:this.handleActiveTabChange,tabs:a}},this.controlBarProps=e=>{const t="/mission-control/"+this.state.assessment.id.toString(),s=[e+1,this.state.assessment.questions.length],a=v.createElement(as,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),n=v.createElement(ns,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),i=v.createElement(rs,{onClickNext:()=>xs.push(t+"/"+(e+1).toString()),onClickReturn:()=>xs.push("/mission-control"),questionProgress:s,key:"next_question"}),r=v.createElement(os,{onClick:()=>xs.push(t+"/"+(e-1).toString()),questionProgress:s,key:"previous_question"}),o=v.createElement(ls,{questionProgress:s,key:"question_view"}),l=v.createElement(cs,{onClick:()=>{this.setState(e=>({...e,showResetTemplateOverlay:e.hasUnsavedChanges}))},key:"reset_template"});return{editorButtons:[v.createElement(ds,{handleEditorEval:this.props.handleEditorEval,key:"run"}),v.createElement(us,{hasUnsavedChanges:this.state.hasUnsavedChanges,onClickSave:this.handleSave,key:"save"}),l],flowButtons:[r,o,i],replButtons:[n,a,v.createElement(kh,{editingMode:this.state.editingMode,toggleEditMode:this.toggleEditingMode,key:"toggle_edit_mode"})]}},this.state={assessment:oh(),activeTab:T.editorQuestionOverview,editingMode:"question",hasUnsavedChanges:!1,showResetTemplateOverlay:!1,originalMaxGrade:0,originalMaxXp:0}}componentDidMount(){this.state.assessment&&(this.resetWorkspaceValues(),this.setState({originalMaxGrade:this.getMaxMarks("maxGrade"),originalMaxXp:this.getMaxMarks("maxXp")}))}componentDidUpdate(){this.checkWorkspaceReset(this.props)}render(){if(null===this.state.assessment||0===this.state.assessment.questions.length)return v.createElement(Bt.NonIdealState,{className:qt()("WorkspaceParent",Bt.Classes.DARK),description:"Getting mission ready...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_LARGE})});const e=this.formatedQuestionId(),t=this.state.assessment.questions[e],s={controlBarProps:this.controlBarProps(e),editorProps:t.type===$t.programming?{editorSessionId:"",editorValue:this.props.editorValue||t.editorValue||t.solutionTemplate,handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints,handleUpdateHasUnsavedChanges:this.props.handleUpdateHasUnsavedChanges,handlePromptAutocomplete:this.props.handlePromptAutocomplete,isEditorAutorun:!1}:void 0,editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,hasUnsavedChanges:this.state.hasUnsavedChanges,mcqProps:{mcq:t,handleMCQSubmit:t=>this.props.handleSave(this.state.assessment.questions[e].id,t)},sideContentHeight:this.props.sideContentHeight,sideContentProps:this.sideContentProps(this.props,e),replProps:{handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange,output:this.props.output,replValue:this.props.replValue}};return v.createElement("div",{className:qt()("WorkspaceParent",Bt.Classes.DARK)},this.resetTemplateOverlay(),v.createElement(fa,s))}checkWorkspaceReset(e){if(void 0===this.state.assessment)return;const t=this.formatedQuestionId();-1===this.props.storedAssessmentId&&this.props.storedQuestionId===t||(this.resetWorkspaceValues(),this.props.handleUpdateCurrentAssessmentId(-1,t),this.props.handleUpdateHasUnsavedChanges(!1),this.state.hasUnsavedChanges&&this.setState({assessment:oh(),hasUnsavedChanges:!1}),this.handleRefreshLibrary())}}function ep(e){const t={};return e.filter(e=>!t.hasOwnProperty(e)&&(t[e]=!0))}var tp=Zh;var sp=Object(C.c)((e,t)=>({editorValue:e.workspaces.assessment.editorValue,editorHeight:e.workspaces.assessment.editorHeight,editorWidth:e.workspaces.assessment.editorWidth,breakpoints:e.workspaces.assessment.breakpoints,highlightedLines:e.workspaces.assessment.highlightedLines,hasUnsavedChanges:e.workspaces.assessment.hasUnsavedChanges,isRunning:e.workspaces.assessment.isRunning,isDebugging:e.workspaces.assessment.isDebugging,enableDebugging:e.workspaces.assessment.enableDebugging,newCursorPosition:e.workspaces.assessment.newCursorPosition,output:e.workspaces.assessment.output,replValue:e.workspaces.assessment.replValue,sideContentHeight:e.workspaces.assessment.sideContentHeight,storedAssessmentId:e.workspaces.assessment.currentAssessment,storedQuestionId:e.workspaces.assessment.currentQuestion}),e=>Object(O.b)({handleBrowseHistoryDown:()=>I("assessment"),handleBrowseHistoryUp:()=>k("assessment"),handleChapterSelect:(e,t)=>_(e,"default","assessment"),handleClearContext:e=>B(e,"assessment"),handleDeclarationNavigate:e=>Z("assessment",e),handleEditorEval:()=>q("assessment"),handleEditorValueChange:e=>z(e,"assessment"),handleEditorHeightChange:e=>x(e,"assessment"),handleEditorWidthChange:e=>N(e.toString(),"assessment"),handleEditorUpdateBreakpoints:e=>Y(e,"assessment"),handleInterruptEval:()=>at("assessment"),handleReplEval:()=>X("assessment"),handleReplOutputClear:()=>U("assessment"),handleReplValueChange:e=>K(e,"assessment"),handleResetWorkspace:e=>te("assessment",e),handleUpdateWorkspace:e=>se("assessment",e),handleSave:we,handleSideContentHeightChange:e=>M(e,"assessment"),handleTestcaseEval:e=>W("assessment",e),handleUpdateHasUnsavedChanges:e=>re("assessment",e),handleUpdateCurrentAssessmentId:ne,handleDebuggerPause:()=>it("assessment"),handleDebuggerResume:()=>ot("assessment"),handleDebuggerReset:()=>lt("assessment"),handlePromptAutocomplete:(e,t,s)=>de("assessment",e,t,s)},e))(tp);class ap extends v.Component{constructor(e){super(e),this.fileReader=void 0,this.handleFileRead=e=>t=>{if(!this.fileReader)return;const s=this.fileReader.result;s&&Object(ih.parseString)(s,(t,s)=>{console.dir(e);try{const t=(e=>{const t=hh(e);return[uh(e,t[1],t[2]),t[0]]})(s);t[0].fileName=e.name.slice(0,-4),dh(t[0]),this.props.updateEditingOverview(t[0]),ch(t[1]),this.props.newAssessment(t[1]),this.setState({fileInputText:"Success!"})}catch(t){console.log(t),this.setState({fileInputText:"Invalid XML!"})}})},this.handleChangeFile=e=>{const t=e.target.files;e.target.files&&(this.fileReader=new FileReader,this.fileReader.onloadend=this.handleFileRead(t[0]),this.fileReader.readAsText(t[0]))},this.makeMission=()=>{dh(Kt()),this.props.updateEditingOverview(Kt()),ch({category:"Mission",globalDeployment:{chapter:1,external:{name:"NONE",symbols:[]},globals:[]},graderDeployment:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},id:-1,longSummary:"Insert mission briefing here",missionPDF:"www.google.com",questions:[{autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],title:"Insert title here"}),this.props.newAssessment({category:"Mission",globalDeployment:{chapter:1,external:{name:"NONE",symbols:[]},globals:[]},graderDeployment:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},id:-1,longSummary:"Insert mission briefing here",missionPDF:"www.google.com",questions:[{autogradingResults:[],answer:"// [Marking Scheme]\n// 1 mark for correct answer",roomId:"19422043",content:"Enter content here",id:0,library:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},graderLibrary:{chapter:-1,external:{name:"NONE",symbols:[]},globals:[]},prepend:"",solutionTemplate:"//This is a mock solution template",postpend:"",testcases:[],testcasesPrivate:[],type:"programming",xp:0,grade:0,maxGrade:0,maxXp:0}],title:"Insert title here"})},this.handleFileRead=this.handleFileRead.bind(this),this.handleChangeFile=this.handleChangeFile.bind(this),this.makeMission=this.makeMission.bind(this),this.state={fileInputText:"Import XML"}}componentDidMount(){const e=oh();e&&this.props.newAssessment(e)}render(){return v.createElement("div",null,v.createElement("div",null,"Please ensure that the xml uploaded is trustable."),v.createElement("div",null,v.createElement(Bt.FileInput,{text:this.state.fileInputText,inputProps:{accept:".xml"},onChange:this.handleChangeFile})),v.createElement("div",null,ss("Make New Mission",Gt.a.NEW_OBJECT,this.makeMission)))}}var np=ap;var ip=Object(C.c)((e,t)=>t,e=>Object(O.b)({newAssessment:Ne},e))(np);class rp extends v.Component{constructor(e){super(e),this.updateEditingOverview=e=>{this.setState({editingOverview:e})},this.state={editOverview:"",editingOverview:lh()}}render(){const e=js(this.props.match.params.assessmentId),t=js(this.props.match.params.questionId)||ze.defaultQuestionId;if(-1===e&&this.state.editingOverview){const s=this.state.editingOverview,a={assessmentId:e,questionId:t,assessmentOverview:s,updateAssessmentOverview:this.updateEditingOverview,notAttempted:s.status===Xt.not_attempted,closeDate:s.closeAt};return v.createElement("div",{className:"Academy"},v.createElement(sp,a))}const s=this.state.editingOverview?v.createElement(fh,{overview:this.state.editingOverview,updateEditingOverview:this.updateEditingOverview,listingPath:"/mission-control"}):null,a=v.createElement(v.Fragment,null,v.createElement(ip,{updateEditingOverview:this.updateEditingOverview}),s);return v.createElement("div",{className:"Assessment Academy"},v.createElement(ka,{display:a,loadContentDispatch:this.props.handleAssessmentOverviewFetch}))}}var op=rp;var lp=Object(A.h)(Object(C.c)((e,t)=>({isStudent:!e.session.role||e.session.role===Ot.Student}),e=>Object(O.b)({handleAssessmentOverviewFetch:ye,handleSubmitAssessment:Te},e))(op));var cp=()=>v.createElement("div",{className:qt()("NotFound",Bt.Classes.DARK)},v.createElement(Bt.NonIdealState,{icon:Gt.a.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})),dp=s(226);function up(e){return v.createElement(Bt.Tooltip,{content:"Execution Time"},v.createElement(Bt.NumericInput,{leftIcon:Gt.a.TIME,style:{width:80},min:1e3,value:e.execTime,onValueChange:e.handleChangeExecTime}))}const hp={INACTIVE:Bt.Intent.NONE,SAVED:Bt.Intent.PRIMARY,DIRTY:Bt.Intent.WARNING},pp=e=>{const t=e.currentFile?e.isDirty?"DIRTY":"SAVED":"INACTIVE",s=ss(e.currentFile&&e.currentFile.name||"Google Drive",Gt.a.CLOUD,null,{intent:hp[t]}),a=ss("Open",Gt.a.DOCUMENT_OPEN,e.onClickOpen),n=ss("Save",Gt.a.FLOPPY_DISK,e.onClickSave,void 0,"INACTIVE"===t),i=ss("Save as",Gt.a.SEND_TO,e.onClickSaveAs),r=e.loggedInAs&&v.createElement(Bt.Tooltip,{content:"Logged in as "+e.loggedInAs},ss("Log out",Gt.a.LOG_OUT,e.onClickLogOut));return v.createElement(Bt.Popover,{autoFocus:!1,content:v.createElement("div",null,v.createElement(Bt.ButtonGroup,{large:!0},a,n,i,r)),onOpening:e.onPopoverOpening,popoverClassName:Bt.Classes.POPOVER_DISMISS},s)};var mp=s(315);class gp extends v.PureComponent{constructor(e){super(e),this.inviteInputElem=void 0,this.state={joinElemValue:""},this.handleChange=this.handleChange.bind(this),this.inviteInputElem=v.createRef(),this.selectInviteInputText=this.selectInviteInputText.bind(this)}render(){const e=v.createElement(Bt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},ss("Invite",Gt.a.GRAPH,()=>{if(""===this.props.editorSessionId){!function(e){const t=new XMLHttpRequest;t.onreadystatechange=()=>{if(t.readyState===zs.DONE&&t.status===Ys.OK){const s=JSON.parse(t.responseText).id;e(s)}},t.open("GET","https://"+We.shareDBServer+"gists/latest/",!0),t.send()}(e=>{this.props.handleSetEditorSessionId(e);const t=this.props.editorValue||"// Collaborative Editing Mode!";this.props.handleInitInvite(t)})}}),v.createElement(v.Fragment,null,v.createElement("input",{value:this.props.editorSessionId,readOnly:!0,ref:this.inviteInputElem}),v.createElement(mp,{text:""+this.props.editorSessionId},ss("",Gt.a.DUPLICATE,this.selectInviteInputText)))),t=v.createElement(Bt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},ss("Join",Gt.a.LOG_IN),v.createElement(v.Fragment,null,v.createElement("form",{onSubmit:e=>{$s(this.state.joinElemValue,()=>this.props.handleSetEditorSessionId(this.state.joinElemValue),()=>{this.props.handleInvalidEditorSessionId(),this.props.handleSetEditorSessionId("")},()=>this.props.handleSetEditorSessionId("")),e.preventDefault()}},v.createElement("input",{type:"text",value:this.state.joinElemValue,onChange:this.handleChange}),v.createElement("span",{className:Bt.Classes.POPOVER_DISMISS},ss("",Gt.a.KEY_ENTER,null,{type:"submit"}))))),s=ss("Leave",Gt.a.FEED,()=>{this.props.handleSetEditorSessionId(""),this.setState({joinElemValue:""})});return v.createElement(Bt.Popover,{content:v.createElement(Bt.Menu,{large:!0},e,""===this.props.editorSessionId?t:s)},ss("Session",Gt.a.SOCIAL_MEDIA,void 0,{iconColor:""===this.props.editorSessionId?void 0:0===this.props.websocketStatus?Bt.Colors.RED3:Bt.Colors.GREEN3}))}selectInviteInputText(){null!==this.inviteInputElem.current&&(this.inviteInputElem.current.focus(),this.inviteInputElem.current.select())}handleChange(e){this.setState({joinElemValue:e.target.value})}}class yp extends v.PureComponent{constructor(e){super(e),this.shareInputElem=void 0,this.selectShareInputText=this.selectShareInputText.bind(this),this.handleChange=this.handleChange.bind(this),this.toggleButton=this.toggleButton.bind(this),this.shareInputElem=v.createRef(),this.state={keyword:"",isLoading:!1}}render(){let e="";const{urlShortener:t}=ze;return t&&(e=t.split("/").slice(0,-1).join("/")+"/"),v.createElement(Bt.Popover,{popoverClassName:"Popover-share",inheritDarkTheme:!1},v.createElement(Bt.Tooltip,{content:"Get shareable link"},ss("Share",Gt.a.SHARE,()=>this.toggleButton())),void 0===this.props.queryString?v.createElement(Bt.Text,null,"Share your programs! Type something into the editor (left), then click on this button again."):v.createElement(v.Fragment,null,this.props.shortURL&&"ERROR"!==this.props.shortURL?v.createElement("div",{key:this.props.shortURL},v.createElement("input",{defaultValue:this.props.shortURL,readOnly:!0,ref:this.shareInputElem}),v.createElement(Bt.Tooltip,{content:"Copy link to clipboard"},v.createElement(mp,{text:this.props.shortURL},ss("",Gt.a.DUPLICATE,this.selectShareInputText)))):this.state.isLoading&&"ERROR"!==this.props.shortURL?v.createElement("div",null,v.createElement(Bt.NonIdealState,{description:"Generating Shareable Link...",icon:v.createElement(Bt.Spinner,{size:Bt.Spinner.SIZE_SMALL})})):v.createElement("div",null,e,"\xa0",v.createElement("input",{placeholder:"custom string (optional)",onChange:this.handleChange,style:{width:175}}),ss("Get Link",Gt.a.SHARE,()=>{this.props.handleShortenURL(this.state.keyword),this.setState({isLoading:!0})}))))}componentDidUpdate(e){this.props.shortURL!==e.shortURL&&this.setState({keyword:"",isLoading:!1})}toggleButton(){this.props.handleGenerateLz&&this.props.handleGenerateLz(),this.props.handleUpdateShortURL(""),this.setState({keyword:"",isLoading:!1})}handleChange(e){this.setState({keyword:e.currentTarget.value})}selectShareInputText(){null!==this.shareInputElem.current&&(this.shareInputElem.current.focus(),this.shareInputElem.current.select())}}class Ep extends v.Component{constructor(e){super(e),this.state={width:window._WIDTH,height:window._HEIGHT}}takePhotoA(){window.video.takePhotoA()}takePhotoB(){window.video.takePhotoB()}takePhotoC(){window.video.takePhotoC()}resetPhotoA(){window.resetPhotoA()}resetPhotoB(){window.resetPhotoB()}resetPhotoC(){window.resetPhotoC()}render(){return v.createElement("div",{className:"sa-video"},v.createElement("div",{className:"sa-video-element"},v.createElement("video",{id:"video",style:{position:"absolute"},autoPlay:!0,width:333,height:250}),v.createElement("canvas",{id:"canvas",style:{position:"relative",top:0,left:0},width:333,height:250})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-live-video-button",style:{height:20},icon:Gt.a.CAMERA,onClick:this.takePhotoA,text:"Take picture"})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-a",style:{height:30}})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-still-image-button",style:{height:20},icon:Gt.a.RESET,onClick:this.resetPhotoA,text:"Reset"}))),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-live-video-button",style:{height:20},icon:Gt.a.CAMERA,onClick:this.takePhotoB,text:"Take picture"})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-b",style:{height:20}})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-still-image-button",style:{height:20},icon:Gt.a.RESET,onClick:this.resetPhotoB,text:"Reset"}))),v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-live-video-button",style:{height:20},icon:Gt.a.CAMERA,onClick:this.takePhotoC,text:"Take picture"})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("canvas",{id:"canvas-capture-c",style:{height:20}})),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.Button,{className:"sa-still-image-button",style:{height:20},icon:Gt.a.RESET,onClick:this.resetPhotoC,text:"Reset"}))))}}var bp=Ep;const vp=()=>v.createElement("div",null,v.createElement("div",{id:"substituter-default-text",className:Bt.Classes.RUNNING_TEXT},"Welcome to the Stepper!",v.createElement("br",null),v.createElement("br",null),"On this tab, the REPL will be hidden from view, so do check that your code has no errors before running the stepper. You may use this tool by writing your program on the left, then dragging the slider above to see its evaluation.",v.createElement("br",null),v.createElement("br",null),"On even-numbered steps, the part of the program that will be evaluated next is highlighted in yellow. On odd-numbered steps, the result of the evaluation is highlighted in green.",v.createElement("br",null),v.createElement("br",null),v.createElement(Bt.Divider,null),"Some useful keyboard shortcuts:",v.createElement("br",null),v.createElement("br",null),ss("(Comma)",Gt.a.LESS_THAN),": Move to the first step",v.createElement("br",null),ss("(Period)",Gt.a.GREATER_THAN),": Move to the last step",v.createElement("br",null),v.createElement("br",null),"Note that the first and last step shortcuts are only active when the browser focus is on this panel (click on the slider or the text!).",v.createElement("br",null),v.createElement("br",null),"When the focus is on the slider, the arrow keys may also be used to move a single step.")),Sp={FIRST_STEP:",",LAST_STEP:"."},fp=e=>v.createElement(Bt.Card,null,v.createElement(Bt.Pre,{className:"resultOutput"},e.content));class Cp extends v.Component{constructor(e){super(e),this.getDiffMarkers=e=>{const t=e<=this.props.content.length?e-1:0,s=this.props.content[t],a=s.code,n=s.redex.split("\n"),i=[];if(n.length>0){const t=a.split("$");let s=t[0],r=s.split("\n"),o=r.length-1,l=r[o].length;for(let a=0;a<t.length-1;a++){const c=o+n.length-1,d=1===n.length?l+n[n.length-1].length:n[n.length-1].length;i.push({startRow:o,startCol:l,endRow:c,endCol:d,className:e%2===0?"beforeMarker":"afterMarker",type:"background"}),s=s+n+t[a+1],r=s.split("\n"),o=r.length-1,l=r[o].length}}return i},this.sliderShift=e=>{this.setState(t=>({value:e}))},this.stepFirst=()=>{this.sliderShift(1)},this.stepLast=e=>()=>{this.sliderShift(e)},this.state={value:1},Object(Hs.HighlightRulesSelector)(2),Object(Hs.ModeSelector)(2)}render(){const e=this.props.content.length,t=0!==e,s=t?{FIRST_STEP:this.stepFirst,LAST_STEP:this.stepLast(e)}:{FIRST_STEP:()=>{},LAST_STEP:()=>{}};return v.createElement(qs.HotKeys,{keyMap:Sp,handlers:s},v.createElement("div",null,v.createElement("div",{className:"sa-substituter"},v.createElement(Bt.Slider,{disabled:!t,min:1,max:this.props.content.length,onChange:this.sliderShift,value:this.state.value<=e?this.state.value:1}),t?v.createElement(Fs.a,{className:"react-ace",mode:"source2defaultNONE",theme:"source",fontSize:17,highlightActiveLine:!1,wrapEnabled:!0,height:"unset",width:"100%",showGutter:!1,readOnly:!0,maxLines:1/0,value:this.getText(this.state.value),markers:this.getDiffMarkers(this.state.value),setOptions:{fontFamily:"'Inconsolata', 'Consolas', monospace"}}):v.createElement(vp,null),t?v.createElement(fp,{content:this.state.value<=e?this.props.content[this.state.value-1].explanation:this.props.content[0].explanation}):null)))}getText(e){const t=e<=this.props.content.length?e-1:0,s=this.props.content[t],a=s.code,n=s.redex,i=s.code.split("$");if(i.length>1){let e=i[0];for(let t=1;t<i.length;t++)e=e+n+i[t];return e}return a}}var Ap=Cp;class Op extends v.Component{constructor(e){super(e),this.$video=null,this.$canvas=null,this.swapModes=e=>()=>{switch(e){case"video":this.setState(e=>({...e,mode:"still"}),this.handleSnapPicture);break;case"still":this.setState(e=>({...e,mode:"video"}),this.handleStartVideo)}},this.state={width:window._WIDTH,height:window._HEIGHT,mode:"video"},this.handleWidthChange=this.handleWidthChange.bind(this),this.handleHeightChange=this.handleHeightChange.bind(this)}componentDidMount(){this.$video&&this.$canvas&&window.VD.init(this.$video,this.$canvas)}componentWillUnmount(){window.VD.deinit()}handleStartVideo(){window.VD.handleStartVideo()}handleSnapPicture(){window.VD.handleSnapPicture()}handleCloseVideo(){window.VD.handleCloseVideo()}handleWidthChange(e){e>0&&(this.setState({width:e,height:this.state.height}),this.handleUpdateDimensions(e,this.state.height))}handleHeightChange(e){e>0&&(this.setState({width:this.state.width,height:e}),this.handleUpdateDimensions(this.state.width,e))}handleUpdateDimensions(e,t){window.VD.handleUpdateDimensions(e,t)}render(){const e="video"===this.state.mode,t="still"===this.state.mode;return v.createElement("div",{className:"sa-video"},v.createElement("div",{className:"sa-video-header"},v.createElement("div",{className:"sa-video-header-element"},v.createElement(Bt.ButtonGroup,null,v.createElement(Bt.Button,{className:"sa-live-video-button",icon:Gt.a.VIDEO,active:e,onClick:this.swapModes(this.state.mode),text:"Live Video"}),v.createElement(Bt.Button,{className:"sa-still-image-button",icon:Gt.a.CAMERA,active:t,onClick:t?this.handleSnapPicture:this.swapModes(this.state.mode),text:"Still Image"}))),v.createElement(Bt.Divider,null),v.createElement("div",{className:"sa-video-header-element"},v.createElement("div",{className:"sa-video-header-numeric-input"},v.createElement(Bt.Tooltip,{content:"Change width"},v.createElement(Bt.NumericInput,{leftIcon:Gt.a.HORIZONTAL_DISTRIBUTION,style:{width:70},value:this.state.width,onValueChange:this.handleWidthChange,minorStepSize:1,stepSize:10,majorStepSize:100}))),v.createElement("div",{className:"sa-video-header-numeric-input"},v.createElement(Bt.Tooltip,{content:"Change height"},v.createElement(Bt.NumericInput,{leftIcon:Gt.a.VERTICAL_DISTRIBUTION,style:{width:70},value:this.state.height,onValueChange:this.handleHeightChange,minorStepSize:1,stepSize:10,majorStepSize:100}))))),v.createElement("div",{className:"sa-video-element"},v.createElement("video",{ref:e=>this.$video=e,style:{display:"none"},autoPlay:!0,width:window._WIDTH,height:window._HEIGHT}),v.createElement("canvas",{ref:e=>this.$canvas=e,width:window._WIDTH,height:window._HEIGHT})))}}var wp=Op;const Tp=`\nWelcome to the Source Academy playground!\n\nThe language [_Source_](${We.sourceDocs}) is the official language of the textbook [_Structure and\nInterpretation of Computer Programs, JavaScript Adaptation_](${We.textbook}). `,Ip=`\n\nIn the editor on the left, you can use the [_Ace keyboard shortcuts_](${We.aceHotkeys}) \nand also the [_Source Academy keyboard shortcuts_](${We.sourceHotkeys}).\n\n`,kp=e=>Tp+(e=>{switch(e){case"1 default":return`You have chosen the sublanguage [_Source \xa71_](${We.source_1}).`;case"1 wasm":return`You have chosen the sublanguage [_Source \xa71 WebAssembly_](${We.source_1_Wasm}).`;case"1 lazy":return`You have chosen the sublanguage [_Source \xa71 Lazy_](${We.source_1_Lazy}).`;case"2 default":return`You have chosen the sublanguage [_Source \xa72_](${We.source_2}).`;case"2 lazy":return`You have chosen the sublanguage [_Source \xa72 Lazy_](${We.source_2_Lazy}).`;case"3 default":return`You have chosen the sublanguage [_Source \xa73_](${We.source_3}).`;case"3 non-det":return`You have chosen the sublanguage [_Source \xa73 Non-Det_](${We.source_3_Nondet}).`;case"3 concurrent":return`You have chosen the sublanguage [_Source \xa73 Concurrent_](${We.source_3_Concurrent}).`;case"4 default":return`You have chosen the sublanguage [_Source \xa74_](${We.source_4}).`;case"4 gpu":return`You have chosen the sublanguage [_Source \xa74 GPU_](${We.source_4_Gpu}).`;default:return"You have chosen an invalid sublanguage. Please pick a sublanguage from the dropdown instead."}})(e)+Ip,Pp=(e,t)=>kp(`${e} ${t}`),xp={goGreen:"h u l k"},Np={label:"Data Visualizer",iconName:Gt.a.EYE_OPEN,body:v.createElement(Qd,null),id:T.dataVisualiser,toSpawn:()=>!0},Rp={label:"Video Display",iconName:Gt.a.MOBILE_VIDEO,body:v.createElement(wp,null),toSpawn:()=>!0},Mp={label:"Face API Display",iconName:Gt.a.MUGSHOT,body:v.createElement(bp,null),toSpawn:()=>!0},_p={label:"Inspector",iconName:Gt.a.SEARCH,body:v.createElement($d,null),id:T.inspector,toSpawn:()=>!0},Dp={label:"Env Visualizer",iconName:Gt.a.GLOBE,body:v.createElement(zd,null),id:T.envVisualiser,toSpawn:()=>!0};var Lp=e=>{const[t,s]=v.useState(new Date),[a,n]=v.useState(!1),[i,r]=v.useState(T.introduction),[o,l]=v.useState(!1),c=v.useMemo(()=>({goGreen:()=>n(!a)}),[a,n]),{handleEditorValueChange:d}=e,u=v.useCallback(e=>{s(new Date),d(e)},[d]),{handleUsingSubst:h,handleReplOutputClear:p,sourceChapter:m}=e,g=v.useCallback((e,t,s)=>{e!==t&&(m<=2&&e===T.substVisualizer&&h(!0),t!==T.substVisualizer||o||(p(),h(!1)),r(e))},[p,h,o,m]),y=e=>{const t=e[0];return t&&"result"===t.type&&t.value instanceof Array&&t.value[0]===Object(t.value[0])&&Object(dp.isStepperOutput)(t.value[0])?t.value:[]},E=v.useMemo(()=>v.createElement(qd,{handleDebuggerPause:e.handleDebuggerPause,handleDebuggerReset:e.handleDebuggerReset,handleDebuggerResume:e.handleDebuggerResume,handleEditorEval:e.handleEditorEval,handleInterruptEval:e.handleInterruptEval,handleToggleEditorAutorun:e.handleToggleEditorAutorun,isDebugging:e.isDebugging,isEditorAutorun:e.isEditorAutorun,isRunning:e.isRunning,key:"autorun"}),[e.handleDebuggerPause,e.handleDebuggerReset,e.handleDebuggerResume,e.handleEditorEval,e.handleInterruptEval,e.handleToggleEditorAutorun,e.isDebugging,e.isEditorAutorun,e.isRunning]),{handleChapterSelect:b}=e,S=v.useCallback(({chapter:e,variant:t},s)=>{(e<=2&&o||i===T.substVisualizer)&&h(!0),e>2&&(p(),h(!1)),b(e,t)},[p,h,o,b,i]),f=v.useMemo(()=>v.createElement(es,{handleChapterSelect:S,sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,key:"chapter"}),[S,e.sourceChapter,e.sourceVariant]),C=v.useMemo(()=>i===T.substVisualizer?null:v.createElement(as,{handleReplOutputClear:e.handleReplOutputClear,key:"clear_repl"}),[e.handleReplOutputClear,i]),A=v.useMemo(()=>i===T.substVisualizer?null:v.createElement(ns,{handleReplEval:e.handleReplEval,isRunning:e.isRunning,key:"eval_repl"}),[e.handleReplEval,e.isRunning,i]),{persistenceUser:O,persistenceFile:w,handlePersistenceUpdateFile:I}=e,k=w&&(!w.lastSaved||w.lastSaved<t),P=v.useMemo(()=>v.createElement(pp,{currentFile:w,loggedInAs:O,isDirty:k,key:"googledrive",onClickSaveAs:e.handlePersistenceSaveFile,onClickOpen:e.handlePersistenceOpenPicker,onClickSave:w?()=>I(w):void 0,onClickLogOut:e.handlePersistenceLogOut,onPopoverOpening:e.handlePersistenceInitialise}),[O,w,k,e.handlePersistenceSaveFile,e.handlePersistenceOpenPicker,e.handlePersistenceLogOut,e.handlePersistenceInitialise,I]),{handleChangeExecTime:x,execTime:N}=e,R=v.useMemo(()=>v.createElement(up,{execTime:N,handleChangeExecTime:e=>x(e),key:"execution_time"}),[N,x]),{handleExternalSelect:M,externalLibraryName:_}=e,D=v.useMemo(()=>v.createElement(Xd,{externalLibraryName:_,handleExternalSelect:({name:e},t)=>M(e),key:"external_library"}),[_,M]),L=v.useMemo(()=>v.createElement(gp,{editorSessionId:e.editorSessionId,editorValue:e.editorValue,handleInitInvite:e.handleInitInvite,handleInvalidEditorSessionId:e.handleInvalidEditorSessionId,handleSetEditorSessionId:e.handleSetEditorSessionId,websocketStatus:e.websocketStatus,key:"session"}),[e.editorSessionId,e.editorValue,e.handleInitInvite,e.handleInvalidEditorSessionId,e.handleSetEditorSessionId,e.websocketStatus]),j=v.useMemo(()=>v.createElement(yp,{handleGenerateLz:e.handleGenerateLz,handleShortenURL:e.handleShortenURL,handleUpdateShortURL:e.handleUpdateShortURL,queryString:e.queryString,shortURL:e.shortURL,key:"share"}),[e.handleGenerateLz,e.handleShortenURL,e.handleUpdateShortURL,e.queryString,e.shortURL]),B=v.useMemo(()=>({label:"Introduction",iconName:Gt.a.COMPASS,body:v.createElement(ps,{content:Pp(e.sourceChapter,e.sourceVariant),openLinksInNewWindow:!0}),id:T.introduction,toSpawn:()=>!0}),[e.sourceChapter,e.sourceVariant]),G=v.useMemo(()=>{const t=[B];return e.externalLibraryName!==gt.PIXNFLIX&&e.externalLibraryName!==gt.ALL||t.push(Rp),e.externalLibraryName===gt.MACHINELEARNING&&t.push(Mp),e.sourceChapter>=2&&t.push(Np),e.sourceChapter>=3&&"concurrent"!==e.sourceVariant&&"non-det"!==e.sourceVariant&&(t.push(_p),t.push(Dp)),e.sourceChapter<=2&&"wasm"!==e.sourceVariant&&t.push({label:"Stepper",iconName:Gt.a.FLOW_REVIEW,body:v.createElement(Ap,{content:y(e.output)}),id:T.substVisualizer,toSpawn:()=>!0}),t},[B,e.externalLibraryName,e.output,e.sourceChapter,e.sourceVariant]),U={controlBarProps:{editorButtons:[E,j,f,"concurrent"!==e.sourceVariant?D:null,L,P,R],replButtons:["concurrent"!==e.sourceVariant?A:null,C]},editorProps:{sourceChapter:e.sourceChapter,externalLibraryName:e.externalLibraryName,sourceVariant:e.sourceVariant,editorValue:e.editorValue,editorSessionId:e.editorSessionId,handleDeclarationNavigate:e.handleDeclarationNavigate,handleEditorEval:e.handleEditorEval,handleEditorValueChange:u,handleSendReplInputToOutput:e.handleSendReplInputToOutput,handlePromptAutocomplete:e.handlePromptAutocomplete,handleFinishInvite:e.handleFinishInvite,sharedbAceInitValue:e.sharedbAceInitValue,sharedbAceIsInviting:e.sharedbAceIsInviting,isEditorAutorun:e.isEditorAutorun,breakpoints:e.breakpoints,highlightedLines:e.highlightedLines,newCursorPosition:e.newCursorPosition,handleEditorUpdateBreakpoints:t=>{const s=t.filter(e=>!!e).length;s>0&&(l(!0),e.sourceChapter<=2&&e.handleUsingSubst(!0)),0===s&&(l(!1),i!==T.substVisualizer&&(e.handleReplOutputClear(),e.handleUsingSubst(!1))),e.handleEditorUpdateBreakpoints(t)},handleSetWebsocketStatus:e.handleSetWebsocketStatus},editorHeight:e.editorHeight,editorWidth:e.editorWidth,handleEditorHeightChange:e.handleEditorHeightChange,handleEditorWidthChange:e.handleEditorWidthChange,handleSideContentHeightChange:e.handleSideContentHeightChange,replProps:{sourceChapter:e.sourceChapter,sourceVariant:e.sourceVariant,output:e.output,replValue:e.replValue,handleBrowseHistoryDown:e.handleBrowseHistoryDown,handleBrowseHistoryUp:e.handleBrowseHistoryUp,handleReplEval:e.handleReplEval,handleReplValueChange:e.handleReplValueChange,hidden:i===T.substVisualizer,usingSubst:e.usingSubst},sideContentHeight:e.sideContentHeight,sideContentProps:{defaultSelectedTabId:i,handleActiveTabChange:e.handleActiveTabChange,onChange:g,tabs:G,workspaceLocation:"playground"},sideContentIsResizeable:i!==T.substVisualizer};return v.createElement(qs.HotKeys,{className:qt()("Playground",Bt.Classes.DARK,a?"GreenScreen":void 0),keyMap:xp,handlers:c},v.createElement(fa,U))};var jp=Object(A.h)(Object(C.c)(e=>({editorSessionId:e.workspaces.playground.editorSessionId,editorWidth:e.workspaces.playground.editorWidth,editorValue:e.workspaces.playground.editorValue,execTime:e.workspaces.playground.execTime,isEditorAutorun:e.workspaces.playground.isEditorAutorun,breakpoints:e.workspaces.playground.breakpoints,highlightedLines:e.workspaces.playground.highlightedLines,isRunning:e.workspaces.playground.isRunning,isDebugging:e.workspaces.playground.isDebugging,enableDebugging:e.workspaces.playground.enableDebugging,newCursorPosition:e.workspaces.playground.newCursorPosition,output:e.workspaces.playground.output,queryString:e.playground.queryString,shortURL:e.playground.shortURL,replValue:e.workspaces.playground.replValue,sharedbAceIsInviting:e.workspaces.playground.sharedbAceIsInviting,sharedbAceInitValue:e.workspaces.playground.sharedbAceInitValue,sideContentHeight:e.workspaces.playground.sideContentHeight,sourceChapter:e.workspaces.playground.context.chapter,sourceVariant:e.workspaces.playground.context.variant,websocketStatus:e.workspaces.playground.websocketStatus,externalLibraryName:e.workspaces.playground.externalLibrary,usingSubst:e.playground.usingSubst,persistenceUser:e.session.googleUser,persistenceFile:e.playground.persistenceFile}),e=>Object(O.b)({handleActiveTabChange:e=>j(e,"playground"),handleBrowseHistoryDown:()=>I("playground"),handleBrowseHistoryUp:()=>k("playground"),handleChangeExecTime:e=>R(e.toString(),"playground"),handleChapterSelect:(e,t)=>_(e,t,"playground"),handleDeclarationNavigate:e=>Z("playground",e),handleEditorEval:()=>q("playground"),handleEditorValueChange:e=>z(e,"playground"),handleEditorHeightChange:e=>x(e,"playground"),handleEditorWidthChange:e=>N(e.toString(),"playground"),handleEditorUpdateBreakpoints:e=>Y(e,"playground"),handleFinishInvite:()=>dr("playground"),handleGenerateLz:Or,handleShortenURL:e=>wr(e),handleUpdateShortURL:e=>Tr(e),handleInterruptEval:()=>at("playground"),handleInvalidEditorSessionId:()=>hr(),handleExternalSelect:e=>D(e,"playground"),handleInitInvite:e=>ur(e,"playground"),handleReplEval:()=>X("playground"),handleReplOutputClear:()=>U("playground"),handleReplValueChange:e=>K(e,"playground"),handleSetEditorSessionId:e=>pr("playground",e),handleSendReplInputToOutput:e=>Q(e,"playground"),handleSetWebsocketStatus:e=>mr("playground",e),handleSideContentHeightChange:e=>M(e,"playground"),handleToggleEditorAutorun:()=>L("playground"),handleUsingSubst:e=>Ir(e),handleDebuggerPause:()=>it("playground"),handleDebuggerResume:()=>ot("playground"),handleDebuggerReset:()=>lt("playground"),handleFetchChapter:oe,handlePromptAutocomplete:(e,t,s)=>de("playground",e,t,s),handlePersistenceOpenPicker:Sr,handlePersistenceSaveFile:Cr,handlePersistenceUpdateFile:fr,handlePersistenceInitialise:Ar,handlePersistenceLogOut:Se},e))(Lp));class Bp extends v.Component{componentDidUpdate(e){const{inputToApply:t}=this.props;if(t&&t!==e.inputToApply)switch(t.type){case"activeTabChange":this.props.handleActiveTabChange(t.data);break;case"chapterSelect":this.props.handleChapterSelect(t.data);break;case"externalLibrarySelect":this.props.handleExternalSelect(t.data)}}render(){const e=v.createElement(qd,{handleDebuggerPause:this.props.handleDebuggerPause,handleDebuggerReset:this.props.handleDebuggerReset,handleDebuggerResume:this.props.handleDebuggerResume,handleEditorEval:this.props.handleEditorEval,handleInterruptEval:this.props.handleInterruptEval,handleToggleEditorAutorun:this.props.handleToggleEditorAutorun,isDebugging:this.props.isDebugging,isEditorAutorun:this.props.isEditorAutorun,isRunning:this.props.isRunning,key:"autorun"}),t=v.createElement(es,{handleChapterSelect:({chapter:e},t)=>this.props.handleChapterSelect(e),sourceChapter:this.props.sourceChapter,sourceVariant:this.props.sourceVariant,key:"chapter"}),s=v.createElement(as,{handleReplOutputClear:this.props.handleReplOutputClear,key:"clear_repl"}),a=v.createElement(ns,{handleReplEval:this.props.handleReplEval,isRunning:this.props.isRunning,key:"eval_repl"}),n=v.createElement(Xd,{externalLibraryName:this.props.externalLibraryName,handleExternalSelect:({name:e},t)=>this.props.handleExternalSelect(e),key:"external_library"}),i={codeDeltasToApply:this.props.codeDeltasToApply,editorReadonly:this.props.editorReadonly,editorValue:this.props.editorValue,editorSessionId:"",handleDeclarationNavigate:this.props.handleDeclarationNavigate,handleEditorEval:this.props.handleEditorEval,handleEditorValueChange:this.props.handleEditorValueChange,isEditorAutorun:this.props.isEditorAutorun,inputToApply:this.props.inputToApply,isPlaying:this.props.playbackStatus===Ge.playing,breakpoints:this.props.breakpoints,highlightedLines:this.props.highlightedLines,newCursorPosition:this.props.newCursorPosition,handleEditorUpdateBreakpoints:this.props.handleEditorUpdateBreakpoints},r={controlBarProps:{editorButtons:[e,t,n],replButtons:[a,s]},customEditor:v.createElement(su,i),editorHeight:this.props.editorHeight,editorWidth:this.props.editorWidth,handleEditorHeightChange:this.props.handleEditorHeightChange,handleEditorWidthChange:this.props.handleEditorWidthChange,handleSideContentHeightChange:this.props.handleSideContentHeightChange,replProps:{output:this.props.output,replValue:this.props.replValue,handleBrowseHistoryDown:this.props.handleBrowseHistoryDown,handleBrowseHistoryUp:this.props.handleBrowseHistoryUp,handleReplEval:this.props.handleReplEval,handleReplValueChange:this.props.handleReplValueChange},sideContentHeight:this.props.sideContentHeight,sideContentProps:{handleActiveTabChange:this.props.handleActiveTabChange,selectedTabId:this.props.sideContentActiveTab,tabs:[{label:"Sourcecast Table",iconName:Gt.a.COMPASS,body:v.createElement("div",null,v.createElement("span",{className:"Multi-line"},v.createElement(Bt.Pre,null,this.props.title?"Title: "+this.props.title+"\nDescription: "+this.props.description:Gp)),v.createElement(lu,{handleFetchSourcecastIndex:this.props.handleFetchSourcecastIndex,handleSetSourcecastData:this.props.handleSetSourcecastData,sourcecastIndex:this.props.sourcecastIndex})),id:T.introduction,toSpawn:()=>!0},Up,Hp,Vp],workspaceLocation:"sourcecast"}},o={handleEditorValueChange:this.props.handleEditorValueChange,handlePromptAutocomplete:this.props.handlePromptAutocomplete,handleSetCurrentPlayerTime:this.props.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:this.props.handleSetCodeDeltasToApply,handleSetEditorReadonly:this.props.handleSetEditorReadonly,handleSetInputToApply:this.props.handleSetInputToApply,handleSetSourcecastDuration:this.props.handleSetSourcecastDuration,handleSetSourcecastStatus:this.props.handleSetSourcecastStatus,audioUrl:this.props.audioUrl,currentPlayerTime:this.props.currentPlayerTime,duration:this.props.playbackDuration,playbackData:this.props.playbackData,playbackStatus:this.props.playbackStatus,handleChapterSelect:this.props.handleChapterSelect,handleExternalSelect:this.props.handleExternalSelect};return v.createElement("div",{className:qt()("Sourcecast",Bt.Classes.DARK)},v.createElement(Zd,o),v.createElement(fa,r))}}const Gp="Welcome to Sourcecast!",Up={label:"Data Visualizer",iconName:Gt.a.EYE_OPEN,body:v.createElement(Qd,null),id:T.dataVisualiser,toSpawn:()=>!0},Hp={label:"Inspector",iconName:Gt.a.SEARCH,body:v.createElement($d,null),id:T.inspector,toSpawn:()=>!0},Vp={label:"Env Visualizer",iconName:Gt.a.GLOBE,body:v.createElement(zd,null),id:T.envVisualiser,toSpawn:()=>!0};var Fp=Bp;var qp=Object(C.c)(e=>({audioUrl:e.workspaces.sourcecast.audioUrl,currentPlayerTime:e.workspaces.sourcecast.currentPlayerTime,codeDeltasToApply:e.workspaces.sourcecast.codeDeltasToApply,title:e.workspaces.sourcecast.title,description:e.workspaces.sourcecast.description,editorReadonly:e.workspaces.sourcecast.editorReadonly,editorWidth:e.workspaces.sourcecast.editorWidth,editorValue:e.workspaces.sourcecast.editorValue,externalLibraryName:e.workspaces.sourcecast.externalLibrary,isEditorAutorun:e.workspaces.sourcecast.isEditorAutorun,inputToApply:e.workspaces.sourcecast.inputToApply,breakpoints:e.workspaces.sourcecast.breakpoints,highlightedLines:e.workspaces.sourcecast.highlightedLines,isRunning:e.workspaces.sourcecast.isRunning,isDebugging:e.workspaces.sourcecast.isDebugging,enableDebugging:e.workspaces.sourcecast.enableDebugging,newCursorPosition:e.workspaces.sourcecast.newCursorPosition,output:e.workspaces.sourcecast.output,playbackDuration:e.workspaces.sourcecast.playbackDuration,playbackData:e.workspaces.sourcecast.playbackData,playbackStatus:e.workspaces.sourcecast.playbackStatus,replValue:e.workspaces.sourcecast.replValue,sideContentActiveTab:e.workspaces.sourcecast.sideContentActiveTab,sideContentHeight:e.workspaces.sourcecast.sideContentHeight,sourcecastIndex:e.workspaces.sourcecast.sourcecastIndex,sourceChapter:e.workspaces.sourcecast.context.chapter,sourceVariant:e.workspaces.sourcecast.context.variant}),e=>Object(O.b)({handleActiveTabChange:e=>j(e,"sourcecast"),handleBrowseHistoryDown:()=>I("sourcecast"),handleBrowseHistoryUp:()=>k("sourcecast"),handleChapterSelect:e=>_(e,"default","sourcecast"),handleDeclarationNavigate:e=>Z("sourcecast",e),handleEditorEval:()=>q("sourcecast"),handleEditorValueChange:e=>z(e,"sourcecast"),handleEditorHeightChange:e=>x(e,"sourcecast"),handleEditorWidthChange:e=>N(e.toString(),"sourcecast"),handleEditorUpdateBreakpoints:e=>Y(e,"sourcecast"),handleExternalSelect:e=>D(e,"sourcecast"),handleFetchSourcecastIndex:()=>xr("sourcecast"),handleInterruptEval:()=>at("sourcecast"),handleReplEval:()=>X("sourcecast"),handleReplOutputClear:()=>U("sourcecast"),handleReplValueChange:e=>K(e,"sourcecast"),handleSetCurrentPlayerTime:e=>Mr(e,"sourcecast"),handleSetCodeDeltasToApply:e=>_r(e,"sourcecast"),handleSetEditorReadonly:e=>ae("sourcecast",e),handleSetInputToApply:e=>Dr(e,"sourcecast"),handleSetSourcecastData:(e,t,s,a)=>Lr(e,t,s,a,"sourcecast"),handleSetSourcecastDuration:e=>jr(e,"sourcecast"),handleSetSourcecastStatus:e=>Br(e,"sourcecast"),handleSideContentHeightChange:e=>M(e,"sourcecast"),handleToggleEditorAutorun:()=>L("sourcecast"),handleDebuggerPause:()=>it("sourcecast"),handleDebuggerResume:()=>ot("sourcecast"),handleDebuggerReset:()=>lt("sourcecast"),handlePromptAutocomplete:(e,t,s)=>de("sourcecast",e,t,s)},e))(Fp);class Xp extends v.Component{render(){const{item:e}=this.props,t=e.category!==zt.Mission||e.maxGrade<=0&&0===e.grade,s=e.maxXp<=0&&0===e.xp,a=v.createElement("div",{className:"grade-details"},v.createElement("div",{className:"title"},"Grade"),v.createElement("div",{className:"value"},e.grade," / ",e.maxGrade),v.createElement(Bt.ProgressBar,{animate:!1,className:"value-bar"+this.props.parseColour(this.props.getFrac(e.grade,e.maxGrade)),stripes:!1,value:this.props.getFrac(e.grade,e.maxGrade)})),n=v.createElement("div",{className:"xp-details"},v.createElement("div",{className:"title"},"XP"),v.createElement("div",{className:"value"},e.xp," / ",e.maxXp),v.createElement(Bt.ProgressBar,{animate:!1,className:"value-bar"+this.props.parseColour(this.props.getFrac(e.xp,e.maxXp)),stripes:!1,value:this.props.getFrac(e.xp,e.maxXp)}));return v.createElement(Ut.a,{className:"profile-summary-navlink",key:`${e.title}-${e.id}`,target:"_blank",to:`/academy/${Ls(e.category)}/${e.id}/0`,activeClassName:"profile-summary-navlink"},v.createElement(Bt.Callout,{className:"profile-summary-callout",key:`${e.title}-${e.id}`,icon:this.props.renderIcon(e.category),title:e.title},t?"":a,s?"":n))}}var Wp=Xp;class zp extends v.Component{componentDidMount(){this.props.name&&this.props.role&&!this.props.assessmentOverviews&&this.props.handleAssessmentOverviewFetch()}render(){let e;if(this.props.name&&this.props.role&&this.props.assessmentOverviews){const t=this.props.assessmentOverviews.filter(e=>e.status===Xt.submitted).length,s=v.createElement("div",{className:"profile-header"},v.createElement("div",{className:"profile-username"},v.createElement("div",{className:"name"},this.props.name),v.createElement("div",{className:"role"},this.props.role)));if(0===t)e=v.createElement("div",{className:"profile-content"},s,v.createElement("div",{className:"profile-placeholder"},"There are no closed assessments to render grade and XP of."));else{const[t,a,n,i]=this.props.assessmentOverviews.reduce((e,t)=>t.status===Xt.submitted?t.category===zt.Mission&&t.gradingStatus===Wt.graded?[e[0]+t.grade/t.maxGrade,e[1]+t.xp,e[2]+1,e[3]+t.maxXp]:[e[0],e[1]+t.xp,e[2],e[3]+t.maxXp]:e,[0,0,0,0]),r=(e,t)=>t<=0||e/t>1?1:e/t,o=e=>e<0?"":e>=.8?" progress-steelblue":e>=.45?" progress-deepskyblue":" progress-skyblue",l=e=>{switch(e){case zt.Mission:return Gt.a.FLAME;case zt.Sidequest:return Gt.a.LIGHTBULB;case zt.Path:return Gt.a.PREDICTIVE_ANALYSIS;case zt.Contest:return Gt.a.COMPARISON;default:return Gt.a.PULSE}},c=this.props.assessmentOverviews.filter(e=>e.status===Xt.submitted).map((e,t)=>v.createElement(Wp,{key:t,item:e,getFrac:r,parseColour:o,renderIcon:l}));e=v.createElement("div",{className:"profile-content"},s,v.createElement("div",{className:"profile-progress"},v.createElement("div",{className:"profile-grade"},v.createElement(Bt.Spinner,{className:"profile-spinner"+o(r(t,n)),size:144,value:r(t,n)}),v.createElement("div",{className:"type"},"Grade"),v.createElement("div",{className:"total-value"},t.toFixed(2)," / ",n.toFixed(2)),v.createElement("div",{className:"percentage"},(100*r(t,n)).toFixed(2),"%")),v.createElement("div",{className:"profile-xp"},v.createElement(Bt.Spinner,{className:"profile-spinner"+o(r(a,i)),size:144,value:r(a,i)}),v.createElement("div",{className:"type"},"XP"),v.createElement("div",{className:"total-value"},a," / ",i),v.createElement("div",{className:"percentage"},(100*r(a,i)).toFixed(2),"%"))),v.createElement("div",{className:"profile-callouts"},c))}}else e=v.createElement(Bt.NonIdealState,{description:"Loading...",icon:v.createElement(Bt.Spinner,null)});return v.createElement(Bt.Drawer,{className:"profile",icon:Gt.a.USER,isCloseButtonShown:!0,isOpen:this.props.isOpen,onClose:this.props.onClose,title:"User Profile",position:"left",size:"30%"},e)}}var Yp=zp;var $p=Object(C.c)(e=>({assessmentOverviews:e.session.assessmentOverviews,name:e.session.name,role:e.session.role}),e=>Object(O.b)({handleAssessmentOverviewFetch:ye},e))(Yp);var Kp=e=>v.createElement(Bt.Dialog,{className:"about",icon:Gt.a.HELP,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"About"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement("div",{className:"abt"},v.createElement("p",null,"The ",v.createElement("i",null,"Source Academy")," is a computer-mediated learning environment for studying the structure and interpretation of computer programs. Students write and run their programs in their web browser, using sublanguages of JavaScript called"," ",v.createElement("a",{href:We.sourceDocs},"Source"),", designed for the textbook"," ",v.createElement("a",{href:We.textbook},"Structure and Interpretation of Computer Programs, JavaScript Adaptation"),"."),v.createElement("p",null,"The Source Academy is available under the Apache License 2.0 at our GitHub organisation,"," ",v.createElement("a",{href:We.githubOrg},"Source Academy"),". The National University of Singapore uses the Source Academy for teaching Programming Methodology to freshmen Computer Science students in the course ",v.createElement("a",{href:We.moduleDetails},"CS1101S"),"."))));var Qp=e=>v.createElement(Bt.Dialog,{className:"help",icon:Gt.a.ERROR,isCloseButtonShown:!0,isOpen:e.isOpen,onClose:e.onClose,title:"Help"},v.createElement("div",{className:Bt.Classes.DIALOG_BODY},v.createElement("p",null,"Please use the following resources when you encounter issues with this system."),v.createElement("p",null,"As of August 2020, we recommend the browsers ",v.createElement("b",null,"Google Chrome")," or ",v.createElement("b",null,"Microsoft Edge"),", Version 83 or higher, or ",v.createElement("b",null,"Mozilla Firefox"),", Version 78 or higher, to visit the Source Academy. If you encounter issues with the Source Academy using these browsers, please use the following resources."),v.createElement("ul",null,v.createElement("li",null,"For critical technical issues that seriously affect your learning experience, email the Technical Services of the NUS School of Computing at"," ",v.createElement("a",{href:We.techSVC},We.techSVC)," or call ",We.techSVCNumber,"."),v.createElement("li",null,"For non-critical technical issues, such as enhancement suggestions, please use the issue system of the ",v.createElement("a",{href:We.githubIssues},"Source Academy repositories on GitHub"),"."),v.createElement("li",null,"For issues related to the content of missions, quests, paths and contests, use the respective forum at ",v.createElement("a",{href:We.piazza}," piazza"),", or approach your Avenger, Reflection instructor or lecturer."))));class Jp extends v.Component{constructor(e){super(e),this.toggleAboutOpen=()=>{this.setState({...this.state,isAboutOpen:!this.state.isAboutOpen})},this.toggleHelpOpen=()=>this.setState({...this.state,isHelpOpen:!this.state.isHelpOpen}),this.toggleProfileOpen=()=>this.setState({...this.state,isProfileOpen:!this.state.isProfileOpen}),this.state={isAboutOpen:!1,isHelpOpen:!1,isProfileOpen:!1}}render(){return v.createElement(v.Fragment,null,v.createElement(Bt.Popover,{content:this.menu(this.props),inheritDarkTheme:!1,position:Bt.Position.BOTTOM},ss("",Gt.a.CARET_DOWN)),v.createElement(Kp,{isOpen:this.state.isAboutOpen,onClose:this.toggleAboutOpen}),v.createElement(Qp,{isOpen:this.state.isHelpOpen,onClose:this.toggleHelpOpen}),this.props.name?v.createElement($p,{isOpen:this.state.isProfileOpen,onClose:this.toggleProfileOpen}):null)}menu(e){const t=this.props.name?v.createElement(Bt.MenuItem,{icon:Gt.a.USER,onClick:this.toggleProfileOpen,text:Zp(this.props.name)}):null,s=this.props.name?v.createElement(Bt.MenuItem,{icon:Gt.a.LOG_OUT,text:"Logout",onClick:this.props.handleLogOut}):null;return v.createElement(Bt.Menu,null,t,v.createElement(Bt.MenuItem,{icon:Gt.a.HELP,onClick:this.toggleAboutOpen,text:"About"}),v.createElement(Bt.MenuItem,{icon:Gt.a.ERROR,onClick:this.toggleHelpOpen,text:"Help"}),s)}}const Zp=e=>e.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase());var em=Jp;var tm=e=>v.createElement(Bt.Navbar,{className:qt()("NavigationBar","primary-navbar",Bt.Classes.DARK)},v.createElement(Bt.NavbarGroup,{align:Bt.Alignment.LEFT},!ze.playgroundOnly&&v.createElement(v.Fragment,null,v.createElement(Ut.a,{activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL),to:"/academy"},v.createElement(Bt.Icon,{icon:Gt.a.SYMBOL_DIAMOND}),v.createElement(Bt.NavbarHeading,{className:"hidden-xs hidden-sm"},"Source Academy"))," ",v.createElement(Ut.a,{activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL),to:"/sourcecast"},v.createElement(Bt.Icon,{icon:Gt.a.MUSIC}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},"Sourcecast"))),v.createElement(Ut.a,{activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL),to:"/playground"},v.createElement(Bt.Icon,{icon:Gt.a.CODE}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},ze.playgroundOnly?"Source Academy Playground":"Playground"))),v.createElement(Bt.NavbarGroup,{align:Bt.Alignment.RIGHT},v.createElement(Ut.a,{activeClassName:Bt.Classes.ACTIVE,className:qt()("NavigationBar__link",Bt.Classes.BUTTON,Bt.Classes.MINIMAL),to:"/contributors"},v.createElement(Bt.Icon,{icon:Gt.a.HEART}),v.createElement("div",{className:"navbar-button-text hidden-xs hidden-sm"},"Contributors")),v.createElement("div",{className:"visible-xs"},v.createElement(Bt.NavbarDivider,{className:"thin-divider"})),v.createElement("div",{className:"hidden-xs"},v.createElement(Bt.NavbarDivider,{className:"default-divider"})),v.createElement(em,{handleLogOut:e.handleLogOut,name:e.name}))),sm=s(455);function am(e){const t=Bo.parse(e);for(const[s,a]of Object.entries(t))Object(sm.isArray)(a)?t[s]=a.join(","):null===a&&delete t[s];return t}class nm extends v.Component{constructor(...e){super(...e),this.redirectToPlayground=()=>v.createElement(A.b,{to:"/playground"}),this.redirectToAcademy=()=>v.createElement(A.b,{to:"/academy"})}componentDidMount(){om(this.props)}render(){return v.createElement("div",{className:"Application"},v.createElement(tm,{handleLogOut:this.props.handleLogOut,role:this.props.role,name:this.props.name,title:this.props.title}),v.createElement("div",{className:"Application__main"},ze.playgroundOnly?v.createElement(A.e,null,v.createElement(A.c,{path:"/playground",component:jp}),v.createElement(A.c,{path:"/contributors",component:Zu}),v.createElement(A.c,{path:"/sourcecast",component:qp}),v.createElement(A.c,{exact:!0,path:"/",render:this.redirectToPlayground}),v.createElement(A.c,{component:cp})):v.createElement(A.e,null,v.createElement(A.c,{path:"/academy",component:im(this.props)}),v.createElement(A.c,{path:"/mission-control/:assessmentId(-?\\d+)?/:questionId(\\d+)?",render:lm}),v.createElement(A.c,{path:"/playground",component:jp}),v.createElement(A.c,{path:"/login",render:rm(this.props)}),v.createElement(A.c,{path:"/contributors",component:Zu}),v.createElement(A.c,{path:"/sourcecast",component:qp}),v.createElement(A.c,{exact:!0,path:"/",render:this.redirectToAcademy}),v.createElement(A.c,{component:cp}))))}}const im=e=>void 0===e.accessToken||void 0===e.role?()=>v.createElement(A.b,{to:"/login"}):()=>v.createElement(qu,{accessToken:e.accessToken,role:e.role}),rm=e=>()=>{const t=am(e.location.search);return v.createElement(ah,{code:t.code,providerId:t.provider,providers:[...ze.authProviders.entries()].map(([e,{name:t}])=>({id:e,name:t}))})},om=e=>{const t=cm(e),s=dm(e)||e.currentPlaygroundChapter,a=um(e,s)||e.currentPlaygroundVariant,n=hm(e)||e.currentExternalLibrary,i=pm(e);t&&(e.handleEditorValueChange(t),e.handleEnsureLibrariesLoaded(),e.handleClearContext(s,a,n),e.handleExternalLibrarySelect(n),e.handleSetExecTime(i))},lm=e=>v.createElement(lp,null),cm=e=>{const t=am(e.location.hash),s=void 0!==t.lz?t.lz:t.prgrm;return void 0!==s?Object(pe.decompressFromEncodedURIComponent)(s):void 0},dm=e=>js(am(e.location.hash).chap)||void 0,um=(e,t)=>{const s=am(e.location.hash).variant,a=wt.find(e=>e.chapter===t&&e.variant===s);return a?a.variant:"default"},hm=e=>{const t=am(e.location.hash).ext||"";return Object.values(gt).find(e=>e===t)||gt.NONE},pm=e=>{const t=am(e.location.hash).exec||"1000",s=js(t)||1e3;return""+(s<1e3?1e3:s)};var mm=nm;var gm=Object(A.h)(Object(C.c)(e=>({title:e.application.title,accessToken:e.session.accessToken,role:e.session.role,name:e.session.name,currentPlaygroundChapter:e.workspaces.playground.context.chapter,currentPlaygroundVariant:e.workspaces.playground.context.variant,currentExternalLibrary:e.workspaces.playground.externalLibrary}),e=>Object(O.b)({handleClearContext:(e,t,s)=>B({chapter:e,variant:t,external:{name:s,symbols:Ct.get(s)},globals:[]},"playground"),handleEditorValueChange:e=>z(e,"playground"),handlePromptAutocomplete:(e,t,s)=>de("playground",e,t,s),handleEditorUpdateBreakpoints:e=>Y(e,"playground"),handleEnsureLibrariesLoaded:F,handleLogOut:he,handleExternalLibrarySelect:e=>D(e,"playground"),handleSetExecTime:e=>R(e,"playground")},e))(mm));const ym=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Em(e,t){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const s=e.installing;null!=s&&(s.onstatechange=()=>{"installed"===s.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}ze.sentryDsn&&y.a({dsn:ze.sentryDsn});const bm=document.getElementById("root");window.__REDUX_STORE__=al,console.log(`%c Source Academy ${ze.sourceAcademyVersion}; Please visit ${We.githubIssues} to report bugs or issues.`,"font-weight: bold;"),Object(b.setBackendStaticURL)(ze.moduleBackendUrl),console.log("Using module backend: "+ze.moduleBackendUrl),Object(f.render)(v.createElement(C.a,{store:al},v.createElement(E.a,{history:xs},v.createElement(gm,null))),bm),function(e){if("serviceWorker"in navigator){if(new URL("/cadet-frontend",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const t="/cadet-frontend/service-worker.js";ym?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(s=>{const a=s.headers.get("content-type");404===s.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Em(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})):Em(t,e)})}}({onUpdate:()=>{Ms("A new version of Source Academy is available. Please refresh the browser.",0)}})},311:function(e,t,s){e.exports=s.p+"static/media/default_cover_image.6f45c87a.jpg"},884:function(e,t,s){e.exports=s(2424)},885:function(e,t,s){},922:function(e,t){},924:function(e,t){}},[[884,1,2]]]);
//# sourceMappingURL=main.7921364a.chunk.js.map